<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport"content="width=device-width"><title>チュートリアル - 実践編 - シューティングゲーム (5/11) - 自機を破壊する - Tonyu1 Wiki</title><meta name="twitter:card"content="summary"><meta property="og:url"content="https://makkii-bcr.github.io/Tonyu1-wiki/"><meta property="og:title"content="チュートリアル - 実践編 - シューティングゲーム (5/11) - 自機を破壊する - Tonyu1 Wiki"><meta property="og:description"content="Tonyu System 1 の新しいWikiページです。今後はこのWikiを更新していきます。"><meta property="og:image"content="https://makkii-bcr.github.io/Tonyu1-wiki/img/ogp-image.png"><link rel="shortcut icon"type="image/x-icon"href="img/tnu.ico"><style type="text/css">@charset "utf-8";body{-webkit-text-size-adjust:100%;font-size:14px;margin:0}h1{font-size:24px;margin:0;color:#080;padding:2px 0 2px 16px;line-height:120%}h2{font-size:18px;background:#b3ff8e;margin-bottom:0;border-left:#60d13f solid 10px;padding:3px 2px 3px 5px;line-height:120%}h3{font-size:15px;background:#d3ffbd;margin-bottom:12px;border-left:#8ee674 solid 5px;border-right:#8ee674 solid 1px;border-bottom:#8ee674 solid 1px;padding:2px 2px 1px 10px;line-height:120%}h4{font-size:14px;background:#dec;margin:8px 0 8px 0;border-left:#aca solid 4px;padding:3px 14px 2px 12px;line-height:120%}h5{margin:0;padding:0}.nav_pc>p{margin-top:2px;margin-bottom:2px}hr{background:#8b8;border-style:solid;border-color:#aca;border-width:1px 0}a:link{color:#080}a:active{color:#25c;background-color:#cde}a:visited{color:#0a0;background-color:inherit}a:hover{color:#0a0;background-color:#bea}.title_h{margin:0;background:#b3ff8e}.title_h>a{text-decoration:none;color:#080;background-color:#0000}.logo{vertical-align:middle;padding:0 16px 0 0}table{border-collapse:collapse;margin-top:6px;margin-bottom:6px}td{border:1px solid #ccc;padding:2px 5px 2px 5px}th{border:1px solid #ccc;padding:2px 5px 2px 5px}dt{font-weight:700}pre{display:table;border:solid;border-width:2px;border-color:#fdc;margin:8px 0 8px 0;padding:8px 16px 8px 8px;background-color:#fff8ee;font-size:13px}code{border:solid;border-width:0;border-color:#fdc;padding:2px 2px 2px 2px;background-color:#fff2e7;font-size:13px}pre>code{border:none;border-width:0;padding:0;background-color:#0000}.container{flex:1;display:flex;margin:0 8px 0 8px}.container_main{flex:1}.nav_mobile{display:none}.nav_pc{display:block;font-size:12px}aside{font-size:12px;margin:0 16px 0 0}main{flex:1}footer{font-size:12px;margin:0 8px 0 8px}@media screen and (max-width:600px){body{overflow:auto}.container{display:block}.nav_mobile{display:block;font-size:12px}.nav_pc{display:none}main{display:block}aside{display:none;font-size:12px;line-height:120%}}</style></head><body><header><h1 class="title_h"><img src="./img/tonyu-mini.png"class="logo"width="57"height="49"><a href="./">Tonyu System 1 - wiki</a></h1></header><div class="container"><aside><p>・<a href="./">Wikiトップ</a><br>・<a href="./about">Tonyu1とは</a><br>・<a href="./download">ダウンロード</a><br>・<a href="./tutorial">チュートリアル</a><br>・<a href="./reference">命令リファレンス</a></p><p>・<a href="https://www.tonyu.jp/">Tonyu公式HP</a><br>・<a href="https://www.tonyu.jp/project/top.cgi">プロジェクトボード</a><br>・<a href="http://www.tonyu.jp/joyful/joyful.cgi">Tonyu BBS</a></p><p>・<a href="http://hoge1e3.sakura.ne.jp/tonyu/wiki/">旧Wiki</a><br>・<a href="./ver118/html/Tonyu%20System.html">旧旧Wiki(ver1.18)</a></p><h3 id="更新履歴">更新履歴</h3><p><strong>2025-05-05</strong><br>・<a href="./download">ver1.303リリース</a></p><p><strong>2024-02-17</strong><br>・<a href="./download">ver1.303リリース</a></p><p><strong>2024-02-12</strong><br>・<a href="./download">ver1.302リリース</a><br>・<a href="./about2">Tonyuについて</a></p><p><strong>2024-02-08</strong><br>・<a href="./download">ver1.301リリース</a></p><p><strong>2022-08-05</strong><br>・<a href="./download">ver1.30リリース</a></p><p><strong><a href="./update-history">全ての更新履歴</a></strong></p></aside><div class="container_main"><nav style="color:#080"><div class="nav_pc"><p>[ <a href="./">Wikiトップ</a> ]　[ <a href="./reference">命令リファレンス</a> | <a href="./tutorial">チュートリアル</a> | <a href="./download">ダウンロード</a> ]　[ <a href="./all">全ページ</a> ]</p></div><div class="nav_mobile"><p>[ <a href="./">Wikiトップ</a> ]　[ <a href="./reference">命令リファレンス</a> | <a href="./tutorial">チュートリアル</a> | <a href="./download">ダウンロード</a> ]　[ <a href="./all">全ページ</a> | <a href="./update-history">更新履歴</a> ]　[ <a href="https://www.tonyu.jp/">Tonyu公式HP</a> | <a href="https://www.tonyu.jp/project/top.cgi">プロジェクトボード</a> | <a href="http://www.tonyu.jp/joyful/joyful.cgi">Tonyu BBS</a> ]　[ <a href="http://hoge1e3.sakura.ne.jp/tonyu/wiki/">旧Wiki</a> | <a href="./ver118/html/Tonyu%20System.html">旧旧Wiki(ver1.18)</a> ]</p></div></nav><hr><main><div style="display:block"id="tr-stg05"class="pagediv"title2="チュートリアル - 実践編 - シューティングゲーム (5/11) - 自機を破壊する - Tonyu1 Wiki"><p><a href="./tr-stg04">←前</a>&emsp;<a href="./tr-stg06">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---シューティングゲーム-511">チュートリアル - 実践編 - シューティングゲーム (5/11)</h3><h2 id="自機を破壊する">自機を破壊する</h2><h3 id="敵と自機がぶつかったら、自機が死ぬ">敵と自機がぶつかったら、自機が死ぬ</h3><p>敵を作りましたが、このままでは弾があたっても、自機がぶつかっても何もおきません。<br>まず、敵が自機にあたると自機が破壊されるようにしましょう</p><p>敵オブジェクトをダブルクリックして、次の行を追加します</p><pre>
extends SpriteChar;
while (y<$screenHeight) {
  y=y+2;
  <span style="color:red">if (crashTo($MyChar)) $MyChar.die();</span>
  update();
}
</pre><p>まずifの条件部から見ていきましょう</p><pre><code>if (crashTo($MyChar)) ...
</code></pre><p><a href="./rf-plainchar#plaincharcrashto">crashTo</a>は、この敵が自機($MyChar)に当たっているかという判定を行います。 当たっている場合はif文の後ろが実行されます。<br>なお、自機の名前は、自機をクリックし、オブジェクトインスペクタで確認できます。</p><p><img src="./img/mycharname.png"width="273"height="149"alt="mycharname.png"></p><p>ぶつかった場合の処理は次のようになります</p><pre><code>... $MyChar.die();
</code></pre><p>これによって自機が死にます。</p><p>xx.<a href="./rf-plainchar#plainchardie">die</a>();は、xxで表されるオブジェクトを殺す命令で、殺されたオブジェクトはただちに処理が止まり、画面上からいなくなります。</p><p>それでは実行してみましょう。敵が自機にふれると、自機が消えてしまいました。</p><h3 id="爆発パターンを作る">爆発パターンを作る</h3><p>しかし、いきなり消えるのはあっけないので、爆発するアニメーションをつけてみましょう。</p><p>新規オブジェクトを作成します。</p><p><img src="./img/mkbomb.png"width="394"height="402"alt="mkbomb.png"></p><p>キャラクタパターンを、爆発パターンの一番先頭のパターンにします。</p><p><img src="./img/mkbombp.png"width="579"height="256"alt="mkbombp.png"></p><p>ダブルクリックして、動作を次のように書きます</p><pre><code>extends SpriteChar;
wait(5);
p=p+1;
wait(5);
p=p+1;
wait(5);
p=p+1;
wait(5);
</code></pre><p>新しくwait(5);という命令が出てきました。これはupdate();に似ています。</p><h4 id="書式">書式</h4><pre><code>wait(待機フレーム数);
</code></pre><p>これを行うことにより待機フレーム(コマ)数で指定しただけオブジェクトの動作が止まります。<br>ここでは5フレーム(5コマ)待機します。</p><p>その後、変数pの値を１増やしています。変数pは、このオブジェクトのキャラクタパターンを表します。<br>つまり、pを1増やすことにより、キャラクタパターンが次のように変化していきます</p><p><img src="./img/bpats.png"width="505"height="62"alt="bpats.png"></p><p>実行してみると、爆発しているようなアニメーションを見ることができます。</p><h3 id="爆発パターンを出現させる">爆発パターンを出現させる</h3><p>爆発パターンを、自機が死んだときに発生させるようにしましょう。<br>自機オブジェクトをダブルクリックして、次のように変更します</p><pre>
extends SpriteChar;

<span style="color:red">function onDie() {
  appear(new Bomb($MyChar.x , $MyChar.y ,$pat_Sample+4));
}</span>

while(1) {
  if (getkey(39)>0 && x<$screenWidth ) x=x+3;
  if (getkey(37)>0 && x>0) x=x-3;
  if (getkey(32)==1) appear(new Tama(x,y,$pat_Sample+1));
  update();
}
</pre><p><a href="./tr-stg04">敵を出現させる</a>で出てきたメソッドを使いました。<br>しかし、先ほどと違ってこの <a href="./rf-plainchar#plaincharondie">onDie</a>というメソッドはプログラム中から呼ばれていません。</p><p>実はこの onDieという名前をつけたメソッドは特別な意味を持ち、そのオブジェクトが死んだときに行わせる処理を記述できます。<br>実際には、敵のオブジェクトが$MyChar.die(); を呼んだときに、自動的にこの onDieメソッドが呼ばれます。</p><p>onDieメソッドの中では、次の処理によって爆発オブジェクトを出現させています。</p><pre><code> appear(new Bomb($MyChar.x , $MyChar.y ,$pat_Sample+4));
</code></pre><p><a href="./rf-object#objectappear">appear</a>の使い方をもう一度復習しておきましょう</p><ul><li><strong>Bomb</strong>は、出現させたいオブジェクトのクラスです。</li><li><strong>$MyChar.x</strong> , <strong>$MyChar.y</strong> は、オブジェクトの出現する座標です。</li><li><strong>$pat_Sample+4</strong>は、オブジェクトのキャラクタパターンを指定します。ここでは<img src="./img/bomp.png"width="33"height="33"alt="bomp.png">です。</li></ul><p><strong>$MyChar.x</strong>は、「$MyChar<strong>の</strong>x」と解釈できます。<br>このように、オブジェクトに続いてドット(.)と変数名書くと、そのオブジェクトが持っている変数を参照することができます。<br>ここでは、自機のいる場所に爆発を出現させるのにこの参照を用いています。</p><hr><p><a href="./tr-stg04">←前</a>&emsp;<a href="./tr-stg06">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-stg04"class="pagediv"title2="チュートリアル - 実践編 - シューティングゲーム (4/11) - 敵を出現させる - Tonyu1 Wiki"><p><a href="./tr-stg03">←前</a>&emsp;<a href="./tr-stg05">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---シューティングゲーム-411">チュートリアル - 実践編 - シューティングゲーム (4/11)</h3><h2 id="敵を出現させる">敵を出現させる</h2><h3 id="ufoを作る">UFOを作る</h3><p>この敵はすぐ下に消えてしまうので、次々と新しいオブジェクトを出現させる仕組みを作ります。</p><p>ここでは、UFOを作り、UFOから敵があらわれるという設定にします。 <a href="./tr-basic02">オブジェクトを作る</a>を参考にUFOのオブジェクトを作成します</p><p><img src-t="./img/mkufo.png"width="394"height="402"alt="mkufo.png"></p><p>キャラクタパターンを設定します。</p><p><img src-t="./img/mkufop.png"width="578"height="256"alt="mkufop.png"></p><p>ダブルクリックして次のように動きを記述します。</p><pre><code>extends SpriteChar;
while(1) {
  while(x&lt;$screenWidth) {
    x=x+2;
    update();
  }
  while(x&gt;0) {
    x=x-2;
    update();
  }
}
</code></pre><p>実行させると、UFOが画面を横方向に往復します。</p><h3 id="ufoから敵が出現する">UFOから敵が出現する</h3><p>さらに、このUFOから敵が出現するようにします。</p><pre>
extends SpriteChar;
while(1) {
  while(x<$screenWidth) {
    x=x+2;
    <span style="color:red">if (rnd(100)==0) appear(new Enemy(x,y,$pat_Sample+2));</span>
    update();
  }
  while(x>0) {
    x=x-2;
    update();
  }
}
</pre><p>追加した部分について解説します。</p><pre><code> if (rnd(100)==0) ..
</code></pre><p><a href="./rf-object#objectrnd">rnd</a>(100)は、0から99までの整数乱数を返します。その値が0のとき、つまり100分の１の確率でifの後ろが実行されます。</p><pre><code> .. appear(new Enemy(x,y,$pat_Sample+2));
</code></pre><p>これによって、敵クラス(Enemy)のオブジェクトが作成されます。 出現場所はUFOのいる場所、キャラクタパターンは $pat_Sample+2 です (<a href="./tr-stg02">弾を撃つ</a>参考)</p><p>上の処理では、左から右に移動しているときしか敵が出現しません。 右から左に移動中にもこの処理を挿入する必要があります。</p><pre>
extends SpriteChar;
while(1) {
  while(x<$screenWidth) {
    x=x+2;
    if (rnd(100)==0) appear(new Enemy(x,y,$pat_Sample+2));
    update();
  }
   
  <span style="color:red">while(x>0) {
    x=x-2;
    if (rnd(100)==0) appear(new Enemy(x,y,$pat_Sample+2));
    update();
  }</span>
}
</pre><h3 id="メソッドを定義する">メソッドを定義する</h3><p>このプログラムでは敵を出現させるために、全く同じ処理を２箇所に書いたことになります。<br>これでもプログラムは正しく動くのですが、いくつか不便な点があります。<br>例えば出現確率を変えたいとか、敵のキャラクタパターンを変えたいとかいったときに、両方書き換える必要があります。</p><p>そこで、この敵出現処理をまとめることを行います。</p><pre>
extends SpriteChar;

<span style="color:red">function appearEnemy() {
  if (rnd(100)==0) appear(new Enemy(x,y,$pat_Sample+2));
}</span>

while(1) {
  while(x<$screenWidth) {
    x=x+2;
    <span style="color:red">appearEnemy();</span>
    update();
  }
  while(x>0) {
    x=x-2;
    <span style="color:red">appearEnemy();</span>
    update();
  }
}
</pre><p>まず、一番上に書いた部分について解説します。</p><pre><code>function appearEnemy() {
  if (rnd(100)==0) appear(new Enemy(x,y,$pat_Sample+2));
}
</code></pre><p>これは<a href="./rf-method-define">メソッド</a>と呼ばれ、ある処理に名前をつけて何度も使えるようにしたものです。<br>ここでは、1/100の確率で敵を出現させる処理に appearEnemyという名前（メソッド名）をつけています。<br>この部分は、最初にいきなり実行されるわけではなく、あとからこのメソッドを呼び出すことによって実行されます。</p><p>その呼び出しを行うのが、下のほうに書いた</p><pre><code>appearEnemy();
</code></pre><p>です。このように</p><h4 id="書式メソッドの呼び出し">書式メソッドの呼び出し</h4><pre><code>メソッド名();
</code></pre><p>と書くことで、いつでもメソッドを呼ぶことができます。</p><p>試しに、敵の出現確率を1/50に変えてみましょう。それにはappearEnemyの一箇所を書き換えればよいのです。<br>このようにメソッドを使って、よく使う処理をまとめておくと、後で修正が楽になります。</p><pre>
extends SpriteChar;
function appearEnemy() {
  if (rnd(<span style="color:red">50</span>)==0) appear(new Enemy(x,y,$pat_Sample+2));
}
while(1) {
  while(x<$screenWidth) {
    x=x+2;
    appearEnemy();
    update();
  }
  while(x>0) {
    x=x-2;
    appearEnemy();
    update();
  }
}
</pre><hr><p><a href="./tr-stg03">←前</a>&emsp;<a href="./tr-stg05">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-stg03"class="pagediv"title2="チュートリアル - 実践編 - シューティングゲーム (3/11) - 敵を動かす - Tonyu1 Wiki"><p><a href="./tr-stg02">←前</a>&emsp;<a href="./tr-stg04">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---シューティングゲーム-311">チュートリアル - 実践編 - シューティングゲーム (3/11)</h3><h2 id="敵を動かす">敵を動かす</h2><p>今度は敵を作ってみましょう。<a href="./tr-basic02">オブジェクトを作る</a>を参考にオブジェクトを作成します</p><p><img src-t="./img/new-enemy.png"width="394"height="402"alt="new-enemy.png"></p><p>キャラクタパターンを指定します</p><p><img src-t="./img/sel-e-pat.png"width="445"height="405"alt="sel-e-pat.png"></p><p>とりあえず、上から下に飛んでくる動きにしてみましょう。敵をダブルクリックして次のように入力します。</p><pre><code>extends SpriteChar;
while (y&lt;$screenHeight) {
  y=y+2;
  update();
}
</code></pre><hr><p><a href="./tr-stg02">←前</a>&emsp;<a href="./tr-stg04">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-stg02"class="pagediv"title2="チュートリアル - 実践編 - シューティングゲーム (2/11) - 弾を撃つ - Tonyu1 Wiki"><p><a href="./tr-stg01">←前</a>&emsp;<a href="./tr-stg03">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---シューティングゲーム-211">チュートリアル - 実践編 - シューティングゲーム (2/11)</h3><h2 id="弾を撃つ">弾を撃つ</h2><h3 id="弾を作る">弾を作る</h3><p><a href="./tr-basic02">オブジェクトを作る</a>を参考に弾のオブジェクトを作ります。</p><p><img src-t="./img/new-tama.png"width="394"height="402"alt="new-tama.png"></p><p><a href="./tr-basic06">オブジェクトのキャラクタパターンを指定する</a>を参考に、弾のパターンを指定します</p><p><img src-t="./img/tamapat.png"width="443"height="340"alt="tamapat.png"></p><p>弾をダブルクリックし、次のように入力します。</p><pre><code>extends SpriteChar;
while(y&gt;0) {
  y=y-8;
  update();
}
</code></pre><p>実行すると、弾が上に飛んでいくのが見えます。 よく見えなかった場合、F2で止めて、弾をドラッグして下の方にもっていくと見やすいでしょう。</p><h3 id="スペースキーを押すと弾が出る">スペースキーを押すと弾が出る</h3><p>しかし実際には弾は自機から発射するものです。 スペースキーを押すと自機から弾が出るようにしましょう。</p><p>自機をダブルクリックし、次のように変更します</p><pre>
extends SpriteChar;
while(1) {
  if (getkey(39)>0 && x<$screenWidth) x=x+3;
  if (getkey(37)>0 && x>0) x=x-3;
  <span style="color:red">if (getkey(32)==1) appear(new Tama(x,y,$pat_Sample+1));</span>
  update();
}
</pre><p>まず前半部(if文の条件)から解説します</p><pre><code>if (getkey(32)==1) ...
</code></pre><p>これは、<a href="./tr-stg01">自機を動かす</a>でも出てきましたが、キーの状態を判定します 32はスペースキーを表す番号です。<br>スペースキーが押された瞬間だけ if文のあとの処理を行います(押しっぱなしでは弾が撃てません)</p><p>そして、スペースキーがおされていた場合の、弾を撃つ処理です</p><pre><code>... appear(new Tama(x,y,$pat_Sample+1));
</code></pre><p>これは、新しいオブジェクトを作るときの決まり文句で、次のような パラメータを指定します。</p><h4 id="書式">書式</h4><pre><code>appear(new クラス名 ( x座標 , y座標 ,キャラクタパターン ))
</code></pre><p>クラス名には、作成したいオブジェクトのクラス名を指定します。<br>...といっても、クラスの話は少し難しいので、ここでは次の手順でクラス名を決めてください。</p><p>まず、今は弾を出したいのですから、とりあえず画面上の弾をクリックします。</p><p>すると、オブジェクトインスペクタに弾の内容が表示されますが、「クラス名」という欄に注目してください。<br>ここに「Tama」とかいてあります。これが弾のクラス名になります</p><p><img src-t="./img/tamaclass.png"width="300"height="203"alt="tamaclass.png"></p><h3 id="x座標--y座標">x座標 , y座標</h3><p>作成するオブジェクトの位置を指定します。ここでは、自機から発射されるので、自機のx,y座標をそのまま使います</p><h3 id="キャラクタパターン">キャラクタパターン</h3><p>作成するオブジェクトのキャラクタパターンを指定します。<br>キャラクタパターンを指定するには、下図のように、キャラクタパターンウィンドウからキャラクタパターンを選ぶと、ステータスバーのところにキャラクタパターンの値が表示されます。<br>この値（$pat_Sample+1）をパラメータとして記述します。<br>同時に、この値がクリップボードにコピーされます。</p><p><img src-t="./img/sel-tama-p.png"width="406"height="203"alt="sel-tama-p.png"></p><p>さて、これで実行させてみましょう。スペースキーを押すと弾が発射されるようになりました。</p><hr><p><a href="./tr-stg01">←前</a>&emsp;<a href="./tr-stg03">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-stg01"class="pagediv"title2="チュートリアル - 実践編 - シューティングゲーム (1/11) - 自機を動かす - Tonyu1 Wiki"><p><a href="./tutorial">←目次</a>&emsp;<a href="./tr-stg02">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---シューティングゲーム-111">チュートリアル - 実践編 - シューティングゲーム (1/11)</h3><h2 id="自機を動かす">自機を動かす</h2><p>まず、「ファイル」＞「メインメニュー」で最初の画面に戻ってください。</p><p><img src-t="./img/return-main.png"width="268"height="272"alt="return-main.png"></p><p><a href="./tr-basic01">新規プロジェクト</a>を参考に新規ページを作成してください。</p><h3 id="自機を作る">自機を作る</h3><p>自機を作ってみましょう。<a href="./tr-basic02">オブジェクトを作る</a>を参考にオブジェクトを作成します</p><p><img src-t="./img/mkmychar.png"width="394"height="402"alt="mkmychar.png"></p><p><a href="./tr-basic06">オブジェクトのキャラクタパターンを指定する</a>を参考に、自機のパターンを指定します。<br>先ほど用いた&quot;Projects&quot;フォルダの下のSample.bmpを使います</p><p><img src-t="./img/sel-patmy.png"width="449"height="400"alt="sel-patmy.png"></p><h3 id="自機の動きを定義する">自機の動きを定義する</h3><p>自機をダブルクリックし、次のように入力します。</p><pre><code>extends SpriteChar;
while(1) {
  if (getkey(39)&gt;0) x=x+3;
  if (getkey(37)&gt;0) x=x-3;
  update();
}
</code></pre><p>自機の位置は画面下のほうがよいので、ドラッグして移動しておきます。 実行してみましょう。カーソルキーの右と左で自機を動かせます。</p><p>まず</p><pre><code>while(1) {...
</code></pre><p>について解説します。<br>whileは()内の条件が成り立っている間、次の{}内を実行するものですが、条件のところに 1と書いてあります。<br>1というのは「いつでも成り立つ」といった意味があります。<br>つまりwhile(1)と書くと、その後ろの処理を永久に行うことになります。(参考：<a href="./rf-while">while</a>)</p><p>次に、その永久に繰り返される処理の内容を解説していきます。</p><p>getkey(x)は、キーが押されているかどうかの判定を行います。<br>xは調べたいキーの番号で 39がカーソルキーの右, 37が左です</p><p>getkey(x)はキーの状態によって、次のような値を表します</p><ul><li>0:押されていない</li><li>1:今押されたばかり</li><li>2以上:押しっぱなしになっている</li></ul><p>※ 他のキーの状態を調べたい場合は<a href="./rf-object#objectgetkey">getkey</a>を参照してください</p><p>以上をふまえて、移動の仕組みをまとめると、次のようになります。</p><pre><code>  if (getkey(39)&gt;0)   x=x+3;
     ↑右がおされたら ↑右に移動
  if (getkey(37)&gt;0)   x=x-3;
     ↑左がおされたら ↑左に移動
</code></pre><h3 id="画面はみだし判定"><span id="screenout">画面はみだし判定</span></h3><p>ところで、このままだと右端や左端にはみだしてもそのまま画面外を移動できてしまうので、次のように変更します</p><pre>
extends SpriteChar;
while(1) {
  if (getkey(39)&gt;0 <span style="color:red">&& x&lt;$screenWidth</span>) x=x+3;
  if (getkey(37)&gt;0 <span style="color:red">&& x&gt;0</span>) x=x-3;
  update();
}
</pre><p>このように &amp;&amp; で条件をつなげると「～かつ～ならば」という記述ができます。</p><pre><code>  if (getkey(39)&gt;0 &amp;&amp; x&lt;$screenWidth)                  x=x+3;
     ↑右がおされて ↑かつ、画面右端に到達してないなら ↑右に移動
  if (getkey(37)&gt;0 &amp;&amp; x&gt;0)                             x=x-3;
     ↑左がおされて ↑かつ、画面左端に到達してないなら ↑左に移動
</code></pre><hr><p><a href="./tutorial">←目次</a>&emsp;<a href="./tr-stg02">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-maze07"class="pagediv"title2="チュートリアル - 実践編 - 迷路ゲーム (7/7) - 配布する - Tonyu1 Wiki"><p><a href="./tr-maze06">←前</a>&emsp;<a href="./tutorial">目次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---迷路ゲーム-77">チュートリアル - 実践編 - 迷路ゲーム (7/7)</h3><h2 id="配布する">配布する</h2><p>これでゲームは一通り完成です。 このゲームを配布したいとします。<br>他の人にTonyuをダウンロードさせるのは大変なので、単体で動くプログラム（ランタイム）を作成しましょう。</p><p>ファイル＞ランタイム作成を選びます。</p><p><img src-t="./img/rumenu.png"width="290"height="275"alt="rumenu.png"></p><p>「メインページ」を $page_startにします。<br>これにより、最初にタイトルページが開くようになります。</p><p>タイトル、作者等の情報を入れます。</p><p>「ネットランキング管理者パスワード」は空欄にしてください。</p><p>「配布条件」について説明します。</p><p>このランタイムには、今までつくったプログラムのソースファイルがそのまま含まれます。<br>このため、他のユーザが簡単にプログラムの中身を書き換えることができます。<br>内容を書き換えたゲーム（または今あなたがつくったゲームそのもの）を、他の人が勝手に配っていいかを決めるのが配布条件です</p><ul><li><strong>再配布、改造ともに無断で許可</strong><br>プログラムの中身を変えようと変えまいと、他の人が勝手に配ってよいという、いちばん緩い条件です</li><li><strong>内容を変更しない再配布を無断で許可、改造は不可</strong><br>プログラムの中身を変えなければ、勝手に配ってよいという条件です</li><li><strong>再配布、改造は要連絡</strong><br>他の人が配布したい場合、作者への連絡が必要、という条件です。この場合メールアドレス等、あなたの連絡先を書いてください。</li><li><strong>再配布、改造は不可</strong><br>勝手に配るな、といういちばんきつい条件です。</li><li><strong>その他</strong><br>どれにもあてはまらない場合は、条件を自分で書くことができます。</li></ul><p>最後に、ランタイムを作成するディレクトリを選び、OKを押します。</p><p><img src-t="./img/rumenu3.png"width="765"height="349"alt="rumenu3.png"></p><p>ランタイム作成が完了したら、「OK」を選んでフォルダを開いてみます</p><p><img src-t="./img/rfold.png"width="674"height="296"alt="rfold.png"></p><p>このフォルダのTonyuRun.exeを実行すれば、作ったゲームが実行できます。<br>このフォルダを圧縮ツール等でまとめたものを配布してください。</p><hr><p><a href="./tr-maze06">←前</a>&emsp;<a href="./tutorial">目次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-maze06"class="pagediv"title2="チュートリアル - 実践編 - 迷路ゲーム (6/7) - 次の面に移る - Tonyu1 Wiki"><p><a href="./tr-maze05">←前</a>&emsp;<a href="./tr-maze07">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---迷路ゲーム-67">チュートリアル - 実践編 - 迷路ゲーム (6/7)</h3><h2 id="次の面に移る">次の面に移る</h2><p>敵をすべて倒すと、次の面に移る処理を行いましょう。</p><h3 id="2面を作る">2面を作る</h3><p>といっても、今のところゲーム画面が１つしかないので もう１つ面をつくることにしましょう。<br>今までのゲーム画面を１面、これから新しく作る面を２面とします。</p><p>まず１面のページを開きます。 そして「ファイル」の「名前をつけて保存」を選びます。</p><p><img src-t="./img/saveasmenu.png"width="215"height="219"alt="saveasmenu.png"></p><p>ここでは<strong>stage2.cmml</strong>という名前で保存します。</p><p><img src-t="./img/saveas.png"width="505"height="244"alt="saveas.png"></p><p>これで、１面の内容が２面にコピーされました。<br>今は２面が開いているので、２面のパターンを作ってみましょう<br>敵の数をふやしたり、はしごの配置をかえたり、いろいろ変更をくわえてみてください。</p><h3 id="1面をクリアしたら、2面を開始する処理を作る">1面をクリアしたら、2面を開始する処理を作る</h3><p>さらに、1面をクリアしたらこの2面が始まるようにしましょう<br>プロジェクトマネージャを開き、再び１面を開きます。</p><p><img src-t="./img/1men.png"width="314"height="270"alt="1men.png"></p><p>まず、クリアしたかどうかの判定を行いましょう<br>クリアしたら２面に移動するという動作を行うオブジェクトを作ります。</p><p><a href="./tr-basic02">オブジェクトを作る</a>を参考にオブジェクトを作成します。ここでは <strong>$stage1</strong> という名前にします。</p><p>さらに、「オブジェクトの種類」を「シークレット」にします。<br>このオブジェクトは、クリアしたかどうかの判定だけを行うので、実行中は表示する必要がありません。<br>「シークレット」にすると実行中に表示されないオブジェクトになります。</p><p><img src-t="./img/mk-stage1.png"width="402"height="289"alt="mk-stage1.png"></p><p>オブジェクトをダブルクリックし、次のように入力します。</p><pre>
extends SecretChar;
enemyLives=1;
while (enemyLives==1) {
  enemyLives=0;
  for (e in $chars) {
    if (e is Enemy) enemyLives=1;
  }
  update();
}
$projectManager.loadPage( <b>$page_stage2</b> );
</pre><p><strong>$page_stage2</strong>の部分は、２面のページの名前です。<br>これはプロジェクトマネージャで確認して、もし違う名前だったらその名前にしてください。</p><p>実行してみると、敵が全滅すると２面が開始します。</p><p>ここで、 $stage1オブジェクトの動作を説明します。</p><p>まず、敵が全滅するまでは、この部分を実行します:</p><pre><code>enemyLives=1;
while (enemyLives==1) {
  enemyLives=0;
  for (e in $chars) {
    if (e is Enemy) enemyLives=1;
  }
  update();
}
</code></pre><p><a href="./rf-while">while</a>文の働きにより、enemyLivesが１のときは次の部分(while文の中)を実行します。</p><pre><code>  enemyLives=0;
  for (e in $chars) {
    if (e is Enemy) enemyLives=1;
  }
  update();
</code></pre><p>↑この処理は、enemyLivesが０になるまで繰り返します。</p><p>enemyLivesは</p><pre><code>  enemyLives=0;
</code></pre><p>によって、一旦０になりますが</p><pre><code>  for (e in $chars) {
    if (e is Enemy) enemyLives=1;
  }
</code></pre><p>によって、画面内に敵が１つでもいる場合、１になります</p><p>結果として、敵がまったくいなくなると、enemyLivesが０になり、while文以降の処理に以降します。</p><p>while文以降の処理では、２面を読み込みます。</p><pre><code> $projectManager.loadPage($page_stage2);
</code></pre><h2 id="2面をクリアしたときの処理を追加する">2面をクリアしたときの処理を追加する</h2><p>今回は簡単のため、２面クリアしたら終わりにして、タイトルに戻るようにしましょう。</p><p>まず２面を読み込みます</p><p><a href="./tr-basic02">オブジェクトを作る</a>を参考にオブジェクトを作成します。<br>ここでは <strong>$stage2</strong> という名前にします。<br>また、先ほどと同じく、「シークレット」を選択します。</p><p><img src-t="./img/mk-stage2.png"width="401"height="286"alt="mk-stage2.png"></p><p>オブジェクトをダブルクリックし、次のように入力します。</p><pre>
extends SecretChar;
enemyLives=1;
while (enemyLives==1) {
  enemyLives=0;
  for (e in $chars) {
    if (e is Enemy) enemyLives=1;
  }
  update();
}
$projectManager.loadPage( <b>$page_start</b> );
</pre><p><strong>$page_start</strong>の部分は、スタート画面のページの名前です。<br>これはプロジェクトマネージャで確認して、もし違う名前だったらその名前にしてください。</p><hr><p><a href="./tr-maze05">←前</a>&emsp;<a href="./tr-maze07">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-maze05"class="pagediv"title2="チュートリアル - 実践編 - 迷路ゲーム (5/7) - スタート画面を作る - Tonyu1 Wiki"><p><a href="./tr-maze04">←前</a>&emsp;<a href="./tr-maze06">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---迷路ゲーム-57">チュートリアル - 実践編 - 迷路ゲーム (5/7)</h3><h2 id="スタート画面を作る">スタート画面を作る</h2><p>ゲーム開始前のスタート画面を作ってみましょう</p><p>まずスタート画面用の新規ページを作ります。<br>メニューの「ファイル」＞「プロジェクトに新規ページを追加」を選びます。</p><p><img src-t="./img/npage-menu.png"width="212"height="252"alt="npage-menu.png"></p><p><img src-t="./img/new-title.png"width="447"height="409"alt="new-title.png"></p><p>ゲーム画面のファイルがあるディレクトリと同じディレクトリに、 start.cmmlというファイル名のページを作成します。</p><p>ここでは単に&quot;Press Space Key&quot;と表示させ、スペースキーの入力が あったらゲーム画面に移動しましょう</p><h3 id="press-space-key-という文字を表示する">Press Space Key という文字を表示する</h3><p><a href="./tr-basic02">オブジェクトを作る</a>を参考にオブジェクトを作成します ただし、「オブジェクトの種類」に「テキスト」を選択してください。</p><p><img src-t="./img/press-space.png"width="403"height="286"alt="press-space.png"></p><p>オブジェクトクリックし、オブジェクトインスペクタでtextの値を編集します。</p><p><img src-t="./img/press-spc-text.png"width="348"height="101"alt="press-spc-text.png"></p><p>オブジェクトをダブルクリックし、次のように入力します。</p><pre><code>extends TextChar;
while(1) {
  update();
}
</code></pre><p>実行させると、画面に<strong>Press Space Key</strong>と出ます。</p><h3 id="ページを変える">ページを変える</h3><p>さらに、スペースキーを押すと先ほどのゲーム画面に移動するようにします。</p><p>まず少し準備が要ります。ツールメインウィンドウの<img src-t="./img/prj-man.png"width="16"height="16"alt="prj-man.png">を選んでください。<br>すると、このように <strong>$page_index</strong>、 <strong>$page_start</strong> といった２つの項目が現れます。<br>これは、このゲームが使用するページの一覧です</p><p><img src-t="./img/toolprj.png"width="329"height="339"alt="toolprj.png"></p><p>ここでは、</p><ul><li>スタート画面のページを$page_start</li><li>ゲーム画面のページを$page_index</li></ul><p>としてすすめていきます。</p><p>先ほどPress Space Keyを表示させるオブジェクトをダブルクリックし、次のように変更します。</p><pre>
extends TextChar;
while(1) {
  <span style="color:red">if (getkey(32)>0) $projectManager.loadPage($page_index);</span>
  update();
}
</pre><p>実行させてみましょう。<br>スペースキーをおすと、先ほどのゲーム画面に移動します。<br>プログラムを停止させ、もう一度プロジェクトマネージャを開いてください。<br>&quot;$page_start&quot;の欄をダブルクリックして、スタート画面に移動してください。</p><p><img src-t="./img/sel-start.png"width="314"height="270"alt="sel-start.png"></p><p>さきほどのプログラムの解説です。</p><pre><code>if (getkey(32)&gt;0)
</code></pre><p>この部分は、<a href="./tr-maze02">自機を動かす</a>で説明したように、キーボードの入力を判定します。<br>32はスペースキーを表します。<br>スペースキーが押されると、次の部分を実行します。</p><pre><code>$projectManager.loadPage($page_index);
</code></pre><p>これは、他のページを読み込む命令で、次のような使い方をします</p><h4 id="書式">書式</h4><pre>
<a href="./rf-projectmanager#projectmanagerloadpage">$projectManager.loadPage</a>(ページ名);
</pre><p>ページ名は、さきほどプロジェクトマネージャで確認したページの名前です。</p><p><img src-t="./img/toolprj.png"width="329"height="339"alt="toolprj.png"></p><h3 id="自機が死んだらスタート画面に戻る">自機が死んだらスタート画面に戻る</h3><p>先ほどのページを読み込む命令を使って、自機が死んだらスタート画面に戻るようにしましょう</p><p>プロジェクトマネージャを開いてください。<br>&quot;$page_index&quot;の欄をダブルクリックして、ゲーム画面に移動してください。</p><p><img src-t="./img/selindex.png"width="314"height="270"alt="selindex.png"></p><p>敵をダブルクリックし、次のように変更します。</p><pre>
extends SpriteChar;
vx=2;
while(1) {
  x+=vx;
  if (x&lt;0) vx=2; if (x&gt;$screenWidth) vx=-2; if (rnd(500)==0) vx=-vx;
  if (crashTo($MyChar)) {
  //↑敵と自機がぶつかったときに
    if ((vx&gt;0 && $MyChar.x&lt;x) || (vx&lt;0 && $MyChar.x&gt;x)) {
    //↑敵が右方向、自機が左　または 敵が左方向、自機が右
      die();
      //↑ならば、敵が死ぬ
    } else {
      $MyChar.die();
      //↑そうでなければ自機が死ぬ」
      <span style="color:red">$projectManager.loadPage($page_start);</span>
    }
  }
  if (vx&lt;0) f=1; else f=0;
  update();
}
</pre><p>これにより、自機が死ぬとスタート画面($page_start)が読み込まれます。</p><hr><p><a href="./tr-maze04">←前</a>&emsp;<a href="./tr-maze06">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-maze04"class="pagediv"title2="チュートリアル - 実践編 - 迷路ゲーム (4/7) - 自機や敵を破壊する - Tonyu1 Wiki"><p><a href="./tr-maze03">←前</a>&emsp;<a href="./tr-maze05">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---迷路ゲーム-47">チュートリアル - 実践編 - 迷路ゲーム (4/7)</h3><h2 id="自機や敵を破壊する">自機や敵を破壊する</h2><p>このゲームでは、敵をやっつける方法が少々変わっていて 「敵の背後から体当たりする」という方法を使います</p><p><img src-t="./img/how2kill.png"width="271"height="117"alt="how2kill.png"></p><h3 id="敵と自機がぶつかったら、自機が死ぬ">敵と自機がぶつかったら、自機が死ぬ</h3><p>とりあえず、敵にぶつかったら自機が死ぬようにしましょう</p><p>敵オブジェクトをダブルクリックして、次の行を追加します</p><pre>
extends SpriteChar;
vx=2;
while(1) {
  x+=vx;
  if (x<0) vx=2;
  if (x>$screenWidth) vx=-2;
  if (rnd(500)==0) vx=-vx;
  <span style="color:red">if (crashTo($MyChar)) $MyChar.die();</span>
  if (vx<0) f=1; else f=0;
  update();
}
</pre><p>まずifの条件部から見ていきましょう</p><pre><code> if (crashTo($MyChar)) ...
</code></pre><p>crashToは、この敵が自機($MyChar)に当たっているかという判定を行います。<br>当たっている場合はif文の後ろが実行されます。</p><p>なお、自機の名前は、自機をクリックし、オブジェクトインスペクタで確認できます。</p><h2 id="敵と自機がぶつかったら、敵が死ぬ"><span id="crashdie">敵と自機がぶつかったら、敵が死ぬ</span></h2><p>このままだと必ず自機が死ぬので、自機が敵の背後からぶつかった場合には、<br>敵のほうが死ぬようにしましょう。</p><p>　ところで「背後からぶつかる」というのをもう少し詳しく説明すると</p><p>　「敵の進行方向と<strong>反対側</strong>から自機がぶつかる」</p><p>ということになります、もうすこし具体的にいうと</p><p>　「敵が<strong>右</strong>(左)に進んでいるとき、自機が<strong>左</strong>(右)からぶつかる」</p><p>となります。</p><p>さらに、「自機が左(右)からぶつかる」は、いいかえると</p><p>「敵と自機がぶつかったとき、自機が敵より左(右)にいる」</p><p>となります。</p><p>　これらのことをまとめると</p><p>「敵と自機がぶつかったときに、<br>　　敵が右に進んでいて、自機が左にいる　または<br>　　敵が左に進んでいて、自機が右にいる<br>　　ならば、敵が死ぬ。そうでなければ自機が死ぬ」<br>という条件を記述すればよさそうです。 これらを踏まえて、プログラムは次のようになります。</p><pre>
extends SpriteChar;
vx=2;
while(1) {
  x+=vx;
  if (x<0) vx=2; if (x>$screenWidth) vx=-2; if (rnd(500)==0) vx=-vx;
  <span style="color:red">if (crashTo($MyChar)) {
  //↑敵と自機がぶつかったときに
    if ((vx>0 && $MyChar.x&lt;x) || (vx&lt;0 && $MyChar.x&gt;x)) {
    //↑敵が右方向、自機が左　または 敵が左方向、自機が右
      die();
      //↑ならば、敵が死ぬ
    } else {
      $MyChar.die();
      //↑そうでなければ自機が死ぬ」
    }
  }</span>
  if (vx&lt;0) f=1; else f=0;
  update();
}
</pre><hr><p><a href="./tr-maze03">←前</a>&emsp;<a href="./tr-maze05">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-maze03"class="pagediv"title2="チュートリアル - 実践編 - 迷路ゲーム (3/7) - 敵を動かす - Tonyu1 Wiki"><p><a href="./tr-maze02">←前</a>&emsp;<a href="./tr-maze04">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---迷路ゲーム-37">チュートリアル - 実践編 - 迷路ゲーム (3/7)</h3><h2 id="敵を動かす">敵を動かす</h2><p>敵を作ってみましょう 敵は次にあげるようなごく単純な動きしかしないものとします</p><ul><li>左右移動しかしない</li><li>画面端にくるか、一定の確率で移動方向が反転する</li></ul><h3 id="敵を作る">敵を作る</h3><p><a href="./tr-basic02">オブジェクトを作る</a>を参考にオブジェクトを作成します</p><p><img src-t="./img/new-enemy.png"width="394"height="402"alt="new-enemy.png"></p><p><a href="./tr-basic06">オブジェクトのキャラクタパターンを指定する</a>を参考に、自機のパターンを指定します。<br>先ほど用いたSamplesの下のMaze.bmpを使います</p><p><img src-t="./img/selenemy.png"width="576"height="243"alt="selenemy.png"></p><h3 id="敵の動きを定義する">敵の動きを定義する</h3><p>敵をダブルクリックし、次のように入力します。</p><pre><code>extends SpriteChar;
vx=2;
while(1) {
  x+=vx;
  if (x&lt;0) vx=2; 
  if (x&gt;$screenWidth) vx=-2;
  if (rnd(500)==0) vx=-vx;
  update();
}
</code></pre><p>実行してみましょう。<br>左に進んでいるとき、向きが反対になっています。<br>そこで、次のような部分を追加してください</p><pre>
extends SpriteChar;
vx=2;
while(1) {
  x+=vx;
  if (x&lt;0) vx=2;
  if (x&gt;$screenWidth) vx=-2;
  if (rnd(500)==0) vx=-vx;
  <span style="color:red">if (vx&lt;0) f=1; else f=0;</span>
  update();
}
</pre><p>変数fは、0以外の値を設定すると、パターンが左右反転します。</p><h3 id="敵をたくさん配置する">敵をたくさん配置する</h3><p>敵が１匹ではおもしろくないので、敵をたくさん配置してみましょう。<br>まず敵をクリックし、そのあとメニューの 「オブジェクト」＞「コピー」を選んでください<br>さらに、 「オブジェクト」＞「貼り付け」を選んでください<br>敵がふえました。 この要領で敵をいくつか配置してみてください。</p><hr><p><a href="./tr-maze02">←前</a>&emsp;<a href="./tr-maze04">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-maze02"class="pagediv"title2="チュートリアル - 実践編 - 迷路ゲーム (2/7) - 自機を動かす - Tonyu1 Wiki"><p><a href="./tr-maze01">←前</a>&emsp;<a href="./tr-maze03">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---迷路ゲーム-27">チュートリアル - 実践編 - 迷路ゲーム (2/7)</h3><h2 id="自機を動かす">自機を動かす</h2><h3 id="自機を作る">自機を作る</h3><p>自機を作ってみましょう。<a href="./tr-basic02">オブジェクトを作る</a>を参考にオブジェクトを作成します</p><p><img src-t="./img/mkmychar.png"width="394"height="402"alt="mkmychar.png"></p><p><a href="./tr-basic06">オブジェクトのキャラクタパターンを指定する</a>を参考に、自機のパターンを指定します。<br>先ほど用いたSamplesの下のMaze.bmpを使います</p><p><img src-t="./img/sel-patmy-m.png"width="580"height="254"alt="sel-patmy-m.png"></p><h3 id="自機の動きを定義する">自機の動きを定義する</h3><p>自機をダブルクリックし、次のように入力します。</p><pre><code>extends SpriteChar;
while(1) {
  if (getkey(39)&gt;0) x+=3;
  if (getkey(37)&gt;0) x-=3;
  update();
}
</code></pre><p>実行してみましょう。カーソルキーの右と左で自機を動かせます。</p><h3 id="下に落ちる">下に落ちる</h3><p>しかし、これだと自機が空中に浮いています。<br>下に落ちる処理を付け加えて見ましょう。</p><pre><code>extends SpriteChar;
while(1) {
  if (getkey(39)&gt;0) x+=3;
  if (getkey(37)&gt;0) x-=3;
  y+=3;
  update();
}
</code></pre><p>これで実行すると、自機はどんどん下におちていきます。</p><h3 id="床やはしごの判定を加える">床やはしごの判定を加える</h3><p>今度は、ずっと落ちっぱなしですね。<br>床やはしごにあたったら止まるようにしないといけません。</p><pre>
extends SpriteChar;
while(1) {
  if (getkey(39)&gt;0) x+=3;
  if (getkey(37)&gt;0) x-=3;
  <span style="color:red">if ($map.getAt(x,y)==$pat_Maze+1) y+=3;</span>
  update();
}
</pre><p>ここで新しく<a href="./rf-map#mapgetat">$map.getAt</a>(x,y)という命令がでてきますが、これは</p><p>「(x,y)地点にあるマップのキャラクタパターンを返す」</p><p>という働きがあります</p><p>(x,y)とは自分のいる地点ですから、<br>自分が床でもはしごでもない場所（紺色の空間）にいる場合だけ落ちるようにすればよいのです。</p><h3 id="めり込みを修正する">めり込みを修正する</h3><p>さて、実行させてみると、確かに床で止まるのですが、<br>ちょっとめりこんだ格好になっています。</p><p>この仕組みを説明しましょう。次の図をみてください。</p><p><img src-t="./img/merikomi.png"width="424"height="274"alt="merikomi.png"></p><p>これで、すこしめりこんだ理由はわかったでしょうか<br>めりこまないようにするには、もう少し下の点で判定をすればよいのです。</p><p><img src-t="./img/merikomi2.png"width="227"height="238"alt="merikomi2.png"></p><pre>
extends SpriteChar;
while(1) {
  if (getkey(39)&gt;0) x+=3;
  if (getkey(37)&gt;0) x-=3;
  if ($map.getAt(x,y<span style="color:red">+16</span>)==$pat_Maze+1) y+=3;
  update();
}
</pre><p>さて、これでうごかしてみましょう。 まだ足りないものがあります。<br>はしごを使っての上下移動ができません。</p><p>そこで、自分がはしごの上にいたら上下キーで移動できるようにしましょう</p><pre>
extends SpriteChar;
while(1) {
  if (getkey(39)&gt;0) x+=3; 
  if (getkey(37)&gt;0) x-=3;
  if ($map.getAt(x,y+16)==$pat_Maze+1) y+=3;
  <span style="color:red">if ($map.getAt(x,y)==$pat_maze+2) {
     if (getkey(40)&gt;0) y+=3;
     if (getkey(38)&gt;0) y-=3;
  }</span>
  update();
}
</pre><p>追加した部分の解説をします。</p><pre><code> if ($map.getAt(x,y)==$pat_maze+2) {
</code></pre><p>↑ここは、自分のいる場所にはしご（キャラクタパターン番号：$pat_maze+2)があるかどうかの判定です</p><p>はしごがある場合はif文の中の処理を行います</p><pre><code>if (getkey(40)&gt;0) y+=3;   
if (getkey(38)&gt;0) y-=3;
</code></pre><p>↑それぞれ、上や下がおされたら上または下に移動します。</p><p>実行させてみましょう。<br>とりあえずはしごを使って上下移動ができるようですが...<br>ずっと下を押していたら、壁にめりこんでしまいました。</p><p><img src-t="./img/merikomi3.png"width="179"height="125"alt="merikomi3.png"></p><p>プログラムをもう一度みてみましょう</p><pre><code>extends SpriteChar;
while(1) {
  if (getkey(39)&gt;0) x+=3;
  if (getkey(37)&gt;0) x-=3;
  if ($map.getAt(x,y+16)==$pat_Maze+1) y+=3;
  if ($map.getAt(x,y)==$pat_maze+2) {
    if (getkey(40)&gt;0) y+=3;
    if (getkey(38)&gt;0) y-=3; 
  }
  update();
}
</code></pre><p>下を押したら、下に移動するという処理は</p><pre><code> if (getkey(40)&gt;0) y+=3;
</code></pre><p>でやっていますが、 ここに「下のほうに壁があったらとまる」という 判定を加えたほうがよさそうです。<br>逆にいえば「下が押されていて、かつ下に壁がなかったら、下に移動できる」と書けばよいのです。<br>先ほどの</p><pre><code> if ($map.getAt(x,y+16)==$pat_Maze+1) y+=3;
</code></pre><p>という処理は 「下になにもない空間があった場合、下に移動する（落ちる）」 という処理でした。<br>これにならって、次のようにかきなおします</p><pre>
extends SpriteChar;
 while(1) {
  if (getkey(39)&gt;0) x+=3;
  if (getkey(37)&gt;0) x-=3;
  if ($map.getAt(x,y+16)==$pat_Maze+1) y+=3;
  if ($map.getAt(x,y)==$pat_maze+2) {
    if (getkey(40)&gt;0 <span style="color:red">&& $map.getAt(x,y+16)!=$pat_Maze+0</span>) y+=3; 
    if (getkey(38)&gt;0) y-=3;
  }
  update();
}
</pre><p>実行させてみましょう。自機の動きはひとまず完成です。</p><hr><p><a href="./tr-maze01">←前</a>&emsp;<a href="./tr-maze03">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-maze01"class="pagediv"title2="チュートリアル - 実践編 - 迷路ゲーム (1/7) - マップを描く - Tonyu1 Wiki"><p><a href="./tutorial">←目次</a>&emsp;<a href="./tr-maze02">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---迷路ゲーム-17">チュートリアル - 実践編 - 迷路ゲーム (1/7)</h3><h2 id="マップを描く">マップを描く</h2><p>今回作るゲームは、下の図のように横からみた4階建ての建物のなかを主人公が移動し、<br>画面上の敵をすべて退治するものです。</p><p><img src-t="./img/maze-game.png"width="566"height="429"alt="maze-game.png"></p><p>まず、「ファイル」＞「メインメニュー」で最初の画面に戻ってください。</p><p><img src-t="./img/return-main.png"width="268"height="272"alt="return-main.png"></p><p>迷路ゲーム用の新規プロジェクトを作ります。 <a href="./tr-basic01">新規プロジェクトを作る</a>を参考にしてください。</p><p><img src-t="./img/newmaze.png"width="447"height="409"alt="newmaze.png"></p><p>まず迷路用のマップを描きましょう メニューの「ウィンドウ」から「マップ作成」を選びます。</p><p><img src-t="./img/new-map-menu.png"width="415"height="202"alt="new-map-menu.png"></p><p>次のように値を入力し、OKを押します</p><p><img src-t="./img/new-map.png"width="228"height="193"alt="new-map.png"></p><p>ツールウィンドウの <img src-t="./img/paticon.png"width="16"height="16"alt="paticon.png"> をクリックし、キャラクタパターンウィンドウを表示します。</p><p><img src-t="./img/selmazebmp.png"width="388"height="316"alt="selmazebmp.png"></p><p>「追加」をクリックし、&quot;Projects&quot;フォルダのmaze.bmpを選びます。</p><p><img src-t="./img/selmazebmp3.png"width="453"height="293"alt="selmazebmp3.png"></p><p>追加された欄をダブルクリックします。このなかで、左から２番目のの紺色のパターンをクリックします</p><p><img src-t="./img/selnavy.png"width="466"height="369"alt="selnavy.png"></p><p>さらに、ツールウィンドウの左端のリストから&quot;Bold&quot;を選びます。<br>メインウィンドウ上でのマウスカーソルがペンの形になります。</p><p><img src-t="./img/sel-bold.png"width="325"height="110"alt="sel-bold.png"></p><p>とりあえず画面中をこの紺色のパターンでぬりつぶしましょう。<br>メインウィンドウ上で左ボタンを押しながらドラッグすると、パターンが塗られます。</p><p><img src-t="./img/draw-map.png"width="566"height="417"alt="draw-map.png"></p><p>次に、ツールウィンドウで&quot;Fine&quot;を選択します。</p><p><img src-t="./img/sel-fine.png"width="320"height="97"alt="sel-fine.png"></p><p>キャラクタパターンウィンドウで、左端のブロックのパターンを選びます</p><p><img src-t="./img/sel-block.png"width="306"height="187"alt="sel-block.png"></p><p>次の図のようにマップを描きます</p><p><img src-t="./img/mainscr1.png"width="566"height="417"alt="mainscr1.png"></p><p>同様に、３番目のはしごのパターンを選び、次のようにマップを描きます<br>※右クリックでマウスと重なっているマップのパターンを拾えます。</p><p><img src-t="./img/mainscr2.png"width="566"height="417"alt="mainscr2.png"></p><p>マップを描き終わったら、ツールウィンドウで&quot;Object&quot;を選んでおきましょう</p><p><img src-t="./img/sel-obj.png"width="321"height="98"alt="sel-obj.png"></p><hr><p><a href="./tutorial">←目次</a>&emsp;<a href="./tr-maze02">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-basic99"class="pagediv"title2="チュートリアル - 基礎編 (付録) - キャラクタパターン用ビットマップの作り方 - Tonyu1 Wiki"><p><a href="./tr-basic09">←前</a>&emsp;<a href="./tutorial">目次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---基礎編-付録">チュートリアル - 基礎編 (付録)</h3><h2 id="キャラクタパターン用ビットマップの作り方">キャラクタパターン用ビットマップの作り方</h2><p>Tonyuに読み込むキャラクタパターンは、bmpファイルまたはpngファイルから読み込みます。<br>その際、bmp/png画像は次の規則に従って描画してください。</p><p>まず、全体を同じ色で塗ります。これがこの画像全体の「背景色」になります</p><p><img src-t="./img/init-bmp.png"width="217"height="99"alt="trans.png"></p><p>キャラクタパターンを描画するには、まず描画したい矩形領域全体を同じ色で塗ります。<br>これがこのパターンの「透過色」になります。左上の1ドットは背景色を残して下さい。</p><p><img src-t="./img/trans.png"width="217"height="99"alt="trans.png"></p><p>この領域にキャラクタパターンを描くのですが、周囲1ドットは透過色以外を塗らないでください。</p><p><img src-t="./img/how2bmp.png"width="343"height="340"alt="how2bmp.png"></p><p>同様に他のパターンを描きます。このとき、パターン同士が隣接しないようにしてください。</p><p><img src-t="./img/how3bmp.png"width="217"height="99"alt="how3bmp.png"></p><p>※ここで書いた方式に従っていない画像を読み込むと、次のようにパターンの切り分けに失敗した場所に×が点滅します。<br>&emsp;この場合は全体を1枚のパターンとみなします。</p><p><img src-t="./img/fail-ana.png"width="406"height="203"alt="fail-ana.png"></p><hr><p><a href="./tr-basic09">←前</a>&emsp;<a href="./tutorial">目次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-basic09"class="pagediv"title2="チュートリアル - 基礎編 (9/9) - オブジェクトを追いかけるオブジェクト - Tonyu1 Wiki"><p><a href="./tr-basic08">←前</a>&emsp;<a href="./tr-basic99">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---基礎編-99">チュートリアル - 基礎編 (9/9)</h3><h2 id="オブジェクトを追いかけるオブジェクト">オブジェクトを追いかけるオブジェクト</h2><p><a href="./tr-basic08">カーソルキーで動くオブジェクト</a> で作成したオブジェクトを追いかけるオブジェクトを作ってみます。</p><p>まず、<a href="./tr-basic08">カーソルキーで動くオブジェクト</a> で作成したオブジェクトをクリックしてください。<br>オブジェクトインスペクタで、このオブジェクトの名前を確認します。<br>下の図では $Cursorという名前になっています。</p><p><img src-t="./img/click-cursor.png"width="379"height="204"alt="click-cursor.png"></p><p>新しくオブジェクトを作成します</p><p><img src-t="./img/create-chaser.png"width="394"height="402"alt="create-chaser.png"></p><p>新しいオブジェクトをダブルクリックし、次のように入力します。</p><pre><code>extends SpriteChar;

while(1) {
  if (x &lt; $Cursor.x) x+=2;
  if (x &gt; $Cursor.x) x-=2;
  if (y &lt; $Cursor.y) y+=2;
  if (y &gt; $Cursor.y) y-=2;
  update();
}
</code></pre><p>$Cursorの部分は、先ほど確認した<a href="./tr-basic08">カーソルキーで動くオブジェクト</a>で作成したオブジェクトの名前にしてください。<br>実行させると、新しくつくったオブジェクトは、カーソルキーで動かせるオブジェクトのいる方にちかづいてきます。</p><p>プログラムの説明をします。</p><pre><code>if (x &lt; $Cursor.x) x+=2;
</code></pre><p>ここででてくる $Cursor.xの読み方は「オブジェクト$Cursorのxの値」、つまり、カーソルキーでうごかせるオブジェクト( $Cursor )のx座標です。</p><p>if文の条件は</p><p>「自分のx座標が $Cursorのx座標より小さければ 」</p><p>つまり</p><p>「自分が$Cursorより左にいれば」</p><p>となります。</p><p>さらに、その条件が成り立った場合はxを増やします。つまり右に移動します。 よって</p><p>「自分が$Cursorより左にいれば、右方向にうごく」 ということになります。 次の３行も同様に<br>「自分が$Cursorより右にいれば、左方向にうごく」<br>「自分が$Cursorより上にいれば、下方向にうごく」<br>「自分が$Cursorより下にいれば、上方向にうごく」 ということを表します。</p><hr><p><a href="./tr-basic08">←前</a>&emsp;<a href="./tr-basic99">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-basic08"class="pagediv"title2="チュートリアル - 基礎編 (8/9) - カーソルキーで動くオブジェクト - Tonyu1 Wiki"><p><a href="./tr-basic07">←前</a>&emsp;<a href="./tr-basic09">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---基礎編-89">チュートリアル - 基礎編 (8/9)</h3><h2 id="カーソルキーで動くオブジェクト">カーソルキーで動くオブジェクト</h2><p>基礎編のまとめとして、典型的なオブジェクトを２つほど作ってみます。まずカーソルキーを使って動かせるオブジェクトです。</p><p><a href="./tr-basic02">オブジェクトを作る</a>を参考に、新しいオブジェクトを作成します</p><p><img src-t="./img/class3.png"width="394"height="402"alt="class3.png"></p><p>オブジェクトをダブルクリックし、次のように入力します。</p><pre><code>extends SpriteChar;

while(1) {
  if (getkey(39)&gt;0) x+=3;
  if (getkey(37)&gt;0) x-=3;
  if (getkey(40)&gt;0) y+=3;
  if (getkey(38)&gt;0) y-=3;
  update();
}
</code></pre><p>新しくgetkeyというものがでてきましたが、 これはキー入力を判定するのに用います。</p><p>getkey(x)は、キーが押されているかどうかの判定を行います。<br>xは調べたいキーの番号で<br>39がカーソルキーの右, 37が左です<br>38がカーソルキーの上, 40が下です</p><p>getkey(x)はキーの状態によって、次のような値を表します:</p><ul><li>0:押されていない</li><li>1:今押されたばかり</li><li>2以上:押しっぱなしになっている</li></ul><p>※他のキーの状態を調べたい場合は<a href="./rf-object#objectgetkey">getkey</a>を参照してください。 getkeyの部分は次のようにいいかえられます</p><pre><code>if (右がおされた) 右に3だけ移動;
if (左がおされた) 左に3だけ移動;
if (下がおされた) 下に3だけ移動;
if (上がおされた) 上に3だけ移動;
</code></pre><p>実行してみましょう。カーソルキーをつかって動かせます。</p><hr><p><a href="./tr-basic07">←前</a>&emsp;<a href="./tr-basic09">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-basic07"class="pagediv"title2="チュートリアル - 基礎編 (7/9) - オブジェクトいろいろ - Tonyu1 Wiki"><p><a href="./tr-basic06">←前</a>&emsp;<a href="./tr-basic08">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---基礎編-79">チュートリアル - 基礎編 (7/9)</h3><h2 id="オブジェクトいろいろ">オブジェクトいろいろ</h2><p>オブジェクト作成時に、オブジェクトの種類を指定すると、いろいろなオブジェクトを作ることができます</p><h3 id="dxスプライト">DXスプライト</h3><p>半透明、回転拡大縮小ができるオブジェクトです</p><p>メニューの「オブジェクト」→「新規」を選び、次の操作をしてみましょう</p><ol><li><p>クラス名を入力</p></li><li><p>「DXスプライト」をクリック</p></li><li><p>「OK」をクリック</p></li></ol><p><img src-t="./img/create-dx.png"width="394"height="402"alt="create-dx.png"></p><p>オブジェクトが表示されました</p><p>オブジェクトインスペクタで、次の値を変更してみましょう</p><ul><li><strong>angle</strong><br>オブジェクトの回転角度を指定します。単位は度です</li><li><strong>alpha</strong><br>オブジェクトの透明度を指定します。値は0から255の範囲で、値が小さいほど透けて見えます</li><li><strong>scaleX</strong><br>オブジェクトの大きさを指定します。もとの大きさは1です</li></ul><p>例：</p><p><img src-t="./img/ex-dx.png"width="374"height="287"alt="ex-dx.png"></p><h3 id="テキスト">テキスト</h3><p>文字を表示するオブジェクトです</p><p>メニューの「オブジェクト」→「新規」を選び、次の操作をしてみましょう</p><ol><li><p>クラス名を入力</p></li><li><p>「テキスト」をクリック</p></li><li><p>「OK」をクリック</p></li></ol><p><img src-t="./img/create-text.png"width="394"height="402"alt="create-text.png"></p><p>オブジェクトが表示されました</p><p>オブジェクトインスペクタで、次の値を変更してみましょう</p><ul><li><strong>text</strong><br>表示する文字列を指定します。</li></ul><p>注意：textはかならず文字列を&quot;(ダブルクォート)で囲んでください。</p><p><img src-t="./img/goodbad.png"width="807"height="270"alt="goodbad.png"></p><ul><li><p><strong>size</strong><br>テキストの大きさを指定します。</p></li><li><p><strong>col</strong><br>テキストの色を指定します。色は次のいずれかを選びます</p><table><tr><td><span style="color:#000">■</span></td><td>$clBlack</td><td><span style="color:red">■</span></td><td>$clRed</td><td><span style="color:#0f0">■</span></td><td>$clGreen</td><td><span style="color:#00f">■</span></td><td>$clBlue</td></tr><tr><td><span style="color:#fff">■</span></td><td>$clWhite</td><td><span style="color:#ff0">■</span></td><td>$clYellow</td><td><span style="color:#0ff">■</span></td><td>$clAqua</td><td><span style="color:#f0f">■</span></td><td>$clPink</td></tr></table></li><li><p><strong>font</strong><br>テキストのフォントを指定します。</p></li></ul><p>例：</p><p><img src-t="./img/ex-text.png"width="345"height="247"alt="ex-text.png"></p><hr><p><a href="./tr-basic06">←前</a>&emsp;<a href="./tr-basic08">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-basic06"class="pagediv"title2="チュートリアル - 基礎編 (6/9) - オブジェクトのキャラクタパターンを指定する - Tonyu1 Wiki"><p><a href="./tr-basic05">←前</a>&emsp;<a href="./tr-basic07">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---基礎編-69">チュートリアル - 基礎編 (6/9)</h3><h2 id="オブジェクトのキャラクタパターンを指定する">オブジェクトのキャラクタパターンを指定する</h2><p>今まではオブジェクトのグラフィックに緑色の四角を使用していましたが、別のグラフィックを表示する方法を示します。<br>まずページにグラフィックスを読み込む必要があります。左上の「ツールウィンドウから左端のボタンを押します。</p><p><img src-t="./img/disp-char.png"width="334"height="55"alt="disp-char.png"></p><p>追加をクリックします。</p><p><img src-t="./img/redadd.png"width="373"height="266"alt="redadd.png"></p><p>一階層上のフォルダに移動し、&quot;Sample.bmp&quot;を選択します。</p><p><img src-t="./img/bmpdialog.png"width="611"height="299"alt="bmpdialog.png"> <img src-t="./img/bmpdialog2.png"width="611"height="299"alt="bmpdialog2.png"></p><p>このページからSample.bmpが使用できる状態になりました。 キャラクタパターンを変えたいオブジェクトをクリックします。</p><p><img src-t="./img/selch.png"width="144"height="203"alt="selch.png"></p><p>オブジェクトインスペクタで、変数pの欄をクリックします。</p><p><img src-t="./img/selp.png"width="223"height="265"alt="selp.png"></p><p>キャラクタパターンウィンドウの、Sample.bmpの欄をダブルクリックします。</p><p><img src-t="./img/redadd2.png"width="373"height="266"alt="redadd2.png"></p><p>キャラクタをクリックして選択します。キャラクタパターンの値が表示されるとともに、オブジェクトインスペクタ上でpの値が変化します。</p><p><img src-t="./img/pchnglast.png"width="542"height="275"alt="pchnglast.png"></p><p>実行させると、選択したキャラクタパターンのオブジェクトが動きます。</p><p>※キャラクタパターンを独自に作成する場合、<a href="./tr-basic99">キャラクタパターン用ビットマップの作り方</a>に書いてある方法に基づいてパターンを作成してください</p><hr><p><a href="./tr-basic05">←前</a>&emsp;<a href="./tr-basic07">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-basic05"class="pagediv"title2="チュートリアル - 基礎編 (5/9) - オブジェクトをコピーする - Tonyu1 Wiki"><p><a href="./tr-basic04">←前</a>&emsp;<a href="./tr-basic06">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---基礎編-59">チュートリアル - 基礎編 (5/9)</h3><h2 id="オブジェクトをコピーする">オブジェクトをコピーする</h2><p>すでに画面上にあるオブジェクトと同じ動きをするオブジェクトを作ることができます。</p><p>コピーしたいオブジェクトをクリックし、メニューの「オブジェクト」→「コピー」を選択します</p><p><img src-t="./img/copy-obj.png"width="275"height="198"alt="copy-obj.png"></p><p>メニューの「オブジェクト」→「貼り付け」を選択します。 新しいオブジェクトが現れます。</p><p><img src-t="./img/pasted.png"width="116"height="202"alt="pasted.png"></p><p>実行すると、貼り付けられたオブジェクトもコピー元のオブジェクトと同じ動作をします。</p><hr><p><a href="./tr-basic04">←前</a>&emsp;<a href="./tr-basic06">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-basic04"class="pagediv"title2="チュートリアル - 基礎編 (4/9) - オブジェクトを動かす2 - Tonyu1 Wiki"><p><a href="./tr-basic03">←前</a>&emsp;<a href="./tr-basic05">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---基礎編-49">チュートリアル - 基礎編 (4/9)</h3><h2 id="オブジェクトを動かす2">オブジェクトを動かす2</h2><p>先ほど書いたプログラムについて解説します。</p><pre><code>1: extends SpriteChar;
2: 
3: while(x&lt;$screenWidth) {
4:   x+=1;
5:   update();
6: }
</code></pre><ul><li>1行目は「おまじない」だと思ってとりあえず無視してください。</li><li>3行目は「自分のx座標が画面右端の座標($screenWidth)より小さい（$screenWidthより左側である）間、{}で囲まれた処理（4,5行目)を実行しなさい」という意味になります(参考：<a href="./rf-while">while文</a>)</li><li>4行目は、x座標を1増加、つまり右に１ドット分移動します</li><li>5行目は、画面のかきかえを行います(参考：<a href="./rf-plainchar#plaincharupdate">updateメソッド</a>)</li></ul><p>もう少し複雑な動きをするオブジェクトを作ってみましょう</p><p><a href="./tr-basic02">オブジェクトを作る</a>を参考に、新しいオブジェクトを作成します</p><p><img src-t="./img/class2.png"width="394"height="402"alt="class2.png"></p><p>新しいオブジェクトをダブルクリックして、次のように入力します(先頭のextends SpriteChar;は自動的に入力されているので新たに入力する必要はありません)</p><pre><code>extends SpriteChar;

while(x&lt;$screenWidth) {
  y+=vy;
  vy+=0.1;
  if (y&gt;$screenHeight) {y=$screenHeight; vy=-vy;}
  x+=1;
  update();
}
</code></pre><p>実行してみましょう。オブジェクトが跳ねながら右に移動する様子が見えたと 思います。</p><p>さっきと違うのは、この３行が追加されたところです</p><pre><code>4: y+=vy;
5: vy+=0.1;
6: if (y&gt;$screenHeight) {y=$screenHeight; vy=-vy;}
</code></pre><ul><li>4行目は、自分のy座標をvyだけ加算します。つまりvyはyの速度をあらわします</li><li>5行目は、vyに0.1を加えます。yの速度に0.1を加えるので、0.1はyの加速度（重力）をあらわします。</li><li>6行目は、跳ね返りの処理です。まず、</li></ul><pre><code>if (y&gt;$screenHeight) ...
</code></pre><p>これは、もし( if )yが画面下端の座標($screenHeight)より大きくなったら、つまり yが画面下端より下になったら、その後ろの<b>{</b>と<b>}</b>で囲まれた部分を実行しなさい という意味です。</p><p>　そして、その<b>{</b>と<b>}</b>で囲まれた部分</p><pre><code> ... {y=$screenHeight; vy=-vy;}
</code></pre><p>これは、yを$screenHeightにして、下にはみ出ないようにします。 さらにvyの符号を反転(=移動方向のy成分を反転)します。</p><p>この「もし～なら～する」という記述は<a href="./rf-if">if文</a>と呼ばれ、今後もよく出てくるので覚えておいてください</p><h4 id="書式">書式</h4><pre><code>if (条件) 処理
</code></pre><p>条件に書いた式が真であるときだけ処理を行います</p><hr><p><a href="./tr-basic03">←前</a>&emsp;<a href="./tr-basic05">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-basic03"class="pagediv"title2="チュートリアル - 基礎編 (3/9) - オブジェクトを動かす - Tonyu1 Wiki"><p><a href="./tr-basic02">←前</a>&emsp;<a href="./tr-basic04">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---基礎編-39">チュートリアル - 基礎編 (3/9)</h3><h2 id="オブジェクトを動かす">オブジェクトを動かす</h2><p>作成したオブジェクトをダブルクリックします。 エディタが開きます。</p><p><img src-t="./img/open-ed.png"width="340"height="213"alt="open-ed.png"></p><p>ここでは、右方向に移動するという動きを定義してみます。エディタに次のように入力します。</p><pre><code>extends SpriteChar;

while(x&lt;$screenWidth) {
  x+=1;
  update();
}
</code></pre><p><img src-t="./img/prog1.png"width="258"height="191"alt="prog1.png"></p><p>メニューの「実行」→「実行(F9)」を選択すると、オブジェクトが動くのが確認できます。</p><p>メニューの「実行」→「実行(F2)」で実行を停止します。</p><hr><p><a href="./tr-basic02">←前</a>&emsp;<a href="./tr-basic04">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-basic02"class="pagediv"title2="チュートリアル - 基礎編 (2/9) - オブジェクトを作る - Tonyu1 Wiki"><p><a href="./tr-basic01">←前</a>&emsp;<a href="./tr-basic03">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---基礎編-29">チュートリアル - 基礎編 (2/9)</h3><h2 id="オブジェクトを作る">オブジェクトを作る</h2><p>メインウィンドウの「オブジェクト」メニューから「新規」を選択します。</p><p><img src-t="./img/inspect.png"width="280"height="200"alt="inspect.png"></p><p>名前とクラス名を次のように入力し、OKを押します。</p><p><img src-t="./img/new-obj.png"width="394"height="402"alt="new-obj.png"></p><p>画面に新しいオブジェクトが現れます。</p><hr><p><a href="./tr-basic01">←前</a>&emsp;<a href="./tr-basic03">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-basic01"class="pagediv"title2="チュートリアル - 基礎編 (1/9) - 新規プロジェクトを作る - Tonyu1 Wiki"><p><a href="./tutorial">←目次</a>&emsp;<a href="./tr-basic02">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---基礎編-19">チュートリアル - 基礎編 (1/9)</h3><h2 id="新規プロジェクトを作る">新規プロジェクトを作る</h2><p>まずTonyuを起動します。</p><p>新しいページを作るには、「新規プロジェクト」を選択します。</p><p><img src-t="./img/tonyu-all.png"width="338"height="277"alt="tonyu-all.png"></p><p>次のように入力し、OKをクリックします。</p><p><img src-t="./img/npage.png"width="433"height="410"alt="npage.png"></p><hr><p><a href="./tutorial">←目次</a>&emsp;<a href="./tr-basic02">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="thanks"class="pagediv"title2="謝辞 - Tonyu1 Wiki"><p><a href="./">Wikiトップ</a></p><h2 id="謝辞">謝辞</h2><p>Tonyuの作成にあたっては、たくさんの方のご協力をいただいております。これらの 方々に感謝いたします。</p><h3 id="メソッド">メソッド</h3><p>次のクラス、メソッドは、ユーザの皆様よりお寄せいただいたものを修正・登録したものです。</p><ul><li><a href="./rf-object#objectcolorhsl">Object.colorHSL</a> ソンヨルさん</li><li><a href="./rf-sprite#spritedrawbrokenline">Sprite.drawBrokenLine</a> / <a href="./rf-panel#paneldrawbrokenline">Panel.drawBrokenLine</a> ラティウスさん</li><li><a href="./rf-math">$Math</a>　りょうたさん</li><li><a href="./rf-radiobutton">RadioButton</a> <a href="./rf-checkbox">CheckBox</a> <a href="./rf-sprite#spritecentertext">Sprite.centerText</a>, <a href="./rf-sprite#spritedrawverticaltext">Sprite.drawVerticalText</a>, <a href="./rf-sprite#spritedrawpolygon">Sprite.drawPolygon</a>, <a href="./rf-sprite#spritedrawrect">Sprite.drawRect</a>, <a href="./rf-sprite#spritedrawrectdx">Sprite.drawRectDx</a>, <a href="./rf-sprite#spritedrawtriangle">Sprite.drawTriangle</a>, <a href="./rf-sprite#spritegradationline">Sprite.gradationLine</a>, <a href="./rf-sprite#spritegradationrect">Sprite.gradationRect</a>, <a href="./rf-sprite#spritegradationtext">Sprite.gradationText</a> kenjiさん</li></ul><h3 id="ドキュメント">ドキュメント</h3><ul><li>このヘルプの<a href="./rf-object#objectanglediff">angleDiff</a>メソッド、<a href="./rf-angle-sin-cos-dist">angle,sin,cos,distの関係</a>の項目に含まれる画像は、AKJさんの&quot;Tonyu Tips&quot;にある画像をいただき、加筆訂正したものです。</li></ul><h3 id="ライブラリ">ライブラリ</h3><p>このプログラムを作成するにあたって、次のライブラリを使用 させて頂きました。</p><ul><li>DelphiX 堀　浩行さん</li><li>BREGEXP.DLL Babaさん</li><li>Delphi用 BREGEXP.DLL利用ユニット 武内 修さん</li><li>文字コード変換総合コンポーネントTPzConv PzFactoryさん</li><li>GLDPNG Tarquinさん ※GLDPNG(ZLIB)の著作権表示:<pre><code> GLDPNG (c) 1998-2001 Copyright Tarquin All Rights Reserved.
 ZLIB ver 1.1.3 (c) 1995-1996 Copyright Jean-loup Gailly and Mark Adler
</code></pre></li></ul><hr><p><a href="./">Wikiトップ</a></p></div><div style="display:none"id="update-history"class="pagediv"title2="更新履歴 - Tonyu1 Wiki"><p><a href="./">Wikiトップ</a></p><h3 id="更新履歴">更新履歴</h3><p><strong>2025-05-05</strong><br>・<a href="./download">ver1.303リリース</a></p><p><strong>2024-02-17</strong><br>・<a href="./download">ver1.303リリース</a></p><p><strong>2024-02-12</strong><br>・<a href="./download">ver1.302リリース</a><br>・<a href="./about2">Tonyuについて</a></p><p><strong>2024-02-08</strong><br>・<a href="./download">ver1.301リリース</a></p><p><strong>2022-08-05</strong><br>・<a href="./download">ver1.30リリース</a></p><h3 id="過去の更新履歴">過去の更新履歴</h3><p><strong>2021-12-12</strong><br>・<a href="./download">ver1.29リリース</a></p><p><strong>2021-10-03</strong><br>・本Wiki完成</p><p><strong>2021-08-31</strong><br>・本Wikiに移転</p><p><strong>2021-07-30</strong><br>・<a href="./download">ver1.29リリース</a><br>・<a href="./download#m-two">M-Twoリリース</a></p><p><strong>2021-04-13</strong><br>・本Wiki公開</p><p><strong>2021-04-07</strong><br>・<a href="./download">ver1.28リリース</a></p><h3 id="細かい更新履歴">細かい更新履歴</h3><p>細かい更新履歴は「<a href="https://github.com/makkii-bcr/Tonyu1-wiki">makkii-bcr/Tonyu1-wiki</a>」を参照してください。</p><hr><p><a href="./">Wikiトップ</a></p></div><div style="display:none"id="all"class="pagediv"title2="全ページ - Tonyu1 Wiki"><p><a href="./">Wikiトップ</a></p><h2 id="全ページ">全ページ</h2><p>※ このページのデザインで表示されている全ページです。旧デザインや他サイトのページは含まれていません。</p><p></p><ol><li><a href="tr-stg05">チュートリアル - 実践編 - シューティングゲーム (5/11) - 自機を破壊する</a></li><li><a href="tr-stg04">チュートリアル - 実践編 - シューティングゲーム (4/11) - 敵を出現させる</a></li><li><a href="tr-stg03">チュートリアル - 実践編 - シューティングゲーム (3/11) - 敵を動かす</a></li><li><a href="tr-stg02">チュートリアル - 実践編 - シューティングゲーム (2/11) - 弾を撃つ</a></li><li><a href="tr-stg01">チュートリアル - 実践編 - シューティングゲーム (1/11) - 自機を動かす</a></li><li><a href="tr-maze07">チュートリアル - 実践編 - 迷路ゲーム (7/7) - 配布する</a></li><li><a href="tr-maze06">チュートリアル - 実践編 - 迷路ゲーム (6/7) - 次の面に移る</a></li><li><a href="tr-maze05">チュートリアル - 実践編 - 迷路ゲーム (5/7) - スタート画面を作る</a></li><li><a href="tr-maze04">チュートリアル - 実践編 - 迷路ゲーム (4/7) - 自機や敵を破壊する</a></li><li><a href="tr-maze03">チュートリアル - 実践編 - 迷路ゲーム (3/7) - 敵を動かす</a></li><li><a href="tr-maze02">チュートリアル - 実践編 - 迷路ゲーム (2/7) - 自機を動かす</a></li><li><a href="tr-maze01">チュートリアル - 実践編 - 迷路ゲーム (1/7) - マップを描く</a></li><li><a href="tr-basic99">チュートリアル - 基礎編 (付録) - キャラクタパターン用ビットマップの作り方</a></li><li><a href="tr-basic09">チュートリアル - 基礎編 (9/9) - オブジェクトを追いかけるオブジェクト</a></li><li><a href="tr-basic08">チュートリアル - 基礎編 (8/9) - カーソルキーで動くオブジェクト</a></li><li><a href="tr-basic07">チュートリアル - 基礎編 (7/9) - オブジェクトいろいろ</a></li><li><a href="tr-basic06">チュートリアル - 基礎編 (6/9) - オブジェクトのキャラクタパターンを指定する</a></li><li><a href="tr-basic05">チュートリアル - 基礎編 (5/9) - オブジェクトをコピーする</a></li><li><a href="tr-basic04">チュートリアル - 基礎編 (4/9) - オブジェクトを動かす2</a></li><li><a href="tr-basic03">チュートリアル - 基礎編 (3/9) - オブジェクトを動かす</a></li><li><a href="tr-basic02">チュートリアル - 基礎編 (2/9) - オブジェクトを作る</a></li><li><a href="tr-basic01">チュートリアル - 基礎編 (1/9) - 新規プロジェクトを作る</a></li><li><a href="thanks">謝辞</a></li><li><a href="update-history">更新履歴</a></li><li><a href="all">全ページ</a></li><li><a href="start-error-win8-10">ランタイムの更新方法</a></li><li><a href="rf-window">命令リファレンス - Window</a></li><li><a href="rf-window-xy">命令リファレンス - $windowX, $windowY</a></li><li><a href="rf-window-active">命令リファレンス - $windowActive</a></li><li><a href="rf-while">命令リファレンス - while</a></li><li><a href="rf-view-xy">命令リファレンス - $viewX, $viewY</a></li><li><a href="rf-variable">命令リファレンス - 変数</a></li><li><a href="rf-true-false">命令リファレンス - 真偽</a></li><li><a href="rf-timestopper">命令リファレンス - TimeStopper</a></li><li><a href="rf-this">命令リファレンス - this</a></li><li><a href="rf-texteditor">命令リファレンス - $TextEditor</a></li><li><a href="rf-textchar">命令リファレンス - TextChar</a></li><li><a href="rf-system">命令リファレンス - $System</a></li><li><a href="rf-switch">命令リファレンス - switch</a></li><li><a href="rf-string">命令リファレンス - String</a></li><li><a href="rf-spritechar">命令リファレンス - SpriteChar</a></li><li><a href="rf-sprite">命令リファレンス - Sprite</a></li><li><a href="rf-selectbox">命令リファレンス - $SelectBox</a></li><li><a href="rf-secretchar">命令リファレンス - SecretChar</a></li><li><a href="rf-screen-wh">命令リファレンス - $screenWidth, $screenHeight</a></li><li><a href="rf-return">命令リファレンス - return</a></li><li><a href="rf-ranking">命令リファレンス - $ranking</a></li><li><a href="rf-radiobutton">命令リファレンス - RadioButton</a></li><li><a href="rf-projectmanager">命令リファレンス - $projectManager</a></li><li><a href="rf-plainchar">命令リファレンス - PlainChar</a></li><li><a href="rf-panelchar">命令リファレンス - PanelChar</a></li><li><a href="rf-panel">命令リファレンス - Panel</a></li><li><a href="rf-panel-g">命令リファレンス - $panel</a></li><li><a href="rf-panel-diff">命令リファレンス - $panelとpanelの違い</a></li><li><a href="rf-options">命令リファレンス - $Options</a></li><li><a href="rf-operator">命令リファレンス - .演算子</a></li><li><a href="rf-object">命令リファレンス - Object</a></li><li><a href="rf-null">命令リファレンス - null</a></li><li><a href="rf-mplayer">命令リファレンス - $mplayer</a></li><li><a href="rf-mousemanager">命令リファレンス - $mouseManager</a></li><li><a href="rf-mouse-xy">命令リファレンス - $mouseX, $mouseY</a></li><li><a href="rf-method-define">命令リファレンス - メソッドの定義</a></li><li><a href="rf-method-call">命令リファレンス - メソッドの呼び出し</a></li><li><a href="rf-matrix">命令リファレンス - Matrix</a></li><li><a href="rf-math">命令リファレンス - $Math</a></li><li><a href="rf-map">命令リファレンス - $TextEditor</a></li><li><a href="rf-lighthashtable">命令リファレンス - LightHashtable</a></li><li><a href="rf-keycode">命令リファレンス - キーID一覧</a></li><li><a href="rf-joystick">命令リファレンス - Joystick</a></li><li><a href="rf-is">命令リファレンス - is</a></li><li><a href="rf-inputbox">命令リファレンス - $InputBox</a></li><li><a href="rf-if">命令リファレンス - if</a></li><li><a href="rf-hashtable">命令リファレンス - Hashtable</a></li><li><a href="rf-getosversion">命令リファレンス - $osPlatformId、$osMajorVer、$osMinorVer</a></li><li><a href="rf-fullscreen">命令リファレンス - $fullScreen</a></li><li><a href="rf-framemanager">命令リファレンス - FrameManager</a></li><li><a href="rf-fps-rps">命令リファレンス - $_fps, $_rps</a></li><li><a href="rf-for">命令リファレンス - for</a></li><li><a href="rf-for-in">命令リファレンス - for..in</a></li><li><a href="rf-for-chars">命令リファレンス - for (xx in $chars)</a></li><li><a href="rf-filewriter">命令リファレンス - FileWriter</a></li><li><a href="rf-filereader">命令リファレンス - FileReader</a></li><li><a href="rf-file-handling">命令リファレンス - ファイルの扱いについて</a></li><li><a href="rf-extends">命令リファレンス - extends</a></li><li><a href="rf-dxchar">命令リファレンス - DxChar</a></li><li><a href="rf-display-wh">命令リファレンス - $displayWidth, $displayHeight</a></li><li><a href="rf-comment">命令リファレンス - 注釈</a></li><li><a href="rf-checkbox">命令リファレンス - CheckBox</a></li><li><a href="rf-break">命令リファレンス - break</a></li><li><a href="rf-assign">命令リファレンス - 代入</a></li><li><a href="rf-assign-oper">命令リファレンス - 演算代入</a></li><li><a href="rf-array">命令リファレンス - Array</a></li><li><a href="rf-arithmetic">命令リファレンス - 算術演算</a></li><li><a href="rf-animationadaptor">命令リファレンス - AnimationAdaptor</a></li><li><a href="rf-angle-sin-cos-dist">命令リファレンス - angle,sin,cos,distの関係</a></li><li><a href="rf-abstracthashtable">命令リファレンス - AbstractHashtable</a></li><li><a href="reference">命令リファレンス</a></li><li><a href="reference-use">命令リファレンス：用途別</a></li><li><a href="pre-release">Tonyu1 プレリリースバージョン</a></li><li><a href="index">Tonyu1 Wiki</a></li><li><a href="get-started">まずはゲームをやってみる</a></li><li><a href="error-mes">エラーメッセージ</a></li><li><a href="download">Tonyu1のダウンロード</a></li><li><a href="dl-history">過去のバージョンアップ履歴</a></li><li><a href="compatibility">互換性の設定</a></li><li><a href="about2">Tonyu Systemについて</a></li><li><a href="about">Tonyu1とは</a></li><li><a href="404">ページが無い</a></li><li><a href="tr-stg06">チュートリアル - 実践編 - シューティングゲーム (6/11) - 敵を破壊する</a></li><li><a href="tr-stg07">チュートリアル - 実践編 - シューティングゲーム (7/11) - 敵の動きに変化をつける</a></li><li><a href="tr-stg08">チュートリアル - 実践編 - シューティングゲーム (8/11) - 得点を表示する</a></li><li><a href="tr-stg09">チュートリアル - 実践編 - シューティングゲーム (9/11) - 弾、爆発を削除する</a></li><li><a href="tr-stg10">チュートリアル - 実践編 - シューティングゲーム (10/11) - 配布する</a></li><li><a href="tr-stg11-1">チュートリアル - 実践編 - シューティングゲーム (11-1 / 11) - ネットランキング対応にする - ランキング用CGIを設置する</a></li><li><a href="tr-stg11-2">チュートリアル - 実践編 - シューティングゲーム (11-2 / 11) - ネットランキング対応にする - ネットランキング対応のランタイムを作成する</a></li><li><a href="tr-stg11">チュートリアル - 実践編 - シューティングゲーム (11/ 11) - ネットランキング対応にする</a></li><li><a href="tutorial">チュートリアル</a></li><li><a href="wnd-bgm">各種ウィンドウの使い方/オプション - BGM・効果音</a></li><li><a href="wnd-char">各種ウィンドウの使い方/オプション - キャラクタパターン</a></li><li><a href="wnd-code">各種ウィンドウの使い方/オプション - コード補完</a></li><li><a href="wnd-csl">各種ウィンドウの使い方/オプション - コンソールウィンドウ</a></li><li><a href="wnd-draw">各種ウィンドウの使い方/オプション - 描画方法</a></li><li><a href="wnd-map">各種ウィンドウの使い方/オプション - マップ作成</a></li><li><a href="wnd-objlist">各種ウィンドウの使い方/オプション - オブジェクト一覧</a></li><li><a href="wnd-pfm">各種ウィンドウの使い方/オプション - パフォーマンス</a></li><li><a href="wnd-prjmgr">各種ウィンドウの使い方/オプション - プロジェクトマネージャ</a></li><li><a href="wnd-recipe">各種ウィンドウの使い方/オプション - レシピ集</a></li><li><a href="wnd-satellite">各種ウィンドウの使い方/オプション - サテライト</a></li><li><a href="wnd-use-opt">各種ウィンドウの使い方/オプション</a></li></ol><p></p><hr><p><a href="./">Wikiトップ</a></p></div><div style="display:none"id="start-error-win8-10"class="pagediv"title2="ランタイムの更新方法 - Tonyu1 Wiki"><p><a href="./download">ダウンロード</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="ランタイムの更新方法">ランタイムの更新方法</h2><p>下記の場合、ランタイムを更新してください。</p><ul><li><a href="https://www.tonyu.jp/project/top.cgi">プロジェクトボード</a>などでダウンロードした古いTonyu System 1のゲームがWindows10や8.1で起動しない場合</li><li>ランタイムのPlayer.exeを最新版に更新したい場合</li></ul><h3 id="更新手順">更新手順</h3><ol><li><a href="./download">最新版のTonyu1</a>をダウンロードします</li><li>ダウンロードしたフォルダ内のKernelとPlayer.exeを、古い（起動しない）ゲーム側のフォルダに上書きします</li></ol><ul><li>注意点<ul><li>Player.exeを上書きしただけだと、エラーが発生する可能性があります。Kernelも上書きしてください。</li><li>古い（起動しない）ゲーム側のKernelは、余分なファイルが残らないように削除してからコピーしてください。</li><li>古い（起動しない）ゲーム側にTempがある場合は削除してください。</li></ul></li></ul><p><img src-t="./img/copy-tonyu1.png"width="653"height="367"alt="copy-tonyu1.png"></p><ul><li>ステータスバーの表示が気になる場合はKernel/Cookies.iniの1行目(env.StatusBar)を0にすると消えます<ul><li>Tonyu1_29_2021_0705以降は、Cookies.iniを書き換えなくても、ステータスバーが非表示になります</li></ul></li></ul><hr><p><a href="./download">ダウンロード</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-window"class="pagediv"title2="命令リファレンス - Window - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="windowオブジェクト">$windowオブジェクト</h2><p>ウィンドウの制御を行います</p><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#windowsetdrawmode">setDrawMode</a></td><td>描画モードを変更します</td></tr><tr><td><a href="#windowsetdrawmodeforcemode">setDrawModeForceMode</a></td><td>Vista以降で実行時でも描画モードを変更できるようにします</td></tr></tbody></table><h3 id="変数一覧">変数一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#windowsizeable">sizeable</a></td><td>この値を1にすると、実行時にウィンドウの大きさをマウスによって変更できます</td></tr></tbody></table><hr><h2 id="windowsetdrawmode">$window.setDrawMode</h2><p>描画モードを変更します</p><pre><code>$window.setDrawMode(m);
</code></pre><ul><li><strong>m</strong><br>&emsp;&quot;A&quot; &quot;B&quot; &quot;C&quot; いずれかの文字列</li></ul><p>※ ver1.30以降、Windows Vista以降で実行時はsetDrawMode()から描画モードを変更できないようにしました<br>&emsp; ウィンドウ上部のメニューから選択した場合は変更できます<br>&emsp; どうしても変更したい場合は<a href="#windowsetdrawmodeforcemode">setDrawModeForceMode</a>で効くように変更できます<br>&emsp; Windows XP以前で実行時はsetDrawModeが効きます</p><p>PCやOSのバージョンによって、動作負担が変わったり、画面のかくつき等が変わります<br>こちらで観測した限りでは下記のような特性があります</p><table><thead><tr><th></th><th>XP以前</th><th>Vista以降</th></tr></thead><tbody><tr><td><strong>A方式</strong></td><td>PCによって描画負担が軽いor重い</td><td>描画負担が軽い・スタッタリング(*2)が少ない</td></tr><tr><td><strong>B方式</strong></td><td>Aの特性と同じことが多いがティアリング(*1)が少ない</td><td>スタッタリング(*2)が多い</td></tr><tr><td><strong>C方式</strong></td><td>PCによって描画負担が軽いor重い<br>どのPCでも半透明の描画をすると重くなる</td><td>描画負担が重い<br>どのPCでも半透明の描画をすると重くなる</td></tr></tbody></table><ul><li>XP以前では、A方式が軽いPCと、C方式が軽いPCの２パターンがあるようです</li><li>Vista以降では、A方式が軽いPCしかみたことが無いので、A方式一択となりそうです</li><li>C方式は、どのPCでも半透明の描画をすると重くなります</li><li>Windows 8、またはWindows Vista/7でAeroが有効の場合は、OSの制御で通常ティアリング(*1)は発生しません</li></ul><p>*1）ティアリング <a href="http://faq3.dospara.co.jp/faq/show/8398?site_domain=default">(ドスパラの解説ページ)</a><br>*2）スタッタリング <a href="http://faq3.dospara.co.jp/faq/show/8398?site_domain=default">(ドスパラの解説ページ)</a></p><hr><h2 id="windowsetdrawmodeforcemode">$window.setDrawModeForceMode</h2><h5 id="1_30_2022_0804以降">(1_30_2022_0804以降)</h5><p>Windows Vista以降で実行時でも、描画モードを変更できるようにします</p><pre><code>$window.setDrawModeForceMode(mode);
</code></pre><ul><li><strong>mode</strong><br>&emsp;0: Vista以降では<a href="#windowsetdrawmode">setDrawMode</a>が効かなくなります（デフォルト）<br>&emsp;1: Vista以降でも<a href="#windowsetdrawmode">setDrawMode</a>を効くようにします</li></ul><p>※ <code>$window.setDrawModeForceMode(1);</code>を実行した後に、<br>&emsp; <a href="#windowsetdrawmode">$window.setDrawMode</a>が効くようになります</p><hr><h2 id="windowsizeable">$window.sizeable</h2><p>この値を1にすると、実行時にウィンドウの大きさをマウスによって変更できます</p><p><strong>関連</strong></p><ul><li><a href="./rf-screen-wh">$screenWidth</a></li><li><a href="./rf-screen-wh">$screenHeight</a></li></ul><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-window-xy"class="pagediv"title2="命令リファレンス - $windowX, $windowY - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="windowx-windowy">$windowX, $windowY</h2><p>ウィンドウの位置を得たり、ウィンドウの移動を行います。</p><p>デスクトップ画面の左上が、メインウィンドウの左上に一致している場合、$windowX=0, $windowY=0 です。</p><h3 id="例1">例1</h3><pre><code>extends SpriteChar;

for (i=0; i&lt;100; i++){
  $windowX=i;
  update();
}
</code></pre><p>▲ ウィンドウが右に移動します</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-window-active"class="pagediv"title2="命令リファレンス - $windowActive - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="windowactive">$windowActive</h2><p>Tonyuがアクティブかを返します。</p><p>アクティブの時は1、非アクティブの時は0を返します。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-while"class="pagediv"title2="命令リファレンス - while - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="while">while</h2><p>条件にしたがって、繰り返し処理を行います。</p><h4 id="書式">書式</h4><pre><code>while (条件) 手続き
</code></pre><p>条件に書かれた計算式の値が<a href="./rf-true-false">真</a>である間は手続きを繰り返し実行し、<a href="./rf-true-false">偽</a>である場合は繰り返しを終了します。</p><p>条件については<a href="./rf-if">if</a>文を参照してください。</p><p>※ while文でだけ使われる特別な条件として、 while( 1 ) という形式があります。これは無条件に(永久に)繰り返す、という意味になります。</p><h3 id="例1">例1</h3><p>オブジェクトを作成し、ダブルクリック後つぎのように入力します。</p><pre><code>extends SpriteChar;
while(x&lt;300) { 
  // x が 300より小さい（300より左にいる）場合、この中を実行
  x=x+1;
  update();
}
</code></pre><p>▲ 実行すると、オブジェクトが右に移動しますが、x = 300 の地点で消滅します。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-view-xy"class="pagediv"title2="命令リファレンス - $viewX, $viewY - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="viewx-viewy">$viewX, $viewY</h2><p><a href="./rf-map#mapscrollto">$map.scrollTo</a>でスクロールした位置を得ます。</p><h3 id="例1">例1</h3><p>ここに書いてあるプログラムは、<br>実行する前に画面にマップを描くことをおすすめします<br>(<a href="./tutorial">チュートリアル</a>参照)</p><pre><code>extends SpriteChar;
while(1) {
  $map.scrollTo(t,t);
  t+=1;
  x=$viewX+$mouseX;
  y=$viewY+$mouseY;
  update();
}
</code></pre><p>▲ この例を実行すると、画面が斜めにスクロールしますが、スクロール位置には関係なくマウスの位置にオブジェクトが現れます。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-variable"class="pagediv"title2="命令リファレンス - 変数 - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="変数">変数</h2><p>変数とは、数値や文字列などのデータを入れるためのものです。</p><ul><li><p><strong>グローバル変数</strong><br>$screenWidth など、先頭が$ で始まる変数はグローバル変数です。 同じ名前のグローバル変数はシステムで１個しかありません。</p></li><li><p><strong>オブジェクト変数</strong><br>x など、先頭がアルファベットの変数は通常、オブジェクト変数です。 オブジェクト変数は、同じ名前でもオブジェクト毎に違う値を持ちます。</p></li><li><p><strong>ローカル変数(中級者向き)</strong><br><a href="./rf-method-define">メソッドの定義</a>内の引数および、メソッド内で次の書式で宣言された変数はローカル変数です。</p></li></ul><h4 id="書式">書式</h4><pre><code>var 変数名, 変数名, ... ;
</code></pre><p>ローカル変数はそのメソッド内だけで有効です。<br>同じ名前のローカル変数でも、宣言されているメソッドが異なる場合、別の変数として扱われます。</p><p>また、あるメソッド内で、オブジェクト変数と同名のローカル変数を宣言した場合、<br>ローカル変数への参照を優先し、オブジェクト変数のほうはそのメソッド内で参照できなくなります。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-true-false"class="pagediv"title2="命令リファレンス - 真偽 - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="真偽">真偽</h2><p><a href="./rf-if">if</a>文や<a href="./rf-while">while</a>文などに用いられる条件式は、その条件が成立したか否かを表す必要があります。 条件が成立したときを<strong>真</strong>、成立していない場合を<strong>偽</strong>といいます。</p><p>Tonyuでは、すべての値が「真」または「偽」を表すようになっています。</p><ul><li>真を表す値： 0以外の数値、オブジェクト(文字列も含む)</li><li>偽を表す値： 数値の0、null</li></ul><p>例</p><ul><li>5&gt;3 : 真</li><li>1+1==3 : 偽</li><li>x&lt;10 : xが10未満の数値なら真、それ以外の場合は偽</li><li>1 : 真</li><li>0 : 偽</li><li>&quot;tonyu&quot;: 真</li></ul><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-timestopper"class="pagediv"title2="命令リファレンス - TimeStopper - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="timestopperクラス">TimeStopperクラス</h2><p>時間の停止を行います</p><p>使い方は、<a href="./rf-object#objecttimestop">timeStop</a>メソッドを参照してください。</p><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#timestopperreleaseall">releaseAll</a></td><td>すべてのオブジェクトの時間停止を解除します。</td></tr><tr><td><a href="#timestopperrelease">release</a></td><td>特定のオブジェクトの時間停止を解除します。</td></tr></tbody></table><hr><h2 id="timestopperreleaseall">TimeStopper.releaseAll</h2><p>すべてのオブジェクトの時間停止を解除します。</p><p><strong>書式</strong></p><pre><code>releaseAll(nonKill)
</code></pre><ul><li><strong>nonKill</strong><br>&emsp;nonKill=0またはnonKillを省略した場合、時間が止まっている間に、<br>&emsp;<a href="./rf-object#objectappear">appear</a>メソッドを用いて出現させたオブジェクトは すべて消滅する。<br>&emsp;nonKill=1なら消滅しない。</li></ul><p><strong>例1</strong></p><p>例は<a href="./rf-object#objecttimestop">timeStop</a>メソッドにあります。</p><hr><h2 id="timestopperrelease">TimeStopper.release</h2><p>特定のオブジェクトの時間停止を解除します。</p><p><strong>書式</strong></p><pre><code>release(o)
</code></pre><ul><li><strong>o</strong><br>&emsp;時間停止を解除するオブジェクト</li></ul><p><strong>戻り値</strong></p><p>なし</p><p><strong>例1</strong></p><p>例は<a href="./rf-object#objecttimestop">timeStop</a>メソッドにあります。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-this"class="pagediv"title2="命令リファレンス - this - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="this">this</h2><p>thisは自分自身を表す特殊な変数です。</p><h3 id="例1">例1</h3><pre><code>extends SpriteChar;
while (1) {
  for (a in $chars) {
    if (a!= this &amp;&amp; crashTo(a)) die();
  }
  update();
}
</code></pre><p>▲ このオブジェクトは、自分以外のオブジェクトに衝突すると、死亡します。<br>※ this=式 という形の代入はできません。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-texteditor"class="pagediv"title2="命令リファレンス - $TextEditor - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="texteditorオブジェクト">$TextEditorオブジェクト</h2><p><a href="./rf-inputbox">$InputBox</a>より小型の、テキスト入力ウィンドウを表示します。</p><h3 id="例1">例1</h3><pre><code>extends SpriteChar;

$TextEditor.setPosition(10,10,200,100);
$TextEditor.setFont(11,&quot;ＭＳ ゴシック&quot;);
$TextEditor.setText(&quot;何か入力してください&quot;);
$TextEditor.edit();
while($TextEditor.isEditing()) {
  update();
}
while (1) {
  drawText(x,y,$TextEditor.getText(),$clWhite);
  x++;
  update();
}
</code></pre><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#texteditorsetposition">setPosition</a></td><td>テキストエディタの表示位置と大きさを指定します</td></tr><tr><td><a href="#texteditorsetfont">setFont</a></td><td>エディット中に使うフォントを指定します</td></tr><tr><td><a href="#texteditorsettext">setText</a></td><td>テキストの内容を設定します</td></tr><tr><td><a href="#texteditoredit">edit</a></td><td>テキストエディタを表示し、編集を開始します</td></tr><tr><td><a href="#texteditorisediting">isEditing</a></td><td>テキストをエディット中かどうか判定します</td></tr><tr><td><a href="#texteditorgettext">getText</a></td><td>テキストの内容を読み出します</td></tr></tbody></table><hr><h2 id="texteditorsetposition">$TextEditor.setPosition</h2><p>テキストエディタの表示位置と大きさを指定します</p><p><strong>書式</strong></p><pre><code>setPosition(x, y, w, h)
</code></pre><ul><li><strong>x</strong><br>&emsp;左上のx座標</li><li><strong>y</strong><br>&emsp;左上のy座標</li><li><strong>w</strong><br>&emsp;幅</li><li><strong>h</strong><br>&emsp;高さ</li></ul><p>hを0にすると、1行のみエディット可能になります。高さはフォントの大きさにしたがって自動的に設定されます。<br>hを0より大きくすると、複数行のエディットが可能になります。</p><hr><h2 id="texteditorsetfont">$TextEditor.setFont</h2><p>エディット中に使うフォントを指定します</p><p><strong>書式</strong></p><pre><code>setFont(size, name)
</code></pre><ul><li><strong>size</strong><br>&emsp;文字の大きさ</li><li><strong>name</strong><br>&emsp;フォント名</li></ul><hr><h2 id="texteditorsettext">$TextEditor.setText</h2><p>テキストの内容を設定します</p><p><strong>書式</strong></p><pre><code>setText(text)
</code></pre><ul><li><strong>text</strong><br>&emsp;テキストの内容</li></ul><hr><h2 id="texteditoredit">$TextEditor.edit</h2><p>テキストエディタを表示し、編集を開始します</p><p><strong>書式</strong></p><pre><code>edit()
</code></pre><hr><h2 id="texteditorisediting">$TextEditor.isEditing</h2><p>テキストをエディット中かどうか判定します</p><p><strong>書式</strong></p><pre><code>isEditing()
</code></pre><p><strong>戻り値</strong> エディット中なら真、エディット完了なら偽</p><p><a href="#texteditoredit">$TextEditor.edit</a>を呼び出した直後から、エディタ以外の場所をクリックして<br>エディタが隠れるまでが「エディット中」とみなされます。</p><hr><h2 id="texteditorgettext">$TextEditor.getText</h2><p>テキストの内容を読み出します <strong>書式</strong></p><pre><code>getText()
</code></pre><p><strong>戻り値</strong> テキストの内容</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-textchar"class="pagediv"title2="命令リファレンス - TextChar - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="textcharクラス">TextCharクラス</h2><p>TextCharクラスのオブジェクトは、文字を表示することができます。</p><h3 id="変数">変数</h3><ul><li><strong>x</strong><br>&emsp;オブジェクトのx座標を表します。xの値が大きくなるほど右に移動します。</li><li><strong>y</strong><br>&emsp;オブジェクトのy座標を表します。yの値が大きくなるほど下に移動します。 （※数学などでは、yが大きいほど上ですが、逆向きになります）</li><li><strong>text</strong><br>&emsp;表示するテキストを設定します。</li><li><strong>col</strong><br>&emsp;テキストの色を指定します。色は<a href="./rf-object#objectcolor">colorメソッドや色定数</a>を使って指定します</li><li><strong>size</strong><br>&emsp;テキストの大きさを指定します。</li><li><strong>font</strong><br>&emsp;フォント名を指定します。例：&quot;ＭＳ 明朝&quot; &quot;ＭＳ ゴシック&quot;など</li><li><strong>bold</strong><br>&emsp;1を指定すると太字になります。0で通常の書体です</li><li><strong>italic</strong><br>&emsp;1を指定すると斜体になります。0で通常の書体です</li><li><strong>underLine</strong><br>&emsp;1を指定すると下線付きになります。0で通常の書体です</li><li><strong>maxTextWidth</strong><br>&emsp;この値が0以外の数値のとき、指定された幅を超えた文字列を改行して表示します。これを用いて複数行の文字列表示が可能です。</li><li><strong>zOrder</strong><br>&emsp;この値が小さいほど文字が手前に表示されます。</li></ul><h3 id="メソッド">メソッド</h3><ul><li><a href="#textcharedit">edit</a></li><li><a href="./rf-plainchar">PlainChar</a>クラスのメソッド</li><li><a href="./rf-sprite">Sprite</a>クラスのメソッド</li><li><a href="./rf-object">Object</a>クラスのメソッド</li></ul><hr><h2 id="textcharedit">TextChar.edit</h2><p>テキストを編集状態にします</p><p><strong>書式</strong></p><pre><code>edit()
</code></pre><p>※複数行表示している場合でも1行のみのエディットになります</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-system"class="pagediv"title2="命令リファレンス - $System - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="systemオブジェクト">$Systemオブジェクト</h2><p>システムの終了などを行います。</p><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#systemexit">exit</a></td><td>Tonyu Systemを終了します</td></tr><tr><td><a href="#systemgetversion">getVersion</a></td><td>Tonyu Systemのバージョンを獲得します。</td></tr><tr><td><a href="#systemsetframerate">setFrameRate</a></td><td>フレーム（コマ）数とコマ落ちの設定を行います</td></tr><tr><td><a href="#systemsetstacksize">setStackSize</a></td><td>オブジェクトに割り当てるプロセスのスタックサイズを変更します。</td></tr><tr><td><a href="#systemsetvsync">setVSync</a></td><td>VSyncの有効・無効を設定します。</td></tr><tr><td><a href="#systemsetadjustscanline">setAdjustScanLine</a></td><td>VSyncの基準位置(走査線)を調節します。</td></tr><tr><td><a href="#systemsetautoadjustscanline">setAutoAdjustScanLine</a></td><td>VSyncの基準位置(走査線)の自動調節機能を使うか設定します。</td></tr><tr><td><a href="#systemsettimerresolution">setTimerResolution</a></td><td>タイマー分解能を設定します。</td></tr><tr><td><a href="#systemsetloopmode">setLoopMode</a></td><td>ゲームループの実行方式を設定します。</td></tr><tr><td><a href="#systemsetprocesssingle">setProcessSingle</a></td><td>オブジェクト大量発生時の点滅防止の有効・無効を設定します。</td></tr><tr><td><a href="#systemsetsleeptimemmt">setSleepTimeMMT</a></td><td>マルチメディアタイマー設定時のsleepTimeを指定します。</td></tr><tr><td><a href="#systemsetlegacyframerate">setLegacyFrameRate</a></td><td>ver1.21～1.29のフレームレートを再現します。</td></tr><tr><td><a href="#systemsetspriteangleaccuracy">setSpriteAngleAccuracy</a></td><td>スプライト描画のangleの精度を設定します</td></tr></tbody></table><hr><h2 id="systemexit">$System.exit</h2><p>Tonyu Systemを終了します</p><p><strong>書式</strong></p><pre><code>exit()
</code></pre><p><strong>例1</strong></p><pre><code>$System.exit();
</code></pre><hr><h2 id="systemgetversion">$System.getVersion</h2><p>Tonyu Systemのバージョンを取得します。</p><p><strong>書式</strong></p><pre><code>$System.getVersion()
</code></pre><p><strong>戻り値</strong></p><p>バージョンを1000倍した値</p><hr><h2 id="systemsetframerate">$System.setFrameRate</h2><p>フレーム（コマ）数とコマ落ちの設定を行います</p><p><strong>書式</strong></p><pre><code>setFrameRate(rate, skip)
</code></pre><ul><li><strong>rate</strong><br>&emsp;1秒あたりのフレーム数</li><li><strong>skip</strong><br>&emsp;最大フレームスキップ数</li></ul><p>Tonyu起動時には、rateは60、skipは5となっています。</p><p>最大フレームスキップ数を大きくすると、処理が落ちた場合に描画の回数を 減らすことで、本来の処理速度を保とうとします。<br>小さくすると、処理が落ちた 場合に実際の速度が落ちますが、画面はなめらかになります。</p><p><strong>例1</strong></p><pre><code>$System.setFrameRate(30,2);
</code></pre><hr><h2 id="systemsetstacksize">$System.setStackSize</h2><p>オブジェクトに割り当てるプロセスのスタックサイズを変更します。</p><p><strong>書式</strong></p><pre><code>$System.setStackSize(sz)
</code></pre><ul><li><p><strong>sz</strong><br>&emsp;スタックサイズ</p></li><li><p>Tonyu System起動時には、スタックサイズは1024となっています。</p></li><li><p>スタックサイズの変更が有効になるのは、<strong>setStackSizeを実行後に初めてオブジェクトが作られた時</strong>です。</p><ul><li>すでに作られているオブジェクトのスタックサイズは変更できません。</li><li>ページをまたいでもサイズの指定は有効です。</li></ul></li></ul><p><strong>例1</strong></p><pre><code>extend SpriteChar;
$System.setStackSize(4096);
appear(new ConsumeMuchStackChar(x,y,p));
</code></pre><hr><h2 id="systemsetvsync">$System.setVSync</h2><h5 id="1_29_2021_0501以降">(1_29_2021_0501以降)</h5><p>VSyncの有効・無効を設定します。</p><p>モニターの走査線を取得し、実行速度をミリ秒単位で微調整することでVSync(垂直同期)をします。</p><p><strong>書式</strong></p><pre><code>setVSync(enable)
</code></pre><ul><li><strong>enable</strong><br>&emsp;1で有効、0で無効にします。</li></ul><p>Tonyu起動時は、VSyncは有効になっています。</p><p>Windows 8以降やWindows Vista/7でAero有効の場合(*1)、 <strong>スタッタリング</strong>(*2)が軽減されます。<br>Windows XP以前では、<strong>ティアリング</strong>(*3)が目立たなくなります</p><p>*1）OSが自動的に垂直同期を行うので通常ティアリングが発生しなくなります<br>*2）スタッタリング <a href="http://faq3.dospara.co.jp/faq/show/8398?site_domain=default">(ドスパラの解説ページ)</a><br>*3）ティアリング <a href="http://faq3.dospara.co.jp/faq/show/8398?site_domain=default">(ドスパラの解説ページ)</a></p><hr><h2 id="systemsetadjustscanline">$System.setAdjustScanLine</h2><h5 id="1_29_2021_0501以降-1">(1_29_2021_0501以降)</h5><p>VSyncの基準位置(走査線)を調節します。</p><p><strong>書式</strong></p><pre><code>setAdjustScanLine(rate)
</code></pre><ul><li><strong>rate</strong><br>&emsp;0～1の小数を指定して、VSyncの基準位置(走査線)を調節します。</li></ul><p>Windows XP以前やWindows Vista/7でAero無効(クラシックテーマ)の場合、 <strong>ティアリング</strong>(*1)が発生するため、<br><strong>ティアリング</strong>を目立たない位置にずらしたりするときに使います。</p><p>*1）ティアリング <a href="http://faq3.dospara.co.jp/faq/show/8398?site_domain=default">(ドスパラの解説ページ)</a></p><hr><h2 id="systemsetautoadjustscanline">$System.setAutoAdjustScanLine</h2><h5 id="1_29_2021_1212以降">(1_29_2021_1212以降)</h5><p>VSyncの基準位置(走査線)の自動調節機能を使うか設定します。</p><p><strong>書式</strong></p><pre><code>setAutoAdjustScanLine(enable)
</code></pre><ul><li><strong>enable</strong><br>&emsp;0:無効、1:有効</li></ul><p>Tonyu起動時は、Windows XP以前では有効、Windows Vista以降では無効になっています。</p><p>1フレームの描画にかかった時間をもとに、VSyncの基準位置(走査線)を自動調節します。<br><a href="#systemsetadjustscanline">setAdjustScanLine</a>と併用して使うと、「自動調節＋手動調整」がVSyncの基準位置となります。</p><hr><h2 id="systemsettimerresolution">$System.setTimerResolution</h2><h5 id="1_29_2021_1212以降-1">(1_29_2021_1212以降)</h5><p>タイマー分解能を設定します。</p><p><strong>書式</strong></p><pre><code>setTimerResolution(ms)
</code></pre><ul><li><strong>ms</strong><br>&emsp;1以上を指定します。（ミリ秒単位）</li></ul><p>Tonyu起動時は、1ミリ秒で設定されています。</p><p>短い時間を指定すると、カクつきが軽減されたりFPSが安定するなどの効果があります。<br>Windows XP以前のPCでは、短い時間にするとCPU負担が大きくなります。<br>Windows XP以前のPCでCPU負担軽減を優先したい場合、設定を変更できます。</p><p>ただし、Kernel/MidiPlayer2.exeがあると1ミリ秒に設定されてしまいます。<br>MidiPlayer2.exeを削除する必要がありますが、Midi,Oggは再生できなくなります。</p><hr><h2 id="systemsetloopmode">$System.setLoopMode</h2><h5 id="1_29_2021_1212以降-2">(1_29_2021_1212以降)</h5><p>ゲームループの実行方式を設定します。</p><p><strong>書式</strong></p><pre><code>setLoopMode(mode)
</code></pre><ul><li><strong>mode</strong><br>&emsp;0:ビジーループ、1:マルチメディアタイマー</li></ul><p>Tonyu起動時は、マルチメディアタイマーで実行します。</p><ul><li>ビジーループ<ul><li><a href="./rf-options#optionsset">sleep_time</a>が0の場合、カクつきは抑えられますが、CPU使用率は1スレッド分100%使います</li><li><a href="./rf-options#optionsset">sleep_time</a>が1以上の場合、CPU負担は抑えられますが、カクつきが発生しやすくなります</li><li>ウィンドウ操作中はゲームが止まります</li></ul></li><li>マルチメディアタイマー<ul><li>CPU負担を抑えつつ、カクつきも抑えることができます</li><li>ウィンドウ操作中もゲームが動作し続けます</li></ul></li></ul><p>※ Tonyu1_28以前は、ビジーループで動作しています。マルチメディアタイマー動作にはできません。</p><hr><h2 id="systemsetprocesssingle">$System.setProcessSingle</h2><h5 id="1_30_2022_0804以降">(1_30_2022_0804以降)</h5><p>オブジェクト大量生成時に発生する、オブジェクト点滅や処理落ちを防ぐ機能の、<br>有効・無効を設定します。</p><p><strong>書式</strong></p><pre><code>setProcessSingle(enable)
</code></pre><ul><li><strong>mode</strong><br>&emsp;1:有効、0:無効<br>&emsp;デフォルトは1で有効</li></ul><p>※ <a href="./compatibility">互換性の設定</a><a href="./compatibility#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E5%A4%A7%E9%87%8F%E7%94%9F%E6%88%90%E3%81%97%E3%81%9F%E9%9A%9B%E3%80%81%E7%82%B9%E6%BB%85%E3%81%97%E3%81%9F%E3%82%8A%E5%8B%95%E4%BD%9C%E3%81%8C%E9%81%85%E3%81%8F%E3%81%AA%E3%82%8B%E7%8F%BE%E8%B1%A1">「オブジェクトを大量生成した際、点滅したり動作が遅くなる現象」</a>を参照</p><hr><h2 id="systemsetsleeptimemmt">$System.setSleepTimeMMT</h2><h5 id="1_30_2022_0804以降-1">(1_30_2022_0804以降)</h5><p>※ <strong>通常このメソッドを使用する必要はありません</strong><br>&emsp; 0設定でも十分にCPU負荷が低いため、基本的に使用する必要はありません<br>&emsp; 1以上にするとFPSが低下しやすくなります</p><p>マルチメディアタイマー（<a href="./rf-system#systemsetloopmode">$System.setLoopMode(1)</a>）設定時のSleepTimeを設定します。</p><p>フレームごとにCPUをスリープする時間（単位：ミリ秒）を設定します。<br>「パフォーマンス」ウィンドウの「CPU負荷」をプログラムから動的に設定します。</p><p><strong>書式</strong></p><pre><code>setSleepTimeMMT(ms)
</code></pre><ul><li><strong>ms</strong><br>&emsp;フレームごとにCPUをスリープする時間（単位：ミリ秒）を設定します。<br>&emsp;デフォルトは0です。</li></ul><hr><h2 id="systemsetlegacyframerate">$System.setLegacyFrameRate</h2><h5 id="1_30_2022_0804以降-2">(1_30_2022_0804以降)</h5><p>ver1.21～1.29のフレームレートを再現します。</p><ul><li>ver1.28以前は、FPSにずれがありました。<ul><li>例えば、フレームレートを60に設定しても、FPSが約62.5になっていました。</li></ul></li><li>ver1.29からはFPSが正確になりました。</li><li>ver1.28以前のFPSを再現したい場合に設定します。</li></ul><p><strong>書式</strong></p><pre><code>setLegacyFrameRate(enable)
</code></pre><ul><li><strong>enable</strong><br>&emsp;0:無効（FPSが正確になる）<br>&emsp;1:有効（ver1.28以前のFPSのずれを再現します）<br>&emsp;デフォルトは0です。</li></ul><p>※ <a href="./compatibility">互換性の設定</a><a href="./compatibility#fps%E3%81%8C%E7%B4%8461%EF%BD%9E63%E3%81%AB%E3%81%AA%E3%82%8B%E7%8F%BE%E8%B1%A1">「FPSが約61～63になる現象」</a>を参照</p><hr><h2 id="systemsetspriteangleaccuracy">$System.setSpriteAngleAccuracy</h2><h5 id="1_30_2022_0804以降-3">(1_30_2022_0804以降)</h5><p>スプライト描画の回転(angle)の精度を設定します</p><ul><li>ver1.29以前は、１回転(360°)で256段階（約1.4°ずつ角度が変わる）でした</li><li>ver1.30以降は、１回転(360°)で36000段階（0.01°ずつ角度が変わる）となります</li><li>default.tonyuprjのtargetVersion（無い場合はsavedVersion）によってデフォルトの精度が変わります<ul><li>1290以下の場合は、互換性のため256段階</li><li>1300以上の場合は、36000段階</li></ul></li><li>手動で精度を変えたい場合、このメソッドを使用します</li></ul><p><strong>書式</strong></p><pre><code>setSpriteAngleAccuracy(mode)
</code></pre><ul><li><strong>mode</strong><br>&emsp;0: １回転256段階<br>&emsp;1: １回転36000段階</li></ul><p>※ <a href="./compatibility">互換性の設定</a><a href="./compatibility#%E3%82%B9%E3%83%97%E3%83%A9%E3%82%A4%E3%83%88%E6%8F%8F%E7%94%BB%E3%81%AE%E5%9B%9E%E8%BB%A2angle%E3%81%AE%E7%B2%BE%E5%BA%A6">「スプライト描画の回転(angle)の精度」</a>を参照</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-switch"class="pagediv"title2="命令リファレンス - switch - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="switch">switch</h2><p>変数の値によって、手続きを振り分けます。</p><h4 id="書式">書式</h4><pre><code>switch (変数) {
  case 値1:
    手続き1;
    break;
  case 値2:
    手続き2;
    break;
  ...
  default:
    手続きn;
}
</code></pre><p><strong>変数</strong>に書かれた変数の値が<strong>case</strong>の<strong>値</strong>に一致する場合、その下の<strong>手続き</strong>を実行します。<br><strong>break</strong>に到達すると<strong>switch</strong>の <strong>{}内</strong>から抜けます。</p><p>※ break を書き忘れると、条件が一致したcase以降の行も次々に実行されてしまうので、注意してください。</p><p>どの case にも一致しない場合、<strong>default</strong>の下の手続きが実行されます。</p><p>case はいくつも書くことができます。<br>default は一番下に１つだけ書くことができ、省略可能です。</p><h3 id="例1">例1</h3><pre>
extends SpriteChar;
<a href="./rf-selectbox">$SelectBox</a>.<a href="./rf-selectbox#selectboxopen">open</a>("何を買いますか？", "ここは武器屋です", "剣", "槍", "斧", "杖");
while (1) {
  select=<a href="./rf-selectbox">$SelectBox</a>.<a href="./rf-selectbox#selectboxgetstatus">getStatus</a>();
  switch (select) {
    case 0:
      text="選択中";
      break;
    case 1:
      text="剣を買いました";
      break;
    case 2:
      text="槍を買いました";
      break;
    case 3:
      text="斧を買いました";
      break;
    case 4:
      text="杖を買いました";
      break;
    default:
      text="何も買いませんでした";
  }
  drawText(10, 10, text, $clWhite, 20); // textの値を表示
  update();
}
</pre><p>▲ 選択ダイアログが表示され、以下の動作となります</p><ul><li>ボタンを押していない間は、selectが0となりcase 0:下の「text=&quot;選択中&quot;;」が実行されます</li><li>左から1番目のボタンを押すと、selectが1となりcase 1:の下、「text=&quot;剣を買いました&quot;;」が実行されます</li><li>左から2番目のボタンを押すと、selectが2となりcase 2:の下、「text=&quot;槍を買いました&quot;;」が実行されます</li><li>左から3番目のボタンを押すと、selectが3となりcase 3:の下、「text=&quot;斧を買いました&quot;;」が実行されます</li><li>左から4番目のボタンを押すと、selectが4となりcase 4:の下、「text=&quot;杖を買いました&quot;;」が実行されます</li><li>ダイアログを×ボタンで閉じると、selectが-1となりcase文で書いてある0～4のいずれにも一致しないので、default:の下、「text=&quot;何も買いませんでした&quot;;」が実行されます</li></ul><p>下記のif文と同じ動作になります。</p><pre><code>extends SpriteChar;
$SelectBox.open(&quot;何を買いますか？&quot;, &quot;ここは武器屋です&quot;, &quot;剣&quot;, &quot;槍&quot;, &quot;斧&quot;, &quot;杖&quot;);
while (1) {
  select=$SelectBox.getStatus();
  if (select == 0) {
    text=&quot;選択中&quot;;
  } else if (select == 1) {
    text=&quot;剣を買いました&quot;;
  } else if (select == 2) {
    text=&quot;槍を買いました&quot;;
  } else if (select == 3) {
    text=&quot;斧を買いました&quot;;
  } else if (select == 4) {
    text=&quot;杖を買いました&quot;;
  } else {
    text=&quot;何も買いませんでした&quot;;
  }
  drawText(10, 10, text, $clWhite, 20); // textの値を表示
  update();
}
</code></pre><h3 id="例2">例2</h3><p>breakがcaseと対になっていない例です。<br>breakが無いとswitch文から即座に抜け出さないので、条件に一致したcaseから次々に処理が実行されてしまいますが、<br>その性質をあえて利用することもできます。</p><pre><code>extends SpriteChar;
$SelectBox.open(&quot;何を買いますか？&quot;, &quot;ここは売店です&quot;, &quot;お茶&quot;, &quot;ジュース&quot;, &quot;高い弁当&quot;, &quot;弁当&quot;);
while (1) {
  select=$SelectBox.getStatus();
  text=&quot;&quot;;
  switch (select) {
    case 0:
      text=&quot;選択中&quot;;
      break;
    case 1:
    case 2:
      text=&quot;飲み物を買いました&quot;;
      break;
    case 3:
      text=&quot;高級な&quot;;
    case 4:
      text=text+&quot;弁当を買いました&quot;;
      break;
    default:
      text=&quot;何も買いませんでした&quot;;
  }
  drawText(10, 10, text, $clWhite, 20); // textの値を表示
  update();
}
</code></pre><p>▲ 選択ダイアログが表示され、以下の動作となります</p><ul><li>ボタンを押していない間は、selectが0となりcase 0:下の「text=&quot;選択中&quot;;」が実行されます</li><li>左から1番目と2番目のボタンを押した場合、どちらも「text=&quot;飲み物を買いました&quot;;」が実行されます</li><li>左から3番目のボタンを押すと、case 3:の下「text=&quot;高級な&quot;;」が実行されますが、break;は無いのでcase 4:の下「text=text+&quot;弁当を買いました&quot;;」も実行されます<br>「高級な弁当を買いました」と表示されます</li><li>左から4番目のボタンを押すと、case 4:の下、「text=text+&quot;弁当を買いました&quot;;」が実行されます<br>「弁当を買いました」と表示されます</li><li>ダイアログを×ボタンで閉じると、selectが-1となりcase文で書いてある0～4のいずれにも一致しないので、default:の下、「text=&quot;何も買いませんでした&quot;;」が実行されます</li></ul><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-string"class="pagediv"title2="命令リファレンス - String - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="stringクラス">Stringクラス</h2><p>文字列を表すオブジェクトです</p><h3 id="演算子">演算子</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#%E6%96%87%E5%AD%97%E5%88%97%E7%B5%90%E5%90%88">文字列結合(+)</a></td><td>文字列と他の文字列を連結します</td></tr><tr><td><a href="#%E6%96%87%E5%AD%97%E5%88%97%E6%AF%94%E8%BC%83">文字列比較(==)</a></td><td>文字列と他の文字列の内容が一致しているかを調べます</td></tr></tbody></table><h3 id="コンストラクタ">コンストラクタ</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#new-string">new String</a></td><td>キャラクタコードをあらわす数値から、文字列を作成します。</td></tr></tbody></table><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#stringbytelength">byteLength</a></td><td>文字列のバイトデータの長さを得ます。</td></tr><tr><td><a href="#stringsubstring">substring</a></td><td>文字列の一部を抜き出します。</td></tr><tr><td><a href="#stringlength">length</a></td><td>文字列の長さを得ます。</td></tr><tr><td><a href="#stringbytesubstring">byteSubstring</a></td><td>substringと似ていますが、全角文字を2文字として数えます。</td></tr><tr><td><a href="#stringbyteat">byteAt</a></td><td>文字列のバイトデータの特定の場所におけるキャラクタコードを得ます。</td></tr><tr><td><a href="#stringcharat">charAt</a></td><td>文字列からiバイト目のキャラクタコードをぬきだします</td></tr><tr><td><a href="#stringsplit">split</a></td><td>カンマ(&quot;,&quot;)などで区切られた文字列(&quot;abc,def,efg&quot;など)を配列に分解します。</td></tr></tbody></table><hr><h2 id="文字列結合">文字列結合</h2><p><b>演算子 +</b>を用いて、<a href="#">文字列</a>と他の文字列を連結します</p><p><strong>例1</strong></p><pre><code>extends SpriteChar;
a=&quot;山&quot;
b=&quot;川&quot;;
c=a+&quot;と&quot;+b;
print(c);
</code></pre><p>▲ <a href="./wnd-csl">コンソール</a>に&quot;山と川&quot; が表示されます&quot;</p><p><strong>例2</strong></p><pre><code>extends SpriteChar;
score=100+200;
print(&quot;score=&quot;+score);
</code></pre><p>▲ コンソールに&quot;score=300&quot; が表示されます。<br>この例のように、文字列と数値を連結することが可能です。</p><p><strong>注意点</strong></p><p>演算子 + は、両辺の値の種類によって意味が変わってきます。<br>次の例をためしてください。</p><p><strong>例3</strong></p><pre><code>extends SpriteChar;
print(&quot;score=&quot;+100+200); // A
print(&quot;score=&quot;+(100+200)); // B
print(100+200+&quot;=score&quot;); // C
</code></pre><p>コンソールは次のように表示されます。</p><pre><code>score=100200
score=300
300=score
</code></pre><p>動作をまとめると次のようになります。</p><ul><li>+ の両辺のうち少なくとも一方が文字列の場合、演算の結果は文字列となる。文字列でないほうの値はその値の文字列表現に変換される。</li><li>+ の両辺が数値の場合、演算の結果は数値となる。数値同士の足し算を行う。</li><li>+ で連結された値が３つ以上ある場合、左から計算する。ただし括弧でくくられたものを先に計算する</li></ul><p>上の例では次のような計算が行われています。</p><p><strong>print(&quot;score=&quot;+100+200); // A</strong></p><p>まず、&quot;score=&quot;+100 を計算し、結果が&quot;score=100&quot;になる。<br>さらに&quot;score=100&quot;+200 を計算し、結果が&quot;score=100200&quot;になる。</p><p><strong>print(&quot;score=&quot;+(100+200)); // B</strong></p><p>まず、(100+200)を計算し、結果が300（数値）になる<br>さらに&quot;score=&quot;+300 を計算し、結果が&quot;score=300&quot;になる。</p><p><strong>print(100+200+&quot;=score&quot;); // C</strong></p><p>まず、100+200を計算し、結果が300（数値）になる<br>さらに300+&quot;=score&quot; を計算し、結果が&quot;300=score&quot;になる。</p><hr><h2 id="文字列比較">文字列比較</h2><p><strong>==演算子</strong>を用いて、 <a href="#">文字列</a>と他の文字列の内容が一致しているかを調べます</p><p><strong>例1</strong></p><pre><code>extends SpriteChar;
a=&quot;abc&quot;;
if (a==&quot;abc&quot;) print(a+&quot; と abc は等しい&quot;);
else print(a+&quot; と abc は等しくない&quot;);
if (a==&quot;def&quot;) print(a+&quot; と def は等しい&quot;);
else print(a+&quot; と def は等しくない&quot;);
</code></pre><p><a href="./wnd-csl">コンソール</a>は次のように表示されます。</p><pre><code>abc と abc は等しい
abc と def は等しくない
</code></pre><hr><h2 id="new-string">new String</h2><p>キャラクタコードをあらわす数値から、文字列を作成します。</p><p><strong>例1</strong></p><pre><code>a=new String(35);
</code></pre><p>▲ aの値は、キャラクタコード35の文字(#) からなる文字列 &quot;#&quot; になります。</p><hr><h2 id="stringbytelength">String.byteLength</h2><p>文字列のバイトデータの長さを得ます。</p><p><strong>書式</strong></p><pre><code>byteLength()
</code></pre><p><strong>戻り値</strong></p><p>全角文字を2文字とした、文字列の長さ</p><p><a href="#stringlength">length</a>メソッドと似ていますが、全角文字を２文字として数えます。</p><hr><h2 id="stringsubstring">String.substring</h2><p>文字列の一部を抜き出します。</p><p><strong>書式</strong></p><pre><code>substring(b,e)
</code></pre><ul><li><strong>b</strong><br>&emsp;抜き出し開始位置。先頭を0として、全角文字も１と数える</li><li><strong>e(省略可能)</strong><br>&emsp;抜き出し終了位置。この位置の１文字手前までが抜き出される。省略した場合は最後まで</li></ul><p><strong>戻り値</strong></p><p>b,eによって指定された範囲内の文字列を返します。</p><p><strong>例1</strong></p><p>メニューの「ウィンドウ」＞「コンソール」でコンソールウィンドウを表示し、さらに<br>メニューの「ウィンドウ」＞「テスト実行」で表示されるウィンドウに次のように入力し<br>F9をおします</p><pre><code>a=&quot;105円です&quot;;
b=a.substring(2); 
c=a.substring(2,4);
print(b);
print(c);
</code></pre><p>▲ コンソールは次のように表示されます。</p><pre><code>5円です
5円
</code></pre><hr><h2 id="stringlength">String.length</h2><p>文字列の長さを得ます。</p><p><strong>書式</strong></p><pre><code>length()
</code></pre><p><strong>戻り値</strong></p><p>文字列の長さ</p><p>全角文字も1文字として数えます。<br>全角文字を2文字として扱いたい場合、<a href="#stringbytelength">byteLength</a>メソッドを用います</p><p><strong>例1</strong></p><p>メニューの「ウィンドウ」＞「コンソール」でコンソールウィンドウを表示し、さらに<br>メニューの「ウィンドウ」＞「テスト実行」で表示されるウィンドウに次のように入力し<br>F9をおします</p><pre><code>a=&quot;Tonyuシステム&quot;;
print(&quot;「&quot;+a+&quot;」は&quot;+a.length()+&quot;文字です&quot;);
</code></pre><p>▲ コンソールには次のように表示されます。</p><pre><code>「Tonyuシステム」は9文字です
</code></pre><p><strong>注意</strong></p><p>次のように文字定数に直接.length()をつけることはできません</p><pre><code>&quot;Tonyu&quot;.length(); // エラー
</code></pre><hr><h2 id="stringbytesubstring">String.byteSubstring</h2><p><a href="#stringsubstring">substring</a>と似ていますが、全角文字を2文字として数えます。</p><p><strong>書式</strong></p><pre><code>byteSubstring(b,e)
</code></pre><ul><li><strong>b</strong><br>&emsp;抜き出し開始位置。先頭を0として、全角文字を2と数える</li><li><strong>e(省略可能)</strong><br>&emsp;抜き出し終了位置。この位置の１文字手前までが抜き出される。省略した場合は最後まで</li></ul><p><strong>戻り値</strong></p><p>b,eによって指定された範囲内の文字列を返します。</p><hr><h2 id="stringbyteat">String.byteAt</h2><p>文字列のバイトデータの特定の場所におけるキャラクタコードを得ます。</p><p><strong>書式</strong></p><pre><code>byteAt(n)
</code></pre><ul><li><strong>n</strong><br>&emsp;位置</li></ul><p><strong>戻り値</strong></p><p>strのバイトデータにおける、nバイト目のキャラクタコード</p><hr><h2 id="stringcharat">String.charAt</h2><p>文字列からiバイト目のキャラクタコードをぬきだします</p><p><strong>書式</strong></p><pre><code>charAt(i)
</code></pre><ul><li><strong>i</strong><br>&emsp;文字列のインデックス。0が先頭、全角文字は2文字と数える</li></ul><p><strong>戻り値</strong></p><p>iバイト目のキャラクタコード</p><p><a href="#stringbyteat">byteAt</a>と同じ動作をします。</p><p>&quot;1文字&quot;だけを抜き出す場合は</p><pre>
s.<a href="#stringsubstring">substring</a>(i,1)
</pre><p>を使います。</p><hr><h2 id="stringsplit">String.split</h2><p>カンマ(&quot;,&quot;)などで区切られた文字列(&quot;abc,def,efg&quot;など)を<a href="./rf-array">配列</a>に分解します。</p><p><strong>書式</strong></p><pre><code>split(separator,limit)
</code></pre><ul><li><strong>separator(省略可能)</strong><br>&emsp;区切りに使う文字列。省略すると、文字列strをカンマ (&quot;,&quot;)で区切ります。</li><li><strong>limit(省略可能)</strong><br>&emsp;limitで指定された個数を超える要素をもつ配列を生成しません。省略すると個数に制限はありません。</li></ul><p><strong>例1</strong></p><p>メニューの「ウィンドウ」＞「コンソール」でコンソールウィンドウを表示してください</p><pre><code>extends SpriteChar;
a=&quot;abc,de!f,ghi&quot;;
print(a+&quot;を , で区切ります&quot;);
b=a.split();
for (e in b) {
  print(e);
}
print(a+&quot;を ! で区切ります&quot;);
b=a.split(&quot;!&quot;);
for (e in b) {
   print(e);
}
print(a+ &quot;を , で区切ります(要素数は2つまで)。&quot;);
b=a.split(&quot;,&quot; ,2);
for (e in b) {
   print(e);
}
</code></pre><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-spritechar"class="pagediv"title2="命令リファレンス - SpriteChar - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="spritecharクラス">SpriteCharクラス</h2><p>SpriteCharクラスのオブジェクトは、ビットマップグラフィックスを表示することができます。</p><h3 id="変数">変数</h3><ul><li><strong>x</strong><br>&emsp;オブジェクトのx座標を表します。xの値が大きくなるほど右に移動します。</li><li><strong>y</strong><br>&emsp;オブジェクトのy座標を表します。yの値が大きくなるほど下に移動します。 （※数学などでは、yが大きいほど上ですが、逆向きになります）</li><li><strong>f</strong><br>&emsp;fに１を代入すると、キャラクタパターンの左右を反転します。0を設定すると反転をやめます。</li><li><strong>zOrder</strong><br>&emsp;この値が小さいほど文字が手前に表示されます。</li></ul><h3 id="メソッド一覧">メソッド一覧</h3><ul><li><a href="#spritecharnewanimation">newAnimation</a></li><li><a href="./rf-plainchar">PlainChar</a>クラスのメソッド</li><li><a href="./rf-sprite">Sprite</a>クラスのメソッド</li><li><a href="./rf-object">Object</a>クラスのメソッド</li></ul><hr><h2 id="spritecharnewanimation">SpriteChar.newAnimation</h2><p>新規AnimationAdaptorを作成します。</p><p><strong>書式</strong></p><pre><code>newAnimation()
</code></pre><p><strong>戻り値</strong></p><p>新規作成された<a href="./rf-animationadaptor">AnimationAdaptor</a></p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-sprite"class="pagediv"title2="命令リファレンス - Sprite - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="spriteクラス">Spriteクラス</h2><p>画面上に出現するすべてのオブジェクト(<a href="./rf-plainchar">PlainChar</a>クラス)の親クラスです。描画命令などが定義されています</p><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#spritetextwidth">textWidth</a></td><td>テキストの横幅を取得します</td></tr><tr><td><a href="#spritetextheight">textHeight</a></td><td>テキストの縦幅（高さ）を取得します</td></tr><tr><td><a href="#spritesetfont">setFont</a></td><td><a href="#spritedrawtext">drawText</a>メソッドで描画する文字フォントを指定します。</td></tr><tr><td><a href="#spritedrawtext">drawText</a></td><td>文字を描画します。</td></tr><tr><td><a href="#spritedrawline">drawLine</a></td><td>直線を描画します</td></tr><tr><td><a href="#spritedrawbrokenline">drawBrokenLine</a></td><td>点線を描画します</td></tr><tr><td><a href="#spritefillrect">fillRect</a></td><td>中の詰まった長方形を描画します</td></tr><tr><td><a href="#spritedrawsprite">drawSprite</a></td><td>スプライトを描画します。</td></tr><tr><td><a href="#spritegetpatwidth">getPatWidth</a></td><td>キャラクタパターンの大きさ（幅）を取得します。</td></tr><tr><td><a href="#spritegetpatheight">getPatHeight</a></td><td>キャラクタパターンの大きさ（幅）を取得します。</td></tr><tr><td><a href="#spritedrawmapsprite">drawMapSprite</a></td><td>未稿</td></tr><tr><td><a href="#spritedrawpolygon">drawPolygon</a></td><td>正多角形を描画します。</td></tr><tr><td><a href="#spritedrawdxsprite">drawDxSprite</a></td><td>回転、拡大、縮小、半透明のスプライトを描画します。</td></tr><tr><td><a href="#spritedrawscreenxy">drawScreenXY</a></td><td>各種描画命令において、座標系にスクリーン座標を使うか、ワールド座標を使うかを指定します。</td></tr><tr><td><a href="#spritecentertext">centerText</a></td><td>指定された座標が中心になるように文字を描画します。</td></tr><tr><td><a href="#spritedrawverticaltext">drawVerticalText</a></td><td>縦書きの文字を描画します。</td></tr><tr><td><a href="#spritedrawrect">drawRect</a></td><td>中空の四角形を描画します。</td></tr><tr><td><a href="#spritedrawrectdx">drawRectDx</a></td><td>中空の四角形を描画します。回転が可能です</td></tr><tr><td><a href="#spritedrawtriangle">drawTriangle</a></td><td>指定された座標が中心になるように文字を描画します。</td></tr><tr><td><a href="#spritegradationline">gradationLine</a></td><td>グラデーション付きの直線を描画します</td></tr><tr><td><a href="#spritegradationrect">gradationRect</a></td><td>グラデーションつき長方形を描画します</td></tr><tr><td><a href="#spritegradationtext">gradationText</a></td><td>グラデーションつき文字を描画します。</td></tr><tr><td><a href="#spritefillpolygon">fillPolygon</a></td><td>多角形を描画し，塗りつぶします。</td></tr><tr><td><a href="#spritesetpolygon">setPolygon</a></td><td><a href="#spritefillpolygon">Sprite.fillPolygon</a> における頂点を指定します。</td></tr></tbody></table><hr><h2 id="spritetextwidth">Sprite.textWidth</h2><p>テキストの横幅を取得します</p><p><strong>書式</strong></p><pre><code>textWidth(t,s)
</code></pre><ul><li><strong>t</strong><br>&emsp;テキストの内容</li><li><strong>s</strong><br>&emsp;テキストサイズ(pt)</li></ul><p><strong>戻り値</strong></p><p>テキストtをサイズsで書いた場合の幅</p><hr><h2 id="spritetextheight">Sprite.textHeight</h2><p>テキストの縦幅（高さ）を取得します</p><p><strong>書式</strong></p><pre><code>textHeight(t,s)
</code></pre><ul><li><strong>t</strong><br>&emsp;テキストの内容</li><li><strong>s</strong><br>&emsp;テキストサイズ(pt)</li></ul><p><strong>戻り値</strong></p><p>テキストtをサイズsで書いた場合の高さ</p><hr><h2 id="spritesetfont">Sprite.setFont</h2><p><a href="#spritedrawtext">drawText</a>メソッドで描画する文字フォントを指定します。</p><p><strong>書式</strong></p><pre><code>setFont(name,bold,italic,underLine)
</code></pre><ul><li><strong>name</strong><br>&emsp;フォント名</li><li><strong>bold(省略可能)</strong><br>&emsp;太字にする場合は1、そうでない場合0にするか省略する</li><li><strong>italic(省略可能)</strong><br>&emsp;斜体にする場合は1、そうでない場合0にするか省略する</li><li><strong>underLine(省略可能)</strong><br>&emsp;下線つきにする場合は1、そうでない場合0にするか省略する フォント名と指定できる文字列は<br>&emsp;&quot;ＭＳ 明朝&quot; &quot;ＭＳ ゴシック&quot; などです。ＭＳと明朝の間は半角スペースです</li></ul><p><strong>例1</strong></p><pre><code>extends SpriteChar;
while (1) {
  setFont (&quot;ＭＳ 明朝&quot;,0,1);
  drawText(x,y-30,&quot;フォントが変わりました&quot;,$clWhite);
  update();
}
</code></pre><p>▲ オブジェクトの上に明朝体、斜体で&quot;フォントが変わりました&quot;を表示します。<br>なお、実行開始時は&quot;ＭＳ Ｐゴシック&quot;、太字、斜体、下線すべてなしに設定されます</p><hr><h2 id="spritedrawtext">Sprite.drawText</h2><p>文字を描画します。</p><p><strong>書式</strong></p><pre><code>drawText(x,y,text,col,size,zOrder)
</code></pre><ul><li><strong>x</strong><br>&emsp;x座標</li><li><strong>y</strong><br>&emsp;y座標</li><li><strong>text</strong><br>&emsp;描画する値</li><li><strong>col</strong><br>&emsp;色(通常<a href="./rf-object#objectcolor">color</a>メソッドで指定)</li><li><strong>size(省略可能)</strong><br>&emsp;サイズ</li><li><strong>zOrder(省略可能)</strong><br>&emsp;描画順序。値が小さいほど手前に描画される</li></ul><p><strong>例1</strong></p><pre><code>extends SpriteChar;
i=0;
while (1) {
  drawText(x,y-30,&quot;Time&quot;,$clWhite);
  drawText(x,y-10,i,$clWhite);
  i=i+1/60;
  update();
}
</code></pre><p>▲ オブジェクトの頭上に1秒に1だけ増えるタイマーが表示されます</p><p>※ drawTextで描いた図形は、次のフレームを描画する前に消去されます。<br>必ず毎回(<a href="./rf-plainchar#plaincharupdate">update</a>が呼ばれるたびに)drawTextを実行してください。</p><p>次のような例だと、一瞬だけ表示されてすぐ消えてしまいます。</p><p><strong>例2</strong></p><p>悪い例：</p><pre><code>extends SpriteChar;
drawText(x,y-30,&quot;Time&quot;,color); // 最初の1フレームしか表示されない
i=0;
while (1) {
  drawText(x,y-10,i,color);
  i=i+1/60;
  update();
}
</code></pre><hr><h2 id="spritedrawline">Sprite.drawLine</h2><p>直線を描画します</p><p><strong>書式</strong></p><pre><code>drawLine(sx,sy,dx,dy,col,zOrder)
</code></pre><ul><li><strong>sx</strong><br>&emsp;始点のx座標</li><li><strong>sy</strong><br>&emsp;始点のy座標</li><li><strong>dx</strong><br>&emsp;終点のx座標</li><li><strong>dy</strong><br>&emsp;終点のy座標</li><li><strong>col</strong><br>&emsp;色(通常<a href="./rf-object#objectcolor">color</a>メソッドで指定)</li><li><strong>zOrder(省略可能)</strong><br>&emsp;描画順序。値が小さいほど手前に描画される</li></ul><hr><h2 id="spritedrawbrokenline">Sprite.drawBrokenLine</h2><p>点線を描画します</p><p><strong>書式</strong></p><pre><code>drawBrokenLine(sx,sy,dx,dy,col,zOrder,length)
</code></pre><ul><li><strong>sx</strong><br>&emsp;始点のx座標</li><li><strong>sy</strong><br>&emsp;始点のy座標</li><li><strong>dx</strong><br>&emsp;終点のx座標</li><li><strong>dy</strong><br>&emsp;終点のy座標</li><li><strong>col</strong><br>&emsp;色</li><li><strong>zOrder</strong><br>&emsp;描画順序(小さいほど手前に描画される)</li><li><strong>length</strong><br>&emsp;点線1個の長さ</li></ul><hr><h2 id="spritefillrect">Sprite.fillRect</h2><p>中の詰まった長方形を描画します</p><p><strong>書式</strong></p><pre><code>fillRect(sx,sy,dx,dy,col,zOrder)
</code></pre><ul><li><strong>sx</strong><br>&emsp;左上点のx座標</li><li><strong>sy</strong><br>&emsp;左上点のy座標</li><li><strong>dx</strong><br>&emsp;右下点のx座標</li><li><strong>dy</strong><br>&emsp;右下点のy座標</li><li><strong>col</strong><br>&emsp;色(通常<a href="./rf-object#objectcolor">color</a>メソッドで指定)</li><li><strong>zOrder(省略可能)</strong><br>&emsp;描画順序。値が小さいほど手前に描画される</li></ul><hr><h2 id="spritedrawsprite">Sprite.drawSprite</h2><p>スプライトを描画します。</p><p><strong>書式</strong></p><pre><code>drawSprite(x,y,p,f,zOrder)
</code></pre><ul><li><strong>x</strong><br>&emsp;x座標</li><li><strong>y</strong><br>&emsp;y座標</li><li><strong>p</strong><br>&emsp;キャラクタパターン</li><li><strong>f(省略可能)</strong><br>&emsp;0でない数値の場合、元のキャラクタパターンを左右反転したパターンを描画する</li><li><strong>zOrder(省略可能)</strong><br>&emsp;描画順序。値が小さいほど手前に描画される</li></ul><p>通常、オブジェクトに対して自動的にスプライトが描画されますが(<a href="./rf-plainchar#plaincharupdate">update</a>メソッド参照)、<br>１つのオブジェクトで複数のスプライトを描画したいときに使用します。</p><p><strong>例1</strong></p><pre><code>extends SpriteChar;
while (1) {
  drawSprite(50,50,21);
  x=100;y=100;p=5;
  update();
}
</code></pre><p>▲ このようにすると、update();により、自動的に(100,100)の位置に青い丸(パターン番号21)がかかれる他に、<br>drawSpriteによって(50,50)の位置に 青い丸(パターン番号21)がかかれます。</p><p>drawSpriteを使った場合、x,y,pの値に関係なく任意の場所に任意のパターンを描画できます。</p><p>※ drawSpriteはupdate()をするたびに毎回呼び出してください。 次のような例だと、一瞬だけ表示されてすぐ消えてしまいます。</p><p><strong>例2</strong></p><p>悪い例：</p><pre><code>drawSprite(50,50,21);  // 最初の1フレームしか表示されない
while (1) {
  x=100;y=100;p=5;
  update();
}
</code></pre><hr><h2 id="spritegetpatwidth">Sprite.getPatWidth</h2><p>キャラクタパターンの大きさ（幅）を取得します。</p><p><strong>書式</strong></p><pre><code>getPatWidth(p)
</code></pre><ul><li><strong>p</strong><br>&emsp;キャラクタパターン番号</li></ul><p><strong>戻り値</strong></p><p>p の大きさ（幅）</p><hr><h2 id="spritegetpatheight">Sprite.getPatHeight</h2><p>キャラクタパターンの大きさ（幅）を取得します。</p><p><strong>書式</strong></p><pre><code>getPatHeight(p)
</code></pre><ul><li><strong>p</strong><br>&emsp;キャラクタパターン番号</li></ul><p><strong>戻り値</strong></p><p>p の大きさ（高さ）</p><hr><h2 id="spritedrawmapsprite">Sprite.drawMapSprite</h2><p>未稿</p><p><strong>書式</strong></p><pre><code>drawMapSprite()
</code></pre><hr><h2 id="spritedrawdxsprite">Sprite.drawDxSprite</h2><p>回転、拡大、縮小、半透明のスプライトを描画します。</p><p><strong>書式</strong></p><pre><code>drawDxSprite(x,y,p,f,zOrder,angle,alpha,scaleX,scaleY)
</code></pre><ul><li><strong>x</strong><br>&emsp;x座標</li><li><strong>y</strong><br>&emsp;y座標</li><li><strong>p</strong><br>&emsp;キャラクタパターン</li><li><strong>f</strong><br>&emsp;0でない数値の場合、元のキャラクタパターンを左右反転したパターンを描画する</li><li><strong>zOrder</strong><br>&emsp;描画順序。値が小さいほど手前に描画される</li><li><strong>angle</strong><br>&emsp;回転角度。単位は度(°)を表す整数</li><li><strong>alpha</strong><br>&emsp;不透明度を0から255の整数であらわす。小さい値ほど透けて見える</li><li><strong>scaleX</strong><br>&emsp;横方向の拡大率。１が原寸</li><li><strong>scaleY(省略可能)</strong><br>&emsp;縦方向の拡大率。省略するとscaleXと同じ</li></ul><p><strong>例1</strong></p><pre><code>extends SpriteChar;
p=-1;
while (1) {
  drawDxSprite(50,50,4,0,0,i,128,2);
  i=(i+1) % 360;
  update();
}
</code></pre><p>▲ このようにすると、回転する立方体が見えます。</p><hr><h2 id="spritedrawpolygon">Sprite.drawPolygon</h2><p>正多角形を描画します。</p><p><strong>書式</strong></p><pre><code>drawPolygon(x,y,number,size,col,ang,zOrder)
</code></pre><ul><li><strong>x</strong><br>&emsp;正多角形の中心のx座標</li><li><strong>y</strong><br>&emsp;正多角形の中心のy座標</li><li><strong>number</strong><br>&emsp;頂点・辺の数（正number角形を描画します）</li><li><strong>size</strong><br>&emsp;中心から頂点までの距離</li><li><strong>col</strong><br>&emsp;色(通常<a href="./rf-object#objectcolor">color</a>メソッドで指定)</li><li><strong>ang</strong><br>&emsp;回転角度</li><li><strong>zOrder(省略可能)</strong><br>&emsp;描画順序。値が小さいほど手前に描画される</li></ul><hr><h2 id="spritedrawscreenxy">Sprite.drawScreenXY</h2><p>各種描画命令において、座標系にスクリーン座標を使うか、ワールド座標を使うかを指定します。</p><p><strong>書式</strong></p><pre><code>drawScreenXY(sc)
</code></pre><ul><li><strong>sc</strong><br>&emsp;0=ワールド座標を使う 1=スクリーン座標を使う</li></ul><p>主に、画面がスクロールするゲームにおいて、<br>スコア表示など特定のオブジェクトを スクロールさせたくない場合に用います。</p><p>オブジェクトをスクロールにあわせて動かないようにするには次のようなメソッドを定義します。</p><p><strong>例1</strong></p><pre><code>extends TextChar;
function draw() {
  drawScreenXY(1);
  super.draw();
  drawScreenXY(0);
}
x=100;
y=20;
text=&quot;Score : 0&quot;;
wait();
</code></pre><p>▲ このオブジェクトはスクロールしても必ず画面上の(100,20)の位置にあります</p><p>drawScreenXYメソッドは、<a href="#spritedrawsprite">drawSprite</a>、<a href="#spritedrawdxsprite">drawDxSprite</a>、<a href="#spritedrawtext">drawText</a>、<a href="#spritedrawline">drawLine</a>、<a href="#spritefillrect">fillRect</a>の各メソッドにおける引数xとyに機能します。</p><p>ワールド座標を用いた場合、(x,y)の値をワールド座標として解釈します。この場合スクロールした位置により画面上の表示位置が変化します。<br>スクリーン座標を用いた場合、スクロールしても画面上の位置は変化しません。<br>スクリーン座標、ワールド座標については<a href="./html/scroll/html/HID00000001.htm">スクロールのサンプル</a>を参照してください。</p><hr><h2 id="spritecentertext">Sprite.centerText</h2><p>指定された座標が中心になるように文字を描画します。</p><p><strong>書式</strong></p><pre><code>centerText(x,y,text,col,size,zOrder)
</code></pre><ul><li><strong>x</strong><br>&emsp;テキストの中心のx座標</li><li><strong>y</strong><br>&emsp;テキストの中心のy座標</li><li><strong>text</strong><br>&emsp;描画する値</li><li><strong>col</strong><br>&emsp;色(通常<a href="./rf-object#objectcolor">color</a>メソッドで指定)</li><li><strong>size(省略可能)</strong><br>&emsp;文字のサイズ</li><li><strong>zOrder(省略可能)</strong><br>&emsp;描画順序。値が小さいほど手前に描画される</li></ul><hr><h2 id="spritedrawverticaltext">Sprite.drawVerticalText</h2><p>縦書きの文字を描画します。</p><p><strong>書式</strong></p><pre><code>drawVerticalText(x,y,text,col,size,zOrder)
</code></pre><ul><li><strong>x</strong><br>&emsp;テキストの中心のx座標</li><li><strong>y</strong><br>&emsp;テキストの中心のy座標</li><li><strong>text</strong><br>&emsp;描画する値</li><li><strong>col</strong><br>&emsp;色(通常<a href="./rf-object#objectcolor">color</a>メソッドで指定)</li><li><strong>size(省略可能)</strong><br>&emsp;サイズ</li><li><strong>zOrder(省略可能)</strong><br>&emsp;描画順序。値が小さいほど手前に描画される</li></ul><hr><h2 id="spritedrawrect">Sprite.drawRect</h2><p>中空の四角形を描画します。</p><p><strong>書式</strong></p><pre><code>drawRect(sx,sy,dx,dy,col,zOrder)
</code></pre><ul><li><strong>sx</strong><br>&emsp;左上の頂点のx座標</li><li><strong>sy</strong><br>&emsp;左上の頂点のy座標</li><li><strong>dx</strong><br>&emsp;右下の頂点のx座標</li><li><strong>dy</strong><br>&emsp;右下の頂点のy座標</li><li><strong>col</strong><br>&emsp;色(通常<a href="./rf-object#objectcolor">color</a>メソッドで指定)</li><li><strong>zOrder(省略可能)</strong><br>&emsp;描画順序。値が小さいほど手前に描画される</li></ul><hr><h2 id="spritedrawrectdx">Sprite.drawRectDx</h2><p>中空の四角形を描画します。回転が可能です</p><p><strong>書式</strong></p><pre><code>drawRectDx(sx,sy,dx,dy,col,angle,zOrder)
</code></pre><ul><li><strong>sx</strong><br>&emsp;中心のx座標</li><li><strong>sy</strong><br>&emsp;中心のy座標</li><li><strong>dx</strong><br>&emsp;幅</li><li><strong>dy</strong><br>&emsp;高さ</li><li><strong>col</strong><br>&emsp;色(通常<a href="./rf-object#objectcolor">color</a>メソッドで指定)</li><li><strong>angle</strong><br>&emsp;回転角度</li><li><strong>zOrder(省略可能)</strong><br>&emsp;描画順序。値が小さいほど手前に描画される</li></ul><hr><h2 id="spritedrawtriangle">Sprite.drawTriangle</h2><p>指定された座標が中心になるように文字を描画します。</p><p><strong>書式</strong></p><pre><code>drawTriangle(ax,ay,bx,by,cx,cy,col,angle,zOrder)
</code></pre><ul><li><strong>ax</strong><br>&emsp;頂点Aのx座標(※)</li><li><strong>ay</strong><br>&emsp;頂点Aのy座標(※)</li><li><strong>bx</strong><br>&emsp;頂点Bのx座標(※)</li><li><strong>by</strong><br>&emsp;頂点Bのy座標(※)</li><li><strong>cx</strong><br>&emsp;頂点Cのx座標(※)</li><li><strong>cy</strong><br>&emsp;頂点Cのy座標(※)</li><li><strong>col</strong><br>&emsp;色(通常<a href="./rf-object#objectcolor">color</a>メソッドで指定)</li><li><strong>angle(省略可能)</strong><br>&emsp;回転角</li><li><strong>zOrder(省略可能)</strong><br>&emsp;描画順序。値が小さいほど手前に描画される</li></ul><p>(※) : angle=0 のときの座標です。angleの値に応じて、右回転します。</p><hr><h2 id="spritegradationline">Sprite.gradationLine</h2><p>グラデーション付きの直線を描画します</p><p><strong>書式</strong></p><pre><code>gradationLine(sx,sy,dx,dy,cols,cold,zOrder)
</code></pre><ul><li><strong>sx</strong><br>&emsp;始点のx座標</li><li><strong>sy</strong><br>&emsp;始点のy座標</li><li><strong>dx</strong><br>&emsp;終点のx座標</li><li><strong>dy</strong><br>&emsp;終点のy座標</li><li><strong>cols</strong><br>&emsp;始点の色(通常<a href="./rf-object#objectcolor">color</a>メソッドで指定)</li><li><strong>cold</strong><br>&emsp;終点の色(通常<a href="./rf-object#objectcolor">color</a>メソッドで指定)</li><li><strong>zOrder(省略可能)</strong><br>&emsp;描画順序。値が小さいほど手前に描画される</li></ul><hr><h2 id="spritegradationrect">Sprite.gradationRect</h2><p>グラデーションつき長方形を描画します</p><p><strong>書式</strong></p><pre><code>gradationRect(sx,sy,dx,dy,type,cols,cold,zOrder)
</code></pre><ul><li><strong>sx</strong><br>&emsp;左上点のx座標</li><li><strong>sy</strong><br>&emsp;左上点のy座標</li><li><strong>dx</strong><br>&emsp;右下点のx座標</li><li><strong>dy</strong><br>&emsp;右下点のy座標</li><li><strong>type</strong><br>&emsp;0 - 左→右にグラデーションをかける<br>&emsp;1 - 上→下にグラデーションをかける</li><li><strong>cols</strong><br>&emsp;左端（上端）の色(通常<a href="./rf-object#objectcolor">color</a>メソッドで指定)</li><li><strong>cold</strong><br>&emsp;右端（下端）(通常<a href="./rf-object#objectcolor">color</a>メソッドで指定)</li><li><strong>zOrder(省略可能)</strong><br>&emsp;描画順序。値が小さいほど手前に描画される</li></ul><hr><h2 id="spritegradationtext">Sprite.gradationText</h2><p>グラデーションつき文字を描画します。</p><p><strong>書式</strong></p><pre><code>gradationText(x,y,text,colL,colR,size,zOrder)
</code></pre><ul><li><strong>x</strong><br>&emsp;x座標</li><li><strong>y</strong><br>&emsp;y座標</li><li><strong>text</strong><br>&emsp;描画する値</li><li><strong>colL</strong><br>&emsp;左端の色(通常<a href="./rf-object#objectcolor">color</a>メソッドで指定)</li><li><strong>colR</strong><br>&emsp;右端の色(通常<a href="./rf-object#objectcolor">color</a>メソッドで指定)</li><li><strong>size(省略可能)</strong><br>&emsp;サイズ</li><li><strong>zOrder(省略可能)</strong><br>&emsp;描画順序。値が小さいほど手前に描画される</li></ul><hr><h2 id="spritefillpolygon">Sprite.fillPolygon</h2><p>多角形を描画し，塗りつぶします。</p><p><strong>書式</strong></p><pre><code>fillPolygon(x,y,points,color,zOrder)
</code></pre><ul><li><strong>x</strong><br>&emsp;基準点のx座標</li><li><strong>y</strong><br>&emsp;基準点のy座標</li><li><strong>points</strong><br>&emsp;頂点の数</li><li><strong>col</strong><br>&emsp;色(通常<a href="./rf-object#objectcolor">color</a>メソッドで指定)</li><li><strong>zOrder(省略可能)</strong><br>&emsp;描画順序。値が小さいほど手前に描画される 各点の座標は、<a href="#spritesetpolygon">Sprite.setPolygon</a>で指定します。</li></ul><pre><code>extends SpriteChar;
setPolygon(0,-50,0);
setPolygon(1,50,-30);
setPolygon(2,30,130);
$panel.fillPolygon(x,y,3,$clRed);
while (1) {
  for (i=0; i&lt;6; i++) {
    sz=100;
    setPolygon(i,sin(i*60+x)*sz,cos(i*60+x)*sz);
  }
  fillPolygon(x,y,6,$clGreen,zOrder);
  fillPolygon(x+30,y+30,6,$clBlack,zOrder+1);
  x++;
  update();
}
</code></pre><hr><h2 id="spritesetpolygon">Sprite.setPolygon</h2><p><a href="#spritefillpolygon">Sprite.fillPolygon</a> における頂点を指定します。</p><p><strong>書式</strong></p><pre><code>setPolygon(seq,x,y)
</code></pre><ul><li><strong>seq</strong><br>&emsp;点番号。seq==0,1,2... の順に点を結んで多角形を描画する。最大99</li><li><strong>x</strong><br>&emsp;点の x 座標</li><li><strong>y</strong><br>&emsp;点の y 座標</li></ul><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-selectbox"class="pagediv"title2="命令リファレンス - $SelectBox - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="selectboxオブジェクト">$SelectBoxオブジェクト</h2><p>選択肢を表示するダイアログボックスです</p><p>※ <a href="./rf-plainchar#plaincharwaitselect">waitSelect</a>も参考にしてください。</p><h3 id="例1">例1</h3><pre><code>extends TextChar;
$SelectBox.open(&quot;何を買いますか？&quot;, &quot;ここは武器屋です&quot;, &quot;剣&quot;, &quot;槍&quot;, &quot;斧&quot;, &quot;杖&quot;);
while (1) {
  select=$SelectBox.getStatus();
  if (select==0) text=&quot;選択中&quot;;
  else if (select==1) text=&quot;剣を買いました&quot;;
  else if (select==2) text=&quot;槍を買いました&quot;;
  else if (select==3) text=&quot;斧を買いました&quot;;
  else if (select==4) text=&quot;杖を買いました&quot;;
  else if (select==-1) text=&quot;何も買いませんでした&quot;;
  update();
}
</code></pre><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#selectboxopen">open</a></td><td>はい・いいえ選択用ダイアログボックスを開きます。</td></tr><tr><td><a href="#selectboxgetstatus">getStatus</a></td><td>はい・いいえ選択用のウィンドウの状態を調べます</td></tr></tbody></table><hr><h2 id="selectboxopen">$SelectBox.open</h2><p>はい・いいえ選択用ダイアログボックスを開きます。</p><p><strong>書式</strong></p><pre><code>open(prompt,title,st1,st2,st3,st4) 
</code></pre><ul><li><strong>prompt</strong><br>&emsp;メッセージ</li><li><strong>title</strong><br>&emsp; タイトルバーの文字列（省略すると&quot;確認&quot;)</li><li><strong>st1</strong><br>&emsp; 1個目のボタンの文字列 （省略すると&quot;はい&quot;)</li><li><strong>st2</strong><br>&emsp; 2個目のボタンの文字列 （省略すると&quot;いいえ&quot;)</li><li><strong>st3</strong><br>&emsp; 3個目のボタンの文字列 （省略すると表示しない)</li><li><strong>st4</strong><br>&emsp; 4個目のボタンの文字列 （省略すると表示しない)</li></ul><p><a href="./rf-plainchar#plaincharwaitselect">waitSelect</a>と異なり、ボタンが押されるまで処理を中断しません。</p><p>どのボタンが押されたか<a href="#selectboxgetstatus">$SelectBox.getStatus</a>で調べます。</p><hr><h2 id="selectboxgetstatus">$SelectBox.getStatus</h2><p>はい・いいえ選択用のウィンドウの状態を調べます</p><p><strong>書式</strong></p><pre><code>getStatus() 
</code></pre><p><strong>戻り値</strong></p><p>-1：ダイアログを閉じた<br>0：まだボタンを選択していない（選択中）<br>1：左から1番目のボタンを選択した<br>2：左から2番目のボタンを選択した<br>3：左から3番目のボタンを選択した<br>4：左から4番目のボタンを選択した</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-secretchar"class="pagediv"title2="命令リファレンス - SecretChar - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="secretcharクラス">SecretCharクラス</h2><p>SecretCharクラスのオブジェクトは、実行中は表示されません。（設計時には表示されます）</p><p>使える変数は<a href="./rf-spritechar">SpriteChar</a>と同じです。これらは実行中には意味をもちません。 設計時に表示する位置やキャラクタパターンを指定するためにあります。</p><h3 id="メソッド一覧">メソッド一覧</h3><p><a href="./rf-plainchar">PlainChar</a>クラスのメソッドが使えます。</p><h3 id="変数一覧">変数一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#serectcharpat">pat</a></td><td>設計時に表示されるキャラクタパターンです。</td></tr></tbody></table><hr><h2 id="secretcharpat">SecretChar.pat</h2><p>設計時に表示されるキャラクタパターンです。実行時は意味を持ちません。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-screen-wh"class="pagediv"title2="命令リファレンス - $screenWidth, $screenHeight - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="screenwidth-screenheight">$screenWidth, $screenHeight</h2><p>ウィンドウの幅や高さを取得・設定できます。</p><ul><li><strong>$screenWidth</strong><br>&emsp;ウィンドウの幅を返します。代入すると幅が変わります。</li><li><strong>$screenHeight</strong><br>&emsp;ウィンドウの高さ（縦幅）を返します。代入すると高さが変わります。</li></ul><p><strong>関連</strong></p><ul><li><a href="./rf-window#windowsizeable">$window.sizeable</a></li></ul><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-return"class="pagediv"title2="命令リファレンス - return - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="return">return</h2><p><a href="./rf-method-define">メソッドの定義</a>の途中で、メソッドの処理を終了します。</p><h4 id="書式">書式</h4><pre><code>return 戻り値;
</code></pre><p>戻り値は、メソッドを呼び出した側に返される値です。(省略可能)</p><h3 id="例1">例1</h3><pre><code>extends SpriteChar;
function inRect(sx,sy,dx,dy) {
  if (x&gt;=sx &amp;&amp; y&gt;=sy &amp;&amp; x&lt;=dx &amp;&amp; y&lt;=dy) return 1;
  return 0;
}
t=200;
while (1) {
if (getkey(39)&gt;0) x+=3;
   if (getkey(37)&gt;0) x-=3;
   if (getkey(40)&gt;0) y+=3;
   if (getkey(38)&gt;0) y-=3;
   t+=0.1;
   fillRect(t,200,t+100,300,$clRed);
   if ( inRect( t,200,t+100,300)==1 ) die();
   update();
}
</code></pre><p>▲ カーソルキーで移動しますが、赤枠のなかに入ると消滅します。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-ranking"class="pagediv"title2="命令リファレンス - $ranking - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="rankingオブジェクト">$rankingオブジェクト</h2><p>ネットランキングCGIの呼び出しを行います</p><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#rankingopenbrowser">openBrowser</a></td><td>メニューの「ウィンドウ」＞「ネットランキング」で指定したURLを開きます。</td></tr><tr><td><a href="#rankingsetparam">setParam</a></td><td>ランキングCGIに渡すパラメータを設定します。</td></tr></tbody></table><hr><h2 id="rankingopenbrowser">$ranking.openBrowser</h2><p>メニューの「ウィンドウ」＞「ネットランキング」で指定したURLを開きます。</p><p><strong>書式</strong></p><pre><code>openBrowser()
</code></pre><hr><h2 id="rankingsetparam">$ranking.setParam</h2><p>ランキングCGIに渡すパラメータを設定します。</p><p><strong>書式</strong></p><pre><code>setParam(name,value)
</code></pre><ul><li><strong>name</strong><br>&emsp;パラメータ名</li><li><strong>value</strong> &emsp;値</li></ul><p>ネットランキングの詳しい設置法は、<a href="./tr-stg11-1">チュートリアル</a>を参照してください</p><p>nameで指定される名前のパラメータに 値value を設定します。 valueには文字列または数値を指定します。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-radiobutton"class="pagediv"title2="命令リファレンス - RadioButton - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="radiobuttonクラス">RadioButtonクラス</h2><p>ラジオボタンを作成します</p><h3 id="例1">例1</h3><pre><code>extends RadioButton; //必ずRadioButtonを親クラスにしてください。
a=new Array();
a.add(&quot;OFF&quot;);a.add(&quot;OFF&quot;);a.add(&quot;OFF&quot;);a.add(&quot;OFF&quot;);a.add(&quot;OFF&quot;);a.add(&quot;OFF&quot;);
init(3,3);
while(1) {
  if (create(300,120,0,0,3,$clBlack)==1) a.set(0,&quot;ON&quot;);else a.set(0,&quot;OFF&quot;);
  if (create(300,140,0,1,3,$clRed)==1) a.set(1,&quot;ON&quot;);else a.set(1,&quot;OFF&quot;);
  if (create(300,160,0,2,3,$clGreen)==1) a.set(2,&quot;ON&quot;);else a.set(2,&quot;OFF&quot;);
  if (create(350,120,1,0,3,$clYellow)==1) a.set(3,&quot;ON&quot;);else a.set(3,&quot;OFF&quot;);
  if (create(350,140,1,1,3,$clPink)==1) a.set(4,&quot;ON&quot;);else a.set(4,&quot;OFF&quot;);
  if (create(350,160,1,2,3,$clWhite)==1) a.set(5,&quot;ON&quot;);else a.set(5,&quot;OFF&quot;);
  drawText(320,120,a.get(0),$clBlack,10);
  drawText(320,140,a.get(1),$clBlack,10);
  drawText(320,160,a.get(2),$clBlack,10);
  drawText(370,120,a.get(3),$clBlack,10);
  drawText(370,140,a.get(4),$clBlack,10);
  drawText(370,160,a.get(5),$clBlack,10);
  update();
}
</code></pre><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#radiobuttoninit">init</a></td><td>ラジオボタン作成の準備をします</td></tr><tr><td><a href="#radiobuttoncreate">create</a></td><td>ラジオボタンを作成します</td></tr></tbody></table><hr><h2 id="radiobuttoninit">RadioButton.init</h2><p>ラジオボタン作成の準備をします</p><p><strong>書式</strong></p><pre><code>init(group,number)
</code></pre><ul><li><strong>group</strong><br>&emsp;作成するグループの数</li><li><strong>number</strong><br>&emsp;1グループに存在するラジオボタンの最大数</li></ul><hr><h2 id="radiobuttoncreate">RadioButton.create</h2><p>ラジオボタンを作成します</p><p><strong>書式</strong></p><pre><code>create(x,y,group,number,maxNumber,color,zOrder)
</code></pre><ul><li><strong>x</strong><br>&emsp;ラジオボタンのx座標</li><li><strong>y</strong><br>&emsp;ラジオボタンのy座標</li><li><strong>group</strong><br>&emsp;グループID (0-N) N=<a href="#radiobuttoninit">init</a>で指定したグループの個数-1</li><li><strong>number</strong><br>&emsp;グループ内の通し番号 (0 - maxNumber-1)</li><li><strong>maxNumber</strong><br>&emsp;グループ内にあるラジオボタンの個数(0-N) N=<a href="#radiobuttoninit">init</a>における、group-1</li><li><strong>color</strong><br>&emsp;色</li><li><strong>zOrder</strong><br>&emsp;表示順序</li></ul><p>作成前に必ず<a href="#radiobuttoninit">init</a>メソッドを呼んでください</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-projectmanager"class="pagediv"title2="命令リファレンス - $projectManager - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="projectmanagerオブジェクト">$projectManagerオブジェクト</h2><p>ページの読み込みを行います</p><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#projectmanagerloadpage">loadPage</a></td><td>他のページを読み込みます。</td></tr><tr><td><a href="#projectmanagergetcurrentpagename">getCurrentPageName</a></td><td>現在開いているページの名前を得ます。</td></tr></tbody></table><hr><h2 id="projectmanagerloadpage">$projectManager.loadPage</h2><p>他のページを読み込みます。</p><p><strong>書式</strong></p><pre><code>loadPage(page)
</code></pre><ul><li><strong>page</strong><br>&emsp;読み込むページ</li></ul><p>pageに指定するのは、<a href="./wnd-prjmgr">プロジェクトマネージャ</a>に表示されるページ名です。<br>例えば、図1のように表示されている場合、$page_index, $page_stage2,$page_startのいずれかを指定します。</p><p><img src-t="./img/1men.png"width="314"height="270"alt="1men.png"></p><p><strong>例1</strong></p><pre><code>$projectManager.loadPage($page_index);
</code></pre><p>▲ 図1で赤く囲ったページ($page_index)を読み込みます。</p><p>※ loadPageメソッド実行後、次に<a href="./rf-plainchar#plaincharupdate">update</a>、<a href="./rf-plainchar#plaincharupdateex">updateEx</a>、<a href="./rf-plainchar#plaincharwait">wait</a>の いずれかのメソッドが呼ばれるまでは、移動前のページで処理が続行します。</p><p>※ ページを切り替えたときにBGMを止めない方法</p><pre><code>$Options.set(&quot;sound_stopOnPageLoad&quot;, 1);
</code></pre><p>参照： <a href="./options#optionsset">$Options.set</a>メソッド</p><hr><h2 id="projectmanagergetcurrentpagename">$projectManager.getCurrentPageName</h2><p>現在開いているページの名前を得ます。</p><p><strong>書式</strong></p><pre><code>getCurrentPageName() 
</code></pre><p><strong>戻り値</strong></p><p>現在開いているページの名前をあらわす文字列</p><p><strong>例1</strong></p><pre><code>extends TextChar;
text=&quot;現在のページ名は&quot;+$projectManager.getCurrentPageName()+&quot;です&quot;;
wait();
</code></pre><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-plainchar"class="pagediv"title2="命令リファレンス - PlainChar - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="plaincharクラス">PlainCharクラス</h2><p>画面上に表示されるオブジェクト(<a href="./rf-spritechar">SpriteChar</a>、<a href="./rf-dxchar">DxChar</a>、<a href="./rf-textchar">TextChar</a>、<a href="./rf-secretchar">SecretChar</a>)の親クラスです。</p><p>これら4種類のオブジェクトに共通な変数やメソッドが用意されています。</p><p>このページで示したものの他にも、<a href="./rf-sprite">Sprite</a>クラスのメソッド（描画命令）も使えます。併せて参照してください。</p><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#plaincharonmousedown">onMouseDown</a></td><td>オブジェクト上でマウスが押されたときに特別な処理をしたいときにユーザが定義するメソッドです。</td></tr><tr><td><a href="#plaincharonmousedownfordesign">onMouseDownForDesign</a></td><td>未稿</td></tr><tr><td><a href="#plaincharonmousedrag">onMouseDrag</a></td><td>マウスボタンが押された状態で、オブジェクト上でマウスが動いたときに特別な処理をしたいときにユーザが定義するメソッドです。</td></tr><tr><td><a href="#plaincharcrashto">crashTo</a></td><td>他のオブジェクトと衝突しているかどうかを判定します。</td></tr><tr><td><a href="#plaincharcrashtoline">crashToLine</a></td><td>オブジェクトと線分の衝突判定を行います。</td></tr><tr><td><a href="#plaincharcrashat">crashAt</a></td><td>未稿</td></tr><tr><td><a href="#plaincharondraw">onDraw</a></td><td>オブジェクトに描画をするときに、特別な処理をする場合にユーザが定義するメソッドです。</td></tr><tr><td><a href="#plainchardraw">draw</a></td><td>未稿</td></tr><tr><td><a href="#plaincharonupdate">onUpdate</a></td><td>updateメソッド、updateExメソッドが呼び出されたときに特別な処理をしたいときにユーザが定義するメソッドです。</td></tr><tr><td><a href="#plaincharupdate">update</a></td><td>オブジェクトの書き換え処理を行います。</td></tr><tr><td><a href="#plaincharupdateex">updateEx</a></td><td>updateメソッドを指定した回数分実行します。これにより、指定したフレーム数だけ待機することができます。</td></tr><tr><td><a href="#plaincharondie">onDie</a></td><td>オブジェクトが死んだときに特別な処理をしたいときにユーザが定義するメソッドです。</td></tr><tr><td><a href="#plainchardie">die</a></td><td>オブジェクトを殺します。</td></tr><tr><td><a href="#plaincharisdead">isDead</a></td><td>オブジェクトが死んでいるかどうかを判定します。</td></tr><tr><td><a href="#plaincharwait">wait</a></td><td>オブジェクトの動作を一時的に停止し、待機状態にします。</td></tr><tr><td><a href="#plaincharnotify">notify</a></td><td>waitメソッドで待機状態にあるオブジェクトの動作を再開します。</td></tr><tr><td><a href="#plaincharsetvisible">setVisible</a></td><td>オブジェクトの表示・非表示を設定します。</td></tr><tr><td><a href="#plainchargetvisible">getVisible</a></td><td>オブジェクトの表示・非表示状態を取得します。</td></tr><tr><td><a href="#plaincharscreenout">screenOut</a></td><td>オブジェクトが画面外に出たかどうかを判定します。</td></tr><tr><td><a href="#plainchargetscreenx">getScreenX</a></td><td>オブジェクトのスクリーン座標のx座標を得ます。</td></tr><tr><td><a href="#plainchargetscreeny">getScreenY</a></td><td>オブジェクトのスクリーン座標のy座標を得ます。</td></tr><tr><td><a href="#plainchargotoscreen">gotoScreen</a></td><td>オブジェクトの位置をスクリーン座標を用いて指定します。</td></tr><tr><td><a href="#plaincharonappear">onAppear</a></td><td>実行開始時またはappearメソッドによりオブジェクトが出現したときに、特別な処理をする場合にユーザが定義するメソッドです。</td></tr><tr><td><a href="#plaincharwaitselect">waitSelect</a></td><td>はい・いいえ選択用のウィンドウを開き、ユーザがウィンドウを閉じるまで処理を中断します。</td></tr><tr><td><a href="#plaincharwaitinput">waitInput</a></td><td>文字入力用のウィンドウを開き、ユーザがボタン（「Ok」 または「キャンセル」）を押すまで処理を中断します。</td></tr></tbody></table><h3 id="変数一覧">変数一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#%E5%A4%89%E6%95%B0x">x</a></td><td>オブジェクトのx座標をあらわす変数です</td></tr><tr><td><a href="#%E5%A4%89%E6%95%B0y">y</a></td><td>オブジェクトのy座標をあらわす変数です</td></tr><tr><td><a href="#%E5%A4%89%E6%95%B0zOrder">zOrder</a></td><td>複数のオブジェクトが重なった場合、この値が小さいオブジェクトのほうが手前に表示されます。</td></tr></tbody></table><hr><h2 id="plaincharonmousedown">PlainChar.onMouseDown</h2><p>オブジェクト上でマウスが押されたときに特別な処理をしたいときにユーザが定義するメソッドです。</p><p><strong>書式</strong></p><pre><code>function onMouseDown(x,y,lb,rb) {
  処理内容
}
</code></pre><ul><li><strong>x</strong><br>&emsp;マウスカーソルのx座標（ウィンドウの左端が0)</li><li><strong>y</strong><br>&emsp;マウスカーソルのy座標（ウィンドウの上端が0)</li><li><strong>lb</strong><br>&emsp;左ボタンがおされていれば1,そうでなければ0</li><li><strong>rb</strong><br>&emsp;右ボタンがおされていれば1,そうでなければ0</li></ul><p>※ onMouseDownはユーザが直接呼び出さないでください。</p><p><span style="color:red">※ このメソッドの中で<a href="#plaincharupdate">update</a>メソッドを呼ばないようにしてください</span></p><hr><h2 id="plaincharonmousedownfordesign">PlainChar.onMouseDownForDesign</h2><p>未稿</p><p><strong>書式</strong></p><pre><code>onMouseDownForDesign()
</code></pre><hr><h2 id="plaincharonmousedrag">PlainChar.onMouseDrag</h2><p>マウスボタンが押された状態で、オブジェクト上でマウスが動いたときに特別な処理をしたいときにユーザが定義するメソッドです。</p><p><strong>書式</strong></p><pre><code>function onMouseDrag(sx,sy,dx,dy,lb,rb) {
  処理内容
}
</code></pre><ul><li><strong>sx</strong><br>&emsp;移動前のマウスカーソルのx座標（ウィンドウの左端が0)</li><li><strong>sy</strong><br>&emsp;移動前のマウスカーソルのy座標（ウィンドウの上端が0)</li><li><strong>dx</strong><br>&emsp;移動後のマウスカーソルのx座標（ウィンドウの左端が0)</li><li><strong>dy</strong><br>&emsp;移動後のマウスカーソルのy座標（ウィンドウの上端が0)</li><li><strong>lb</strong><br>&emsp;左ボタンがおされていれば1,そうでなければ0</li><li><strong>rb</strong><br>&emsp;右ボタンがおされていれば1,そうでなければ0</li></ul><p>onMouseDragはユーザが直接呼び出さないでください。</p><p><span style="color:red">※ onMouseDragの中で<a href="#plaincharupdate">update</a>メソッドを呼ばないようにしてください</span></p><hr><h2 id="plaincharcrashto">PlainChar.crashTo</h2><p>他のオブジェクトと衝突しているかどうかを判定します。</p><p><strong>書式</strong></p><pre><code>crashTo(t)
</code></pre><ul><li><strong>t</strong><br>&emsp;判定対象のオブジェクト</li></ul><p><strong>戻り値</strong></p><p>tと衝突していれば真(0以外の値)、そうでなければ偽(0)</p><p><strong>例1</strong></p><pre><code>extends SpriteChar;
while(1) {
  if (crashTo($Teki)) die();
  update();
}
</code></pre><p>▲ $Tekiとぶつかっていたら、die()メソッドを呼び、このオブジェクトが死にます。</p><p>※ crashToは自分で定義することもできます。<br>これを利用して、当たり判定の大きさの調整などができます。</p><p><strong>例2</strong></p><pre><code>extends SpriteChar;
function crashTo(t) {
  return dist(t.x-x,t.y-y)&lt;50;
}
while(1) {
  if (crashTo($Teki)) die();
  update();
}
</code></pre><p>▲ この例では、他のオブジェクト(t)との距離が50未満のときにcrashToは真に（このオブジェクトとtがぶつかった）なります。</p><p><strong>関連</strong></p><ul><li><a href="./rf-for-chars">for (xx in $chars)</a></li></ul><hr><h2 id="plaincharcrashtoline">PlainChar.crashToLine</h2><p>オブジェクトと線分の衝突判定を行います。</p><p><strong>書式</strong></p><pre><code>crashToLine(sx,sy,dx,dy,width,xx,yy)
</code></pre><ul><li><strong>sx</strong><br>&emsp;始点のx座標</li><li><strong>sy</strong><br>&emsp;始点のy座標</li><li><strong>dx</strong><br>&emsp;終点のx座標</li><li><strong>dy</strong><br>&emsp;終点のy座標</li><li><strong>width</strong><br>&emsp;線分の幅</li><li><strong>xx(省略可能)</strong><br>&emsp;判定する点のx座標。省略するとオブジェクトのxの値</li><li><strong>yy(省略可能)</strong><br>&emsp;判定する点のy座標。省略するとオブジェクトのyの値</li></ul><p><strong>戻り値</strong></p><p>(sx,sy)と(dx,dy)を結ぶ、幅がwidthドットの線分と点(xx,yy)がぶつかっていれば 真(0でない値)。そうでなければ偽 (0)</p><p>※ (sx,sy)と(dx,dy) が一致してしまうとエラーになります</p><p><strong>例1</strong></p><p>LineRoll.tonyu</p><pre><code>extends SpriteChar;
a=0;
while (1) {
  sx=x+cos(a)*100;
  sy=y+sin(a)*100;
  drawLine(x,y,sx,sy,$clWhite);
  update();
  a+=rnd(10);
}
</code></pre><p>Jiki.tonyu</p><pre><code>extends SpriteChar;
while(1) {
  if (getkey(39)&gt;0) x+=3;
  if (getkey(37)&gt;0) x-=3; 
  if (getkey(40)&gt;0) y+=3;
  if (getkey(38)&gt;0) y-=3;
  if (crashToLine($LineRoll.x,$LineRoll.y,$LineRoll.sx,$LineRoll.sy,10)) {
    die();
  }
  update();
}
</code></pre><hr><h2 id="plaincharcrashat">PlainChar.crashAt</h2><p>未稿</p><p><strong>書式</strong></p><pre><code>crashAt()
</code></pre><hr><h2 id="plaincharondraw">PlainChar.onDraw</h2><p>オブジェクトに描画をするときに、特別な処理をする場合にユーザが定義するメソッドです。</p><p><strong>書式</strong></p><pre><code>function onDraw() {
  処理内容
}
</code></pre><p>onDrawはユーザが直接呼び出さないでください。</p><p><span style="color:red">※ このメソッドの中で<a href="#plaincharupdate">update</a>メソッドを呼ばないようにしてください</span></p><p><strong>例1</strong></p><pre><code>function onDraw() {
  drawText(x,y-30,&quot;Text&quot;,$clWhite);
}
</code></pre><p>▲ このようにすると、オブジェクトの上にTextという文字が表示されまず。<br>(設計中でも表示されます)</p><p><span style="color:red">※ このメソッド内部でエラーが起きると、設計時にオブジェクトが正しく表示されなくなります。<br>その場合は、onDrawの部分を<a href="./rf-comment">注釈</a>にするなどして、表示の問題を回避してください。</span></p><hr><h2 id="plainchardraw">PlainChar.draw</h2><p>未稿</p><p><strong>書式</strong></p><pre><code>draw()
</code></pre><hr><h2 id="plaincharonupdate">PlainChar.onUpdate</h2><p><a href="#plaincharupdate">update</a>メソッド、<a href="#plaincharupdateex">updateEx</a>メソッドが呼び出されたときに特別な処理をしたいときにユーザが定義するメソッドです。</p><p><strong>書式</strong></p><pre><code>onUpdate()
</code></pre><p>※ onUpdateは<a href="#plaincharupdate">update</a>メソッドから自動的に呼ばれます。ユーザが直接呼び出さないでください。</p><p>※ このメソッドの中でupdateメソッドを呼ぶことが可能です。但しその場合onUpdateが重複して呼ばれることはありません。</p><p><strong>例1</strong></p><pre><code>function onUpdate() {
  drawText(x,y-10,&quot;Text&quot;,color(255,255,255));  
}
</code></pre><p>▲ このように定義しておくと、オブジェクトの上にTextという文字が書かれるようになります。</p><hr><h2 id="plaincharupdate">PlainChar.update</h2><p>オブジェクトの書き換え処理を行います。</p><p><strong>書式</strong></p><pre><code>update()
</code></pre><p>updateは１フレーム（コマ）が終了する毎に必ず呼び出してください。</p><p>通常のスプライトオブジェクトは、updateが呼ばれた時点で、次にあげる変数の内容にしたがってスプライトが描画されます。</p><ul><li><strong>x</strong><br>&emsp;x座標</li><li><strong>y</strong><br>&emsp;y座標</li><li><strong>p</strong><br>&emsp;キャラクタパターン</li><li><strong>f</strong><br>&emsp;0でない数値の場合、元のキャラクタパターンを左右反転したパターンを描画する</li><li><strong>zOrder</strong><br>&emsp;このスプライトの表示順序を決める。描画時に、この値の小さいスプライトが手前にくるように描画される。</li></ul><hr><h2 id="plaincharupdateex">PlainChar.updateEx</h2><p><a href="#plaincharupdate">update</a>メソッドを指定した回数分実行します。これにより、指定したフレーム数だけ待機することができます。</p><p><strong>書式</strong></p><pre><code>updateEx(t)
</code></pre><ul><li><strong>t</strong><br>&emsp;update(); を呼び出す回数。</li></ul><p>※ この命令は<a href="#plaincharwait">wait</a>メソッドと似ていますが、 <strong>updateEx</strong>の実行中はフレーム毎に<a href="#plaincharonupdate">onUpdate</a>メソッドが呼ばれます。</p><hr><h2 id="plaincharondie">PlainChar.onDie</h2><p>オブジェクトが死んだときに特別な処理をしたいときにユーザが定義するメソッドです。</p><p><strong>書式</strong></p><pre><code>function onDie() {
  処理内容
}
</code></pre><p>※ onDieは自動的に呼ばれます。ユーザが直接呼び出さないでください。</p><p><span style="color:red">※ onDieの中で<a href="#plaincharupdate">update</a>メソッドを呼ばないようにしてください</span></p><p><strong>例1</strong></p><pre><code>function onDie() {
  $score=$score+10;
}
</code></pre><p>▲ このように定義しておくと、このオブジェクトが死ぬ度に$scoreが10増えます。</p><hr><h2 id="plainchardie">PlainChar.die</h2><p>オブジェクトを殺します。殺されたオブジェクトは次に<a href="#plaincharupdate">update</a>();が呼ばれた段階で処理を終了し、画面上から消えます。</p><p><strong>書式</strong></p><pre><code>die()
</code></pre><p><strong>例1</strong></p><pre><code>die();
</code></pre><p>▲ 自分自身が死にます</p><p><strong>例2</strong></p><pre><code>$teki.die();
</code></pre><p>▲ オブジェクト$tekiが死にます</p><hr><h2 id="plaincharisdead">PlainChar.isDead</h2><p>オブジェクトが死んでいるかどうかを判定します。</p><p><strong>書式</strong></p><pre><code>isDead()
</code></pre><p><strong>戻り値</strong></p><p>死んでいる場合は<a href="./rf-true-false">真</a>(0以外の値)、そうでなければ<a href="./rf-true-false">偽</a>(0)</p><p>※ このメソッドは1.09以前では isDied という名前でした。今後はisDeadを使用してください。<br>互換性を保つため、isDied を使用したプログラムも従来通り動作するようになっています。</p><p><a href="#plainchardie">die</a>メソッドが呼ばれるか、プログラムの最後に到達すると そのオブジェクトは死んだとみなされます、</p><p><strong>例1</strong></p><p>Object1.tonyu</p><pre><code>extends SpriteChar;
i=0;
while (i&lt;100) {
  i+=1;update();
}
</code></pre><p>Object2.tonyu</p><pre><code>extends SpriteChar;
while (! $Object1.isDead()) {
  x+=1; update();
}
</code></pre><p>▲ この例では、$Object1は100フレームたつとプログラムが終了し、死にます。<br>$Object2は$Object1が死ぬのを監視しながら、$Object1が死んでない間移動を続け $Object1が死ぬと一緒に死にます。</p><hr><h2 id="plaincharwait">PlainChar.wait</h2><p>オブジェクトの動作を一時的に停止し、待機状態にします。</p><p><strong>書式</strong></p><pre><code>wait(frames)
</code></pre><ul><li><strong>frames(省略可能)</strong><br>&emsp;待機するフレーム数。省略すると<a href="#plaincharnotify">notify</a>()が呼ばれるまで永久に待機する。</li></ul><p><strong>例1</strong></p><pre><code>extends SpriteChar;
while(1) {
  x+=8;
  wait(8);
}
</code></pre><p>▲ 8フレームに1回、8ドット横に移動します。</p><p><strong><a href="#plaincharupdateex">updateEx</a>メソッドとの違い</strong></p><ul><li>待機中は<a href="#plaincharonupdate">onUpdate</a>メソッドは呼ばれません</li><li>スレッドの処理順を表すリストから一時的にこのオブジェクトのスレッドを除外し，再開時にこのオブジェクトのスレッドをリストの末尾に追加します．</li><li>したがって，updateExより処理が軽くなりますが，処理順が変化する点に注意してください．</li></ul><hr><h2 id="plaincharnotify">PlainChar.notify</h2><p><a href="#plaincharwait">wait</a>メソッドで待機状態にあるオブジェクトの動作を再開します。</p><p><strong>書式</strong></p><pre><code>notify()
</code></pre><p><strong>例1</strong></p><p>WaitObj.tonyu ($waitObj)</p><pre><code>extends SpriteChar;
wait();
while(1) {
  x+=8;
  wait(8);
}
</code></pre><p>NotifyObj.tonyu ($notifyObj)</p><pre><code>extends SpriteChar;
while(getkey(32)==0) {
  update();
}
$waitObj.notify();
</code></pre><p>▲ $waitObjは、プログラム開始時にwait()によって待機状態になります。<br>スペースキーを押すと、$notifyObjが$waitObjに対してnotify() を呼び、 $waitObjの動作が始まります。</p><hr><h2 id="plaincharsetvisible">PlainChar.setVisible</h2><p>オブジェクトの表示・非表示を設定します。</p><p><strong>書式</strong></p><pre><code>setVisible(v)
</code></pre><ul><li><strong>v</strong><br>&emsp;0= 非表示、 1= 表示</li></ul><p><strong>例1</strong></p><pre><code>extends SpriteChar;
while(1) {
  setVisible(0);
  update();
  setVisible(1);
  update();
}
</code></pre><p>▲ オブジェクトが高速に点滅します</p><hr><h2 id="plainchargetvisible">PlainChar.getVisible</h2><p>オブジェクトの表示・非表示状態を取得します。</p><p><strong>書式</strong></p><pre><code>getVisible()
</code></pre><p><strong>戻り値</strong></p><p>0: 非表示、 1以外: 表示</p><p><strong>参考</strong></p><p><a href="#plaincharsetvisible">setVisible</a></p><hr><h2 id="plaincharscreenout">PlainChar.screenOut</h2><p>オブジェクトが画面外に出たかどうかを判定します。</p><p><strong>書式</strong></p><pre><code>screenOut()
</code></pre><p><strong>戻り値</strong></p><p>画面外に出ていない場合は0、 画面外に出ている場合は0より大きい値を返す。<br>その値は x方向にはみだしたドット数＋y方向にはみだしたドット数</p><p><strong>例1</strong></p><pre><code>extends SpriteChar;
while(1) {
  if (screenOut()&gt;0) die();
  if (getkey(39)&gt;0) x+=3;
  if (getkey(37)&gt;0) x-=3;
  if (getkey(40)&gt;0) y+=3;
  if (getkey(38)&gt;0) y-=3;
  update();
}
</code></pre><p>▲ カーソルキーでオブジェクトを動かしていくと、画面外に出た瞬間に死亡します<br>なお、 if (screenOut()&gt;0) die(); は if (screenOut()) die(); と書いても同じ動作をします。</p><hr><h2 id="plainchargetscreenx">PlainChar.getScreenX</h2><p>オブジェクトのスクリーン座標のx座標を得ます。</p><p><strong>書式</strong></p><pre><code>getScreenX()
</code></pre><p><strong>戻り値</strong></p><p>スクリーン座標(x座標)</p><p>※スクリーン座標については<a href="./html/scroll/html/HID00000001.htm">スクロールのサンプル</a>を参考してください。</p><p><strong>例1</strong></p><p>ここに書いてあるプログラムは、実行する前に画面にマップを描くことをおすすめします(<a href="./tr-maze01">チュートリアル参照</a>)</p><pre>
extends SpriteChar;
while(1) {
  if (getkey(39)>0 && getScreenX()<$screenWidth-16) x+=3;
  if (getkey(37)>0 && getScreenX()>16) x-=3; 
  if (getkey(40)>0 && getScreenY()<$screenHeight-16) y+=3;
  if (getkey(38)>0 && getScreenY()>16) y-=3;
  <a href="./rf-map#mapscrollto">$map.scrollTo</a>(0,t);
  y-=1;
  t-=1;
  update();
}
</pre><p>▲ この例では、カーソルキーでオブジェクトを動かしますが、 スクロール位置に関係なく画面端を飛び出さないようにします。<br>※試しにgetScreenY()をyに変えてみると、しばらくすると上に動けなくなります。</p><hr><h2 id="plainchargetscreeny">PlainChar.getScreenY</h2><p>オブジェクトのスクリーン座標のy座標を得ます。</p><p><strong>書式</strong></p><pre><code>getScreenY()
</code></pre><p><strong>戻り値</strong></p><p>スクリーン座標(y座標)</p><p>※スクリーン座標については<a href="./html/scroll/html/HID00000001.htm">スクロールのサンプル</a>を参考してください。</p><p><strong>例1</strong></p><p><a href="#plainchargetscreenx">getScreenX</a>参照</p><hr><h2 id="plainchargotoscreen">PlainChar.gotoScreen</h2><p>オブジェクトの位置をスクリーン座標を用いて指定します。</p><p><strong>書式</strong></p><pre><code>gotoScreen(xx,yy)
</code></pre><ul><li><strong>xx</strong><br>&emsp;移動先x座標（スクリーン座標）</li><li><strong>yy</strong><br>&emsp;移動先y座標（スクリーン座標）</li></ul><p>※スクリーン座標については<a href="./html/scroll/html/HID00000001.htm">スクロールのサンプル</a>を参考してください。</p><p><strong>例1</strong></p><p>ここに書いてあるプログラムは、実行する前に<br>画面にマップを描くことをおすすめします(<a href="./tr-maze01">チュートリアル参照</a>)</p><pre><code>extends SpriteChar;
sx=x;sy=y;
while (1) {
  gotoScreen(sx,sy);
  $map.scrollTo(0,t);
  t-=1;
  update();
}
</code></pre><p>▲ この例では、プログラム開始時の位置をsx,syに覚えた後、 その場にとどまりつづけます。 スクロールしても画面上での位置は変わりません</p><hr><h2 id="plaincharonappear">PlainChar.onAppear</h2><p>実行開始時または<a href="./rf-object#objectappear">appear</a>メソッドによりオブジェクトが出現したときに、<br>特別な処理をする場合にユーザが定義するメソッドです。</p><p><strong>書式</strong></p><pre><code>function onAppear() {
  処理内容
}
</code></pre><p>※ onAppearはユーザが直接呼び出さないでください。</p><p><span style="color:red">※ このメソッドの中で<a href="#plaincharupdate">update</a>メソッドを呼ばないようにしてください。</span></p><hr><h2 id="plaincharwaitselect">PlainChar.waitSelect</h2><p>はい・いいえ選択用のウィンドウを開き、ユーザがウィンドウを閉じるまで処理を中断します。</p><p><strong>書式</strong></p><pre><code>waitSelect(prompt,title)
</code></pre><ul><li><strong>prompt</strong><br>&emsp;質問文</li><li><strong>title</strong><br>&emsp;文字入力用のウィンドウのタイトルバーに表示する文字列</li></ul><p><strong>戻り値</strong></p><p>「はい」を押したなら1 「いいえ」を押すか、ウィンドウ右上のxでウィンドウを閉じた場合0</p><p>※ 処理を中断したくないときは<a href="./rf-selectbox#selectboxopen">$SelectBox.open</a>を用います。</p><p>※ <a href="#plaincharonmousedown">onMouseDown</a>,<a href="#plaincharonmousedrag">onMouseDrag</a>メソッドの中ではこのメソッドを呼ばないでください</p><p><strong>例1</strong></p><pre><code>extends TextChar;
text=&quot;ここは武器屋です&quot;;
if (waitSelect(&quot;剣を買いますか&quot;)) {
  text=&quot;ありがとうございました&quot;;
} else {
  if (waitSelect(&quot;それでは、もっといい剣を買いますか&quot;)) {
    text=&quot;お金がたりません&quot;;
  } else {
    text=&quot;またどうぞ&quot;;
  }
}
wait();
</code></pre><hr><h2 id="plaincharwaitinput">PlainChar.waitInput</h2><p>文字入力用のウィンドウを開き、ユーザがボタン（「Ok」 または「キャンセル」）を押すまで処理を中断します。</p><p><strong>書式</strong></p><pre><code>waitInput(title,prompt,default)
</code></pre><ul><li><strong>title</strong><br>&emsp;文字入力用のウィンドウのタイトルバーに表示する文字列</li><li><strong>prompt</strong><br>&emsp;プロンプト部分（入力部分のすぐ上）に表示する文字列。改行文字(\n)を使うと複数行表示できます。</li><li><strong>default</strong><br>&emsp;入力部分にあらかじめ入っている文字列</li></ul><p><strong>戻り値</strong></p><p>入力された文字列。 ユーザが「Ok」「キャンセル」のどちらを押したかは<a href="./rf-inputbox#inputboxgetstatus">$InputBox.getStatus</a>で調べることができます。</p><p>処理を中断したくないときは<a href="./rf-inputbox#inputboxopen">$InputBox.open</a>を用います。<br><a href="#plaincharonmousedown">onMouseDown</a>,<a href="#plaincharonmousedrag">onMouseDrag</a>メソッドの中ではこのメソッドを呼ばないでください</p><p><strong>例1</strong></p><pre><code>extends SpriteChar;
while (1) {
  // rに入力結果をいれる
  r=waitInput(&quot;どっちへいきますか&quot;,&quot;\&quot;L\&quot;:←  \&quot;R\&quot;:→ &quot;); 
  if ($InputBox.getStatus()==2) die(); // キャンセル押したら死亡
  if (r==&quot;Left&quot;) { // &quot;Left&quot; を入力したら 、左に移動
    for (i=0 ; i&lt;16 ; i++) {
      x--;
      update();
    }
  }
  if (r==&quot;Right&quot;) { // &quot;Right&quot; を入力したら 、左に移動
    for (i=0 ; i&lt;16 ; i++) {
      x++;
      update();
    }
  }
  update();
}
</code></pre><hr><h2 id="変数x">変数x</h2><p>オブジェクトのx座標をあらわす変数です</p><hr><h2 id="変数y">変数y</h2><p>オブジェクトのy座標をあらわす変数です</p><hr><h2 id="変数zorder">変数zOrder</h2><p>複数のオブジェクトが重なった場合、この値が小さいオブジェクトのほうが手前に表示されます。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-panelchar"class="pagediv"title2="命令リファレンス - PanelChar - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="panelcharクラス">PanelCharクラス</h2><p>任意の図形（線、四角形、文字などの組み合わせ)が描けるオブジェクトです</p><p>PanelCharクラスのオブジェクトを作るには、図1のように「パネル」を選びます</p><p>図1 :<br><img src-t="./img/panel.png"width="412"height="344"alt="panel.png"></p><p><a href="#%E5%A4%89%E6%95%B0panel">変数panel</a>を通じて、<a href="./rf-panel">Panel</a>クラスに用意されている描画命令を使うことができます。</p><h3 id="例1">例1</h3><pre><code>extends PanelChar;
resize(200,200);
while (1) {
  x=x+1;
  panel.drawLine(0,0,200,t,$clWhite);
  t=t+1;
  update();
}
</code></pre><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#panelcharsettext">setText</a></td><td>パネルに描画する文字列を指定します。</td></tr><tr><td><a href="#panelchargetwidth">getWidth</a></td><td>パネルの横幅を得ます</td></tr><tr><td><a href="#panelchargetheight">getHeight</a></td><td>パネルの縦幅（高さ）を得ます</td></tr><tr><td><a href="#panelcharresize">resize</a></td><td>パネルの大きさを設定します。</td></tr><tr><td><a href="./rf-panel#paneldrawsprite">panel.drawSprite</a></td><td>パネルにスプライトを描画します。</td></tr><tr><td><a href="./rf-panel#paneldrawdxsprite">panel.drawDxSprite</a></td><td>回転、拡大、縮小、半透明のスプライトを描画します。</td></tr><tr><td><a href="./rf-panel#paneldrawline">panel.drawLine</a></td><td>パネルに直線を描画します</td></tr><tr><td><a href="./rf-panel#panelgetpixel">panel.getPixel</a></td><td>パネルの特定の点における色を得ます。</td></tr><tr><td><a href="./rf-panel#panelfillrect">panel.fillRect</a></td><td>パネルに中の詰まった長方形を描画します</td></tr><tr><td><a href="./rf-panel#panelcopyrect">Panel.copyRect</a></td><td>パネル間で画像をコピーします</td></tr><tr><td><a href="./rf-panel#paneldrawtext">panel.drawText</a></td><td>パネルに文字を描画します。</td></tr><tr><td><a href="./rf-panel#panelsettransparentcolor">panel.setTransparentColor</a></td><td>パネルの透過色を指定します。</td></tr><tr><td><a href="./rf-panel#panelgettransparentcolor">panel.getTransparentColor</a></td><td>パネルの透過色を取得します。</td></tr><tr><td><a href="./rf-panel#panelsetpixel">panel.setPixel</a></td><td>パネルに点を描きます。</td></tr></tbody></table><h3 id="変数一覧">変数一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#%E5%A4%89%E6%95%B0alpha">alpha</a></td><td>パネルの透明度を指定します。</td></tr><tr><td><a href="#%E5%A4%89%E6%95%B0angle">angle</a></td><td>パネルの回転角度を指定します。</td></tr><tr><td><a href="#%E5%A4%89%E6%95%B0bold">bold</a></td><td>テキストを太字にするか指定します。</td></tr><tr><td><a href="#%E5%A4%89%E6%95%B0col">col</a></td><td>テキストの色を指定します。</td></tr><tr><td><a href="#%E5%A4%89%E6%95%B0font">font</a></td><td>テキストのフォント名を指定します。</td></tr><tr><td><a href="#%E5%A4%89%E6%95%B0width">width</a></td><td>パネルの幅を得ます。</td></tr><tr><td><a href="#%E5%A4%89%E6%95%B0height">height</a></td><td>パネルの縦幅（高さ）を得ます。</td></tr><tr><td><a href="#%E5%A4%89%E6%95%B0italic">italic</a></td><td>テキストを斜体にするか指定します。</td></tr><tr><td><a href="#%E5%A4%89%E6%95%B0panel">panel</a></td><td>パネル本体を表すオブジェクトです。</td></tr><tr><td><a href="#%E5%A4%89%E6%95%B0scalex">scaleX</a></td><td>パネルの拡大率を指定します。</td></tr><tr><td><a href="#%E5%A4%89%E6%95%B0scaley">scaley</a></td><td>パネルの拡大率を指定します。</td></tr><tr><td><a href="#%E5%A4%89%E6%95%B0size">size</a></td><td>テキストの大きさをptで指定します。</td></tr><tr><td><a href="#%E5%A4%89%E6%95%B0underline">underLine</a></td><td>テキストを下線付きにするか指定します。</td></tr></tbody></table><hr><h2 id="panelcharsettext">PanelChar.setText</h2><p>パネルに描画する文字列を指定します。</p><p><strong>書式</strong></p><pre><code>setText(t,c,sz)
</code></pre><ul><li><strong>t(省略可能)</strong><br>&emsp;描画する文字列。省略すると変数textの値を使う</li><li><strong>c(省略可能)</strong><br>&emsp;文字列の色。 省略すると変数col の値を使う</li><li><strong>sz(省略可能)</strong><br>&emsp;文字列の大きさ。省略すると変数sizeの値を使う</li></ul><p>※ 実行中は、変数textに値を代入しただけでは画面上のテキストは変わりません。必ずこのメソッドを呼び出してください。</p><p>このメソッドを呼び出すとテキストに応じてパネルの大きさが自動的に変わります。<br>このメソッドによりテキスト以外の図形は消去されます。テキストと他の図形を混在させたい場合、<a href="./rf-panel#paneldrawtext">panel.drawText</a>メソッドを使ってください。<br>描画時のフォントは、font,bold,italic,underline 変数で指定します。</p><p>これらについては<a href="#">パネルオブジェクト</a>の説明を参照してください</p><hr><h2 id="panelchargetwidth">PanelChar.getWidth</h2><p>パネルの横幅を得ます</p><p><strong>書式</strong></p><pre><code>getWidth()
</code></pre><p><strong>戻り値</strong></p><p>パネルの横幅</p><hr><h2 id="panelchargetheight">PanelChar.getHeight</h2><p>パネルの縦幅（高さ）を得ます</p><p><strong>書式</strong></p><pre><code>getHeight()
</code></pre><p><strong>戻り値</strong></p><p>パネルの高さ</p><hr><h2 id="panelcharresize">PanelChar.resize</h2><p>パネルの大きさを設定します。</p><p><strong>書式</strong></p><pre><code>resize(w,h)
</code></pre><ul><li><strong>w</strong><br>&emsp;パネルの幅</li><li><strong>h</strong><br>&emsp;パネルの高さ</li></ul><hr><h2 id="変数alpha">変数alpha</h2><p>パネルの透明度を指定します。<br>255が完全に不透明で、減らすにしたがって透明になっていきます。<br>0にすると見えなくなります。</p><hr><h2 id="変数angle">変数angle</h2><p>パネルの回転角度を指定します。単位は度で右回りです。</p><hr><h2 id="変数bold">変数bold</h2><p><a href="#panelcharsettext">setText</a>メソッドでテキストを指定している場合のみ有効です。</p><p>1を指定すると太字になります。0で通常の書体です</p><hr><h2 id="変数col">変数col</h2><p><a href="#panelcharsettext">setText</a>メソッドでテキストを指定している場合のみ有効です。</p><p>テキストの色を指定します。通常は<a href="./rf-object#objectcolor">color</a>メソッドを使います</p><hr><h2 id="変数font">変数font</h2><p><a href="#panelcharsettext">setText</a>メソッドでテキストを指定している場合のみ有効です。</p><p>テキストのフォント名を指定します。 (&quot;ＭＳ ゴシック&quot;など)</p><hr><h2 id="変数width">変数width</h2><p>パネルの幅を得ます。</p><p>※widthに値を代入しても幅は変更できません。 代わりに<a href="./rf-panel#panelresize">resize</a>メソッドを使用してください。</p><hr><h2 id="変数height">変数height</h2><p>パネルの縦幅（高さ）を得ます。</p><p>※heightに値を代入しても高さは変更できません。 代わりに<a href="./rf-panel#panelresize">resize</a>メソッドを使用してください。</p><hr><h2 id="変数italic">変数italic</h2><p><a href="#panelcharsettext">setText</a>メソッドでテキストを指定している場合のみ有効です。</p><p>1を指定すると斜体になります。0で通常の書体です</p><hr><h2 id="変数panel">変数panel</h2><p>パネル本体を表すオブジェクトです。<br>このオブジェクトに対しては<a href="./rf-panel">Panel</a>クラスの各種メソッドを呼び出すことができます。</p><hr><h2 id="変数scalex">変数scaleX</h2><p>パネルの拡大率を指定します。</p><p>scaleyを設定していない場合、縦横ともにscaleX倍拡大します。<br>scaleyを設定した場合、縦にscaley倍、横にscaleX倍拡大します。</p><hr><h2 id="変数scaley">変数scaley</h2><p>パネルの拡大率を指定します。</p><p>scaleyを設定していない場合、縦横ともにscaleX倍拡大します。<br>scaleyを設定した場合、縦にscaley倍、横にscaleX倍拡大します。</p><hr><h2 id="変数size">変数size</h2><p><a href="#panelcharsettext">setText</a>メソッドでテキストを指定している場合のみ有効です。</p><p>テキストの大きさをptで指定します。</p><hr><h2 id="変数underline">変数underLine</h2><p><a href="#panelcharsettext">setText</a>メソッドでテキストを指定している場合のみ有効です。</p><p>1を指定すると下線付きになります。0で通常の書体です</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-panel"class="pagediv"title2="命令リファレンス - Panel - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="panelクラス">Panelクラス</h2><p>通常の描画メソッド(<a href="./rf-sprite#spritedrawtext">drawText</a>,<a href="./rf-sprite#spritedrawline">drawLine</a>,<a href="./rf-sprite#spritedrawsprite">drawSprite</a>,<a href="./rf-sprite#spritefillrect">fillRect</a>)では、描画されたものは１フレームごとに消去されてしまいます。<br>一度描画したグラフィックスを消さないでおくときは、パネルを使うと便利です。</p><p>パネルにアクセスするには、次の２通りがあります。</p><ul><li>$panelという変数を頭につけて、通常の描画命令と同様にメソッドを呼びます。</li><li><a href="./rf-panelchar">パネルオブジェクト</a>を作成します。</li></ul><p><strong>例1</strong></p><p>例１(パネルを使わない)：</p><pre><code>extends SpriteChar;
i=0;
while(i&lt;$screenHeight) {
  drawLine(0,0,$screenWidth,i,color(255,255,255));
  i+=3;
  update();
}
</code></pre><p><strong>例2</strong></p><p>例２：(パネルを使う)：</p><pre>
extends SpriteChar;
i=0;
while(i<$screenHeight) {
  <b>$panel.</b>drawLine(0,0,$screenWidth,i,color(255,255,255));
  i+=3;
  update();
}
</pre><p>▲ 例１では、一本の線が上から下に流れる様子が見えますが、例２では、線の描いた跡が全部残ります。</p><p>※ 一度パネルに描いた内容を消去するには、パネルを黒（ color(0,0,0)で指定する色）で塗りつぶします。</p><p><strong>例3</strong></p><p>例3：(パネルの消去)：</p><pre><code>extends SpriteChar;
i=0;
while(i&lt;$screenHeight) {
  $panel. drawLine(0,0,$screenWidth,i,color(255,255,255));
  i+=3;
  update();
}
$panel.fillRect(0,0,$screenWidth,$screenHeight,color(0,0,0));
// ↑パネルに描画した内容を消去
while(i&gt;0) {
  $panel. drawLine($screenWidth,0,0,i,color(255,255,255));
  i-=3;
  update();
}
</code></pre><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#paneldrawsprite">drawSprite</a></td><td>パネルにスプライトを描画します。</td></tr><tr><td><a href="#paneldrawdxsprite">drawDxSprite</a></td><td>回転、拡大、縮小、半透明のスプライトを描画します。</td></tr><tr><td><a href="#paneldrawline">drawLine</a></td><td>パネルに直線を描画します</td></tr><tr><td><a href="#paneldrawbrokenline">drawBrokenLine</a></td><td>点線を描画します</td></tr><tr><td><a href="#panelgetpixel">getPixel</a></td><td>パネルの特定の点における色を得ます。</td></tr><tr><td><a href="#panelfillrect">fillRect</a></td><td>パネルに中の詰まった長方形を描画します</td></tr><tr><td><a href="#paneldrawtext">drawText</a></td><td>パネルに文字を描画します。</td></tr><tr><td><a href="#panelcopyrect">copyRect</a></td><td>パネル間で画像をコピーします</td></tr><tr><td><a href="#panelresize">resize</a></td><td>パネルの大きさを変更します</td></tr><tr><td><a href="#panelsettransparentcolor">setTransparentColor</a></td><td>パネルの透過色を指定します。</td></tr><tr><td><a href="#panelgettransparentcolor">getTransparentColor</a></td><td>パネルの透過色を取得します。</td></tr><tr><td><a href="#panelsetpixel">setPixel</a></td><td>パネルに点を描きます。</td></tr><tr><td><a href="#panelload">load</a></td><td>ファイルから画像を読み込みます</td></tr><tr><td><a href="#panelsave">save</a></td><td>パネルの画像をファイルに保存します</td></tr></tbody></table><h3 id="変数一覧">変数一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#panelalpha">alpha</a></td><td>パネルの透明度を指定します。</td></tr><tr><td><a href="#panelangle">angle</a></td><td>パネルの回転角度を指定します。単位は度で右回りです。</td></tr><tr><td><a href="#panelheight">height</a></td><td>Panelの高さ（ピクセル）が格納されています。</td></tr><tr><td><a href="#panelwidth">width</a></td><td>Panelの横幅（ピクセル）が格納されています。</td></tr><tr><td><a href="#panelzorder">zOrder</a></td><td>Panelの表示の前後を指定します。</td></tr></tbody></table><hr><h2 id="paneldrawsprite">Panel.drawSprite</h2><p>パネルにスプライトを描画します。</p><p><strong>書式</strong></p><pre><code>drawSprite(x,y,p,f)
</code></pre><ul><li><strong>x</strong><br>&emsp;x座標</li><li><strong>y</strong><br>&emsp;y座標</li><li><strong>p</strong><br>&emsp;キャラクタパターン</li><li><strong>f(省略可能)</strong><br>&emsp;0でない数値の場合、元のキャラクタパターンを左右反転したパターンを描画する</li></ul><p>パネルについては、<a href="#">パネルの使い方</a>を参照してください。 <a href="./rf-panel-diff">$panelとpanelの違い</a></p><hr><h2 id="paneldrawdxsprite">Panel.drawDxSprite</h2><p>回転、拡大、縮小、半透明のスプライトを描画します。</p><p><strong>書式</strong></p><pre><code>drawDxSprite(x,y,p,f,angle,scaleX,scaleY)
</code></pre><ul><li><strong>x</strong><br>&emsp;x座標</li><li><strong>y</strong><br>&emsp;y座標</li><li><strong>p</strong><br>&emsp;キャラクタパターン</li><li><strong>f</strong><br>&emsp;0でない数値の場合、元のキャラクタパターンを左右反転したパターンを描画する</li><li><strong>angle</strong><br>&emsp;回転角度。単位は度(°)を表す整数</li><li><strong>scaleX</strong><br>&emsp;横方向の拡大率。１が原寸</li><li><strong>scaleY(省略可能)</strong><br>&emsp;縦方向の拡大率。省略するとscaleXと同じ</li></ul><hr><h2 id="paneldrawline">Panel.drawLine</h2><p>パネルに直線を描画します</p><p><strong>書式</strong></p><pre><code>drawLine(sx,sy,dx,dy,col)
</code></pre><ul><li><strong>sx</strong><br>&emsp;始点のx座標</li><li><strong>sy</strong><br>&emsp;始点のy座標</li><li><strong>dx</strong><br>&emsp;終点のx座標</li><li><strong>dy</strong><br>&emsp;終点のy座標</li><li><strong>col</strong><br>&emsp;色(通常colorメソッドで指定)</li></ul><p>パネルについては、<a href="#">パネルの使い方</a>を参照してください。</p><p>参考： <a href="./rf-panel-diff">$panelとpanelの違い</a></p><hr><h2 id="paneldrawbrokenline">Panel.drawBrokenLine</h2><p>点線を描画します</p><p><strong>書式</strong></p><pre><code>drawBrokenLine(sx,sy,dx,dy,col,length)
</code></pre><ul><li><strong>sx</strong><br>&emsp;始点のx座標</li><li><strong>sy</strong><br>&emsp;始点のy座標</li><li><strong>dx</strong><br>&emsp;終点のx座標</li><li><strong>dy</strong><br>&emsp;終点のy座標</li><li><strong>col</strong><br>&emsp;色</li><li><strong>length</strong><br>&emsp;点線1個の長さ</li></ul><hr><h2 id="panelgetpixel">Panel.getPixel</h2><p>パネルの特定の点における色を得ます。</p><p><strong>書式</strong></p><pre><code>getPixel(x,y)
</code></pre><ul><li><strong>x</strong><br>&emsp;点のx座標</li><li><strong>y</strong><br>&emsp;点のy座標</li></ul><p><strong>戻り値</strong></p><p>パネル上(x,y)における色を整数値で返します</p><p>戻り値は次の意味を持ちます。</p><p>戻り値 ＝ 赤成分 + 緑成分 * 256 + 青成分 * 65536</p><p><strong>例1</strong></p><pre><code>extends TextChar;
$panel.fillRect(30,30,50,50,$clRed);
$panel.fillRect(130,30,150,50,$clGreen);
$panel.fillRect(30,130,50,150,$clBlue);
while(1) {
  text=&quot;色 =&quot;+$panel.getPixel($mouseX,$mouseY);
  update();
}
</code></pre><p>パネルについては、<a href="#">パネルの使い方</a>を参照してください。 <a href="./rf-panel-diff">$panelとpanelの違い</a></p><hr><h2 id="panelfillrect">Panel.fillRect</h2><p>パネルに中の詰まった長方形を描画します</p><p><strong>書式</strong></p><pre><code>fillRect(sx,sy,dx,dy,col)
</code></pre><ul><li><strong>sx</strong><br>&emsp;左上点のx座標</li><li><strong>sy</strong><br>&emsp;左上点のy座標</li><li><strong>dx</strong><br>&emsp;右下点のx座標</li><li><strong>dy</strong><br>&emsp;右下点のy座標</li><li><strong>col</strong><br>&emsp;色(通常colorメソッドで指定)</li></ul><p>参考： <a href="./rf-panel-diff">$panelとpanelの違い</a></p><hr><h2 id="paneldrawtext">Panel.drawText</h2><p>パネルに文字を描画します。</p><p><strong>書式</strong></p><pre><code>drawText(x,y,t,col,size)
</code></pre><ul><li><strong>x</strong><br>&emsp;x座標</li><li><strong>y</strong><br>&emsp;y座標</li><li><strong>t</strong><br>&emsp;描画する値</li><li><strong>col</strong><br>&emsp;色(通常colorメソッドで指定)</li><li><strong>size</strong><br>&emsp;サイズ</li></ul><p>パネルについては、<a href="#">パネルの使い方</a>を参照してください <a href="./rf-panel-diff">$panelとpanelの違い</a></p><hr><h2 id="paneldrawtext-1">Panel.drawText</h2><p>パネルに文字を描画します。</p><p><strong>書式</strong></p><pre><code>drawText(x,y,t,col,size)
</code></pre><ul><li><strong>x</strong><br>&emsp;x座標</li><li><strong>y</strong><br>&emsp;y座標</li><li><strong>t</strong><br>&emsp;描画する値</li><li><strong>col</strong><br>&emsp;色(通常colorメソッドで指定)</li><li><strong>size</strong><br>&emsp;サイズ</li></ul><p>パネルについては、<a href="#">パネルの使い方</a>を参照してください <a href="./rf-panel-diff">$panelとpanelの違い</a></p><hr><h2 id="panelcopyrect">Panel.copyRect</h2><p>パネル間で画像をコピーします</p><p><strong>書式</strong></p><pre><code>copyRect(dlx,dty,drx,dby,src,slx,sty,srx,sby)
</code></pre><ul><li><strong>dlx</strong><br>&emsp;コピー先の左上のx座標</li><li><strong>dty</strong><br>&emsp;コピー先の左上のy座標</li><li><strong>drx</strong><br>&emsp;コピー先の右下のx座標</li><li><strong>dby</strong><br>&emsp;コピー先の右下のy座標</li><li><strong>src</strong><br>&emsp;コピー元のパネル</li><li><strong>slx</strong><br>&emsp;コピー元の左上のx座標</li><li><strong>sty</strong><br>&emsp;コピー元の左上のy座標</li><li><strong>srx</strong><br>&emsp;コピー元の右下のx座標</li><li><strong>sby</strong><br>&emsp;コピー元の右下のy座標</li></ul><hr><h2 id="panelresize">Panel.resize</h2><p>パネルの大きさを変更します</p><p><strong>書式</strong></p><pre><code>resize(width,height)
</code></pre><ul><li><strong>width</strong><br>&emsp;幅</li><li><strong>height</strong><br>&emsp;高さ</li></ul><hr><h2 id="panelsettransparentcolor">Panel.setTransparentColor</h2><p>パネルの透過色を指定します。</p><p><strong>書式</strong></p><pre><code>setTransparentColor(c)
</code></pre><ul><li><strong>c</strong><br>&emsp;透過色（<a href="./rf-object#objectcolor">color</a>メソッドで指定)</li></ul><hr><h2 id="panelgettransparentcolor">Panel.getTransparentColor</h2><p>パネルの透過色を取得します。</p><p><strong>書式</strong></p><pre><code>getTransparentColor()
</code></pre><p><strong>戻り値</strong></p><p>透過色を表す値</p><p><strong>参考</strong> <a href="#panelsettransparentcolor">Panel.setTransparentColor</a></p><hr><h2 id="panelsetpixel">Panel.setPixel</h2><p>パネルに点を描きます。</p><p><strong>書式</strong></p><pre><code>setPixel(x,y,c)
</code></pre><ul><li><strong>x</strong><br>&emsp;点のx座標</li><li><strong>y</strong><br>&emsp;点のy座標</li><li><strong>c</strong><br>&emsp;パネル上(x,y)に設定する色（整数値） ＝赤成分 + 緑成分 * 256 + 青成分 * 65536</li></ul><p>パネルについては、<a href="#">パネルの使い方</a>を参照してください。</p><p>参考： <a href="./rf-panel-diff">$panelとpanelの違い</a></p><hr><h2 id="panelload">Panel.load</h2><p>ファイルから画像を読み込みます</p><p><strong>書式</strong></p><pre><code>load(fileName)
</code></pre><ul><li><strong>fileName</strong><br>&emsp;ファイル名(bmpファイルのみ)</li></ul><p>読み込みが起きると、パネルの大きさは読み込んだ画像の大きさに自動的に変更されます。</p><hr><h2 id="panelsave">Panel.save</h2><p>パネルの画像をファイルに保存します</p><p><strong>書式</strong></p><pre><code>save(fileName,sx,sy,dx,dy)
</code></pre><ul><li><strong>fileName</strong><br>&emsp;ファイル名(bmpのみ)</li><li><strong>sx(省略可能)</strong><br>&emsp;保存する範囲(左上のx座標)</li><li><strong>sy(省略可能)</strong><br>&emsp;保存する範囲(左上のy座標)</li><li><strong>dx(省略可能)</strong><br>&emsp;保存する範囲(右下のx座標)</li><li><strong>dy(省略可能)</strong><br>&emsp;保存する範囲(右下のy座標)</li></ul><p>保存する範囲を省略すると、パネル全体を保存します。</p><hr><h2 id="panelalpha">Panel.alpha</h2><p>パネルの透明度を指定します。<br>255が完全に不透明で、減らすにしたがって透明になっていきます。<br>0にすると見えなくなります。</p><p>参考： パネルオブジェクトの透明度は、次の例のように指定します。</p><p><strong>例1</strong></p><pre><code>extends PanelChar;
resize(100,100);
panel.fillRect(0,0,100,100,$clWhite);
panel.drawText(0,0,&quot;パネル&quot;,$clBlue,18);
wait(60);
alpha=128; // 透明度を128にする
wait();
</code></pre><p><strong>例2</strong></p><p>悪い例</p><pre><code>extends PanelChar;
resize(100,100);
panel.fillRect(0,0,100,100,$clWhite);
panel.drawText(0,0,&quot;パネル&quot;,$clBlue,18);
wait(60);
panel.alpha=128; // panel.alpha に代入しても透明度は変化しません
wait();
</code></pre><hr><h2 id="panelangle">Panel.angle</h2><p>パネルの回転角度を指定します。単位は度で右回りです。</p><p>参考： パネルオブジェクトの回転角度は、次のように指定します。</p><p><strong>例1</strong></p><pre><code>extends PanelChar;
resize(100,100);
panel.fillRect(0,0,100,100,$clWhite);
panel.drawText(0,0,&quot;パネル&quot;,$clBlue,18);
wait(60);
angle=128; // 回転角度を128度にする
wait();
</code></pre><p><strong>例2</strong></p><p>悪い例</p><pre><code>extends PanelChar;
resize(100,100);
panel.fillRect(0,0,100,100,$clWhite);
panel.drawText(0,0,&quot;パネル&quot;,$clBlue,18);
wait(60);
panel.angle=128; // panel.alpha に代入しても回転しません
wait();
</code></pre><hr><h2 id="panelheight">Panel.height</h2><p>Panelの高さ（ピクセル）が格納されています。</p><p>※ この変数に代入してもPanelの大きさは変わりません。<br>Panelの大きさを変える場合は、<a href="#panelresize">resize</a>メソッドを使います。</p><hr><h2 id="panelwidth">Panel.width</h2><p>Panelの横幅（ピクセル）が格納されています。</p><p>※ この変数に代入してもPanelの大きさは変わりません。<br>Panelの大きさを変える場合は、<a href="#panelresize">resize</a>メソッドを使います。</p><hr><h2 id="panelzorder">Panel.zOrder</h2><p>複数のオブジェクトが重なった場合、この値が小さいオブジェクトのほうが手前に表示されます。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-panel-g"class="pagediv"title2="命令リファレンス - $panel - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="panelオブジェクト">$panelオブジェクト</h2><p>自動的に作成される<a href="./rf-panel">Panel</a>クラスのオブジェクトです。</p><h3 id="参考">参考</h3><p><a href="./rf-panel-diff">$panelとpanelの違い</a></p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-panel-diff"class="pagediv"title2="命令リファレンス - $panelとpanelの違い - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="panelとpanelの違い">$panelとpanelの違い</h2><h4 id="panel">$panel</h4><p>１ページにつき１個、自動的に作成されます。２個以上は作成できません。<br>パネル全体の移動はできません</p><h4 id="panel-1">panel</h4><p><a href="./rf-panel">パネルオブジェクト</a>がそれぞれ１つずつ保有します。<br>パネルオブジェクトが移動するにつれてパネルも移動します</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-options"class="pagediv"title2="命令リファレンス - $Options - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="optionsオブジェクト">$Optionsオブジェクト</h2><p>各種設定を行います</p><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#optionsget">get</a></td><td><a href="#optionsset">$Options.set</a>メソッドで設定したプロジェクトの設定を得ます。</td></tr><tr><td><a href="#optionsset">set</a></td><td>プロジェクトの各種設定を行います。</td></tr><tr><td><a href="#optionsgetenv">getEnv</a></td><td><a href="#optionssetenv">$Options.setEnv</a>メソッドで設定したランタイムの設定を得ます。</td></tr><tr><td><a href="#optionssetenv">setEnv</a></td><td>ランタイムの各種設定を行います。</td></tr></tbody></table><hr><h2 id="optionsget">$Options.get</h2><p><a href="#optionsset">$Options.set</a>メソッドで設定したプロジェクトの設定を得ます。</p><p><strong>書式</strong></p><pre><code>get(name)
</code></pre><ul><li><strong>name</strong><br>&emsp;設定項目の名前（<a href="#optionsset">$Options.set</a>メソッド参照)</li></ul><p><strong>戻り値</strong></p><p>設定されている値</p><p>default.tonyuprjファイルの<code>&lt;resourcelist name=&quot;params&quot;&gt;</code>内の要素から取得されます。</p><hr><h2 id="optionsset">$Options.set</h2><p>プロジェクトの各種設定を行います。</p><p><strong>書式</strong></p><pre><code>set(name,value)
</code></pre><ul><li><strong>name</strong><br>&emsp;設定項目の名前</li><li><strong>value</strong><br>&emsp;設定する値</li></ul><p>設定項目の名前(name)として指定できるのは、今のところ次のいずれかです。</p><ul><li><strong>deactivation_pause</strong><br>&emsp;値(value)が1ならば、Tonyuがアクティブでないときに実行を自動的に一時停止します。<br>&emsp;0なら一時停止しません。(デフォルトの動作)</li><li><strong>deactivation_disableKey</strong><br>&emsp;値(value)が1ならば、Tonyuがアクティブでないときに<a href="./rf-object#objectgetkey">getkey</a>メソッドを無効にします。(デフォルトの動作)<br>&emsp;0なら無効にしません。</li><li><strong>sound_stopOnPageLoad</strong><br>&emsp;値(value)が1ならば、<a href="./rf-projectmanager#projectmanagerloadpage">$projectManager.loadPage</a>メソッドでページを切り替えたときにBGMを停止します。(デフォルトの動作)<br>&emsp;0ならページをまたがってそのまま演奏されます。</li><li><strong>sleep_time</strong><br>&emsp;フレームごとにCPUをスリープする時間（単位：ミリ秒）を設定します。<br>&emsp;「パフォーマンス」ウィンドウの「CPU負荷」をプログラムから動的に設定するためのオプションです。<br>&emsp;※ ver1.29はsleep_timeを設定しなくても（デフォルト値の0でも）、CPU負荷がかかりません<br>&emsp;※ ver1.30以降はビジーループ（<a href="./rf-system#systemsetloopmode">$System.setLoopMode(0)</a>）設定時のみ有効です</li><li><strong>disable_pause</strong><br>&emsp;F3キーや「実行」→「一時停止」で一時停止する機能を、無効にするかを設定します。<br>&emsp;値(value)が1ならば、一時停止を無効にします。0なら一時停止を有効にします。<br>&emsp;それ以外の値ならば、開発環境では一時停止を有効、ランタイムでは無効にします。(デフォルトの動作)</li><li><strong>起動時に適用される設定</strong>（<a href="./compatibility">互換性の設定</a>を参照）<ul><li><strong>init_base_volume</strong><ul><li><a href="./rf-mplayer#mplayersetbasevolume">$mplayer.setBaseVolume</a>を起動時に設定します。</li></ul></li><li><strong>init_sound_play_mode</strong><ul><li><a href="./rf-mplayer#mplayersetsoundplaymode">$mplayer.setSoundPlayMode</a>を起動時に設定します。</li></ul></li><li><strong>init_volume_limiter</strong><ul><li><a href="./rf-mplayer#mplayersetvolumelimiter">$mplayer.setVolumeLimiter</a>を起動時に設定します。</li></ul></li><li><strong>init_process_single</strong><ul><li><a href="./rf-system#systemsetprocesssingle">$System.setProcessSingle</a>を起動時に設定します。</li></ul></li><li><strong>init_legacy_frame_rate</strong><ul><li><a href="./rf-system#systemsetlegacyframerate">$System.setLegacyFrameRate</a>を起動時に設定します。</li></ul></li><li><strong>init_sprite_angle_accuracy</strong><ul><li><a href="./rf-system#systemsetspriteangleaccuracy">$System.setSpriteAngleAccuracy</a>を起動時に設定します。</li></ul></li><li><strong>init_sin_cos_accuracy</strong><ul><li><a href="./rf-math#mathsetsincosaccuracy">$Math.setSinCosAccuracy</a>を起動時に設定します。</li></ul></li><li><strong>init_draw_mode_force_mode</strong><ul><li><a href="./rf-window#windowsetdrawmodeforcemode">$window.setDrawModeForceMode</a>を起動時に設定します。</li></ul></li><li><strong>init_se_loop_enable</strong><ul><li><a href="./rf-mplayer#mplayersetseloopenable">$mplayer.setSeLoopEnable</a>を起動時に設定します。</li></ul></li></ul></li></ul><p>default.tonyuprjファイルの<code>&lt;resourcelist name=&quot;params&quot;&gt;</code>内の値が変更、または要素が追加されます。<br>Tonyuを終了した後も値が残ります。</p><p><strong>例1</strong></p><pre><code>extends SpriteChar;
$Options.set(&quot;deactivation_pause&quot;,1); 
// ↑Tonyu以外のアプリケーションをアクティブにすると
// 一時停止する
while (1) {
  x++;
  update();
}
</code></pre><hr><h2 id="optionsgetenv">$Options.getEnv</h2><p><a href="#optionssetenv">$Options.setEnv</a>メソッドで設定したランタイムの設定を得ます。</p><p>※ ランタイム版（Player.exe）でのみ有効です。</p><p><strong>書式</strong></p><pre><code>getEnv(name)
</code></pre><ul><li><strong>name</strong><br>&emsp;設定項目の名前（<a href="#optionssetenv">$Options.setEnv</a>メソッド参照)</li></ul><p><strong>戻り値</strong></p><p>設定されている値</p><p>Kernel/Cookies.iniファイル内の要素から取得されます。</p><hr><h2 id="optionssetenv">$Options.setEnv</h2><p>ランタイムの各種設定を行います。</p><p>※ ランタイム版（Player.exe）でのみ有効です。</p><p><strong>書式</strong></p><pre><code>setEnv(name,value)
</code></pre><ul><li><strong>name</strong><br>&emsp;設定項目の名前</li><li><strong>value</strong><br>&emsp;設定する値</li></ul><p>設定項目の名前(name)として指定できるのは、今のところ次のいずれかです。</p><ul><li><strong>screenWidth</strong><br>&emsp;起動時のウィンドウの幅を指定します。</li><li><strong>screenHeight</strong><br>&emsp;起動時のウィンドウの高さを指定します。</li><li><strong>windowX</strong><br>&emsp;ウィンドウの横の位置を指定します。</li><li><strong>windowY</strong><br>&emsp;ウィンドウの縦の位置を指定します。</li></ul><p>Kernel/Cookies.iniファイル内の値が変更、または要素が追加されます。<br>Tonyuを終了した後も値が残ります。</p><p><strong>例1</strong></p><pre><code>extends SpriteChar;
$Options.setEnv(&quot;screenWidth&quot;,600);
$Options.setEnv(&quot;screenHeight&quot;,400);
$Options.setEnv(&quot;windowX&quot;,200);
$Options.setEnv(&quot;windowY&quot;,100);
// ↑次回ランタイムを起動したとき
// 600×400pxの画面サイズで
// ディスプレイの左上から(200,100)の位置に
// ウィンドウが表示されます
while (1) {
  update();
}
</code></pre><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-operator"class="pagediv"title2="命令リファレンス - .演算子 - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="演算子">.演算子</h2><p>他のオブジェクトの変数を参照するには <code>.</code> を使います。</p><h4 id="書式">書式</h4><pre><code>式 . 変数名
</code></pre><p>式 がオブジェクトの場合 、そのオブジェクトが持っている、変数名 で指定された名前をもつ変数を返します。<br>式 が初期化されていなかったり、式がオブジェクトでないと、 次の<a href="./error-mes">エラーメッセージ</a>が表示されます。</p><pre>
<span style="color:red">変数$xxxは初期化されていないので、変数yyy を参照できません。</span>
または
<span style="color:red">nullはオブジェクトではないので、変数yyy を参照できません。</span>
</pre><h3 id="例1">例1</h3><ul><li>オブジェクトを２つ作成します。名前は $ObjectA と $ObjectB にして下さい</li><li>$ObjectAをダブルクリックし、次のように入力します。</li></ul><pre><code>extends SpriteChar;
while (1) {
  x=x+1;
  update();
}
</code></pre><ul><li>$ObjectBをダブルクリックし、次のように入力します。</li></ul><pre><code>extends SpriteChar;
while (1) {
  x= $ObjectA.x +30; // x を、$ObjectAの変数xの値 + 30 にする
  $ObjectA.y =300; // $ObjectAの変数yの値 を 300 にする
  update();
}
</code></pre><p>▲ 実行すると、$ObjectA,$ObjectBはともに横に移動します。<br>$ObjectA という名前を書き間違えると次のようなメッセージが出ます。名前は間違えないようにしてください。</p><pre>
<span style="color:red">$xxx は初期化されていないので、変数x を参照できません。</span>
</pre><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-object"class="pagediv"title2="命令リファレンス - Object - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="objectクラス">Objectクラス</h2><p>すべてのオブジェクトの親クラスです。Objectクラスのメソッドはどのクラスからも利用できます。</p><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#objectabs">abs</a></td><td>絶対値を得ます。</td></tr><tr><td><a href="#objectamod">amod</a></td><td>剰余を求めますが、負の値を割る場合%演算子と挙動が変わります。</td></tr><tr><td><a href="#objectangle">angle</a></td><td>線分(1,0)-(0,0)と線分(0,0)-(x,y)のなす角を求めます</td></tr><tr><td><a href="#objectanglediff">angleDiff</a></td><td>角度の比較を行います。</td></tr><tr><td><a href="#objectappear">appear</a></td><td>実行中にオブジェクトを出現させます。</td></tr><tr><td><a href="#objectclearallvalues">clearAllValues</a></td><td>全ての数値を初期化します。</td></tr><tr><td><a href="#objectcolor">color</a></td><td>fillRect、drawLine、drawTextなどで、描画色を指定します</td></tr><tr><td><a href="#objectcolorhsl">colorHSL</a></td><td>色相、彩度、明度から色を作成します。</td></tr><tr><td><a href="#objectcos">cos</a></td><td>余弦(コサイン)を求めます。</td></tr><tr><td><a href="#objectdeletefile">deleteFile</a></td><td>ファイルを削除します</td></tr><tr><td><a href="#objectdesignmode">designMode</a></td><td>現在設計中であれば真を返します。</td></tr><tr><td><a href="#objectdist">dist</a></td><td>線分(0,0)-(x,y)の長さを求めます。</td></tr><tr><td><a href="#objectfileexists">fileExists</a></td><td>ファイルが存在するかどうかを調べます。</td></tr><tr><td><a href="#objectfloor">floor</a></td><td>実数から整数への変換を、値を超えない最大の整数を得ることで行います。</td></tr><tr><td><a href="#objectgetblue">getBlue</a></td><td>colorメソッドや色定数などの色を表す整数から青色の成分を取り出します。</td></tr><tr><td><a href="#objectgetclassname">getClassName</a></td><td>オブジェクトのクラス名を得ます。</td></tr><tr><td><a href="#objectgetglobal">getGlobal</a></td><td>グローバル変数の値を取得します</td></tr><tr><td><a href="#objectgetgreen">getGreen</a></td><td>colorメソッドや色定数などの色を表す整数から緑色の成分を取り出します。</td></tr><tr><td><a href="#objectgetred">getRed</a></td><td>colorメソッドや色定数などの色を表す整数から赤色の成分を取り出します。</td></tr><tr><td><a href="#objectgettime">getTime</a></td><td>システムタイマの値（OS起動からの時間）をミリ秒単位で返します。</td></tr><tr><td><a href="#objectgetvaluename">getValueName</a></td><td>オブジェクトの持つ変数名を取り出します。</td></tr><tr><td><a href="#objectgetkey">getkey</a></td><td>キーボードのキーやマウスボタンが押されているかどうか判定します。</td></tr><tr><td><a href="#objectinspect">inspect</a></td><td>オブジェクトをオブジェクトインスペクタに表示します。</td></tr><tr><td><a href="#objectisfloat">isFloat</a></td><td>値が実数（浮動小数点数）であるか調べます</td></tr><tr><td><a href="#objectisint">isInt</a></td><td>値が整数であるか調べます</td></tr><tr><td><a href="#objectmovefile">moveFile</a></td><td>ファイル名を変更します</td></tr><tr><td><a href="#objectprint">print</a></td><td>コンソールウィンドウとステータスバーに文字を出力します。</td></tr><tr><td><a href="#objectpset">pset</a></td><td>ドット描画を行います。</td></tr><tr><td><a href="#objectrandomize">randomize</a></td><td>rndメソッドが生成する乱数の系列(乱数の発生順序)を設定します。</td></tr><tr><td><a href="#objectrnd">rnd</a></td><td>乱数(でたらめな数)を返します</td></tr><tr><td><a href="#objectsin">sin</a></td><td>正弦(サイン)を求めます。</td></tr><tr><td><a href="#objectsqrt">sqrt</a></td><td>平方根を得ます</td></tr><tr><td><a href="#objectsub">sub</a></td><td>減算関数。引き算を行います。</td></tr><tr><td><a href="#objecttimestop">timeStop</a></td><td>すべてのオブジェクトの動作を停止します。</td></tr><tr><td><a href="#objecttrunc">trunc</a></td><td>実数から整数への変換を、小数部切捨てにより行います。</td></tr><tr><td><a href="#objectvalueof">valueOf</a></td><td>文字列から数値への変換を行います。</td></tr></tbody></table><hr><h2 id="objectabs">Object.abs</h2><p>絶対値を得ます。</p><p><strong>書式</strong></p><pre><code>abs(x)
</code></pre><ul><li><strong>x</strong><br>&emsp;数値</li></ul><p><strong>戻り値</strong></p><p>xの絶対値 x&gt;=0 なら x , x&lt;0 なら-x</p><hr><h2 id="objectamod">Object.amod</h2><p>剰余を求めますが、負の値を割る場合<a href="./rf-arithmetic">%演算子</a>と挙動が変わります。</p><p><strong>書式</strong></p><pre><code>amod(a,b)
</code></pre><ul><li><strong>a</strong><br>&emsp;割られる数(整数)</li><li><strong>b</strong><br>&emsp;割る数(正の整数)</li></ul><p><strong>戻り値</strong></p><p>a-(aを超えない最大のbの倍数)</p><p><strong>例1</strong></p><pre><code>extends SpriteChar;
print (amod(12,5));
print (12 % 5);
print (amod(-12,5));
print (-12 % 5);
</code></pre><hr><h2 id="objectangle">Object.angle</h2><p>線分(1,0)-(0,0)と線分(0,0)-(x,y)のなす角を求めます</p><p><strong>書式</strong></p><pre><code>angle(x,y)
</code></pre><ul><li><strong>x</strong><br>&emsp;線分(0,0)-(x,y)のx</li><li><strong>y</strong><br>&emsp;線分(0,0)-(x,y)のy</li></ul><p><strong>戻り値</strong></p><p>線分(1,0)-(0,0)と(0,0)-(x,y)のなす角(単位:度)</p><p>※angleで計算される角度はあまり正確ではありません。<br>角度を45で割った余りが22付近になる場合、誤差が大きくなります。<br>もっと正確に求めたい場合は、<a href="./rf-math#mathangle">$Math.angle</a>メソッドを使います。</p><p>参照： <a href="./rf-angle-sin-cos-dist">angle,sin,cos,distの関係</a></p><hr><h2 id="objectanglediff">Object.angleDiff</h2><p>角度の比較を行います。</p><p><strong>書式</strong></p><pre><code>angleDiff(a,b)
</code></pre><ul><li><strong>a</strong><br>&emsp;角度a</li><li><strong>b</strong><br>&emsp;角度b</li></ul><p><strong>戻り値</strong></p><p>angleDiff(a,b) は、-180 から 179 までの値を返します。</p><p>この値は次の性質をもっています。</p><p>angleDiff(a,b) == (a-b) + 360 * n (nは整数) 言い換えると、angleDiff(a,b)の戻り値は、角度a-b と同じ向きを持つ、-180 から 179 までの角度です。</p><p>angleDiff(360,90) = -90</p><p>angleDiff(-50,180) = 130</p><p>angleDiffを図で表すと図1のようになります。</p><p>d=angleDiff(a,b);</p><p><img src-t="./img/angle-diff.png"width="200"height="200"alt="angle-diff.png"></p><p>angleDiffを用いると、角度a から 角度bに到達するには右回り、左回りのどちらが早いかを判定することができます。<br>angleDiff(a,b)の値が正の とき、a から b に 至るには 左回り（aを減らす)が近く、<br>負のときは右回り(aを増やす) のほうが近くなります。</p><hr><h2 id="objectappear">Object.appear</h2><p>実行中にオブジェクトを出現させます。</p><p><strong>書式</strong></p><pre><code>appear(o)
</code></pre><ul><li><strong>o</strong><br>&emsp;出現させるオブジェクト</li></ul><p><strong>戻り値</strong></p><p>出現したオブジェクト(o自身)</p><p><a href="./rf-spritechar">スプライトオブジェクト</a>、<a href="./rf-dxchar">DXスプライトオブジェクト</a>の作成には、次の形式が便利です。</p><p><strong>書式:</strong></p><pre>
appear(new <b>クラス名</b>( <b>x座標</b>, <b>y座標</b>, <b>キャラクタパターン</b>, <b>反転</b> ))
</pre><ul><li><strong>クラス名</strong><br>&emsp;出現させるオブジェクトのクラスを指定します</li><li><strong>x座標,y座標</strong><br>&emsp;出現位置を指定します</li><li><strong>キャラクタパターン</strong><br>&emsp;出現したときのキャラクタパターンを指定します</li><li><strong>反転(省略可)</strong><br>&emsp;１を指定するとキャラクタパターンを左右反転します</li></ul><p>テキストオブジェクトは次の形式で作成します</p><p><strong>書式:</strong></p><pre>
appear(new <b>クラス名</b>( <b>x座標</b>, <b>y座標</b>, <b>テキスト</b>, <b>色</b>, <b>サイズ</b>))
</pre><ul><li><strong>クラス名</strong><br>&emsp;出現させるオブジェクトのクラスを指定します</li><li><strong>テキスト</strong><br>&emsp;出現したときのテキストの内容を文字列で指定します</li><li><strong>色</strong><br>&emsp;テキストの色を決めます。通常<a href="#objectcolor">color</a>メソッドを使います。</li><li><strong>サイズ</strong><br>&emsp;文字の大きさを決めます。省略すると12です</li></ul><p><strong>例1</strong></p><pre><code>en=appear(new Enemy(x,y,$pat_enemy+3));
</code></pre><p><strong>例2</strong></p><p>Tama.tonyu</p><pre><code>extends SpriteChar;
while(1) {
  x+=vx;y+=vy;
  update();
}
</code></pre><p>Jiki.tonyu</p><pre><code>extends SpriteChar;
while(1) {
  if (getkey(32)==1) {
    t=new Tama(x,y,10); // t:出現させるオブジェクト
    // tの変数を初期化。←を押すと左方向、→を押すと右方向に飛んでいく
    if (getkey(37)) t.vx=-2;
    if (getkey(39)) t.vx=2;
    t.vy=-8;
    appear(t);
  }
  update();
}
</code></pre><hr><h2 id="objectclearallvalues">Object.clearAllValues</h2><p>全ての数値を初期化します。</p><p><strong>書式</strong></p><pre><code>clearAllValues()
</code></pre><p>全ての数値の初期化。</p><p><strong>(推奨されない関数)</strong> clearAllValuesはTonyu Systemが自動的に呼び出します。<br>プログラム中に記述するとゲームが正常に作動しないことが予想されます。</p><p><strong>例1</strong></p><pre><code>clearAllValues();
</code></pre><p>▲ 全ての数値が初期化されます</p><hr><h2 id="objectcolor">Object.color</h2><p><a href="./rf-sprite#spritefillrect">fillRect</a>、<a href="./rf-sprite#spritedrawline">drawLine</a>、<a href="./rf-sprite#spritedrawtext">drawText</a>などで、描画色を指定します</p><p><strong>書式</strong></p><pre><code>color(r,g,b)
</code></pre><ul><li><strong>r</strong><br>&emsp;赤成分(0-255)</li><li><strong>g</strong><br>&emsp;緑成分(0-255)</li><li><strong>b</strong><br>&emsp;青成分(0-255)</li></ul><p><strong>戻り値</strong></p><p>色を表す整数</p><p><strong>例1</strong></p><pre><code>drawText(10,10,&quot;赤巻き紙&quot;,color(255,50,50));
drawText(10,40,&quot;青巻き紙&quot;,color(50,50,255));
drawText(10,70,&quot;黄巻き紙&quot;,color(255,255,50));
</code></pre><p>また、次の8種類の色があらかじめ定義されています。</p><table><thead><tr><th>変数名</th><th>色</th><th>colorメソッドによる定義</th></tr></thead><tbody><tr><td>$clBlack</td><td><span style="color:#000">■</span></td><td>color(8, 8, 16)</td></tr><tr><td>$clRed</td><td><span style="color:red">■</span></td><td>color(255, 0, 0)</td></tr><tr><td>$clYellow</td><td><span style="color:#ff0">■</span></td><td>color(255, 255, 0)</td></tr><tr><td>$clGreen</td><td><span style="color:#0f0">■</span></td><td>color(0, 255, 0)</td></tr><tr><td>$clAqua</td><td><span style="color:#0ff">■</span></td><td>color(0, 255, 255)</td></tr><tr><td>$clBlue</td><td><span style="color:#00f">■</span></td><td>color(0, 0, 255)</td></tr><tr><td>$clPink</td><td><span style="color:#f0f">■</span></td><td>color(255, 0, 255)</td></tr><tr><td>$clWhite</td><td><span style="color:#fff">■</span></td><td>color(255, 255, 255)</td></tr></tbody></table><p><strong>参考</strong></p><p><a href="https://www.tonyu.jp/joyful/joyful.cgi?mode=res&amp;no=5729">$clBlackの色が中途半端なのは</a></p><p><strong>例2</strong></p><pre><code>drawText(10,10,&quot;赤巻き紙&quot;,$clRed);
drawText(10,40,&quot;青巻き紙&quot;,$clBlue);
drawText(10,70,&quot;黄巻き紙&quot;,$clYellow);
</code></pre><p><strong>参照</strong></p><p><a href="#objectcolorhsl">colorHSL</a></p><hr><h2 id="objectcolorhsl">Object.colorHSL</h2><p>色相、彩度、明度から色を作成します。</p><p><strong>書式</strong></p><pre><code>colorHSL(h,s,l)
</code></pre><ul><li><strong>h</strong><br>&emsp;色相</li><li><strong>s</strong><br>&emsp;彩度</li><li><strong>l</strong><br>&emsp;明度</li></ul><hr><h2 id="objectcos">Object.cos</h2><p>余弦(コサイン)を求めます。</p><p><strong>書式</strong></p><pre><code>cos(t)
</code></pre><ul><li><strong>t</strong><br>&emsp;度をあらわす整数(ラジアンではありません)</li></ul><p><strong>戻り値</strong></p><p>t度の余弦を求めます。<br>cosがどのような値をもっているかは、<a href="./rf-angle-sin-cos-dist">angle,sin,cos,distの関係</a>を参照してください。</p><p><strong>例1</strong></p><p>例は<a href="#objectsin">sin</a>メソッドに載っています。<br>※sin,cosの計算は、三角関数表をあらかじめ用意しているため高速ですが、<br>指定する角度は整数のみ有効です(角度の小数点以下は切り捨てられます)<br>ver1.30では精度が向上します。詳しくは<a href="rf-math#mathsetsincosaccuracy">$Math.setSinCosAccuracy</a>を参照</p><p><strong>参照</strong></p><ul><li><a href="#objectsin">sin</a>メソッド</li><li><a href="#objectangle">angle</a>メソッド</li></ul><hr><h2 id="objectdeletefile">Object.deleteFile</h2><p>ファイルを削除します</p><p><strong>書式</strong></p><pre><code>deleteFile(fileName)
</code></pre><ul><li><strong>fileName</strong><br>&emsp;削除するファイル名</li></ul><p><strong>戻り値</strong></p><p>削除が成功ならば1、そうでなければ0</p><p>ファイルについては、<a href="./rf-file-handling">ファイルの扱いについて</a>を参照してください。</p><hr><h2 id="objectdesignmode">Object.designMode</h2><p>現在設計中(実行コマンドを発行する前や、実行を停止した後)であれば真を返します。</p><p><strong>書式</strong></p><pre><code>designMode()
</code></pre><hr><h2 id="objectdist">Object.dist</h2><p>線分(0,0)-(x,y)の長さを求めます。</p><p><strong>書式</strong></p><pre><code>dist(x,y)
</code></pre><ul><li><strong>x</strong><br>&emsp;線分(0,0)-(x,y)のx</li><li><strong>y</strong><br>&emsp;線分(0,0)-(x,y)のy</li></ul><p><strong>戻り値</strong></p><p>線分(0,0)-(x,y)の長さ</p><p><strong>例1</strong></p><pre><code>extends SpriteChar;
while (1) {
  if (dist(x-$teki.x, y-$teki.y)&lt;50) die();
  update();
}
</code></pre><p>▲ オブジェクト $teki との距離が50以下になるとdie(); が呼ばれます。</p><p><strong>参照</strong></p><p><a href="./rf-angle-sin-cos-dist">angle,sin,cos,distの関係</a></p><hr><h2 id="objectfileexists">Object.fileExists</h2><p><a href="./rf-file-handling">ファイル</a>が存在するかどうかを調べます。</p><p><strong>書式</strong></p><pre><code>fileExists(f)
</code></pre><ul><li><strong>f</strong><br>&emsp;ファイル名</li></ul><p><strong>戻り値</strong></p><p>ファイルが存在すれば1、なければ0</p><hr><h2 id="objectfloor">Object.floor</h2><p>実数から整数への変換を、値を超えない最大の整数を得ることで行います。</p><p><strong>書式</strong></p><pre><code>floor(r)
</code></pre><ul><li><strong>r</strong><br>&emsp;実数値</li></ul><p><strong>戻り値</strong></p><p>rを超えない最大の整数</p><p>※ rが正または0の場合、<a href="#objecttrunc">trunc</a>(r)と同じ値を返しますが、負の場合はtrunc(r)-1 が返されます。</p><hr><h2 id="objectgetblue">Object.getBlue</h2><p><a href="#objectcolor">colorメソッドや色定数</a>などの色を表す整数から青色の成分を取り出します。</p><p><strong>書式</strong></p><pre><code>getBlue(c)
</code></pre><ul><li><strong>c</strong><br>&emsp;色を表す整数</li></ul><p><strong>戻り値</strong></p><p>c の青成分(0-255)</p><p>getBlueメソッドとcolorメソッドの関係は次のようになります。<br>c = color(r,g,b) ならば、 getBlue( c ) == b</p><hr><h2 id="objectgetclassname">Object.getClassName</h2><p>オブジェクトのクラス名を得ます。</p><p><strong>書式</strong></p><pre><code>getClassName()
</code></pre><p><strong>戻り値</strong></p><p>このオブジェクトのクラス名</p><hr><h2 id="objectgetglobal">Object.getGlobal</h2><p>グローバル変数の値を取得します</p><p><strong>書式</strong></p><pre><code>getGlobal(n)
</code></pre><ul><li><strong>n</strong><br>&emsp;変数名をあらわす文字列（$を含む)</li></ul><p><strong>戻り値</strong></p><p>変数nの値</p><p><strong>例</strong></p><pre><code>n=&quot;$Test&quot;;
t=getGlobal(n);
</code></pre><hr><h2 id="objectgetgreen">Object.getGreen</h2><p><a href="#objectcolor">colorメソッドや色定数</a>などの色を表す整数から緑色の成分を取り出します。</p><p><strong>書式</strong></p><pre><code>getGreen(c)
</code></pre><ul><li><strong>c</strong><br>&emsp;色を表す整数</li></ul><p><strong>戻り値</strong></p><p>c の緑成分(0-255)</p><p>getGreenメソッドとcolorメソッドの関係は次のようになります。<br>c = color(r,g,b) ならば、 getGreen( c ) == g</p><hr><h2 id="objectgetred">Object.getRed</h2><p><a href="#objectcolor">colorメソッドや色定数</a>などの色を表す整数から赤色の成分を取り出します。</p><p><strong>書式</strong></p><pre><code>getRed(c)
</code></pre><ul><li><strong>c</strong><br>&emsp;色を表す整数</li></ul><p><strong>戻り値</strong></p><p>c の赤成分(0-255)</p><p>getRedメソッドとcolorメソッドの関係は次のようになります。<br>c = color(r,g,b) ならば、 getRed( c ) == r</p><hr><h2 id="objectgettime">Object.getTime</h2><p>システムタイマの値（OS起動からの時間）をミリ秒単位で返します。</p><p><strong>書式</strong></p><pre><code>getTime()
</code></pre><p><strong>戻り値</strong></p><p>システムタイマの値</p><hr><h2 id="objectgetvaluename">Object.getValueName</h2><p>オブジェクトの持つ変数名を取り出します。</p><p><strong>書式</strong></p><pre><code>getValueName(idx)
</code></pre><ul><li><strong>idx</strong><br>&emsp;インデックスをあらわす整数。<br>&emsp;インデックスは、この オブジェクトをオブジェクトインスペクタに表示させたときの、<br>&emsp;一番上の変数が0で、順番に増えていきます。</li></ul><p><strong>戻り値</strong></p><p>idx番目の変数の名前</p><hr><h2 id="objectgetkey">Object.getkey</h2><p>キーボードのキーやマウスボタンが押されているかどうか判定します。</p><p><strong>書式</strong></p><pre><code>getkey(i)
</code></pre><ul><li><strong>i</strong><br>&emsp;調べたいキーのキーID</li></ul><p><strong>戻り値</strong></p><p>0：押されていない<br>1：今押されたばかり<br>2以上：押しっぱなしになっている</p><p>主なキーのキーIDを示します。</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>1</td><td>マウスの左ボタン</td></tr><tr><td>2</td><td>マウスの右ボタン</td></tr><tr><td>4</td><td>マウスのホイールボタン</td></tr><tr><td>32</td><td>スペースキー</td></tr><tr><td>37</td><td>カーソルキー←</td></tr><tr><td>38</td><td>カーソルキー↑</td></tr><tr><td>39</td><td>カーソルキー→</td></tr><tr><td>40</td><td>カーソルキー↓</td></tr><tr><td>48-57</td><td>数字0-9(Q W E...の上段に並んでいるキー)</td></tr><tr><td>65-90</td><td>アルファベットA-Z</td></tr><tr><td>96-105</td><td>テンキーの0-9</td></tr><tr><td>16</td><td>左、右シフト（両方16)</td></tr></tbody></table><p><a href="./rf-keycode">その他のキーID</a></p><p><strong>例1</strong></p><pre><code>extends SpriteChar;
while (1) {
  if (getkey(32)&gt;0) x+=1;
  update();
}
</code></pre><p>▲ スペースキーの状態が押されていると横移動します。</p><p>※その他のキーのキーIDの調べ方</p><ol><li>新規オブジェクト(新規クラス)を作成</li><li>オブジェクトをダブルクリックし、次のように入力して実行</li><li>押しているキーのキーIDが表示される<pre><code>extends SpriteChar;
while (1) {
  i=0;
  while(i&lt;255) {
 if (getkey(i)) drawText(i,10,i,color(255,255,255));
 i=i+1;
  }
  update();
}
</code></pre></li></ol><p>※Tonyuがアクティブでないときにgetkeyを無効にする</p><pre><code>$Options.set(&quot;deactivate_disableKey&quot;,1);
</code></pre><p>参照： <a href="./rf-options#optionsset">$Options.set</a>メソッド</p><hr><h2 id="objectinspect">Object.inspect</h2><p>オブジェクトをオブジェクトインスペクタに表示します。</p><p><strong>書式</strong></p><pre><code>inspect()
</code></pre><hr><h2 id="objectisfloat">Object.isFloat</h2><p>値が実数（浮動小数点数）であるか調べます</p><p><strong>書式</strong></p><pre><code>isFloat(v)
</code></pre><ul><li><strong>v</strong><br>&emsp;調べる値</li></ul><p><strong>戻り値</strong></p><p>vが実数であれば0以外、そうでなければ0</p><hr><h2 id="objectisint">Object.isInt</h2><p>値が整数であるか調べます</p><p><strong>書式</strong></p><pre><code>isInt(v)
</code></pre><ul><li><strong>v</strong><br>&emsp;調べる値</li></ul><p><strong>戻り値</strong></p><p>vが整数であれば0以外、そうでなければ0</p><hr><h2 id="objectmovefile">Object.moveFile</h2><p>ファイル名を変更します</p><p><strong>書式</strong></p><pre><code>moveFile(from,to)
</code></pre><ul><li><strong>from</strong><br>&emsp;変更前のファイル名</li><li><strong>to</strong><br>&emsp;変更後のファイル名</li></ul><p><strong>戻り値</strong></p><p>変更が成功ならば1、そうでなければ0</p><hr><h2 id="objectprint">Object.print</h2><p><a href="./wnd-csl">コンソールウィンドウ</a>とステータスバーに文字を出力します。</p><p><strong>書式</strong></p><pre><code>print(v)
</code></pre><ul><li><strong>v</strong><br>&emsp;表示する値</li></ul><p>コンソールウィンドウはメニューの「ウィンドウ」＞「コンソール」 で表示できます。</p><p><strong>例1</strong></p><pre><code>extends SpriteChar;
print(2+3);
print(&quot;Hello, world&quot;);
</code></pre><hr><h2 id="objectpset">Object.pset</h2><p>ドット描画を行います。</p><p><strong>書式</strong></p><pre><code>pset(x,y,c)
</code></pre><ul><li><strong>x,y,c</strong><br>&emsp;指定した位置にドット描画を行います。</li></ul><p><strong>(使用できない関数)</strong> 古いFormatに付き、現在は使用できないようになっています。</p><p><strong>例1</strong></p><pre><code>pset(100,100,$clBlack);
</code></pre><p>▲ (100,100)に黒い点が現れます。</p><hr><h2 id="objectrandomize">Object.randomize</h2><p><a href="#objectrnd">rnd</a>メソッドが生成する乱数の系列(乱数の発生順序)を設定します。</p><p><strong>書式</strong></p><pre><code>randomize(seed)
</code></pre><ul><li><strong>seed(省略可能)</strong><br>&emsp;乱数系列を表す整数( 0 ～ 16777215 )。 省略すると、システムタイマによって乱数系列が設定されます。</li></ul><p>このseedの値によって、この後rndメソッドが返す値の順番が決まります。<br>seedを省略した場合、プログラムを実行するたびにまったく違う乱数を返すことができます</p><p><strong>例1</strong></p><pre><code>extends SpriteChar;
randomize();
while (1) {
  if (rnd(10)==0) {
    x=rnd()*$screenWidth;
    y=rnd()*$screenHeight;
  }
  update();
}
</code></pre><hr><h2 id="objectrnd">Object.rnd</h2><p>乱数(でたらめな数)を返します</p><p><strong>書式</strong></p><pre><code>rnd(n)
</code></pre><ul><li><strong>n(省略可能)</strong><br>&emsp;発生させる乱数の範囲。</li></ul><p><strong>戻り値</strong></p><p>0 から n-1の整数乱数。nを省略すると0から1の実数乱数を返します。</p><p><strong>例1</strong></p><pre><code>extends SpriteChar;
while (1) {
  if( rnd(10)==0) {
    x=rnd()*$screenWidth;
    y=rnd()*$screenHeight;
  }
  update();
}
</code></pre><p>▲ 10フレームに１回の確率で、画面上のいろいろな場所にオブジェクトが移動します。</p><p>実行のたびに違う順序で乱数を発生させるには<a href="#objectrandomize">randomize</a>メソッドを使います。</p><hr><h2 id="objectsin">Object.sin</h2><p>正弦(サイン)を求めます。</p><p><strong>書式</strong></p><pre><code>sin(t)
</code></pre><ul><li><strong>t</strong><br>&emsp;度をあらわす整数(ラジアンではありません)</li></ul><p><strong>戻り値</strong></p><p>t度の正弦を求めます。<br>sinがどのような値をもっているかは、<a href="./rf-angle-sin-cos-dist">angle,sin,cos,distの関係</a>を参照してください。</p><p><strong>例1</strong></p><pre><code>extends SpriteChar;
a=0;
while (1) {
  x=200+cos(a)*100;
  y=200+sin(a)*100; 
  a=a+10;
  update();
}
</code></pre><p>▲ オブジェクトが回転します。</p><p>※sin,cosの計算は、三角関数表をあらかじめ用意しているため高速ですが、<br>指定する角度は整数のみ有効です(角度の小数点以下は切り捨てられます)<br>ver1.30では精度が向上します。詳しくは<a href="rf-math#mathsetsincosaccuracy">$Math.setSinCosAccuracy</a>を参照</p><p><strong>参照</strong></p><ul><li><a href="#objectcos">cos</a>メソッド</li><li><a href="#objectangle">angle</a>メソッド</li></ul><hr><h2 id="objectsqrt">Object.sqrt</h2><p>平方根を得ます</p><p><strong>書式</strong></p><pre><code>sqrt(x)
</code></pre><ul><li><strong>x</strong><br>&emsp;正の数値</li></ul><p><strong>戻り値</strong></p><p>√x</p><p><strong>例1</strong></p><pre><code>extends TextChar;
while (1) {
  dx=x-$mouseX;
  dy=y-$mouseY;
  text=sqrt(dx*dx+dy*dy); 
  update();
}
</code></pre><p>▲ このオブジェクトとマウスカーソルの距離を計算します（本当は<a href="#objectdist">dist</a>メソッドを使ったほうが楽です)</p><hr><h2 id="objectsub">Object.sub</h2><p>減算関数。引き算を行います。</p><p><strong>書式</strong></p><pre><code>sub(x,y)
</code></pre><ul><li><strong>x,y</strong><br>&emsp;x-yの結果を出力します。</li></ul><p><strong>戻り値</strong></p><p>x-y</p><p><strong>(使用できない関数)</strong> 古いFormatに付き、現在は使用できないようになっています。</p><p><strong>例1</strong></p><pre><code>sub(x,y);
print(sub(10,1));
</code></pre><p>▲ 10-1の結果の9を出力します。</p><hr><h2 id="objecttimestop">Object.timeStop</h2><p>すべてのオブジェクトの動作を停止します。ただし、このメソッドを呼び出したオブジェクトだけ停止しません</p><p><strong>書式</strong></p><pre><code>timeStop()
</code></pre><p><strong>戻り値</strong></p><p>新規作成された<a href="./rf-timestopper">TimeStopper</a>オブジェクト。</p><p>TimeStopperオブジェクトは、止めた時間をふたたび動かす時に使います。</p><p>時間を動かすにはTimeStopperオブジェクトに対して、 <a href="./rf-timestopper#timestopperrelease">release</a>メソッドや <a href="./rf-timestopper#timestopperreleaseall">releaseAll</a>メソッドを 呼び出します。</p><p><strong>例1</strong></p><p>Ball.tonyu</p><pre><code>extends SpriteChar;
while (x&lt;$screenWidth) {
  x+=2;
  update();
}
</code></pre><p>Stop.tonyu</p><pre><code>extends SpriteChar;
t=null;
while (1) {
  if (t==null) {// まだ時間をとめていなければ
    if (rnd(60)==0) appear(new Ball(0,rnd($screenHeight),19)); // 玉を出現させる
    if (getkey(32)==1) { //スペースキーが押されたら時間をとめる
      t=timeStop();
    }
  } else {
    // すでに時間をとめていたら
    if (getkey(32)==1) { //スペースキーが押されたら時間を動かす
      t.releaseAll();
      t=null;
    }
    // 玉にふれるとその玉は動き出す
    for (a in $chars) {
       if (a is Ball &amp;&amp; crashTo(a)) t.release(a);
    }
  }
  if (getkey(39)&gt;0) x+=3;
  if (getkey(37)&gt;0) x-=3; 
  if (getkey(40)&gt;0) y+=3;
  if (getkey(38)&gt;0) y-=3;
  update(); 
}
</code></pre><hr><h2 id="objecttrunc">Object.trunc</h2><p>実数から整数への変換を、小数部切捨てにより行います。</p><p><strong>書式</strong></p><pre><code>trunc(r)
</code></pre><ul><li><strong>r</strong><br>&emsp;実数値</li></ul><p><strong>戻り値</strong></p><p>rの小数点を切り捨てた値</p><p>※ rが正または0の場合、<a href="#objectfloor">floor</a>(r)と同じ値を返しますが、負の場合はfloor(r)+1 が返されます。</p><p><strong>例1</strong></p><pre><code>extends SpriteChar;
x=10;
x=trunc(x/3);
print(x);
</code></pre><p>▲ xの値は10/3 = 3.333... の小数部を切り捨てた3になります</p><p><strong>参考：四捨五入</strong></p><p>次のようにすると、小数点以下を四捨五入します。</p><pre><code>n=trunc(n+0.5);
</code></pre><hr><h2 id="objectvalueof">Object.valueOf</h2><p>文字列から数値への変換を行います。</p><p><strong>書式</strong></p><pre><code>valueOf(s)
</code></pre><ul><li><strong>s</strong><br>&emsp;文字列 ( &quot;123&quot; &quot;45.6&quot; &quot;-78&quot; など)</li></ul><p><strong>戻り値</strong></p><p>変換された値。文字列が数値を表していない場合null</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-null"class="pagediv"title2="命令リファレンス - null - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="null">null</h2><p><strong>null</strong>とは、「何も値が入っていない」という意味です。変数に値が代入される前には、このnullという値が入っています。</p><p>ある変数がnullであるか(まだ値が入っていないか)どうかは、次のように判定できます</p><pre><code>if (x==null) ...
</code></pre><p>次のように、変数にnullを代入することも可能です。</p><pre><code>x=null;
</code></pre><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-mplayer"class="pagediv"title2="命令リファレンス - $mplayer - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="mplayerオブジェクト">$mplayerオブジェクト</h2><p>音楽、効果音の制御を行います</p><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#mplayerplay">play</a></td><td>BGM,効果音を演奏します</td></tr><tr><td><a href="#mplayerstop">stop</a></td><td>BGMの演奏を停止します</td></tr><tr><td><a href="#mplayerstopse">stopSE</a></td><td>効果音の再生を停止します</td></tr><tr><td><a href="#mplayersetvolume">setVolume</a></td><td>BGMの音量を調節します</td></tr><tr><td><a href="#mplayersetdelay">setDelay</a></td><td>効果音を鳴らす際の待機時間を調整します(ver1.29以前などに適用)</td></tr><tr><td><a href="#mplayersetdelayds">setDelayDs</a></td><td>効果音を鳴らす際の待機時間を調整します(ver1.30以降などに適用)</td></tr><tr><td><a href="#mplayergetautodelayds">getAutoDelayDs</a></td><td>setDelayDsで自動調整に設定時の待機時間を取得します</td></tr><tr><td><a href="#mplayerresetautodelayds">resetAutoDelayDs</a></td><td>setDelayDsで自動調整に設定時の待機時間をリセットします</td></tr><tr><td><a href="#mplayersetsoundplaymode">setSoundPlayMode</a></td><td>wav,mzo再生の音源モードを切り替えます</td></tr><tr><td><a href="#mplayersetbasevolume">setBaseVolume</a></td><td>wav,mzo再生の全体音量を設定します</td></tr><tr><td><a href="#mplayersetvolumelimiter">setVolumeLimiter</a></td><td>wav,mzoの音量が大きい場合、音割れを防ぐ機能の有効・無効を設定します</td></tr><tr><td><a href="#mplayersetseloopenable">setSeLoopEnable</a></td><td>wavのループを有効・無効を設定します</td></tr><tr><td><a href="#mplayersetsestopenable">setSeStopEnable</a></td><td>stopSEの有効・無効を設定します</td></tr></tbody></table><hr><h2 id="mplayerplay">$mplayer.play</h2><p>BGM,効果音を演奏します</p><p><strong>書式</strong></p><pre><code>play(s,autoReplay,vol)
</code></pre><ul><li><strong>s</strong><br>&emsp;演奏するサウンドオブジェクト</li><li><strong>autoReplay (省略可能)</strong><br>&emsp;Midi,Wavを繰り返し演奏する場合は1</li><li><strong>vol (省略可能)</strong><br>&emsp;効果音の音量(0-128)</li></ul><p><strong>戻り値</strong></p><p>効果音のID</p><p>効果音を途中停止する場合に使います。（<a href="#mplayerstopse">$mplayer.stopSE</a>）</p><p><strong>例1</strong></p><p>(予め、<a href="./wnd-bgm">BGM・効果音</a>ウィンドウで test.wavというサウンドファイルを読み込んでおく必要があります)</p><pre><code>extends SpriteChar;
while (1) {
  if (getkey(32)==1) {$mplayer.play($se_test);}
  update();
}
</code></pre><p>▲ スペースキーを押すとtest.wavが鳴ります</p><hr><h2 id="mplayerstop">$mplayer.stop</h2><p>BGMの演奏を停止します</p><p><strong>書式</strong></p><pre><code>stop()
</code></pre><p><strong>例1</strong></p><pre><code>$mplayer.stop();
</code></pre><hr><h2 id="mplayerstopse">$mplayer.stopSE</h2><h5 id="1_30_2022_0804以降">(1_30_2022_0804以降)</h5><p>効果音を再生中に停止できます</p><p><a href="#mplayersetsoundplaymode">setSoundPlayMode(1)</a>以外に設定時、動作します。</p><p>※ <strong>stopSEを使う時は、先に<a href="#mplayersetsestopenable">setSeStopEnable</a>で有効化してください。</strong></p><p>※ ver1.303現在、バグなのか音が若干残る場合があります。<a href="#mplayersetsoundplaymode">setSoundPlayMode(4)</a>を設定すると音が完全に止まります。</p><p>※ wavの効果音とBGMが50音以上同時に再生されている場合は、正しく停止できない場合があります。</p><p><strong>書式</strong></p><pre><code>stopSE(id, shortFadeout)
</code></pre><ul><li><strong>id</strong><br>&emsp;再生中の効果音のID</li><li><strong>shortFadeout (省略可能)</strong><br>&emsp;フェードアウトの時間 (サンプル数）（1秒＝44100)<br>&emsp;指定した時間をかけて緩やかに停止します<br>&emsp;停止時にプチっとノイズが鳴るのを軽減したい場合に指定します<br>&emsp;ノイズ対策用のため、0～10000(約0.23秒)の範囲です<br>&emsp;省略すると0指定時と同じで、速やかに停止します<br>&emsp;<a href="#mplayersetsoundplaymode">setSoundPlayMode(2or3)</a>に設定時のみ適用となります</li></ul><p><strong>例1</strong></p><p>(予め、<a href="./wnd-bgm">BGM・効果音</a>ウィンドウで test.wavというサウンドファイルを読み込んでおく必要があります)</p><pre><code>extends SpriteChar;
$mplayer.setSeStopEnable(1); // stopSE有効化
while (1) {
  if (getkey(90)==1) seID=$mplayer.play($se_test); // Zキーで効果音再生
  if (getkey(88)==1) $mplayer.stopSE(seID); // Xキーで効果音を途中停止
  if (getkey(67)==1) $mplayer.stopSE(seID,100); // Cキーで効果音を途中停止(停止時のノイズ軽減)
  update();
}
</code></pre><hr><h2 id="mplayersetvolume">$mplayer.setVolume</h2><p>BGMの音量を調節します</p><p><em>このメソッドは.mzo形式にのみ利用可能です</em></p><p><strong>書式</strong></p><pre><code>setVolume(vol)
</code></pre><ul><li><strong>vol</strong><br>&emsp;音量(0-256)</li></ul><p><strong>例1</strong></p><pre><code>for (i=256; i&gt;0; i--) {
  $mplayer.setVolume(i);
  update();
}
</code></pre><p>▲ フェードアウトします。他の音楽を鳴らす前には<code>$mplayer.setVolume(256)</code>を実行してください。（音が出なくなります）</p><hr><h2 id="mplayersetdelay">$mplayer.setDelay</h2><p>効果音を鳴らす際の待機時間を調整します<br>ver1.30以降<a href="#mplayersetsoundplaymode">setSoundPlayMode(1or2)</a>に設定時のみ適用となります。</p><p><strong>書式</strong></p><pre><code>setDelay(time)
</code></pre><ul><li><strong>time</strong><br>&emsp;待機時間 (サンプル数：1秒＝44100)</li></ul><p>効果音の最初の部分が途切れる場合は、この値を大きめにしてください<br>（ただし大きくしすぎると待機しなくなるので、最大約19000が限度です）</p><p>規定値はWindowsのバージョンによって以下にしています</p><table><thead><tr><th>Windowsのバージョン</th><th>規定値</th></tr></thead><tbody><tr><td>Windows XP以前</td><td>1350</td></tr><tr><td>Windows Vista / 7</td><td>2400</td></tr><tr><td>Windows 8 / 8.1</td><td>2500</td></tr><tr><td>Windows 10以降</td><td>3000</td></tr></tbody></table><hr><h2 id="mplayersetdelayds">$mplayer.setDelayDs</h2><h5 id="1_30_2022_0804以降-1">(1_30_2022_0804以降)</h5><p>※ デフォルト自動で調整する設定のため、<strong>通常このメソッドを使用する必要はありません</strong></p><p>効果音を鳴らす際の待機時間を調整します。<br><a href="#mplayersetsoundplaymode">setSoundPlayMode(3)</a>に設定時、適用されます。</p><p><strong>書式</strong></p><pre><code>setDelayDs(time)
</code></pre><ul><li><strong>time</strong><br>&emsp;待機時間 (サンプル数：1秒＝44100)<br>&emsp;<strong>-1：自動設定（デフォルト）</strong><br>&emsp;&emsp;・待機時間を自動で調整します<br>&emsp;&emsp;・DirectSoundから情報取得し待機時間を求めています<br>&emsp;<strong>0以上：手動設定</strong><br>&emsp;&emsp;・待機時間を手動で調整します<br>&emsp;&emsp;・ただし大きくしすぎると待機しなくなるので、最大約19000が限度です</li></ul><hr><h2 id="mplayergetautodelayds">$mplayer.getAutoDelayDs</h2><h5 id="1_30_2022_0804以降-2">(1_30_2022_0804以降)</h5><p><a href="#mplayersetdelayds">setDelayDs</a>で自動調整に設定している際の待機時間を取得します</p><p><a href="#mplayersetsoundplaymode">setSoundPlayMode(3)</a>かつ<a href="#mplayersetdelayds">setDelayDs(-1)</a>に設定時、Tonyu内部で使用されます。</p><p><strong>書式</strong></p><pre><code>getAutoDelayDs()
</code></pre><p><strong>戻り値</strong></p><p>自動調整に設定している際の待機時間 (サンプル数：1秒＝44100)</p><hr><h2 id="mplayerresetautodelayds">$mplayer.resetAutoDelayDs</h2><h5 id="1_30_2022_0804以降-3">(1_30_2022_0804以降)</h5><p><strong>※ 通常このメソッドを使用する必要はありません</strong></p><p><a href="#mplayersetdelayds">setDelayDs</a>で自動調整に設定している際の待機時間をリセットします。</p><p>DirectSoundから情報取得し待機時間を求めていますが、<br>待機時間が自動で大きくなっていきますが小さくはなりません。<br>手動で待機時間を0に戻します。</p><p><strong>書式</strong></p><pre><code>resetAutoDelayDs()
</code></pre><hr><h2 id="mplayersetsoundplaymode">$mplayer.setSoundPlayMode</h2><h5 id="1_30_2022_0804以降-4">(1_30_2022_0804以降)</h5><p>wav,mzo再生の音源モードを切り替えます。</p><p>※ 実行すると効果音とBGMが止まります。<br>&emsp; 処理が重いので、起動時に１度だけ使用したり、設定画面等で使用することをお勧めします。<br>&emsp; BGMは自動では復帰しないので、鳴らしたい場合は再度再生する必要があります。</p><p>※ 基本的にはデフォルト設定の、音源モード3のままで問題ありません。<br>&emsp; 旧バージョンの音源を再現したい場合は1にします。<br>&emsp; 2,4は開発の過程でできたものです。</p><p><strong>書式</strong></p><pre><code>setSoundPlayMode(mode)
</code></pre><ul><li><strong>mode</strong><br>&emsp;音源モードの番号<br>&emsp;デフォルトは3に設定されています。</li></ul><table><thead><tr><th>音源モードの番号</th><th>概要</th></tr></thead><tbody><tr><td>1</td><td><strong>Tonyu1.29以前の音源</strong><br>旧音源です。昔の音源で鳴らしたい特殊な場合にのみ使います。<br>ただし、下記の不具合や仕様も再現されてしまいます。<br>・音質が44100Hz8bitモノラルとなり劣化します<br>・wavのレイテンシが大きいです<br>・11025Hz, 22050Hz, 44100Hz以外のwavは再生速度が速くなります<br>・wavの同時発音数は再生から約0.45秒までは無限、それ以降は9です</td></tr><tr><td>2</td><td><strong>修正版の音源</strong><br>ステレオ対応や不具合修正した音源です。<br>旧音源と同じMME(*1)を使用しています。<br>・wavのレイテンシは旧音源と変わらず大きいです<br>・wavの同時発音数は再生から約0.45秒までは無限、それ以降は50です</td></tr><tr><td>3（デフォルトの設定）</td><td><strong>DirectSoundの音源（波形書き込み式）</strong><br>ステレオ対応や不具合修正した音源です。<br>DirectSound(*2)を使用し、音の波形を直接サウンドバッファに書き込み再生しています。<br>・レイテンシが小さくなります<br>・旧音源に近い音になります（特に効果音を、毎フレーム再生した場合や大量再生した際の音）<br>・wavの同時発音数は再生から約0.45秒までは無限、それ以降は50です</td></tr><tr><td>4</td><td><strong>DirectSoundの音源（API使用式）</strong><br>ステレオ対応や不具合修正した音源です。<br>DirectSound(*2)を使用し、DirectSoundのAPIを使い再生します。<br>・レイテンシが小さくなります<br>・wavの同時発音数は常に50です<br>・効果音の発音タイミングは10ms単位になります（効果音を毎フレーム再生すると、他のモードとは少し音が違う）<br>・Windows XP以前では、再生時の処理負担が軽いです</td></tr></tbody></table><p>※ 音源モード2,3は、音源がMMEかDirectSoundかの違いのみです。<br>※ Windows 95,98,98SE,Meは、デフォルト音源モード2となります。(3,4の場合、あるPCでレイテンシが遅い・音がならないなどの現象があったため)</p><p>*1) MME<br>&emsp;&emsp;&emsp;Windows標準のサウンドドライバーです<br>&emsp;&emsp;&emsp;音声が再生されるまでの時間（レイテンシ）が大きいです<br>*2) DirectSound<br>&emsp;&emsp;&emsp;Windowsのゲーム用のサウンドドライバーです<br>&emsp;&emsp;&emsp;MMEよりもレイテンシが小さくなります</p><p>※ <a href="./compatibility">互換性の設定</a><a href="./compatibility#11025hz-22050hz-44100hz%E4%BB%A5%E5%A4%96%E3%81%AEwav%E3%81%A7%E5%86%8D%E7%94%9F%E9%80%9F%E5%BA%A6%E3%81%8C%E9%80%9F%E3%81%8F%E3%81%AA%E3%82%8B%EF%BC%88%E3%81%8B%E3%81%A4%E9%9F%B3%E3%81%8C%E9%AB%98%E3%81%8F%E3%81%AA%E3%82%8B%EF%BC%89%E7%8F%BE%E8%B1%A1">「11025Hz, 22050Hz, 44100Hz以外のwavで再生速度が速くなる（かつ音が高くなる）現象」</a>を参照</p><hr><h2 id="mplayersetbasevolume">$mplayer.setBaseVolume</h2><h5 id="1_30_2022_0804以降-5">(1_30_2022_0804以降)</h5><p>wav,mzo再生の全体音量を設定します</p><ul><li>ver1.19以前、wavとmzoの音量は100%でした。</li><li>ver1.21～1.29は、wavとmzoの音量は50%でした。</li><li>ver1.30以降、wavとmzoの音量は100%になりました。</li><li>default.tonyuprjのtargetVersion（無い場合はsavedVersion）によってデフォルトの精度が変わります<ul><li>1210～1290の場合は、互換性のためwavとmzoの音量は50%</li><li>1300以上の場合は、wavとmzoの音量は100%</li></ul></li><li>手動で音量を変えたい場合、このメソッドを使用します</li></ul><p><strong>書式</strong></p><pre><code>setBaseVolume(volPer)
</code></pre><ul><li><strong>volPer</strong><br>&emsp;wav,mzoの全体音量を実数で指定します。<br>&emsp;例えば、1.0は元の音量(100%)、0.5は50%の音量となります。<br>&emsp;デフォルトはver1.21～1.29では0.5、それ以外のバージョンでは1.0です。</li></ul><p>※ <a href="./compatibility">互換性の設定</a><a href="./compatibility#wavmzo%E3%81%AE%E9%9F%B3%E9%87%8F">「wav,mzoの音量」</a>を参照</p><hr><h2 id="mplayersetvolumelimiter">$mplayer.setVolumeLimiter</h2><h5 id="1_30_2022_0804以降-6">(1_30_2022_0804以降)</h5><p>wav,mzoの音量が大きい場合、音割れを防ぐ機能の有効・無効を設定します。<br><a href="#mplayersetsoundplaymode">setSoundPlayMode(2or3)</a>に設定時、適用されます。<br><a href="#mplayersetsoundplaymode">setSoundPlayMode(4)</a>に設定時は、DirectSoundが自動的に行います。(Windows XP以前では音割れします)</p><p><strong>書式</strong></p><pre><code>setVolumeLimiter(enable)
</code></pre><ul><li><strong>enable</strong><br>&emsp;1で有効、0で無効<br>&emsp;デフォルトは0(無効)です。</li></ul><p>※ <a href="./compatibility">互換性の設定</a><a href="./compatibility#%E5%8A%B9%E6%9E%9C%E9%9F%B3%E3%82%92%E5%A4%9A%E6%95%B0%E5%A4%A7%E9%9F%B3%E9%87%8F%E3%81%A7%E9%B3%B4%E3%82%89%E3%81%99%E3%81%A8%E9%9F%B3%E5%89%B2%E3%82%8C%E3%81%99%E3%82%8B%E7%8F%BE%E8%B1%A1">「効果音を多数大音量で鳴らすと音割れする現象」</a>を参照</p><hr><h2 id="mplayersetseloopenable">$mplayer.setSeLoopEnable</h2><h5 id="1_30_2022_0804以降-7">(1_30_2022_0804以降)</h5><p>wavのループの有効・無効を設定します</p><p>※ 一部のゲームで、wavループが効かないver1.22以前の時にループ再生を指定してしまい、<br>&emsp; ver1.23以降で実行するとwavループが大量に行われ大音量となったため、それを防ぐために追加した機能です。<br>&emsp; 自動的に互換性を保つため、通常このメソッドを使う必要はありません</p><ul><li>ver1.22以前は、<a href="#mplayerplay">$mplayer.play</a>でwavをループ再生を指定しても、ループ再生をしないようにします</li><li>ver1.23以降は、<a href="#mplayerplay">$mplayer.play</a>でwavをループ再生を指定すると、ループ再生します</li><li>default.tonyuprjのtargetVersion（無い場合はsavedVersion）によってデフォルトの精度が変わります<ul><li>1220以下の場合は、wavループ再生を無効にします</li><li>1230以上の場合は、wavループ再生を有効にします</li></ul></li><li>手動で設定を変えたい場合、このメソッドを使用します</li></ul><p><strong>書式</strong></p><pre><code>setSeLoopEnable(enable)
</code></pre><ul><li><strong>enable</strong><br>&emsp;1で有効、0で無効<br>&emsp;ver1.22以前では、0がデフォルトで無効です。<br>&emsp;ver1.23以降では、1がデフォルトで有効です。</li></ul><p>※ <a href="./compatibility">互換性の設定</a><a href="./compatibility#ver122%E4%BB%A5%E5%89%8D%E3%81%AE%E3%82%B2%E3%83%BC%E3%83%A0%E3%82%92ver123%E4%BB%A5%E9%99%8D%E3%81%A7%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E3%81%A8%E3%80%81wav%E3%81%8C%E3%83%AB%E3%83%BC%E3%83%97%E3%81%97%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86">「ver1.22以前のゲームをver1.23以降で実行すると、wavがループしてしまう」</a>を参照</p><hr><h2 id="mplayersetsestopenable">$mplayer.setSeStopEnable</h2><h5 id="1_30_2022_0804以降-8">(1_30_2022_0804以降)</h5><p><a href="#mplayerstopse">$mplayer.stopSE</a>の有効・無効を設定します</p><p><strong>書式</strong></p><pre><code>setSeStopEnable(enable)
</code></pre><ul><li><strong>enable</strong><br>&emsp;1で有効、0で無効<br>&emsp;デフォルトでは無効になっているので、<a href="#mplayerstopse">$mplayer.stopSE</a>を使うときは有効化してください。</li></ul><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-mousemanager"class="pagediv"title2="命令リファレンス - $mouseManager - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="mousemanagerオブジェクト">$mouseManagerオブジェクト</h2><p>マウスの制御(マウスカーソルの強制移動、マウスの非表示など)を行います。</p><h3 id="例1">例1</h3><pre><code>extends SpriteChar;
$mouseManager.showCursor(0);
while (1) {
  $mouseManager.moveCursor(100,100);
  x+=($mouseManager.relX);
  y+=($mouseManager.relY);
  update();
}
</code></pre><p>▲ Windows標準のマウスが消え、代わりにこのオブジェクトがマウスカーソルとして働きます。</p><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#mousemanagermovecursor">moveCursor</a></td><td>マウスカーソルを指定した場所に移動します。</td></tr><tr><td><a href="#mousemanagershowcursor">showCursor</a></td><td>マウスカーソルの表示、非表示を設定します</td></tr><tr><td><a href="#mousemanagerrefreshxy">refreshXY</a></td><td>直ちに$mouseX,$mouseYを更新します</td></tr></tbody></table><h3 id="変数一覧">変数一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#mousemanagerrelx">relX</a></td><td>マウスカーソルの相対移動量のx成分を読み出します。</td></tr><tr><td><a href="#mousemanagerrely">relY</a></td><td>マウスカーソルの相対移動量のy成分を読み出します。</td></tr></tbody></table><hr><h2 id="mousemanagermovecursor">$mouseManager.moveCursor</h2><p>マウスカーソルを指定した場所に移動します。</p><p><strong>書式</strong></p><pre><code>moveCursor(x,y)
</code></pre><ul><li><strong>x</strong><br>&emsp;移動先x座標。メインウィンドウの左端はx=0</li><li><strong>y</strong><br>&emsp;移動先y座標。メインウィンドウの上端はy=0</li></ul><p>このメソッドを実行すると<a href="#mousemanagerrelx">$mouseManager.relX</a>, <a href="#mousemanagerrely">$mouseManager.relY</a>にカーソルの相対移動量が設定されます。</p><hr><h2 id="mousemanagershowcursor">$mouseManager.showCursor</h2><p>マウスカーソルの表示、非表示を設定します</p><p><strong>書式</strong></p><pre><code>showCursor(s)
</code></pre><ul><li><strong>s</strong><br>&emsp;0=非表示 / 1=表示</li></ul><hr><h2 id="mousemanagerrefreshxy">$mouseManager.refreshXY</h2><p><a href="./rf-mouse-xy">$mouseX,$mouseY</a>は、通常、１フレームが終わる毎に自動的に更新されますが、<br>このメソッドを呼び出すと、呼び出した時点で直ちに$mouseX,$mouseYが更新されます。<br>通常は呼び出す必要はありません。</p><p><strong>書式</strong></p><pre><code>refreshXY()
</code></pre><hr><h2 id="mousemanagerrelx">$mouseManager.relX</h2><p>マウスカーソルの相対移動量（直前の位置からどれだけ動いたか）のx成分を読み出します。</p><p>この値を調べる前に、<a href="#mousemanagermovecursor">$mouseManager.moveCursor</a>を実行してください。</p><hr><h2 id="mousemanagerrely">$mouseManager.relY</h2><p>マウスカーソルの相対移動量（直前の位置からどれだけ動いたか）のy成分を読み出します。</p><p>この値を調べる前に、<a href="#mousemanagermovecursor">$mouseManager.moveCursor</a>を実行してください。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-mouse-xy"class="pagediv"title2="命令リファレンス - $mouseX, $mouseY - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="mousex-mousey">$mouseX, $mouseY</h2><p>マウスカーソルの位置($mouseX :x座標 / $mouseY :y座標) を返します。</p><p>メインウィンドウの左上が <strong>($mouseX,$mouseY)=(0,0)</strong><br>メインウィンドウの右下が <strong>($mouseX,$mouseY)=($screenWidth,$screenHeight)</strong> になります。</p><p>ver 1.09から、画面外にいるマウスカーソルも位置がわかるようになりました。</p><ul><li>メインウィンドウより左側にいる場合、$mouseXが負の値になります。</li><li>メインウィンドウより上にいる場合、$mouseYが負の値になります。</li></ul><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-method-define"class="pagediv"title2="命令リファレンス - メソッドの定義 - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="メソッドの定義">メソッドの定義</h2><p><a href="./rf-method-call">メソッド</a>は、あらかじめ定義されているものを呼び出すだけではなく、自分で定義（作成）することができます。</p><p>メソッドの定義をするには次の書式に従います。</p><h4 id="書式">書式</h4><pre><code>function メソッド名 (引数名, 引数名,... ) {
  ローカル変数宣言
  処理本体
}
</code></pre><p><strong>引数名</strong>：このメソッドを呼び出すときに、呼び出す側から渡される値を格納するための変数名を指定します。</p><p><strong>ローカル変数宣言</strong> ： このメソッドの中だけで一時的に使いたい変数（ローカル変数）が必要ならば、次の書式で宣言します(* 中級者向き)</p><h4 id="書式-1">書式</h4><pre><code>var 変数名,変数名 ...;
</code></pre><h3 id="例1">例1</h3><pre><code>extends SpriteChar;
function upDown(speed) {
   if(getkey(38)) y=y-speed;
   if(getkey(40)) y=y+speed;
}
while (1) {
   while (x&lt;200) {
     upDown(2);
     update();
     x=x+2;
   }
   while (x&gt;0) {
     upDown(5);
     update();
     x=x-2;
   }
}
</code></pre><p>▲ オブジェクトが左右に往復します。カーソールキーの上下で上下移動ができますが、<br>右に動いているときは上下移動の速度が2、左のときは5になります。</p><p>※ Ver 1.17から、プログラム中のどの場所でも(メインの手続きの後ろでも)メソッド宣言が可能です</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-method-call"class="pagediv"title2="命令リファレンス - メソッドの呼び出し - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="メソッドの呼び出し">メソッドの呼び出し</h2><p><strong>メソッド</strong>とは、ある決まった処理をまとめたものです。<br>プログラムからメソッドを呼び出すことによりその処理を実行させることができます。</p><p>あらかじめ定義されているメソッドを呼ぶには、次の書式に従います。</p><h4 id="書式">書式</h4><pre><code>メソッド名 ( 引数 , 引数 ... )
</code></pre><p>メソッド名で指定された名前をもつメソッドを呼び出します。<br>引数は、呼び出すメソッドに渡す値です。<br>引数の詳細は、 それぞれのメソッドの説明のところに記載されています。</p><p>また、メソッドによっては呼び出す相手を指定する必要があります。<br>その場合は次の書式に従います。</p><h4 id="書式-1">書式</h4><pre><code>式. メソッド名 ( 引数 , 引数 ... )
</code></pre><p>式で表されるオブジェクトに対して、メソッド名で指定された名前をもつメソッドを呼び出します。<br>式がが初期化されていなかったり、式がオブジェクトでないと、 次のメッセージが表示されます。</p><pre>
<span style="color:red">変数$xxxは初期化されていないので、メソッド mmm を呼び出せません。</span>
</pre><p>または</p><pre>
<span style="color:red">nullはオブジェクトではないので、メソッド mmmを呼び出せません。</span>
</pre><h3 id="例1">例1</h3><pre><code>extends SpriteChar;
while (1) {
  x=x+1;
  update(); 
}
</code></pre><p>▲ update(); によって、<a href="./rf-plainchar#plaincharupdate">update</a>メソッドを呼び出します。 updateメソッドには引数が不要なので、() をつけるだけにします。</p><h3 id="例2">例2</h3><pre><code>extends SpriteChar;
while (1) {
  x=x+1;
  drawText(x,y,&quot;文字&quot;,$clWhite);
  update();
}
</code></pre><p>▲ <a href="./rf-sprite#spritedrawtext">drawText</a>メソッドは、文字を描画する処理を行います。どこにどんな文字を出すかといった情報を引数で渡します。</p><h3 id="例3">例3</h3><p>オブジェクトを２つ作成します。名前は $ObjectA と $ObjectB にして下さい</p><p>$ObjectAをダブルクリックし、次のように入力します。</p><pre><code>extends SpriteChar;
while (1) {
  x=x+1;
  update();
}
</code></pre><p>$ObjectBをダブルクリックし、次のように入力します。</p><pre><code>extends SpriteChar;
while (1) {
  x=x+1;
  if (x==300) $ObjectA.die(); // x==300になったら、$ObjectAを消す
  update();
}
</code></pre><p>▲ オブジェクトに対して <a href="./rf-plainchar#plainchardie">die</a>メソッドを呼ぶと、そのオブジェクトが消えます。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-matrix"class="pagediv"title2="命令リファレンス - Matrix - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="matrixクラス">Matrixクラス</h2><p>2次元配列を格納するオブジェクトです。</p><h3 id="例1">例1</h3><pre>
extends TextChar;
m=new Matrix(10); // 横10列の配列を作成
m.addRows(5); // 縦に5行追加
for (y=0; y&lt;5; y++) {
  for (x=0; x&lt;10; x++) {
     m.set(x,y,x+y);
  }
}
while (1) {
  x=<a href="./rf-object#objectvalueof">valueOf</a>(<a href="./rf-plainchar#plaincharwaitinput">waitInput</a>("Xの値?"));
  y=valueOf(waitInput("Yの値?"));
  text="("+x+","+y+")="+m.get(x,y);
  update();
}
</pre><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#matrixget">get</a></td><td>2次元配列の内容を取得します。</td></tr><tr><td><a href="#matrixset">set</a></td><td>2次元配列の内容を更新します。</td></tr></tbody></table><hr><h2 id="matrixget">Matrix.get</h2><p>2次元配列の内容を取得します。</p><p><strong>書式</strong></p><pre><code>get(x,y)
</code></pre><ul><li><strong>x</strong><br>&emsp;横位置</li><li><strong>y</strong><br>&emsp;縦位置</li></ul><p><strong>戻り値</strong></p><p>(x,y) に格納されている値。</p><hr><h2 id="matrixset">Matrix.set</h2><p>2次元配列の内容を更新します。</p><p><strong>書式</strong></p><pre><code>set(x,y,value)
</code></pre><ul><li><strong>x</strong><br>&emsp;横位置</li><li><strong>y</strong><br>&emsp;縦位置</li><li><strong>value</strong><br>&emsp;新しい値</li></ul><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-math"class="pagediv"title2="命令リファレンス - $Math - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="mathオブジェクト">$Mathオブジェクト</h2><p>高度な数学関数を提供します</p><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#mathpow">$Math.pow</a></td><td>べき乗を求めます。</td></tr><tr><td><a href="#mathexp">$Math.exp</a></td><td>e(ネイピア数)を底とした対数を返します。</td></tr><tr><td><a href="#mathlog">$Math.log</a></td><td>e(ネイピア数)を累乗した値を返します。</td></tr><tr><td><a href="#mathpi">$Math.pi</a></td><td>円周率πを返します</td></tr><tr><td><a href="#mathatan">$Math.atan</a></td><td>逆正接(アークタンジェント)を求めます。</td></tr><tr><td><a href="#mathsetatanaccuracy">$Math.setAtanAccuracy</a></td><td><a href="#mathatan">$Math.atan</a>の精度を変更します。</td></tr><tr><td><a href="#mathangle">$Math.angle</a></td><td>高精度なangleメソッドです</td></tr><tr><td><a href="#mathtan">$Math.tan</a></td><td>正接(タンジェント)を求めます。</td></tr><tr><td><a href="#mathcot">$Math.cot</a></td><td>余接（コタンジェント）を求めます。</td></tr><tr><td><a href="#mathsec">$Math.sec</a></td><td>正割（セカント）を求めます。</td></tr><tr><td><a href="#mathcsc">$Math.csc</a></td><td>余割（コセカント）を求めます。</td></tr><tr><td><a href="#mathasin">$Math.asin</a></td><td>逆正弦(アークサイン)を求めます。</td></tr><tr><td><a href="#mathacos">$Math.acos</a></td><td>逆余弦(アークコサイン)を求めます。</td></tr><tr><td><a href="#mathdegrees">$Math.degrees</a></td><td>ラジアンを表す値から、度を計算します</td></tr><tr><td><a href="#mathradians">$Math.radians</a></td><td>度を表す値から、ラジアンを計算します</td></tr><tr><td><a href="#mathroll">$Math.roll</a></td><td>座標を回転させます</td></tr><tr><td><a href="#mathisodd">$Math.isOdd</a></td><td>値が奇数であるかどうかを調べます</td></tr><tr><td><a href="#mathiseven">$Math.isEven</a></td><td>値が偶数であるかどうかを調べます</td></tr><tr><td><a href="#mathrandbetween">$Math.randBetween</a></td><td>2つの値の間を範囲とする、整数乱数を返します</td></tr><tr><td><a href="#mathrandbetweenfloat">$Math.randBetweenFloat</a></td><td>2つの値の間を範囲とする、実数乱数を返します</td></tr><tr><td><a href="#mathsetsincosaccuracy">$Math.setSinCosAccuracy</a></td><td><a href="rf-object#objectsin">sin</a>,<a href="rf-object#objectcos">cos</a>の精度を変更します</td></tr></tbody></table><hr><h2 id="mathpow">$Math.pow</h2><p>べき乗 a^b を求めます。<br>引数に実数も渡すことができます。</p><p><strong>書式</strong></p><pre><code>pow(a,b)
</code></pre><ul><li><strong>a</strong><br>&emsp;基数</li><li><strong>b</strong><br>&emsp;指数</li></ul><p><strong>戻り値</strong></p><p>aをb乗した値</p><hr><h2 id="mathexp">$Math.exp</h2><p>e(ネイピア数)をxで累乗した値を返します。</p><p><strong>書式</strong></p><pre><code>exp(x)
</code></pre><ul><li><strong>x</strong><br>&emsp;指数</li></ul><p><strong>戻り値</strong> e(ネイピア数)をxで累乗した値</p><hr><h2 id="mathlog">$Math.log</h2><p>e(ネイピア数) を底とした x の対数を返します。</p><p><strong>書式</strong></p><pre><code>log(x)
</code></pre><ul><li><strong>x</strong><br>&emsp;値</li></ul><p><strong>戻り値</strong> e(ネイピア数) を底とした x の対数</p><hr><h2 id="mathpi">$Math.pi</h2><p>円周率πを返します</p><p><strong>書式</strong></p><pre><code>pi()
</code></pre><p><strong>戻り値</strong></p><p>πの近似値(3.141592653589793)</p><hr><h2 id="mathatan">$Math.atan</h2><p>逆正接(アークタンジェント)を求めます。</p><p><strong>書式</strong></p><pre><code>atan(t)
</code></pre><ul><li><strong>t</strong><br>&emsp;実数値</li></ul><p><strong>戻り値</strong></p><p><a href="#mathtan">tan</a>(x)=tとなるような x。単位は度(ラジアンでありません)</p><p><strong>参考</strong></p><p><a href="#mathsetatanaccuracy">$Math.setAtanAccuracy</a></p><hr><h2 id="mathsetatanaccuracy">$Math.setAtanAccuracy</h2><p><a href="#mathatan">$Math.atan</a>の精度を変更します。</p><p><strong>書式</strong></p><pre><code>setAtanAccuracy(accuracy)
</code></pre><ul><li><strong>accuracy</strong><br>&emsp;精度</li></ul><p>accuracyに逆正接の精度を設定します。<br>accuracyが大きくするとatanの値が正確に 求められますが、計算に時間がかかります。<br>標準値は10000で、精度、速度のバランスがとれた値です。<br>精度優先なら1000000、速度優先なら100～1000が適切です。<br>10000000より大きいと計算が終わらなくなるので注意してください。</p><hr><h2 id="mathangle">$Math.angle</h2><p>高精度な<a href="./rf-object#objectangle">angle</a>メソッドです</p><p><strong>書式</strong></p><pre><code>angle(x,y)
</code></pre><ul><li><strong>x</strong><br>&emsp;線分(0,0)-(x,y)のx</li><li><strong>y</strong><br>&emsp;線分(0,0)-(x,y)のy</li></ul><p><strong>戻り値</strong></p><p>線分(1,0)-(0,0)と(0,0)-(x,y)のなす角(単位:度)</p><p><a href="#mathatan">$Math.atan</a>を利用して、従来の<a href="./rf-object#objectangle">angle</a>より高い精度で角度を計算します。</p><hr><h2 id="mathtan">$Math.tan</h2><p>正接(タンジェント)を求めます。</p><p><strong>書式</strong></p><pre><code>tan(t)
</code></pre><ul><li><strong>t</strong><br>&emsp;度をあらわす整数(ラジアンではありません)</li></ul><p><strong>戻り値</strong></p><p>t度の正接を求めます。</p><hr><h2 id="mathcot">$Math.cot</h2><p>余接（コタンジェント）を求めます。</p><p><strong>書式</strong></p><pre><code>cot(t)
</code></pre><ul><li><strong>t</strong><br>&emsp;度をあらわす整数(ラジアンではありません)</li></ul><p><strong>戻り値</strong></p><p>t度の余接を求めます。</p><p>cot(t)=1/tan(t) です</p><hr><h2 id="mathsec">$Math.sec</h2><p>正割（セカント）を求めます。</p><p><strong>書式</strong></p><pre><code>sec(t)
</code></pre><ul><li><strong>t</strong><br>&emsp;度をあらわす整数(ラジアンではありません)</li></ul><p><strong>戻り値</strong></p><p>t度の正割を求めます。</p><p>sec(t)=1/cos(t) です</p><hr><h2 id="mathcsc">$Math.csc</h2><p>余割（コセカント）を求めます。</p><p><strong>書式</strong></p><pre><code>csc(t)
</code></pre><ul><li><strong>t</strong><br>&emsp;度をあらわす整数(ラジアンではありません)</li></ul><p><strong>戻り値</strong></p><p>t度の余割を求めます。</p><p>csc(t)=1/sin(t) です</p><hr><h2 id="mathasin">$Math.asin</h2><p>逆正弦(アークサイン)を求めます。</p><p><strong>書式</strong></p><pre><code>asin(t)
</code></pre><ul><li><strong>t</strong><br>&emsp;実数値</li></ul><p><strong>戻り値</strong></p><p><a href="./rf-object#objectsin">sin</a>(x)=tとなるような x。単位は度(ラジアンでありません)</p><hr><h2 id="mathacos">$Math.acos</h2><p>逆余弦(アークコサイン)を求めます。</p><p><strong>書式</strong></p><pre><code>acos(t)
</code></pre><ul><li><strong>t</strong><br>&emsp;実数値</li></ul><p><strong>戻り値</strong></p><p><a href="./rf-object#objectcos">cos</a>(x)=tとなるような x。単位は度(ラジアンでありません)</p><hr><h2 id="mathdegrees">$Math.degrees</h2><p>ラジアンを表す値から、度を計算します</p><p><strong>書式</strong></p><pre><code>degrees(r)
</code></pre><ul><li><strong>r</strong><br>&emsp;実数</li></ul><p><strong>戻り値</strong></p><p>ラジアンrを表す角度</p><hr><h2 id="mathradians">$Math.radians</h2><p>度を表す値から、ラジアンを計算します</p><p><strong>書式</strong></p><pre><code>radians(t)
</code></pre><ul><li><strong>t</strong><br>&emsp;実数</li></ul><p><strong>戻り値</strong></p><p>t度のラジアン</p><hr><h2 id="mathroll">$Math.roll</h2><p>座標を回転させます</p><p><strong>書式</strong></p><pre><code>roll(sx,sy,angle,cx,cy)
</code></pre><ul><li><strong>sx</strong><br>&emsp;回転させたい点のx座標</li><li><strong>sy</strong><br>&emsp;回転させたい点のy座標</li><li><strong>angle</strong><br>&emsp;回転角</li><li><strong>cx (省略可能)</strong><br>&emsp;回転の中心のx座標(省略時は0)</li><li><strong>cy (省略可能)</strong><br>&emsp;回転の中心のy座標(省略時は0)</li></ul><p><strong>戻り値</strong></p><p>$Math.rx, $Math.ryに、回転後の座標</p><hr><h2 id="mathisodd">$Math.isOdd</h2><p>値が奇数であるかどうかを調べます</p><p><strong>書式</strong></p><pre><code>isOdd(n)
</code></pre><ul><li><strong>n</strong><br>&emsp;整数値</li></ul><p><strong>戻り値</strong></p><p>nが奇数のとき<a href="./rf-true-false">真</a></p><hr><h2 id="mathiseven">$Math.isEven</h2><p>値が偶数であるかどうかを調べます</p><p><strong>書式</strong></p><pre><code>isOdd(n)
</code></pre><ul><li><strong>n</strong><br>&emsp;整数値</li></ul><p><strong>戻り値</strong></p><p>nが偶数のとき<a href="./rf-true-false">真</a></p><hr><h2 id="mathrandbetween">$Math.randBetween</h2><p>2つの値の間を範囲とする、整数乱数を返します</p><p><strong>書式</strong></p><pre><code>randBetween(f,t)
</code></pre><ul><li><strong>f</strong><br>&emsp;整数値</li><li><strong>t</strong><br>&emsp;整数値</li></ul><p><strong>戻り値</strong></p><p>f&lt;tのときは、f以上t未満の乱数。 t&lt;fの場合t以上f未満。t==fの場合t。</p><hr><h2 id="mathrandbetweenfloat">$Math.randBetweenFloat</h2><p>2つの値の間を範囲とする、実数乱数を返します</p><p><strong>書式</strong></p><pre><code>randBetweenFloat(f,t)
</code></pre><ul><li><strong>f</strong><br>&emsp;実数値</li><li><strong>t</strong><br>&emsp;実数値</li></ul><p><strong>戻り値</strong></p><p>f&lt;tのときは、f以上t未満の乱数。 t&lt;fの場合t以上f未満。t==fの場合t。</p><hr><h2 id="mathsetsincosaccuracy">$Math.setSinCosAccuracy</h2><h5 id="1_30_2022_0804以降">(1_30_2022_0804以降)</h5><p><a href="rf-object#objectsin">sin</a>,<a href="rf-object#objectcos">cos</a>の精度を変更します</p><ul><li>ver1.29以前は、<a href="rf-object#objectsin">sin</a>,<a href="rf-object#objectcos">cos</a>は1°単位までしか受け付けず、0～360°で360段階となっていました</li><li>ver1.30以降は、<a href="rf-object#objectsin">sin</a>,<a href="rf-object#objectcos">cos</a>は0.01°単位まで受け付け、0～360°で36000段階となります</li><li>default.tonyuprjのtargetVersion（無い場合はsavedVersion）によってデフォルトの精度が変わります<ul><li>1290以下の場合は、互換性のため360段階</li><li>1300以上の場合は、36000段階</li></ul></li><li>手動で精度を変えたい場合、このメソッドを使用します</li></ul><p><strong>書式</strong></p><pre><code>setSpriteAngleAccuracy(mode)
</code></pre><ul><li><strong>mode</strong><br>&emsp;-1: 最高精度（ただし計算をするため、他の精度よりも少し重くなります）<br>&emsp;0: 0～360°で360段階（三角関数表を使うため高速です）<br>&emsp;1: 0～360°で36000段階（三角関数表を使うため高速です）</li></ul><p>※ <a href="./compatibility">互換性の設定</a><a href="./compatibility#sincos%E3%81%AE%E7%B2%BE%E5%BA%A6">「sin,cosの精度」</a>を参照</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-map"class="pagediv"title2="命令リファレンス - $TextEditor - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="mapオブジェクト">$mapオブジェクト</h2><p>マップパターンの設定や取得、画面のスクロールを行います</p><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#mapset">set</a></td><td>マップパターンを設定します</td></tr><tr><td><a href="#mapget">get</a></td><td>マップパターンを取得します</td></tr><tr><td><a href="#mapgetat">getAt</a></td><td>画面上の座標からマップパターンを取得します</td></tr><tr><td><a href="#mapscrollto">scrollTo</a></td><td>画面をスクロールします</td></tr><tr><td><a href="#mapsetbgcolor">setBGColor</a></td><td>画面の背景色を設定します</td></tr><tr><td><a href="#mapgetbgcolor">getBGColor</a></td><td>画面の背景色を得ます</td></tr></tbody></table><hr><h2 id="mapset">$map.set</h2><p>マップパターンを設定します</p><p><strong>書式</strong></p><pre><code>set(mx,my,p)
</code></pre><ul><li><strong>mx</strong><br>&emsp;マップパターン上のx座標</li><li><strong>my</strong><br>&emsp;マップパターン上のy座標</li><li><strong>p</strong><br>&emsp;設定するキャラクタパターン番号</li></ul><p>マップの(mx,my)のパターンをpに設定します</p><hr><h2 id="mapget">$map.get</h2><p>マップパターンを取得します</p><p><strong>書式</strong></p><pre><code>get(mx,my)
</code></pre><ul><li><strong>mx</strong> &emsp;マップパターン上のx座標</li><li><strong>my</strong> &emsp;マップパターン上のy座標</li></ul><p><strong>戻り値</strong></p><p>マップ上のmx,myにおけるキャラクタパターン番号を返します</p><p><strong>例1</strong></p><pre><code> pa=$map.get(4,3);
</code></pre><p>▲ 図1の緑枠の部分のキャラクタパターンを返します</p><p><img src-t="./img/map-get.png"width="207"height="238"alt="map-get.png"></p><hr><h2 id="mapgetat">$map.getAt</h2><p>画面上の座標からマップパターンを取得します</p><p><strong>書式</strong></p><pre><code>getAt(sx,sy)
</code></pre><ul><li><strong>sx</strong><br>&emsp;画面の座標上のx座標</li><li><strong>sy</strong><br>&emsp;画面の座標上のy座標</li></ul><p><strong>戻り値</strong></p><p>画面の座標sx,syにおけるキャラクタパターン番号を返します。</p><p>「画面の座標」とは、図1のように1ドットを単位とした座標です。</p><p><strong>例1</strong></p><pre><code>pa=$map.getAt(72,56);
</code></pre><p>▲ 図1の緑枠の部分のキャラクタパターンを返します</p><p>図1 :<br><img src-t="./img/map-get-at.png"width="232"height="273"alt="map_getAt"></p><hr><h2 id="mapscrollto">$map.scrollTo</h2><p>画面をスクロールします</p><p><strong>書式</strong></p><pre><code>scrollTo(sx,sy)
</code></pre><ul><li><strong>sx</strong><br>&emsp;スクロール方向のx座標</li><li><strong>sy</strong><br>&emsp;スクロール方向のy座標</li></ul><p>画面全体を、最初の位置から右方向にsxドット,下方向にsyドットだけずらして表示します。</p><p>左や上にずらすには、sx,syを負の値にします。</p><p><strong>例1</strong></p><p>ここに書いてあるプログラムは、実行する前に画面に マップを描くことをおすすめします(マップを描く参照)</p><pre><code>extends SpriteChar;
while(1) {
  $map.scrollTo(t,t);t+=1;
  update();
}
</code></pre><p>▲ 画面全体を右下にスクロールさせます</p><p><strong>参考</strong></p><p><a href="./html/scroll/html/HID00000001.htm">スクロールのサンプル</a></p><hr><h2 id="mapgetbgcolor">$map.getBGColor</h2><p>画面の背景色を得ます</p><p><strong>書式</strong></p><pre><code>getBGColor()
</code></pre><p><strong>戻り値</strong></p><p>画面の背景色</p><hr><h2 id="mapsetbgcolor">$map.setBGColor</h2><p>画面の背景色を設定します</p><p><strong>書式</strong></p><pre><code>setBGColor(col)
</code></pre><ul><li><strong>col</strong><br>&emsp;色（通常、<a href="./rf-object#objectcolor">color</a>メソッドで指定)</li></ul><p><strong>例1</strong></p><pre><code>$map.setBGColor(color(200,255,255));
</code></pre><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-lighthashtable"class="pagediv"title2="命令リファレンス - LightHashtable - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="lighthashtableクラス">LightHashtableクラス</h2><p><a href="./rf-hashtable">ハッシュテーブル</a>の一種で、処理速度が速い代わりに、キーに文字列が使えません。</p><p>使い方は<a href="./rf-hashtable">ハッシュテーブル</a>の項目を参照してください。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-keycode"class="pagediv"title2="命令リファレンス - キーID一覧 - Tonyu1 Wiki"><p><a href="./rf-object#objectgetkey">getkey</a>&emsp;<a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="キーid一覧">キーID一覧</h2><p><a href="./rf-object#objectgetkey">getkey</a>で指定できるキーIDの一覧です。</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>1</td><td>左クリック</td></tr><tr><td>2</td><td>右クリック</td></tr><tr><td>4</td><td>ホイールボタン</td></tr><tr><td>5</td><td>戻るクリック（5ボタンマウス）</td></tr><tr><td>6</td><td>進むクリック（5ボタンマウス）</td></tr><tr><td>8</td><td>BackSpace</td></tr><tr><td>9</td><td>Tab</td></tr><tr><td>13</td><td>Enter</td></tr><tr><td>16</td><td>Shift 左右</td></tr><tr><td>17</td><td>Ctrl 左右</td></tr><tr><td>18</td><td>Alt 左右</td></tr><tr><td>19</td><td>Pause/Break</td></tr><tr><td>20</td><td>Shift + Caps Lock</td></tr><tr><td>21</td><td>Ctrl + Caps Lock</td></tr><tr><td>27</td><td>エスケープ</td></tr><tr><td>28</td><td>変換</td></tr><tr><td>29</td><td>無変換</td></tr><tr><td>32</td><td>スペース</td></tr><tr><td>33</td><td>Page Up</td></tr><tr><td>34</td><td>Page Down</td></tr><tr><td>35</td><td>End</td></tr><tr><td>36</td><td>Home</td></tr><tr><td>37</td><td>←</td></tr><tr><td>38</td><td>↑</td></tr><tr><td>39</td><td>→</td></tr><tr><td>40</td><td>↓</td></tr><tr><td>44</td><td>Print Screen</td></tr><tr><td>45</td><td>Insert</td></tr><tr><td>46</td><td>Delete</td></tr><tr><td>48</td><td>0</td></tr><tr><td>49</td><td>1</td></tr><tr><td>50</td><td>2</td></tr><tr><td>51</td><td>3</td></tr><tr><td>52</td><td>4</td></tr><tr><td>53</td><td>5</td></tr><tr><td>54</td><td>6</td></tr><tr><td>55</td><td>7</td></tr><tr><td>56</td><td>8</td></tr><tr><td>57</td><td>9</td></tr><tr><td>65</td><td>A</td></tr><tr><td>66</td><td>B</td></tr><tr><td>67</td><td>C</td></tr><tr><td>68</td><td>D</td></tr><tr><td>69</td><td>E</td></tr><tr><td>70</td><td>F</td></tr><tr><td>71</td><td>G</td></tr><tr><td>72</td><td>H</td></tr><tr><td>73</td><td>I</td></tr><tr><td>74</td><td>J</td></tr><tr><td>75</td><td>K</td></tr><tr><td>76</td><td>L</td></tr><tr><td>77</td><td>M</td></tr><tr><td>78</td><td>N</td></tr><tr><td>79</td><td>O</td></tr><tr><td>80</td><td>P</td></tr><tr><td>81</td><td>Q</td></tr><tr><td>82</td><td>R</td></tr><tr><td>83</td><td>S</td></tr><tr><td>84</td><td>T</td></tr><tr><td>85</td><td>U</td></tr><tr><td>86</td><td>V</td></tr><tr><td>87</td><td>W</td></tr><tr><td>88</td><td>X</td></tr><tr><td>89</td><td>Y</td></tr><tr><td>90</td><td>Z</td></tr><tr><td>91</td><td>左ウィンドウズ</td></tr><tr><td>92</td><td>右ウィンドウズ</td></tr><tr><td>93</td><td>アプリケーション</td></tr><tr><td>96</td><td>テンキー 0</td></tr><tr><td>97</td><td>テンキー 1</td></tr><tr><td>98</td><td>テンキー 2</td></tr><tr><td>99</td><td>テンキー 3</td></tr><tr><td>100</td><td>テンキー 4</td></tr><tr><td>101</td><td>テンキー 5</td></tr><tr><td>102</td><td>テンキー 6</td></tr><tr><td>103</td><td>テンキー 7</td></tr><tr><td>104</td><td>テンキー 8</td></tr><tr><td>105</td><td>テンキー 9</td></tr><tr><td>106</td><td>テンキー *</td></tr><tr><td>107</td><td>テンキー +</td></tr><tr><td>109</td><td>テンキー -</td></tr><tr><td>110</td><td>テンキー .</td></tr><tr><td>111</td><td>テンキー /</td></tr><tr><td>112</td><td>F1</td></tr><tr><td>113</td><td>F2</td></tr><tr><td>114</td><td>F3</td></tr><tr><td>115</td><td>F4</td></tr><tr><td>116</td><td>F5</td></tr><tr><td>117</td><td>F6</td></tr><tr><td>118</td><td>F7</td></tr><tr><td>119</td><td>F8</td></tr><tr><td>120</td><td>F9</td></tr><tr><td>121</td><td>F10</td></tr><tr><td>122</td><td>F11</td></tr><tr><td>123</td><td>F12</td></tr><tr><td>144</td><td>Num Lock</td></tr><tr><td>145</td><td>Scroll Lock</td></tr><tr><td>160</td><td>左Shift</td></tr><tr><td>161</td><td>右Shift</td></tr><tr><td>162</td><td>左Ctrl</td></tr><tr><td>163</td><td>右Ctrl</td></tr><tr><td>164</td><td>左Alt</td></tr><tr><td>165</td><td>右Alt</td></tr><tr><td>186</td><td>:</td></tr><tr><td>187</td><td>;</td></tr><tr><td>188</td><td>,</td></tr><tr><td>189</td><td>-</td></tr><tr><td>190</td><td>.</td></tr><tr><td>191</td><td>/</td></tr><tr><td>192</td><td>@</td></tr><tr><td>219</td><td>[</td></tr><tr><td>220</td><td>\ (Yen)</td></tr><tr><td>221</td><td>]</td></tr><tr><td>222</td><td>^</td></tr><tr><td>226</td><td>＼ (BackSlash)</td></tr><tr><td>240</td><td>Caps Lock を押すとON？</td></tr><tr><td>242</td><td>カタカナひらがなローマ字キー を押すとON？</td></tr><tr><td>243</td><td>IMEが直接入力<br>（全角半角キーを押すと244に変わる。IMEアイコンからひらがなに変えた場合244に切り替わらない）</td></tr><tr><td>244</td><td>IMEがひらがな<br>（全角半角キーを押すと244に変わる。IMEアイコンから直接入力に変えた場合243に切り替わらない）</td></tr><tr><td>245</td><td>Alt + カタカナひらがなローマ字キーを押すと245⇔246に切り替わる？</td></tr><tr><td>246</td><td>Alt + カタカナひらがなローマ字キーを押すと245⇔246に切り替わる？</td></tr></tbody></table><hr><p><a href="./rf-object#objectgetkey">getkey</a>&emsp;<a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-joystick"class="pagediv"title2="命令リファレンス - Joystick - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="joystickクラス">Joystickクラス</h2><p>ジョイスティックの入力を調べます</p><p><strong>$Joystick</strong>、<b>$Joystick2</b>というオブジェクトが、システムによって自動的に用意されています。</p><p>通常は$Joystickを用いますが、2個目のジョイスティックを調べたい場合は$Joystick2を用います。</p><h3 id="例1">例1</h3><pre><code>extends SpriteChar;
while (1) {
  if ($Joystick.up()&gt;0) y=y-2;
  if ($Joystick.down()&gt;0) y=y+2;
  if ($Joystick.left()&gt;0) x=x-2;
  if ($Joystick.right()&gt;0) x=x+2;
  if ($Joystick.button(0)&gt;0) {
    drawText(x,y,&quot;press&quot;,$clWhite);
  }
  update();
}
</code></pre><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#joystickleft">left</a></td><td>ジョイスティックの左方向が押されているかを調べます。</td></tr><tr><td><a href="#joystickright">right</a></td><td>ジョイスティックの右方向が押されているかを調べます。</td></tr><tr><td><a href="#joystickup">up</a></td><td>ジョイスティックの上方向が押されているかを調べます。</td></tr><tr><td><a href="#joystickdown">down</a></td><td>ジョイスティックの下方向が押されているかを調べます。</td></tr><tr><td><a href="#joystickbutton">button</a></td><td>ジョイスティックのボタンが押されているかを調べます。</td></tr></tbody></table><hr><h2 id="joystickleft">Joystick.left</h2><p>ジョイスティックの左方向が押されているかを調べます。</p><p><strong>書式</strong></p><pre><code>left()
</code></pre><p><strong>戻り値</strong></p><p>0=押されていない<br>1=押されたばかり<br>2以上=押しっぱなし</p><hr><h2 id="joystickright">Joystick.right</h2><p>ジョイスティックの右方向が押されているかを調べます。</p><p><strong>書式</strong></p><pre><code>right()
</code></pre><p><strong>戻り値</strong></p><p>0=押されていない<br>1=押されたばかり<br>2以上=押しっぱなし</p><hr><h2 id="joystickup">Joystick.up</h2><p>ジョイスティックの上方向が押されているかを調べます。</p><p><strong>書式</strong></p><pre><code>up()
</code></pre><p><strong>戻り値</strong></p><p>0=押されていない<br>1=押されたばかり<br>2以上=押しっぱなし</p><hr><h2 id="joystickdown">Joystick.down</h2><p>ジョイスティックの下方向が押されているかを調べます。</p><p><strong>書式</strong></p><pre><code>down()
</code></pre><p><strong>戻り値</strong></p><p>0=押されていない<br>1=押されたばかり<br>2以上=押しっぱなし</p><hr><h2 id="joystickbutton">Joystick.button</h2><p>ジョイスティックのボタンが押されているかを調べます。</p><p><strong>書式</strong></p><pre><code>button(n)
</code></pre><ul><li><strong>n</strong><br>&emsp;ボタンの番号</li></ul><p><strong>戻り値</strong></p><p>0=押されていない<br>1=押されたばかり<br>2以上=押しっぱなし</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-is"class="pagediv"title2="命令リファレンス - is - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="is">is</h2><p>オブジェクトが特定のクラスに属しているかを調べます。</p><h4 id="書式">書式</h4><pre><code>式 is クラス名
</code></pre><p>式で表されるオブジェクトのクラスがクラス名で表されるクラスに属しているならば真(0以外の値)を返します。<br>また、オブジェクトの属するクラスがクラス名の子クラスである場合も真を返します。</p><p>主に、<a href="./rf-for-chars">for (xx in $chars)</a>で、特定のクラスのオブジェクトだけを抜き出すのに使います。</p><h3 id="例1">例1</h3><p><a href="./rf-for-chars">for (xx in $chars)</a> 参照</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-inputbox"class="pagediv"title2="命令リファレンス - $InputBox - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="inputboxオブジェクト">$InputBoxオブジェクト</h2><p>テキストを入力するためのウィンドウを表示します</p><p>参考：<a href="./rf-plainchar#plaincharwaitinput">waitInput</a>メソッド</p><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#inputboxopen">open</a></td><td>文字入力用のウィンドウを開きます。</td></tr><tr><td><a href="#inputboxgetstatus">getStatus</a></td><td>文字入力用のウィンドウの状態を調べます</td></tr><tr><td><a href="#inputboxgettext">getText</a></td><td>文字入力用のウィンドウに入力された文字列を調べます。</td></tr></tbody></table><hr><h2 id="inputboxopen">$InputBox.open</h2><p>文字入力用のウィンドウを開きます。</p><p><strong>書式</strong></p><pre><code>open(title, prompt, default, left, top, width, height) 
</code></pre><ul><li><strong>title</strong><br>&emsp;文字入力用のウィンドウのタイトルバーに表示する文字列</li><li><strong>prompt</strong><br>&emsp;プロンプト部分（入力部分のすぐ上）に表示する文字列。改行文字( )を使うと複数行表示できます。(Ver1.12から)</li><li><strong>default</strong><br>&emsp;入力部分にあらかじめ入っている文字列</li><li><strong>left</strong><br>&emsp;ウィンドウの横位置（省略可）</li><li><strong>top</strong><br>&emsp;ウィンドウの縦位置（省略可）</li><li><strong>width</strong><br>&emsp;ウィンドウの幅（省略可）</li><li><strong>height</strong><br>&emsp;ウィンドウの高さ（省略可）</li></ul><p><a href="./rf-plainchar#plaincharwaitinput">waitInput</a>と異なり、ユーザがボタン（「Ok」 または「キャンセル」）を押すまで処理を中断しません。</p><p>ユーザがボタン（「OK」 または「キャンセル」）を押したかは<a href="#inputboxgetstatus">$InputBox.getStatus</a> で調べることができます。<br>入力された文字の内容は <a href="#inputboxgettext">$InputBox.getText</a> で調べることができます。</p><p><strong>例1</strong></p><pre><code>extends TextChar;
$InputBox.open(&quot;名前の入力&quot;,&quot;あなたは\nだあれ&quot;,&quot;ななしの　ごんべ&quot;);
while ($InputBox.getStatus()==0) {
  text=&quot;名前を入力しています...&quot;+$InputBox.getText();
  update();
}
if ($InputBox.getStatus()==1) {  
  text=$InputBox.getText()+&quot;さん、よろしく！&quot;;
} else {
  text=&quot;キャンセルしました&quot;;
}
wait();
</code></pre><hr><h2 id="inputboxgetstatus">$InputBox.getStatus</h2><p>文字入力用のウィンドウの状態を調べます</p><p><strong>書式</strong></p><pre><code>getStatus()
</code></pre><p><strong>戻り値</strong></p><ul><li>0: 文字入力用のウィンドウが表示されている（＝ユーザからの入力を待っている）</li><li>1: 「OK」ボタンが押され、ウィンドウが閉じられた</li><li>2: 「キャンセル」ボタン、または右上の「x」が押され、ウィンドウが閉じられた</li></ul><p><strong>例1</strong></p><p><a href="#inputboxopen">$InputBox.open</a>参照</p><hr><h2 id="inputboxgettext">$InputBox.getText</h2><p><a href="#inputboxopen">$InputBox.open</a> によって開かれた文字入力用のウィンドウに入力された文字列を調べます。</p><p><strong>書式</strong></p><pre><code>getText()
</code></pre><p><strong>戻り値</strong> 入力された文字列</p><p><strong>例1</strong></p><p><a href="#inputboxopen">$InputBox.open</a>参照</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-if"class="pagediv"title2="命令リファレンス - if - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="if">if</h2><p>条件にしたがって、手続きを振り分けます。</p><h4 id="書式">書式</h4><pre><code>if (条件) 手続き1 else 手続き2
</code></pre><p>条件に書かれた計算式の値が、<a href="./rf-true-false">真</a>である場合は手続き1を実行し、<a href="./rf-true-false">偽</a>である場合で、else以降がある場合は手続き2を実行します。</p><h3 id="条件式の書き方">条件式の書き方</h3><p>条件には、次の形式で条件を書きます。条件が成り立ったときが真です。</p><table><thead><tr><th>書き方</th><th>意味</th></tr></thead><tbody><tr><td>式1 == 式2</td><td>式1と式2が等しいならば真</td></tr><tr><td>式1 != 式2</td><td>式1と式2が等しくないならば真</td></tr><tr><td>式1 &gt; 式2</td><td>式1が式2より大きいならば真</td></tr><tr><td>式1 &lt; 式2</td><td>式1が式2より小さいならば真</td></tr><tr><td>式1 &gt;= 式2</td><td>式1が式2以上ならば真</td></tr><tr><td>式1 &lt;= 式2</td><td>式1が式2以下ならば真</td></tr><tr><td>式1 (単体)</td><td>式1が0でない、かつnullでもないならば真</td></tr><tr><td>!式1</td><td>式1が0以外、またはnull以外ならば真</td></tr></tbody></table><h3 id="複数の条件式の書き方">複数の条件式の書き方</h3><p>上記の条件式を複数つなげて、複雑な条件を作ることもできます。<br>条件が成り立ったときが真です。</p><table><thead><tr><th>書き方</th><th>意味</th><th>例</th></tr></thead><tbody><tr><td>条件式1 &amp;&amp; 条件式2</td><td>条件式1が真、かつ、条件式2が真ならば真</td><td><a href="./tr-stg01#screenout">チュートリアル - シューティングゲーム -<br>自機を動かす - 画面はみだし判定</a></td></tr><tr><td>条件式1 &#124;&#124; 条件式2</td><td>条件式1が真、または、条件式2が真ならば真<br>（条件式1,2が両方真の場合も真）</td><td><a href="./tr-maze04#crashdie">チュートリアル - 迷路ゲーム -<br>自機や敵を破壊する - 敵と自機がぶつかったら、敵が死ぬ</a></td></tr></tbody></table><h3 id="--の使い方">{ } の使い方</h3><p>手続き1または手続き2の部分に、2つ以上の命令（文）書きたい場合、それらを <strong>{</strong> と <strong>}</strong> で囲ってください。</p><h4 id="例1">例1</h4><p>(オブジェクトを作成し、ダブルクリック後つぎのように入力します。)</p><pre><code>extends SpriteChar;
while(1) {
  if (x&gt;300) {
    x=0;
    print (&quot;x=0に戻りました&quot;);
  } else {
    x=x+1;
  }
  update();
}
</code></pre><p>▲ 実行すると、オブジェクトが右に移動しますが、x = 300 の地点で左端に戻り、「x=0に戻りました」と表示します。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-hashtable"class="pagediv"title2="命令リファレンス - Hashtable - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="hashtableクラス">Hashtableクラス</h2><p>複数の値（要素）を入れることが可能なオブジェクトです。各要素へのアクセスにはキーと呼ばれる値を用います。</p><p>ハッシュテーブルは、<a href="./rf-array">配列</a>のように複数の値（要素）を入れることが可能なオブジェクトです。</p><p>配列に入っている要素を参照するときは、「3番目の要素」というように数値を使って要素を参照しましたが、<br>ハッシュテーブルは、「文字 列&quot;red&quot;に対応する要素」というように任意の値を使って要素を参照できます。<br>なお、上の例で示した&quot;red&quot;のような、要素を参照するための値をキーと呼びます。</p><h3 id="例1">例1</h3><p>Colors.tonyu</p><pre><code>extends SpriteChar;
wait();
</code></pre><p>HashTester.tonyu</p><pre>
extends SpriteChar;
green=appear(new Colors(100,300,3));
yellow=appear(new Colors(150,300,5));
red=appear(new Colors(200,300,7));

h=new Hashtable(); // ハッシュテーブル作成
h.<a href="#hashtableput">put</a>("あか",red); // キー "あか" にオブジェクト red を割り当てる
h.put("きいろ",yellow); // キー "きいろ" にオブジェクト yellow を割り当てる
h.put("みどり",green); // キー "みどり" にオブジェクト green を割り当てる

s="あか";
while (1) {
  s=waitInput("いろ？","あかorみどりorきいろ",s);
  target=h.<a href="#hashtableget">get</a>(s); // sをキーとして要素(green,yellow,red、またはnull)をとりだす。
  if (target!=null) target.y-=16;
  update();
}
</pre><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#hashtableget">get</a></td><td>指定されたキーに対応する値を取り出します</td></tr><tr><td><a href="#hashtableput">put</a></td><td>キーと値の組を追加します。</td></tr><tr><td><a href="#hashtableiterator">iterator</a></td><td>キーや値をすべて調べるためのイテレータを作成します。</td></tr><tr><td><a href="#hashtableremove">remove</a></td><td>キーとそれに対応する値を削除します。</td></tr><tr><td><a href="#hashtablesize">size</a></td><td>格納されているキーの数(=値の数) を返します。</td></tr><tr><td><a href="#hashtablehasnext">hasNext</a></td><td><a href="#hashtableiterator">イテレータ</a>から<a href="#hashtablenextkey">nextKey</a>メソッドや<a href="#hashtablenextvalue">nextValue</a>メソッドを使って取り出せる組が残っているか調べます。</td></tr><tr><td><a href="#hashtablenextkey">nextKey</a></td><td><a href="#hashtableiterator">イテレータ</a>から次の組を取り出し、取り出した組のキーを返します。</td></tr><tr><td><a href="#hashtablenextvalue">nextValue</a></td><td><a href="#hashtableiterator">イテレータ</a>から次の組を取り出し、取り出した組の値を返します。</td></tr></tbody></table><hr><h2 id="hashtableget">Hashtable.get</h2><p>ハッシュテーブルから指定されたキーに対応する値を取り出します</p><p><strong>書式</strong></p><pre><code>get(key)
</code></pre><ul><li><strong>key</strong><br>&emsp;キー</li></ul><p><strong>戻り値</strong></p><p>ハッシュテーブルにおけるキーkeyに対応する値</p><hr><h2 id="hashtableput">Hashtable.put</h2><p>ハッシュテーブルにキーと値の組を追加します。</p><p><strong>書式</strong></p><pre><code>put(key,value)
</code></pre><ul><li><strong>key</strong><br>&emsp;追加するキー</li><li><strong>value</strong><br>&emsp;キーに対応する値</li></ul><p>ハッシュテーブルのキー keyに 値value を設定します。<br>すでに同じキーがハッシュテーブルにある場合、そのキーに対する新しい値を設定します。</p><hr><h2 id="hashtableiterator">Hashtable.iterator</h2><p>ハッシュテーブルに格納されているキーや値をすべて調べるためのオブジェクト(イテレータ)を作成します。</p><p><strong>書式</strong></p><pre><code>iterator()
</code></pre><p><strong>戻り値</strong></p><p>ハッシュテーブルのイテレータ</p><p>イテレータに対しては <a href="#hashtablehasnext">hasNext</a>メソッド, <a href="#hashtablenextkey">nextKey</a>メソッド, <a href="#hashtablenextvalue">nextValue</a>メソッドを呼ぶことができます。</p><p><strong>例1</strong></p><pre><code>extends SpriteChar;
h=new Hashtable();
h.put(&quot;国語&quot;,40);
h.put(&quot;英語&quot;,70);
h.put(&quot;数学&quot;,50);
y=20;
$panel.drawText(20,y,&quot;科目&quot;,$clWhite);
$panel.drawText(100,y,&quot;成績&quot;,$clAqua);
y+=30;sum=0;
it=h.iterator(); // hのイテレータを作成
while (it.hasNext()) { // 次の要素がある間は
  k=it.nextKey(); // 次のキー（科目）を取り出す
  score=h.get(k); // キーに対応する値（科目の点数)をとりだす
  sum+=score;
  $panel.drawText(20,y,k,$clWhite); // キー(科目)を表示
  $panel.drawText(100,y,score,$clAqua); // キーに対応する値(点数)を表示
  y+=30;
}
$panel.drawText(20,y,&quot;合計&quot;,$clWhite);
$panel.drawText(100,y,sum,$clGreen);
y+=30;
$panel.drawText(20,y,&quot;平均&quot;,$clWhite);
$panel.drawText(100,y,trunc(sum/h.size()),$clYellow);
y+=30;
</code></pre><hr><h2 id="hashtableremove">Hashtable.remove</h2><p>ハッシュテーブルからキーとそれに対応する値を削除します。</p><p><strong>書式</strong></p><pre><code>remove(key)
</code></pre><ul><li><strong>key</strong><br>&emsp;削除するキー</li></ul><p><strong>戻り値</strong></p><p>削除したキー</p><p>ハッシュテーブルhからキーkeyとそれに対応する値を削除します。</p><hr><h2 id="hashtablesize">Hashtable.size</h2><p>ハッシュテーブルに格納されているキーの数(=値の数) を返します。</p><p><strong>書式</strong></p><pre><code>size()
</code></pre><p><strong>戻り値</strong></p><p>ハッシュテーブルに格納されているキーの数</p><hr><h2 id="hashtablehasnext">Hashtable.hasNext</h2><p><a href="#hashtableiterator">イテレータ</a>から<a href="#hashtablenextkey">nextKey</a>メソッドや<a href="#hashtablenextvalue">nextValue</a>メソッドを使って取り出せる組が残っているか調べます。</p><p><strong>書式</strong></p><pre><code>hasNext()
</code></pre><p><strong>戻り値</strong></p><p>イテレータから取り出せる項目が残っている場合 1、 残っていない場合 0</p><hr><h2 id="hashtablenextkey">Hashtable.nextKey</h2><p><a href="#hashtableiterator">イテレータ</a>から次の組を取り出し、取り出した組のキーを返します。</p><p><strong>書式</strong></p><pre><code>nextKey()
</code></pre><p><strong>戻り値</strong></p><p>イテレータから取り出した組のキー</p><p>※このメソッドと<a href="#hashtablenextvalue">nextValue</a>メソッドは一緒に使わないことを推奨します。</p><hr><h2 id="hashtablenextvalue">Hashtable.nextValue</h2><p><a href="#hashtableiterator">イテレータ</a>から次の組を取り出し、取り出した組の値を返します。</p><p><strong>書式</strong></p><pre><code>nextValue()
</code></pre><p><strong>戻り値</strong></p><p>イテレータから取り出した組の値</p><p>※このメソッドと<a href="#hashtablenextkey">nextKey</a>メソッドは一緒に使わないことを推奨します。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-getosversion"class="pagediv"title2="命令リファレンス - $osPlatformId、$osMajorVer、$osMinorVer - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="osplatformid、osmajorver、osminorver、osbuildnumber">$osPlatformId、$osMajorVer、$osMinorVer、$osBuildNumber</h2><h5 id="1_29_2021_0501以降-osbuildnumberは1_29_2021_1212以降">(1_29_2021_0501以降)　$osBuildNumberは1_29_2021_1212以降</h5><p>Windowsのバージョンを返します。</p><p>Tonyuを実行しているWindowsのバージョンを判定できます。</p><table><thead><tr><th>OS</th><th>$osPlatformId</th><th>$osMajorVer</th><th>$osMinorVer</th><th>$osBuildNumber</th></tr></thead><tbody><tr><td>Windows 11</td><td>2</td><td>10</td><td>0</td><td>22000以上</td></tr><tr><td>Windows 10</td><td>2</td><td>10</td><td>0</td><td>22000未満</td></tr><tr><td>Windows 8.1</td><td>2</td><td>6</td><td>3</td><td>9600</td></tr><tr><td>Windows 8</td><td>2</td><td>6</td><td>2</td><td>9200</td></tr><tr><td>Windows 7</td><td>2</td><td>6</td><td>1</td><td>7601 (SP1)<br>7600</td></tr><tr><td>Windows Vista</td><td>2</td><td>6</td><td>0</td><td>6002 (SP2)<br>6001 (SP1)<br>6000</td></tr><tr><td>Windows XP</td><td>2</td><td>5</td><td>1</td><td>2600</td></tr><tr><td>Windows 2000</td><td>2</td><td>5</td><td>0</td><td>2195</td></tr><tr><td>Windows Me</td><td>1</td><td>4</td><td>90</td><td>3000</td></tr><tr><td>Windows 98 SE</td><td>1</td><td>4</td><td>10</td><td>2222</td></tr><tr><td>Windows 98</td><td>1</td><td>4</td><td>10</td><td>1998</td></tr><tr><td>Windows 95</td><td>1</td><td>4</td><td>0</td><td>いろいろ(詳しくはWebで調べてください)</td></tr></tbody></table><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-fullscreen"class="pagediv"title2="命令リファレンス - $fullScreen - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="fullscreen">$fullScreen</h2><p>フルスクリーンで起動した場合1、ウィンドウモードで起動した場合0が入っています。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-framemanager"class="pagediv"title2="命令リファレンス - FrameManager - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="framemanagerクラス">FrameManagerクラス</h2><p>１フレームに毎に特別な処理を行いたい場合に使うオブジェクトです</p><ul><li>フレームマネージャは１ページに１個しか作成できません</li><li>作成されたフレームマネージャは、作成したときの名前に関係なく$frameManagerというグローバル変数から参照することができます。</li></ul><p>フレームマネージャには次の３つのメソッドを定義してください。</p><ul><li>onStart</li><li>onBeforeMove</li><li>onAfterMove</li></ul><p>これらのメソッドは、次に示すようなタイミングで呼ばれます。</p><h4 id="フレームマネージャの動作">フレームマネージャの動作</h4><pre>
実行開始
   ↓
onStartを呼び出す
   ↓
 <i>*フレーム開始</i>
   ↓
onBeforeMoveを呼び出す
   ↓
各オブジェクトが動作する
   ↓
onAfterMoveを呼び出す
   ↓
各オブジェクトを描画する
   ↓
フレーム終了。<i>*フレーム開始</i> へ戻る 
</pre><h3 id="例1">例1</h3><p>FrameTest.tonyu</p><pre><code>extends FrameManager;
function onStart() {
  print(&quot;スタート&quot;);
}
function onBeforeMove() {
  ctemp=0; // TestObjの個数カウンタをリセット
}
function onAfterMove() {
  count=ctemp;
  drawText(x,y,&quot;TestObj の個数: &quot;+count,$clWhite);
}
</code></pre><p>TestObj.tonyu (2,3個置いてみましょう)</p><pre><code>extends SpriteChar;
vx=rnd(6)-3;
vy=rnd(6)-3;
while (screenOut()==0) {
  $frameManager.ctemp++; // TestObjの個数カウンタ増やす
  x+=vx;y+=vy;
  update(); 
}
</code></pre><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-fps-rps"class="pagediv"title2="命令リファレンス - $_fps, $_rps - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="_fps-_rps">$_fps, $_rps</h2><h5 id="1_29_2021_0501以降">(1_29_2021_0501以降)</h5><ul><li><p><strong>$_fps</strong><br>FPS（Frame per Second）<br>１秒あたりの描画回数を実数で格納されています</p></li><li><p><strong>$_rps</strong><br>RPS（Run per Second）<br>１秒あたりの実行回数を実数で格納されています</p></li></ul><p>パフォーマンスウィンドウに表示されている、FPSとRPSの値が実数で格納されます。<br>約１秒ごとに更新されます。</p><h3 id="例1">例1</h3><pre><code>extends SpriteChar;
while (1) {
  drawText(10, 10, &quot;FPS: &quot;+trunc($_fps+0.5)+&quot;.&quot;+(($_fps+0.5)*10%10), $clWhite);
  drawText(10, 30, &quot;RPS: &quot;+trunc($_rps+0.5)+&quot;.&quot;+(($_rps+0.5)*10%10), $clWhite);
  update();
}
</code></pre><p>$_fpsと$_rpsは実数で返されるので、例えばパフォーマンスウィンドウに「FPS=60.0」と表示されている場合は、<br>59.999641418457 のように返されます。</p><p>例1では、パフォーマンスウィンドウの、FPS・RPSと同じ値を表示しています。<br>パフォーマンスウィンドウのFPSとRPSの値は、小数点第２位以下を四捨五入して表示しています。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-for"class="pagediv"title2="命令リファレンス - for - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="for">for</h2><p>※ for文は、ここに示したもののほかに<a href="./rf-for-in">for..in</a>という文もあります。</p><p>条件にしたがって、繰り返し処理を行います。</p><h4 id="書式">書式</h4><pre>
for (<b>初期化文</b>; <b>条件</b>; <b>カウント文</b>) <b>手続き</b>
</pre><p>次のwhile文と同じ動作をします。</p><h4 id="書式-1">書式</h4><pre>
<b>初期化文</b>
while (<b>条件</b>) {
  <b>手続き</b>
  <b>カウント文</b>
}
</pre><p>主に、次の形式で使います</p><h4 id="書式-2">書式</h4><pre><code>for ( xxx = 初期値 ; xxx &lt; 終了値+1 ; xxx+=増分 ) 手続き
または
for ( xxx = 初期値 ; xxx &lt; 終了値+1 ; xxx++ ) 手続き
</code></pre><p>xxxは、ループに使う変数です。<br>変数xxxを <strong>初期値</strong> から <strong>終了値</strong> まで、１づつ、または<strong>増分</strong> づつ増やしながら<strong>手続き</strong>を行います。</p><h3 id="例1">例1</h3><pre><code>extends SpriteChar;
for (i=0; i&lt;60; i++) {
   drawText(x, y, i, $clWhite);
   update();
}
</code></pre><p>▲ i を 0 から59 まで表示したあと、消滅します。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-for-in"class="pagediv"title2="命令リファレンス - for..in - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="forin">for..in</h2><p><a href="./rf-array">配列</a>のすべての要素に対して処理を行います。</p><p>特に、<a href="./rf-for-chars">for (xx in $chars)</a>は、画面上のオブジェクトをすべて調べるのに用います。</p><h4 id="書式">書式</h4><pre><code>for (b in a) 手続き
</code></pre><ul><li>aで示される配列オブジェクトが持っている要素のうち、最初の要素を変数bに代入し 手続きを実行します。</li><li>その後、aの2番目の要素を変数bに代入し、同様に手続きを実行します。</li><li>3番目、4番目についても同様に処理を行い、最後の要素まで処理を行ったら文全体が終了します。</li></ul><p><span style="color:red">※ 処理中にaに対して<a href="./rf-array#arrayadd">Array.add</a>や<a href="./rf-array#arraydelete">Array.delete</a>などの処理を行うと処理が正しく実行されません</span></p><h3 id="例1">例1</h3><p><a href="./rf-array">Array</a>クラスを参照してください</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-for-chars"class="pagediv"title2="命令リファレンス - for (xx in $chars) - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="for-xx-in-chars">for (xx in $chars)</h2><p>画面上のすべてのオブジェクトに対して処理を行います</p><h4 id="書式">書式</h4><pre><code>for (変数名 in $chars) 処理
</code></pre><p>変数名で表される変数に画面上のオブジェクトを順番に代入していき、処理を行います。</p><h3 id="例1">例1</h3><p>Enemy.tonyu</p><pre><code>extends SpriteChar;
while (1) {
  y=y+1;
  update();
}
</code></pre><p>Jiki.tonyu</p><pre>
extends SpriteChar;
while (1) {
  if (getkey(39)&gt;0) x+=3;
  if (getkey(37)&gt;0) x-=3;
  if (getkey(40)&gt;0) y+=3;
  if (getkey(38)&gt;0) y-=3;
  for (e in $chars) {
    if (e <a href="./rf-is">is</a> Enemy && <a href="./rf-plainchar#plaincharcrashto">crashTo</a>(e)) <a href="./rf-plainchar#plainchardie">die</a>();
  }
  update();
}
</pre><p>▲ Jikiは、画面上のEnemyクラスのオブジェクトeのうちのどれかに対して、 <a href="./rf-plainchar#plaincharcrashto">crashTo</a>(e)が成立すれば<a href="./rf-plainchar#plainchardie">die</a>();を呼び出します。<br>すなわち、Enemyクラスのいずれかに当たると死亡します。</p><h3 id="例2">例2</h3><p>新たにEnemy2を増やして、別クラスの当たり判定を増やす場合です。</p><p>以下は<span style="color:red"><strong>悪い例</strong></span>です。</p><p>Jiki.tonyu</p><pre>
extends SpriteChar;
while (1) {
  if (getkey(39)>0) x+=3;
  if (getkey(37)>0) x-=3;
  if (getkey(40)>0) y+=3;
  if (getkey(38)>0) y-=3;
  for (e in $chars) {
    if (e is Enemy && crashTo(e)) die();
  }
  <span style="color:red">for (e in $chars) {
    if (e is Enemy2 && crashTo(e)) die();
  }</span>
  update();
}
</pre><p>▲ <code>for (e in $chars)</code> を２回実行しています。これでも判定はできますが、<br>全オブジェクトを２回判定しているので、オブジェクトが増えると処理落ちしやすくなってしまいます。<br>これにEnemy3, Enemy4, ... などと増やしていくと、ちょっとオブジェクトを増やしただけで、かなり重くなるかもしれません。</p><p>以下の実装の方が処理が軽くなります。</p><p>Jiki.tonyu</p><pre>
extends SpriteChar;
while (1) {
  if (getkey(39)>0) x+=3;
  if (getkey(37)>0) x-=3;
  if (getkey(40)>0) y+=3;
  if (getkey(38)>0) y-=3;
  for (e in $chars) {
    <span style="color:red">if (e is Enemy || e is Enemy2) {
      if (crashTo(e)) {
        die();
      }
    }</span>
  }
  update();
}
</pre><p>▲ この書き方であれば、<code>for (e in $chars)</code> は１回だけで済むので、判定処理が軽くなります。</p><h3 id="関連">関連</h3><ul><li><a href="./rf-is">is</a></li></ul><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-filewriter"class="pagediv"title2="命令リファレンス - FileWriter - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="filewriterクラス">FileWriterクラス</h2><p>ファイルにデータを書き出します。</p><p>※ ファイルについてはファイルの扱いについてを参照してください</p><h3 id="例1">例1</h3><ol><li>オブジェクトを作成し、次のようなコードを書いて実行します。</li><li>現在開いているページのフォルダのなかにある filesというフォルダを開きます。</li><li>filesフォルダにあるtest.txtという テキストファイルを開きます</li></ol><pre><code>extends SpriteChar;
a=new FileWriter(&quot;test.txt&quot;);
a.writeLn(&quot;ファイル出力&quot;);
a.writeLn(1+1);
a.writeLn(&quot;終了&quot;);
a.close();
</code></pre><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#filewriterclose">close</a></td><td>ファイルの読み込みを終了します。</td></tr><tr><td><a href="#filewriterwrite">write</a></td><td>ファイルへ１バイトを書き出します。</td></tr><tr><td><a href="#filewriterwritestr">writeStr</a></td><td>テキストファイルへ文字列を書き出します。</td></tr><tr><td><a href="#filewriterwriteln">writeLn</a></td><td>ファイルに文字列を書き出し、最後に改行をいれます。</td></tr><tr><td><a href="#filewritererror">error</a></td><td>ファイルの書き込み時にエラーが発生したかを調べます。</td></tr></tbody></table><hr><h2 id="filewriterclose">FileWriter.close</h2><p>ファイルの読み込みを終了します。FilerWriterオブジェクトを使ったら最後に必ず呼び出してください。</p><p><strong>書式</strong></p><pre><code>close()
</code></pre><hr><h2 id="filewriterwrite">FileWriter.write</h2><p>ファイルへ１バイトを書き出します。</p><p><strong>書式</strong></p><pre><code>write(d)
</code></pre><ul><li><strong>d</strong><br>&emsp;書き出す1バイト分のデータ。</li></ul><hr><h2 id="filewriterwritestr">FileWriter.writeStr</h2><p>テキストファイルへ文字列を書き出します。</p><p><strong>書式</strong></p><pre><code>writeStr(s)
</code></pre><ul><li><strong>s</strong><br>&emsp;書き出す文字列</li></ul><hr><h2 id="filewriterwriteln">FileWriter.writeLn</h2><p>ファイルに文字列を書き出し、最後に改行をいれます。</p><p><strong>書式</strong></p><pre><code>writeLn(s)
</code></pre><ul><li><strong>s</strong><br>&emsp;書き出す文字列</li></ul><hr><h2 id="filewritererror">FileWriter.error</h2><p>ファイルの書き込み時にエラーが発生したかを調べます。</p><p><strong>書式</strong></p><pre><code>error()
</code></pre><p><strong>戻り値</strong></p><p>エラーなら１。エラーでなければ０</p><p>他のアプリケーションがファイルを使っていたり（共有違反）、ディスクの調子が悪い時などにエラーになります。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-filereader"class="pagediv"title2="命令リファレンス - FileReader - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="filereaderクラス">FileReaderクラス</h2><p>ファイルからデータを読み込みます。ファイルについては<a href="./rf-file-handling">ファイルの扱いについて</a>を参照してください</p><h3 id="例1">例1</h3><ol><li>現在開いているページのフォルダのなかにfilesというフォルダを作ります。</li><li>filesフォルダにtest.txtというテキストファイルを置きます。</li><li>test.txtに数行なにかかいておきます。</li><li>メニューの「ウィンドウ」＞「コンソール」でコンソールウィンドウを表示します。</li><li>オブジェクトを作成し、次のようなコードを書いて実行します。</li><li>コンソールにファイルの内容が表示されます。</li></ol><pre><code>extends SpriteChar;
a=new FileReader(&quot;test.txt&quot;);
eof=0;
while (!eof) {
  l=a.readLn();
  if (l==null) eof=1; else print (l);
}
a.close();
</code></pre><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#filereaderread">read</a></td><td>ファイルから１バイトを読み込みます。</td></tr><tr><td><a href="#filereadereof">eof</a></td><td>ファイルの終わりに達しているかを調べます。</td></tr><tr><td><a href="#filereaderclose">close</a></td><td>ファイルの読み込みを終了します。</td></tr><tr><td><a href="#filereaderreadln">readLn</a></td><td>テキストファイルから１行を読み込みます。</td></tr><tr><td><a href="#filereadererror">error</a></td><td>ファイルの読み取り時に、エラーが発生したかを調べます。</td></tr></tbody></table><hr><h2 id="filereaderread">FileReader.read</h2><p>ファイルから１バイトを読み込みます。</p><p><strong>書式</strong></p><pre><code>read()
</code></pre><p><strong>戻り値</strong></p><p>読み込んだ1バイト分のデータ。ファイルの終わりに達している場合はnull</p><hr><h2 id="filereadereof">FileReader.eof</h2><p>ファイルの終わりに達しているかを調べます。</p><p><strong>書式</strong></p><pre><code>eof()
</code></pre><p><strong>戻り値</strong></p><p>ファイルの終わりに達している場合、0以外の値、そうでない場合0</p><hr><h2 id="filereaderclose">FileReader.close</h2><p>ファイルの読み込みを終了します。FileReaderオブジェクトを使ったら最後に必ず呼び出してください。</p><p><strong>書式</strong></p><pre><code>close()
</code></pre><hr><h2 id="filereaderreadln">FileReader.readLn</h2><p>テキストファイルから１行を読み込みます。</p><p><strong>書式</strong></p><pre><code>readLn()
</code></pre><p><strong>戻り値</strong></p><p>読み込んだ文字列。改行コード(rおよび )は含まない。<br>ファイルの終わりに達している場合はnull</p><p>改行コードはWindowsスタイル、UNIXスタイルどちらでも読むことができます。</p><hr><h2 id="filereadererror">FileReader.error</h2><p>ファイルの読み取り時に、エラーが発生したかを調べます。</p><p><strong>書式</strong></p><pre><code>error()
</code></pre><p><strong>戻り値</strong></p><p>エラーなら１。エラーでなければ０</p><p>エラーは、指定されたファイルがない場合や、他のアプリケーションがファイルを使っていたり（共有違反）、<br>ディスクの調子が悪い時などにエラーになります。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-file-handling"class="pagediv"title2="命令リファレンス - ファイルの扱いについて - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="ファイルの扱いについて">ファイルの扱いについて</h2><p><a href="./rf-filereader">FileReader</a>オブジェクト、<a href="./rf-filewriter">FileWriter</a>オブジェクト、<a href="./rf-array#arrayload">Array.load</a>メソッド、<a href="./rf-array#arraysave">Array.save</a>メソッドを用いると、<br>ファイルに対する読み込み、書き込み操作ができます。</p><p>セキュリティの観点から、Tonyuで扱えるファイルは、次のディレクトリにあるファイルのみです。</p><p><b>(現在のページフォルダ)\files\</b></p><p>例えば、現在開いているページが</p><p><strong>C:\My Documents\Tonyu\test\index.cmml</strong></p><p>の場合、読み書きできるファイルは、フォルダ</p><p><b>C:\My Documents\Tonyu\test\files\</b></p><p>にあるファイルのみです。</p><h3 id="注意">注意</h3><ul><li>filesフォルダの中にサブフォルダを作成することはできません。</li><li>FileWriter,FileReaderオブジェクトでファイル名を指定する場合、ドライブ名やフォルダの区切り文字は除去されます。</li><li>FileWriterオブジェクトは、filesフォルダが存在しない場合はこれを自動的に作成します</li><li>ページフォルダに&quot;files&quot;という名前のファイル（フォルダではない）があるとファイルは扱えません</li></ul><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-extends"class="pagediv"title2="命令リファレンス - extends - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="extends">extends</h2><p>親クラスを設定します。親クラスを設定すると、親クラスの持っているすべての変数およびメソッドを利用できるようになります。</p><h4 id="書式">書式</h4><pre><code>extends クラス名;
</code></pre><ul><li>extendsはかならずファイルの先頭に書いてください。</li><li>クラス名で指定されたクラスを親クラスにします。</li></ul><h3 id="例1">例1</h3><p>Enemy.tonyu</p><pre><code>extends SpriteChar;
function atariHantei() {
   if (crashTo($Jiki)) $Jiki.die();
}
</code></pre><p>Teki1.tonyu</p><pre><code>extends Enemy;
while (1) {
    x=x+1;
    atariHantei();
    update();
}
</code></pre><p>Teki2.tonyu</p><pre><code>extends Enemy;
while (1) {
    y=y+1;
    atariHantei();
    update();
}
</code></pre><p>Jiki.tonyu (オブジェクト名は$Jikiにします)</p><pre><code>extends SpriteChar;
while (1) {
   if (getkey(39)&gt;0) x+=3;
   if (getkey(37)&gt;0) x-=3;
   if (getkey(40)&gt;0) y+=3;
   if (getkey(38)&gt;0) y-=3;
   update();
}
</code></pre><p>Teki1,Teki2 からatariHanteiを呼び出していますが、atariHanteiは親クラスのEnemyで定義されています。</p><p>このように同じメソッドを複数のクラスで使うときは親クラスを設定すると便利です。</p><p>特に、atariHanteiの内容を変更するときに、各クラスに同じメソッドが複数のクラスにあると、<br>すべてのメソッドを変更する必要がありますが、親クラスに定義すれば１箇所のみの変更ですみます。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-dxchar"class="pagediv"title2="命令リファレンス - DxChar - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="dxcharクラス">DxCharクラス</h2><p>DxCharクラスのオブジェクトは、ビットマップパターンの半透明、回転拡大縮小表示が可能です</p><h3 id="変数">変数</h3><ul><li><strong>x</strong><br>&emsp;オブジェクトのx座標を表します。xの値が大きくなるほど右に移動します。</li><li><strong>y</strong><br>&emsp;オブジェクトのy座標を表します。yの値が大きくなるほど下に移動します。<br>（※数学などでは、yが大きいほど上ですが、逆向きになります）</li><li><strong>p</strong><br>&emsp;表示する<a href="./wnd-char">キャラクタパターン</a>の番号を表します。<br>&emsp;キャラクタパターンと番号との対応は、キャラクタパターンウィンドウを参考にしてください。</li><li><strong>f</strong><br>&emsp;fに１を代入すると、キャラクタパターンの左右を反転します。0を設定すると反転をやめます。</li><li><strong>zOrder</strong><br>&emsp;この値が小さいほど、オブジェクトを手前に表示します。</li><li><strong>scaleX</strong><br>&emsp;オブジェクトの拡大率を指定します。<br>&emsp;scaleyが未定義または0の場合、縦横比は1のままです。</li><li><strong>scaley</strong><br>&emsp;scaleyを指定すると、横をscaleX倍、縦をscaley倍拡大します。</li><li><strong>angle</strong><br>&emsp;オブジェクトの回転を指定します。単位は度で右回りです。</li><li><strong>alpha</strong><br>&emsp;オブジェクトの透明度を指定します。<br>&emsp;255が完全に不透明で、減らすにしたがって透明になっていきます。<br>&emsp;0にすると見えなくなります。</li></ul><h3 id="メソッド一覧">メソッド一覧</h3><ul><li><a href="#dxcharcharnewanimation">newAnimation</a></li><li><a href="./rf-plainchar">PlainChar</a>クラスのメソッド</li><li><a href="./rf-sprite">Sprite</a>クラスのメソッド</li><li><a href="./rf-object">Object</a>クラスのメソッド</li></ul><hr><h2 id="dxcharnewanimation">DxChar.newAnimation</h2><p>新規AnimationAdaptorを作成します。</p><p><strong>書式</strong></p><pre><code>newAnimation()
</code></pre><p><strong>戻り値</strong></p><p>新規作成された<a href="./rf-animationadaptor">AnimationAdaptor</a></p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-display-wh"class="pagediv"title2="命令リファレンス - $displayWidth, $displayHeight - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="displaywidth-displayheight">$displayWidth, $displayHeight</h2><h5 id="1_29_2021_0501以降">(1_29_2021_0501以降)</h5><p>モニターの解像度を取得します。</p><p>$displayWidth には横のピクセル数、<br>$displayHeight には縦のピクセル数が格納されています。</p><p>※ Windows 8.1, 10などで、ディスプレイ設定のスケーリングが100%以外に設定されている環境では、<br>&emsp; 仮想のピクセル数となります。</p><h2 id="_displayrealwidth-_displayrealheight">$_displayRealWidth, $_displayRealHeight</h2><h5 id="1_29_2021_0630以降">(1_29_2021_0630以降)</h5><p>実際の解像度は、下記の変数に格納されています。</p><ul><li>$_displayRealWidth</li><li>$_displayRealHeight</li></ul><p>ディスプレイ設定のスケーリング設定には影響されません。</p><h2 id="_displayfrequency">$_displayFrequency</h2><h5 id="1_29_2021_0630以降-1">(1_29_2021_0630以降)</h5><p>モニターのリフレッシュレート（周波数）を取得します。</p><p>例えば、60Hzの設定であれば60が返ります。</p><h2 id="_displaycolor">$_displayColor</h2><h5 id="1_29_2021_0630以降-2">(1_29_2021_0630以降)</h5><p>モニターの色数を取得します。</p><p>例えば、32bit色の設定であれば32が返ります。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-comment"class="pagediv"title2="命令リファレンス - 注釈 - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="注釈">注釈</h2><p><strong>注釈</strong>は、プログラムの実行に影響を与えない文字列です。</p><ul><li>// から行の最後までが注釈になります</li><li>/*　から　 */ まで（行をまたいでも）も注釈になります</li></ul><p>　</p><h3 id="例1">例1</h3><pre>
extends SpriteChar;
<span style="color:#080">/* サンプル
　　プログラム */</span>
while(1) {
  x=x+1; <span style="color:#080">// 横移動</span>
  update(); <span style="color:#080">// 1フレームすすめる</span>
}
</pre><p>▲ <span style="color:#080">緑色</span>の部分が注釈です</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-checkbox"class="pagediv"title2="命令リファレンス - CheckBox - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="checkboxクラス">CheckBoxクラス</h2><p>チェックボックスを作成します</p><h3 id="例1">例1</h3><pre><code>extends CheckBox; // 必ずCheckBoxを親クラスにしてください

a=new Array();
a.add(&quot;OFF&quot;);a.add(&quot;OFF&quot;);a.add(&quot;OFF&quot;);a.add(&quot;OFF&quot;);a.add(&quot;OFF&quot;);a.add(&quot;OFF&quot;);
init(6);
while(1) {
  if (create(60,120,0,$clBlack)==1) a.set(0,&quot;ON&quot;); else a.set(0,&quot;OFF&quot;);
  if (create(60,140,1,$clRed)==1) a.set(1,&quot;ON&quot;); else a.set(1,&quot;OFF&quot;);
  if (create(60,160,2,$clGreen)==1) a.set(2,&quot;ON&quot;); else a.set(2,&quot;OFF&quot;);
  if (create(110,120,3,$clYellow)==1) a.set(3,&quot;ON&quot;); else a.set(3,&quot;OFF&quot;);
  if (create(110,140,4,$clPink)==1) a.set(4,&quot;ON&quot;); else a.set(4,&quot;OFF&quot;);
  if (create(110,160,5,$clWhite)==1) a.set(5,&quot;ON&quot;); else a.set(5,&quot;OFF&quot;);
  drawText(75,120,a.get(0),$clBlack,10);
  drawText(75,140,a.get(1),$clBlack,10);
  drawText(75,160,a.get(2),$clBlack,10);
  drawText(125,120,a.get(3),$clBlack,10);
  drawText(125,140,a.get(4),$clBlack,10);
  drawText(125,160,a.get(5),$clBlack,10);
  update();
}
</code></pre><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#checkboxinit">init</a></td><td>チェックボックス作成の準備をします</td></tr><tr><td><a href="#checkboxcreate">create</a></td><td>チェックボックスを作成します</td></tr></tbody></table><hr><h2 id="checkboxinit">CheckBox.init</h2><p>チェックボックス作成の準備をします</p><p><strong>書式</strong></p><pre><code>init(n)
</code></pre><ul><li><strong>n</strong><br>&emsp;作成するチェックボックスの数</li></ul><hr><h2 id="checkboxcreate">CheckBox.create</h2><p>チェックボックスを作成します</p><p><strong>書式</strong></p><pre><code>create(x,y,number,color,zOrder)
</code></pre><ul><li><strong>x</strong><br>&emsp;チェックボックスのx座標</li><li><strong>y</strong><br>&emsp;チェックボックスのy座標</li><li><strong>number</strong><br>&emsp;チェックボックスのID (0-N)<br>&emsp;N=<a href="#checkboxinit">init</a>で指定した個数-1</li><li><strong>color</strong><br>&emsp;色</li><li><strong>zOrder</strong><br>&emsp;表示順序</li></ul><p>作成前に必ず<a href="#checkboxinit">init</a>メソッドを呼んでください</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-break"class="pagediv"title2="命令リファレンス - break - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="break">break</h2><p><a href="./rf-while">while</a>文、<a href="./rf-for">for</a>文のループを抜け出します。</p><p>また、<a href="./rf-switch">switch</a>文の{}内を抜け出します。</p><h3 id="例1">例1</h3><pre><code>extends SpriteChar;
while (x&lt;300) {
  x=x+1;
  if (getkey(32)) break;
  update();
}
</code></pre><p>▲ xが300になるまで右に移動しますが、途中でスペースキーをおすとただちにループを抜け出し、オブジェクトが消滅します。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-assign"class="pagediv"title2="命令リファレンス - 代入 - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="代入">代入</h2><p>代入とは、<a href="./rf-variable">変数</a>の値を設定することです。 =演算子を用いて変数へ値を代入します。</p><h4 id="書式">書式</h4><pre><code>変数名 = 式;
</code></pre><p>例1</p><pre><code>//オブジェクトを作成し、ダブルクリック後つぎのように入力します。 
extends SpriteChar;
x=200;
y=100;
wait();
</code></pre><p>▲ 変数 x に 200 という値が入り、同様に yに100 が入ります。</p><p>Tonyuでは、変数xとy によってそのオブジェクトの位置を表します。<br>この例では、画面上から100 ドット目、左から200ドット目にオブジェクトが移動します。</p><p>x,yの値を確認することもできます。<br>実行中にオブジェクトをクリックし、オブジェクトインスペクタでx,yの値を確認します。</p><p><img src-t="./img/chk-xy.png"width="457"height="181"alt="chk-xy.png"></p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-assign-oper"class="pagediv"title2="命令リファレンス - 演算代入 - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="演算代入">演算代入</h2><p><a href="./rf-assign">代入</a>、<a href="./rf-arithmetic">算術演算</a>の箇所で説明した機能で、代入や計算は一通りできますが、ここで説明する演算子を使うとプログラムが簡潔になり、処理速度も上がります。</p><h3 id="----演算子">+= , -= 演算子</h3><h4 id="書式">書式</h4><pre><code>変数名 += 式;
変数名 -= 式;
</code></pre><p>それぞれ、</p><p>変数名 = 変数名 + 式 ;<br>変数名 = 変数名 - 式 ;</p><p>と同じ効果があります。変数名で示される変数の値を式の値だけ増やしたり減らしたりできます。</p><p>例1</p><pre><code>//オブジェクトを作成し、ダブルクリック後つぎのように入力します。
extends SpriteChar;
while (1) {
  x+=2;
  update();
}
</code></pre><p>▲ x+=2; は x=x+2; と書いても同じですが、x+=2のほうが処理速度が上がります。</p><h3 id="-----演算子">++ , -- 演算子</h3><h4 id="書式-1">書式</h4><pre><code>変数名 ++;
変数名 --;
</code></pre><p>それぞれ、</p><p>変数名 = 変数名 + 1;<br>変数名 = 変数名 - 1;</p><p>と同じ効果があります。変数名で示される変数の値を1増やしたり減らしたりできます。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-array"class="pagediv"title2="命令リファレンス - Array - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="arrayクラス">Arrayクラス</h2><p>Array(配列)クラスのオブジェクトには、複数の値（要素）を格納することができます。</p><h3 id="例1">例1</h3><p>予め<a href="./wnd-csl">コンソールウィンドウ</a>を表示しておいてください</p><pre><code>extends SpriteChar;
a=new Array(); // 配列の作成
a.add(&quot;orange&quot;);
a.add(&quot;apple&quot;);
print(&quot;要素数=&quot;+a.size());
print(&quot;1番目の要素は&quot;+a.get(0));
print(&quot;2番目の要素は&quot;+a.get(1));
 
a.insert(1,&quot;banana&quot;);
a.set(0,&quot;grape&quot;);
print(&quot;要素数=&quot;+a.size());
print(&quot;1番目の要素は&quot;+a.get(0));
print(&quot;2番目の要素は&quot;+a.get(1));
print(&quot;3番目の要素は&quot;+a.get(2));
 
a.delete(2);
print(&quot;全要素のリスト&quot;);
for (b in a) {
  print(b);
}
a.save(&quot;result.txt&quot;); 
// files\result.txt に
// 配列の内容が保存されます。
</code></pre><h3 id="特殊構文">特殊構文</h3><p><a href="./rf-for-in">for..in</a></p><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#arrayadd">add</a></td><td>配列に要素を追加します</td></tr><tr><td><a href="#arrayinsert">insert</a></td><td>配列の途中に要素を挿入します</td></tr><tr><td><a href="#arrayget">get</a></td><td>配列の要素を取り出します</td></tr><tr><td><a href="#arrayset">set</a></td><td>配列の要素に値を代入します</td></tr><tr><td><a href="#arraysize">size</a></td><td>配列の要素数を返します</td></tr><tr><td><a href="#arraydelete">delete</a></td><td>配列から要素を削除します</td></tr><tr><td><a href="#arrayindexof">indexOf</a></td><td>配列における要素のインデックスを返します。</td></tr><tr><td><a href="#arraylightindexof">lightIndexOf</a></td><td>indexOfメソッドの高速化版（数値専用）</td></tr><tr><td><a href="#arrayremove">remove</a></td><td>配列の要素を削除します</td></tr><tr><td><a href="#arrayclear">clear</a></td><td>配列の内容をすべて消去します。</td></tr><tr><td><a href="#arrayload">load</a></td><td>テキストファイルから配列の内容を読み込みます。</td></tr><tr><td><a href="#arraysave">save</a></td><td>配列の内容をテキストファイルに保存します。</td></tr></tbody></table><hr><h2 id="arrayadd">Array.add</h2><p>配列に要素を追加します</p><p><strong>書式</strong></p><pre><code>add(e)
</code></pre><ul><li><strong>e</strong><br>&emsp;追加する要素</li></ul><hr><h2 id="arrayinsert">Array.insert</h2><p>配列の途中に要素を挿入します</p><p><strong>書式</strong></p><pre><code>insert(index,element) 
</code></pre><ul><li><strong>index</strong><br>&emsp;挿入する場所。(先頭:0 末尾:size()-1)</li><li><strong>element</strong><br>&emsp;追加する要素。</li></ul><hr><h2 id="arrayget">Array.get</h2><p>配列の要素を取り出します</p><p><strong>書式</strong></p><pre><code>get(i)
</code></pre><ul><li><strong>i</strong><br>&emsp;取り出す要素のインデックス(先頭:0 末尾:size()-1)</li></ul><p><strong>戻り値</strong></p><p>i番目の要素</p><hr><h2 id="arrayset">Array.set</h2><p>配列の要素に値を代入します</p><p><strong>書式</strong></p><pre><code>set(i,e)
</code></pre><ul><li><strong>i</strong><br>&emsp;代入される要素のインデックス(先頭:0 末尾:size()-1)</li><li><strong>e</strong><br>&emsp;代入する要素</li></ul><hr><h2 id="arraysize">Array.size</h2><p>配列の要素数を返します</p><p><strong>書式</strong></p><pre><code>size()
</code></pre><p><strong>戻り値</strong></p><p>配列の要素数</p><hr><h2 id="arraydelete">Array.delete</h2><p>配列から要素を削除します</p><p><strong>書式</strong></p><pre><code>delete(i)
</code></pre><ul><li><strong>i</strong><br>&emsp;削除する要素のインデックス(先頭:0 末尾:size()-1)</li></ul><p><strong>戻り値</strong></p><p>削除した要素</p><p>※インデックスがわからない場合は<a href="#arrayremove">remove</a>メソッドが便利です</p><hr><h2 id="arrayindexof">Array.indexOf</h2><p>配列における要素のインデックスを返します。</p><p><strong>書式</strong></p><pre><code>indexOf(e)
</code></pre><ul><li><strong>e</strong><br>&emsp;インデックスを調べる要素</li></ul><p><strong>戻り値</strong></p><p>この配列における 要素eのインデックス。インデックスが複数の場合は最小のもの。<br>要素eが配列にない場合-1</p><hr><h2 id="arraylightindexof">Array.lightIndexOf</h2><p><a href="#arrayindexof">indexOf</a>メソッドを高速化したものですが、要素が文字列の場合は使えません。</p><p><strong>書式</strong></p><pre><code>lightIndexOf(e)
</code></pre><ul><li><strong>e</strong><br>&emsp;インデックスを調べる要素(文字列は使えません)</li></ul><p><strong>戻り値</strong></p><p>この配列における、要素eのインデックス。インデックスが複数の場合は最小のもの。<br>要素eが配列にない場合は-1</p><hr><h2 id="arrayremove">Array.remove</h2><p>配列の要素を削除します</p><p><strong>書式</strong></p><pre><code>remove(e)
</code></pre><ul><li><strong>e</strong><br>&emsp;削除する要素</li></ul><p><a href="#arraydelete">delete</a>メソッドと異なり、削除したい要素を引数に指定します</p><hr><h2 id="arrayclear">Array.clear</h2><p>配列の内容をすべて消去します。</p><p><strong>書式</strong></p><pre><code>clear()
</code></pre><hr><h2 id="arrayload">Array.load</h2><p>テキストファイルから配列の内容を読み込みます。</p><p><strong>書式</strong></p><pre><code>load(fn)
</code></pre><ul><li><strong>fn</strong><br>&emsp;ファイル名</li></ul><p>読み込めるファイルについては、<a href="./rf-file-handling">ファイルの扱いについて</a>を参照してください。</p><p>loadメソッドは、配列の内容をクリアしたあと、テキストファイルの１行につき１つの要素を追加します。<br>各要素の内容は行の内容を表す文字列です。</p><hr><h2 id="arraysave">Array.save</h2><p>配列の内容をテキストファイルに保存します。</p><p><strong>書式</strong></p><pre><code>save(fn)
</code></pre><ul><li><strong>fn</strong><br>&emsp;ファイル名</li></ul><p>ファイルの保存先については、<a href="./rf-file-handling">ファイルの扱いについて</a>を参照してください。</p><p>saveメソッドは、配列の要素を先頭から順に、１行ずつ出力したものをファイルに保存します。<br>要素が文字列の場合、その内容をそのまま出力し、 文字列でない場合、要素の文字列表現を出力します。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-arithmetic"class="pagediv"title2="命令リファレンス - 算術演算 - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="算術演算">算術演算</h2><p>足し算、掛け算など算術演算を行います。</p><h4 id="書式">書式</h4><pre><code>式1 + 式2
式1 - 式2
式1 * 式2
式1 / 式2
式1 % 式2
</code></pre><ul><li>+ : 足し算 (式1 + 式2)</li><li>- : 引き算 (式1 - 式2)</li><li>* : 掛け算 (式1 × 式2)</li><li>/ : 割り算 (式1 ÷ 式2)</li><li>% : 剰余 (式1 を 式2で割った余り)</li></ul><h3 id="例1">例1</h3><pre><code>//オブジェクトを作成し、ダブルクリック後つぎのように入力します
extends SpriteChar;
x=100+20;
y=30*2;
wait();
</code></pre><p>▲ 変数 x に 100+20 の 計算結果 120 が入り、同様に yに60 (=30*2) が入ります。</p><h3 id="例2">例2</h3><pre><code>extends SpriteChar;
x=200;
y=x-50;
wait();
</code></pre><p>▲ 変数 x に 200 が入ります。 また y には x-50 = 200-50 = 150 が入ります。</p><h3 id="例3">例3</h3><pre><code>extends SpriteChar;
while (1) {
  x=x+1;
  update();
}
</code></pre><p>▲ <a href="./rf-while">while</a>文により、x=x+1 が繰り返されます。<br>x=x+1 は、変数 x に、(現在の x の値) +1 が入ります。 結果として、x の値が1 増加します。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-animationadaptor"class="pagediv"title2="命令リファレンス - AnimationAdaptor - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="animationadaptorクラス">AnimationAdaptorクラス</h2><p>AnimationAdaptorとは、キャラクタパターンを次々に変化させることによるアニメーションを簡単に実現するためのオブジェクトです。</p><p>ここでは、図1のようなキャラクタを用意して、オブジェクトを歩かせる処理を考えます。</p><p><strong>図1：</strong><br><img src-t="./img/chars.png"width="290"height="46"alt="chars.png"></p><p>まず簡単な例を示します。次のオブジェクトは、キャラクタパターン$pat_chars+0と$pat_chars+1を５フレームごとに交互に表示します。</p><h3 id="例1">例1</h3><pre>
extends SpriteChar;
a=<a href="./rf-spritechar#spritecharnewanimation">newAnimation</a>();
a.<a href="./rf-animationadaptor#animationadaptorloop">loop</a>($pat_chars+0,$pat_chars+1,5);
wait();
</pre><p>※ <a href="./rf-spritechar#spritecharnewanimation">newAnimation</a>メソッド, <a href="./rf-animationadaptor#animationadaptorloop">loop</a>メソッドの説明も参照してください。</p><p>次のオブジェクトは、カーソルキーを使って歩きながら移動するオブジェクトです。</p><h3 id="例2">例2</h3><pre><code>extends SpriteChar;

a=newAnimation();
while(1) {
  a.pause(); // 動いていないときはアニメーションを止める。
  // 各カーソルキーが押されたとき、アニメーションを設定する。 左右移動の場合fによって向きも指定する。
  if (getkey(39)&gt;0) {a.loop($pat_chars+2,$pat_chars+3,3); f=0; x+=3;}  
  if (getkey(37)&gt;0) {a.loop($pat_chars+2,$pat_chars+3,3); f=1; x-=3;} 
  if (getkey(40)&gt;0) {a.loop($pat_chars+0,$pat_chars+1,3); y+=3;}
  if (getkey(38)&gt;0) {a.loop($pat_chars+4,$pat_chars+5,3); y-=3;}
  update();
}
</code></pre><p>※ アニメーションさせるコマ数が３つ以上の場合、最初のパターンを１番目の引数、最後のパターンを２番目の引数に指定します（途中のパター ンは指定しません）</p><h3 id="メソッド一覧">メソッド一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="#animationadaptorplay">play</a></td><td>指定したアニメーションを１回だけ実行します。</td></tr><tr><td><a href="#animationadaptorloop">loop</a></td><td>指定したアニメーションを繰り返し実行します。</td></tr><tr><td><a href="#animationadaptorswing">swing</a></td><td>指定したパターンの間を往復するアニメーションを実行します。</td></tr><tr><td><a href="#animationadaptorpause">pause</a></td><td>アニメーションを一時停止します。</td></tr><tr><td><a href="#animationadaptorresume">resume</a></td><td>pauseメソッドで停止したアニメーションを再開します。</td></tr></tbody></table><hr><h2 id="animationadaptorplay">AnimationAdaptor.play</h2><p>指定したアニメーションを１回だけ実行します。</p><p><strong>書式</strong></p><pre><code>play(from,to,spd) 
</code></pre><ul><li><strong>from</strong><br>&emsp;アニメーションの最初のキャラクタパターン</li><li><strong>to</strong><br>&emsp;アニメーションの最後のキャラクタパターン</li><li><strong>spd</strong><br>&emsp;アニメーション速度( spdフレームにつき1パターン進む 。 1が最速 )</li></ul><p><strong>例1</strong></p><pre><code>extends SpriteChar;
anim=newAnimation();
anim.play($Pat_Bomb+3,$Pat_Bomb+6,3);
wait();
</code></pre><p>▲ このオブジェクトは、図1ように$Pat_Bomb+3から$Pat_Bomb+6までを順番に表示します。</p><p><img src-t="./img/bpats3.png"width="406"height="96"alt="bpats3.png"></p><hr><h2 id="animationadaptorloop">AnimationAdaptor.loop</h2><p>指定したアニメーションを繰り返し実行します。</p><p><strong>書式</strong></p><pre><code>loop(from,to,spd) 
</code></pre><ul><li><strong>from</strong><br>&emsp;アニメーションの最初のキャラクタパターン</li><li><strong>to</strong><br>&emsp;アニメーションの最後のキャラクタパターン</li><li><strong>spd</strong><br>&emsp;アニメーション速度( spdフレームにつき1パターン進む 。 1が最速 )</li></ul><p><strong>例1</strong></p><pre><code>extends SpriteChar;
anim=newAnimation();
anim.loop($Pat_Sample+4,$Pat_Sample+6,3);
wait();
</code></pre><p>▲ このオブジェクトは、図1のように$Pat_Sample+4から$Pat_Sample+6までを順番に表示し、再び$Pat_Sample+4に戻るという動作を繰り返 します。</p><p><img src-t="./img/bpats4.png"width="381"height="86"alt="bpats4.png"></p><hr><h2 id="animationadaptorswing">AnimationAdaptor.swing</h2><p>アニメーションを繰り返し実行します。指定したパターンの間を往復するアニメーションを実行します。</p><p><strong>書式</strong></p><pre><code>swing(from,to,spd)
</code></pre><ul><li><strong>from</strong><br>&emsp;アニメーションの最初のキャラクタパターン</li><li><strong>to</strong><br>&emsp;アニメーションの最後のキャラクタパターン</li><li><strong>spd</strong><br>&emsp;アニメーション速度( spdフレームにつき1パターン進む 。 1が最速 )</li></ul><p><strong>例1</strong></p><pre><code>extends SpriteChar;
anim=newAnimation();
anim.swing($Pat_Sample+4,$Pat_Sample+6,3);
wait();
</code></pre><p>このオブジェクトは、次の順番でパターンを切り替えます、この動作を繰り返します。</p><p>$Pat_Sample+4 → $Pat_Sample+5 → $Pat_Sample+6 → $Pat_Sample+5 → 再び$Pat_Sample+4...</p><p><img src-t="./img/bpats2.png"width="381"height="86"alt="bpats2.png"></p><hr><h2 id="animationadaptorpause">AnimationAdaptor.pause</h2><p>アニメーションを一時停止します。</p><p><strong>書式</strong></p><pre><code>pause()
</code></pre><hr><h2 id="animationadaptorresume">AnimationAdaptor.resume</h2><p>pauseメソッドで停止したアニメーションを再開します。</p><p><strong>書式</strong></p><pre><code>resume()
</code></pre><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-angle-sin-cos-dist"class="pagediv"title2="命令リファレンス - angle,sin,cos,distの関係 - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="anglesincosdistの関係">angle,sin,cos,distの関係</h2><p><a href="./rf-object#objectangle">angle</a>、<a href="./rf-object#objectsin">sin</a>、<a href="./rf-object#objectcos">cos</a>、<a href="./rf-object#objectdist">dist</a>の間には次のような関係が成り立ちます。</p><ul><li>d =<a href="./rf-object#objectdist">dist</a>(dx,dy)</li><li>a =<a href="./rf-object#objectangle">angle</a>(dx,dy)</li><li>dx=<a href="./rf-object#objectcos">cos</a>( a )* d</li><li>dy=<a href="./rf-object#objectsin">sin</a>( a )* d</li></ul><p><img src-t="./img/theta.png"width="200"height="200"alt="theta.png"></p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="rf-abstracthashtable"class="pagediv"title2="命令リファレンス - AbstractHashtable - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="abstracthashtableクラス">AbstractHashtableクラス</h2><p><a href="./rf-hashtable">Hashtable</a>、<a href="./rf-lighthashtable">LightHashtable</a>の親クラスです。</p><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="reference"class="pagediv"title2="命令リファレンス - Tonyu1 Wiki"><p><a href="./">Wikiトップ</a></p><h2 id="命令リファレンス">命令リファレンス</h2><p><a href="./reference-use">命令リファレンス:用途別</a></p><h3 id="文法">文法</h3><p><a href="./rf-assign">代入</a> <a href="./rf-arithmetic">算術演算</a> <a href="./rf-assign-oper">演算代入</a> <a href="./rf-variable">変数</a> <a href="./rf-operator">.演算子</a><br><a href="./rf-if">if</a> <a href="./rf-while">while</a> <a href="./rf-break">break</a> <a href="./rf-switch">switch</a> <a href="./rf-comment">注釈(コメントアウト)</a><br><a href="./rf-for">for</a> <a href="./rf-for-in">for..in</a> <a href="./rf-for-chars">for (xx in $chars)</a><br><a href="./rf-method-call">メソッドの呼び出し</a> <a href="./rf-method-define">メソッドの定義</a> <a href="./rf-return">return</a><br><a href="./rf-extends">extends</a> <a href="./rf-is">is</a><br><a href="./rf-this">this</a> <a href="./rf-null">null</a></p><h3 id="グローバル変数一覧">グローバル変数一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="./rf-mouse-xy">$mouseX<br>$mouseY</a></td><td>マウスカーソルの位置を返します。</td></tr><tr><td><a href="./rf-screen-wh">$screenWidth<br>$screenHeight</a></td><td>ウィンドウの幅や高さを取得・設定できます。</td></tr><tr><td><a href="./rf-view-xy">$viewX<br>$viewY</a></td><td><a href="./rf-map#mapscrollto">$map.scrollTo</a>でスクロールした位置を得ます。</td></tr><tr><td><a href="./rf-window-xy">$windowX<br>$windowY</a></td><td>ウィンドウの位置を得たり、ウィンドウの移動を行います。</td></tr><tr><td><a href="./rf-fullscreen">$fullScreen</a></td><td>フルスクリーンで起動したかどうか判定できます。</td></tr><tr><td><a href="./rf-display-wh">$displayWidth, $_displayRealWidth<br>$displayHeight, $_displayRealHeight<br>$_displayFrequency, $_displayColor</a></td><td>モニターの解像度・リフレッシュレート・色数を取得します。</td></tr><tr><td><a href="./rf-getosversion">$osPlatformId, $osMajorVer,<br>$osMinorVer, $osBuildNumber</a></td><td>Windowsのバージョンを返します。</td></tr><tr><td><a href="./rf-fps-rps">$_fps, $_rps</a></td><td>FPSやRPS(実行速度)を取得できます。</td></tr><tr><td><a href="./rf-window-active">$windowActive</a></td><td>Tonyuがアクティブかを返します。</td></tr></tbody></table><h3 id="オブジェクト・クラス一覧">オブジェクト・クラス一覧</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="./rf-inputbox">$InputBox</a></td><td>テキストを入力するためのウィンドウを表示します</td></tr><tr><td><a href="./rf-texteditor">$TextEditor</a></td><td><a href="./rf-inputbox">$InputBox</a>より小型の、テキスト入力ウィンドウを表示します。</td></tr><tr><td><a href="./rf-map">$map</a></td><td>マップパターンの設定や取得、画面のスクロールを行います</td></tr><tr><td><a href="./rf-math">$Math</a></td><td>高度な数学関数を提供します</td></tr><tr><td><a href="./rf-mplayer">$mplayer</a></td><td>音楽、効果音の制御を行います</td></tr><tr><td><a href="./rf-mousemanager">$mouseManager</a></td><td>マウスの制御(マウスカーソルの強制移動、マウスの非表示など)を行います。</td></tr><tr><td><a href="./rf-options">$Options</a></td><td>各種設定を行います</td></tr><tr><td><a href="./rf-panel-g">$panel</a></td><td>自動的に作成される<a href="./rf-panel">Panel</a>クラスのオブジェクトです。</td></tr><tr><td><a href="./rf-projectmanager">$projectManager</a></td><td>ページの読み込みを行います</td></tr><tr><td><a href="./rf-ranking">$ranking</a></td><td>ネットランキングCGIの呼び出しを行います</td></tr><tr><td><a href="./rf-selectbox">$SelectBox</a></td><td>選択肢を表示するダイアログボックスです</td></tr><tr><td><a href="./rf-system">$System</a></td><td>システムの終了などを行います。</td></tr><tr><td><a href="./rf-window">$window</a></td><td>ウィンドウの制御を行います</td></tr><tr><td><a href="./rf-abstracthashtable">AbstractHashtable</a></td><td><a href="./rf-hashtable">Hashtable</a>、<a href="./rf-lighthashtable">LightHashtable</a>の親クラスです。</td></tr><tr><td><a href="./rf-animationadaptor">AnimationAdaptor</a></td><td>AnimationAdaptorとは、キャラクタパターンを次々に変化させることによるアニメーションを簡単に実現するためのオブジェクトです。</td></tr><tr><td><a href="./rf-array">Array</a></td><td>Array(配列)クラスのオブジェクトには、複数の値（要素）を格納することができます。</td></tr><tr><td><a href="./rf-checkbox">CheckBox</a></td><td>チェックボックスを作成します</td></tr><tr><td><a href="./rf-dxchar">DXChar</a></td><td>DXCharクラスのオブジェクトは、ビットマップパターンの半透明、回転拡大縮小表示が可能です</td></tr><tr><td><a href="./rf-filereader">FileReader</a></td><td>ファイルからデータを読み込みます。ファイルについては<a href="./rf-file-handling">ファイルの扱いについて</a>を参照してください</td></tr><tr><td><a href="./rf-filewriter">FileWriter</a></td><td>ファイルにデータを書き出します。</td></tr><tr><td><a href="./rf-framemanager">FrameManager</a></td><td>１フレームに毎に特別な処理を行いたい場合に使うオブジェクトです</td></tr><tr><td><a href="./rf-hashtable">Hashtable</a></td><td>複数の値（要素）を入れることが可能なオブジェクトです。各要素へのアクセスにはキーと呼ばれる値を用います。</td></tr><tr><td><a href="./rf-joystick">Joystick</a></td><td>ジョイスティックの入力を調べます</td></tr><tr><td><a href="./rf-lighthashtable">LightHashtable</a></td><td><a href="./rf-hashtable">ハッシュテーブル</a>の一種で、処理速度が速い代わりに、キーに文字列が使えません。</td></tr><tr><td><a href="./rf-matrix">Matrix</a></td><td>2次元配列を格納するオブジェクトです。</td></tr><tr><td><a href="./rf-object">Object</a></td><td>すべてのオブジェクトの親クラスです。Objectクラスのメソッドはどのクラスからも利用できます。</td></tr><tr><td><a href="./rf-panel">Panel</a></td><td>通常の描画メソッド(<a href="./rf-sprite#spritedrawtext">drawText</a>,<a href="./rf-sprite#spritedrawline">drawLine</a>,<a href="./rf-sprite#spritedrawsprite">drawSprite</a>,<a href="./rf-sprite#spritefillrect">fillRect</a>)では、描画されたものは１フレームごとに消去されてしまいます。一度描画したグラフィックスを消さないでおくときは、パネルを使うと便利です。</td></tr><tr><td><a href="./rf-panelchar">PanelChar</a></td><td>任意の図形（線、四角形、文字などの組み合わせ)が描けるオブジェクトです</td></tr><tr><td><a href="./rf-plainchar">PlainChar</a></td><td>画面上に表示されるオブジェクト(<a href="./rf-spritechar">SpriteChar</a>、<a href="./rf-dxchar">DXChar</a>、<a href="./rf-textchar">TextChar</a>、<a href="./rf-secretchar">SecretChar</a>)の親クラスです。</td></tr><tr><td><a href="./rf-radiobutton">RadioButton</a></td><td>ラジオボタンを作成します</td></tr><tr><td><a href="./rf-secretchar">SecretChar</a></td><td>SecretCharクラスのオブジェクトは、実行中は表示されません。（設計時には表示されます）</td></tr><tr><td><a href="./rf-spritechar">SpriteChar</a></td><td>SpriteCharクラスのオブジェクトは、ビットマップグラフィックスを表示することができます。</td></tr><tr><td><a href="./rf-sprite">Sprite</a></td><td>画面上に出現するすべてのオブジェクト(<a href="./rf-plainchar">PlainChar</a>クラス)の親クラスです。描画命令などが定義されています</td></tr><tr><td><a href="./rf-string">String</a></td><td>文字列を表すオブジェクトです</td></tr><tr><td><a href="./rf-textchar">TextChar</a></td><td>TextCharクラスのオブジェクトは、文字を表示することができます。</td></tr><tr><td><a href="./rf-timestopper">TimeStopper</a></td><td>時間の停止を行います</td></tr></tbody></table><hr><p><a href="./">Wikiトップ</a></p></div><div style="display:none"id="reference-use"class="pagediv"title2="命令リファレンス：用途別 - Tonyu1 Wiki"><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="命令リファレンス：用途別">命令リファレンス：用途別</h2><h3 id="入出力">入出力</h3><ul><li><a href="./rf-object#objectprint">print</a></li><li><a href="./rf-object#objectgetkey">getkey</a></li><li><a href="./rf-joystick">Joystick</a></li><li><a href="./rf-mouse-xy">$mouseX,$mouseY</a></li><li><a href="./rf-mousemanager">$mouseManager</a></li><li><a href="./rf-inputbox">$InputBox</a><ul><li><a href="./rf-plainchar#plaincharwaitinput">waitInput</a></li></ul></li><li><a href="./rf-texteditor">$TextEditor</a><ul><li><a href="./rf-textchar#textcharedit">TextChar.edit</a></li></ul></li><li><a href="./rf-selectbox">$SelectBox</a><ul><li><a href="./rf-plainchar#plaincharwaitselect">waitSelect</a></li></ul></li></ul><h3 id="オブジェクトの種類">オブジェクトの種類</h3><ul><li>スプライト(<a href="./rf-spritechar">SpriteChar</a>クラス)</li><li>DXスプライト(<a href="./rf-dxchar">DxChar</a>クラス)</li><li>テキスト(<a href="./rf-textchar">TextChar</a>クラス)</li><li>シークレット(<a href="./rf-secretchar">SecretChar</a>クラス)</li><li>パネル(<a href="./rf-panelchar">PanelChar</a>クラス)</li><li>フレームマネージャ(<a href="./rf-framemanager">FrameManager</a>クラス)</li></ul><h3 id="オブジェクト制御">オブジェクト制御</h3><ul><li><a href="./rf-plainchar#plainchardie">die</a></li><li><a href="./rf-plainchar#plaincharupdate">update</a></li><li><a href="./rf-plainchar#plaincharupdateex">updateEx</a></li><li><a href="./rf-plainchar#plaincharwait">wait</a></li><li><a href="./rf-plainchar#plaincharnotify">notify</a></li><li><a href="./rf-object#objectappear">appear</a></li><li><a href="./rf-plainchar#plaincharsetvisible">setVisible</a></li><li><a href="./rf-object#objecttimestop">timeStop</a></li></ul><h3 id="判定">判定</h3><ul><li><a href="./rf-for-chars">for (xx in $chars)</a></li><li><a href="./rf-plainchar#plaincharcrashto">crashTo</a></li><li><a href="./rf-plainchar#plaincharisdead">isDead</a></li><li><a href="./rf-plainchar#plaincharscreenout">screenOut</a></li><li><a href="./rf-plainchar#plainchargetvisible">getVisible</a></li><li><a href="./rf-plainchar#plaincharcrashtoline">crashToLine</a></li></ul><h3 id="イベント">イベント</h3><ul><li><a href="./rf-plainchar#plaincharonupdate">onUpdate</a></li><li><a href="./rf-plainchar#plaincharonmousedown">onMouseDown</a></li><li><a href="./rf-plainchar#plaincharondie">onDie</a></li><li><a href="./rf-plainchar#plaincharondraw">onDraw</a></li><li><a href="./rf-plainchar#plaincharonappear">onAppear</a></li></ul><h3 id="アニメーション">アニメーション</h3><ul><li><a href="./rf-spritechar#spritecharnewanimation">newAnimation</a></li></ul><h3 id="グラフィックス">グラフィックス</h3><ul><li><a href="./rf-sprite#spritedrawtext">drawText</a></li><li><a href="./rf-sprite#spritesetfont">setFont</a></li><li><a href="./rf-sprite#spritedrawline">drawLine</a></li><li><a href="./rf-sprite#spritefillrect">fillRect</a></li><li><a href="./rf-object#objectcolor">color</a></li><li><a href="./rf-object#objectcolorhsl">colorHSL</a></li><li><a href="./rf-object#objectgetred">getRed</a></li><li><a href="./rf-object#objectgetgreen">getGreen</a></li><li><a href="./rf-object#objectgetblue">getBlue</a></li><li><a href="./rf-sprite#spritedrawsprite">drawSprite</a></li><li><a href="./rf-sprite#spritedrawdxsprite">drawDxSprite</a></li><li><a href="./rf-sprite#spritecentertext">centerText</a></li><li><a href="./rf-sprite#spritedrawverticaltext">drawVerticalText</a></li><li><a href="./rf-sprite#spritedrawpolygon">drawPolygon</a></li><li><a href="./rf-sprite#spritedrawrect">drawRect</a></li><li><a href="./rf-sprite#spritedrawrectdx">drawRectDx</a></li><li><a href="./rf-sprite#spritedrawtriangle">drawTriangle</a></li><li><a href="./rf-sprite#spritegradationline">gradationLine</a></li><li><a href="./rf-sprite#spritegradationrect">gradationRect</a></li><li><a href="./rf-sprite#spritegradationtext">gradationText</a></li><li><a href="./rf-panel">パネルの使い方</a></li></ul><h3 id="マップ">マップ</h3><ul><li><a href="./rf-map">$map</a><ul><li><a href="./rf-map#mapset">$map.set</a></li><li><a href="./rf-map#mapget">$map.get</a></li></ul></li></ul><h3 id="画面制御">画面制御</h3><ul><li><a href="./rf-map#mapscrollto">$map.scrollTo</a></li><li><a href="./rf-view-xy">$viewX,$viewY</a></li><li><a href="./rf-plainchar#plainchargetscreenx">getScreenX</a>,<a href="./rf-plainchar#plainchargetscreeny">getScreenY</a></li><li><a href="./rf-screen-wh">$screenWidth,$screenHeight</a>,<a href="./rf-window#windowsizeable">$window.sizeable</a></li><li><a href="./rf-window-xy">$windowX,$windowY</a></li><li><a href="./rf-map#mapsetbgcolor">$map.setBGColor</a></li></ul><h3 id="ページ制御">ページ制御</h3><ul><li><a href="./rf-projectmanager#projectmanagerloadpage">$projectManager.loadPage</a></li></ul><h3 id="サウンド">サウンド</h3><ul><li><a href="./rf-mplayer#mplayerplay">$mplayer.play</a></li><li><a href="./rf-mplayer#mplayerstop">$mplayer.stop</a></li></ul><h3 id="数学関数">数学関数</h3><ul><li><a href="./rf-math">$Math</a></li><li><a href="./rf-object#objectrandomize">randomize</a></li><li><a href="./rf-object#objectrnd">rnd</a></li><li><a href="./rf-object#objectabs">abs</a></li><li><a href="./rf-object#objectsin">sin</a></li><li><a href="./rf-object#objectcos">cos</a></li><li><a href="./rf-object#objectangle">angle</a></li><li><a href="./rf-object#objectdist">dist</a></li><li><a href="./rf-object#objectanglediff">angleDiff</a></li><li><a href="./rf-object#objecttrunc">trunc</a></li><li><a href="./rf-object#objectfloor">floor</a></li><li><a href="./rf-object#objectvalueof">valueOf</a></li><li><a href="./rf-object#objectamod">amod</a></li></ul><h3 id="配列">配列</h3><ul><li><a href="./rf-array">Array</a></li></ul><h3 id="ハッシュテーブル">ハッシュテーブル</h3><ul><li><a href="./rf-hashtable">Hashtable</a></li></ul><h3 id="文字列">文字列</h3><ul><li><a href="./rf-string">String</a><ul><li><a href="./rf-string#%E6%96%87%E5%AD%97%E5%88%97%E7%B5%90%E5%90%88">文字列結合 +演算子</a></li><li><a href="./rf-string#%E6%96%87%E5%AD%97%E5%88%97%E6%AF%94%E8%BC%83">文字列比較 ==演算子</a></li><li><a href="./rf-string#stringlength">String.length</a></li><li><a href="./rf-string#stringsubstring">String.substring</a></li><li><a href="./rf-string#stringsplit">String.split</a></li></ul></li></ul><h3 id="ファイル">ファイル</h3><ul><li><a href="./rf-file-handling">ファイルの扱いについて</a></li><li><a href="./rf-filereader">FileReader</a></li><li><a href="./rf-filewriter">FileWriter</a></li></ul><h3 id="ネットランキング">ネットランキング</h3><ul><li><a href="./rf-ranking#rankingsetparam">$ranking.setParam</a></li><li><a href="./rf-ranking#rankingopenbrowser">$ranking.openBrowser</a></li></ul><h3 id="設定">設定</h3><ul><li><a href="./rf-options#optionsset">$Options.set</a></li><li><a href="./rf-options#optionsget">$Options.get</a></li></ul><hr><p><a href="./reference">命令リファレンス</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="pre-release"class="pagediv"title2="Tonyu1 プレリリースバージョン - Tonyu1 Wiki"><p><a href="./download">ダウンロード</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="tonyu1-プレリリースバージョン">Tonyu1 プレリリースバージョン</h2><p>開発中のバージョンを一旦公開しています。</p><p><a href="./dl/Tonyu1_301_2022_0916.zip">Tonyu1_301_2022_0916.zip</a></p><ul><li>細かい修正<ul><li>wavの再生処理を軽量化<ul><li>stopSE無効＆volumeLimiter無効の場合に、処理軽量化するよう実装</li><li>モノラルwavしかないときはモノラル再生にして軽量化</li></ul></li><li>mzoでpcm(wav)音源が上手くならないのを修正（Tonyu1.30で発生）</li><li>速いCPUでloopMode==0&amp;&amp;sleepTime==0の時、mzoの音が伸びたような音になるので修正</li><li>loopMode==0&amp;&amp;sleepTime==0の時、非アクティブになってもスリープがかからないので修正</li><li>loopMode==2を追加<ul><li>loopMode==0(Busy Loop)とほぼ同じだが、FPSが維持できているときはsleepTime=1、FPSが維持できなくなるとsleepTime=0にする</li></ul></li><li>エディタのインデント挙動修正・インデント高速化</li></ul></li></ul><hr><p><a href="./download">ダウンロード</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="index"class="pagediv"title2="Tonyu1 Wiki"><h2 id="tonyu-system-1">Tonyu System 1</h2><p><img src-t="./img/banner.png"width="96"height="41"alt="banner.png"></p><p>2001-2025 (c) Hoge- Ship<br><a href="https://www.tonyu.jp/">https://www.tonyu.jp/</a></p><p>最新版 - Version 1.303（2025-05-05）</p><hr><ul><li><a href="./about">Tonyu1とは</a></li><li><a href="./download">ダウンロード</a></li></ul><hr><ul><li><a href="./get-started">まずはゲームをやってみる</a> - Tonyuでこんなことができます。</li><li><a href="./tutorial">チュートリアル</a> - とりあえずゲームを作ってみたい方はこちらから</li><li><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a></li><li><a href="./reference">命令リファレンス</a></li><li><a href="./error-mes">エラーメッセージ</a></li><li><a href="./html/faq.html">FAQ</a></li></ul><hr><ul><li><a href="./about2">Tonyu Systemについて</a></li><li><a href="./thanks">謝辞</a></li></ul><hr></div><div style="display:none"id="get-started"class="pagediv"title2="まずはゲームをやってみる - Tonyu1 Wiki"><p><a href="./">Wikiトップ</a></p><h2 id="まずはゲームをやってみる">まずはゲームをやってみる</h2><p>Tonyuはアクションゲームを作ることができます。まずどんなゲームができるのか、サンプルゲームをやって確かめてみましょう。</p><p>起動画面の「最近使ったファイル：」のどれか１つをクリックしましょう</p><p><img src-t="./img/samples.png"width="338"height="277"alt="samples.png"></p><p>しばらくすると、ゲーム画面が開きます。ここで F9を押すとゲーム開始です。</p><ul><li>どのゲームも基本的に使用するのはマウスおよびカーソルキー、スペースキーのみです</li><li>F3でポーズがかけられます。</li><li>F2でゲーム終了です。リプレイは F9です</li></ul><p>他のゲームをやるには、「ファイル」＞「メインメニュー」でメニューを表示させてください。</p><p><img src-t="./img/return-main.png"width="268"height="272"alt="returnMain.png"></p><hr><p><a href="./">Wikiトップ</a></p></div><div style="display:none"id="error-mes"class="pagediv"title2="エラーメッセージ - Tonyu1 Wiki"><p><a href="./">Wikiトップ</a></p><h2 id="エラーメッセージ">エラーメッセージ</h2><p>プログラムに書き間違えがあったり、実行中に異常な動作をした場合は、次のようなエラーメッセージが表示されます。</p><p><img src-t="./img/errwnd.png"width="781"height="163"alt="errwnd.png"></p><p>エラーが発生するとエディタが表示され、エラーが起きた場所にカーソルが移動するので、原因を調べてプログラムを訂正してください。</p><h3 id="コンパイルエラー">コンパイルエラー</h3><p>コンパイルエラーは、ページを読み込んだ時や、実行させようとしたときに発生するエラーです。</p><ul><li><strong>「文法エラー」</strong> 文法が正しくありません。例えば文の末尾にセミコロン(;)がないなどです。</li><li><strong>「関数xxxは未定義です」</strong><br>呼び出そうとしている関数は定義されていません。関数の綴りが間違っていないか調べてみましょう。</li></ul><p>例1</p><pre><code>//--ファイルClassA.tonyu--
extends Object;
function test(p) {
 print(p);
}
testo(p);  // 関数testoは未定義です
//--ClassA.tonyu終わり--
</code></pre><ul><li><strong>「循環参照があります」</strong><br>クラスの親子関係が不正です。例えば、 ClassAがClassBの親クラスで、かつClassBがClassAの親クラス であってはいけません。</li></ul><h3 id="実行時エラー">実行時エラー</h3><p>実行時エラーは、プログラム実行中に発生するエラーです。</p><ul><li><strong>「xxxはオブジェクトではないため、関数yyyを呼び出せません」</strong> a.method1(); のように、他のオブジェクトのメソッドを呼び出そうと していますが、aの値がオブジェクトでない（数値やnull）ため メソッドを呼べません。<br>aの値がおかしくなっていないか調べましょう。<br>aの綴りが間違っている場合がよくあります。綴りが間違った変数はnullとみなされます。</li></ul><p>例2</p><pre><code>a=0;
a.run();  // 0はオブジェクトでないため、関数runを呼び出せません
</code></pre><ul><li><strong>「リストのインデックスが範囲を超えています(xx)」</strong> Array型オブジェクトにおいてget,setメソッドなどをもちいたアクセスを行った場合に、要素を指定するための番号(添字)が範囲外です</li></ul><p>例3</p><pre><code>a=new Array();
a.add(&quot;apple&quot;);a.add(&quot;orange&quot;);
b=a.get(3);  // 配列aの要素は２つ（添字は0,1)なのに、添字の番号が3
</code></pre><h3 id="その他のエラー">その他のエラー</h3><ul><li><strong>「モジュールxxxxxのアドレスyyyyでzzzzへの読み込み（書き込み）違反がおきました」</strong></li><li><strong>「参照カウントが負になりました」</strong></li></ul><p>メソッドの呼び出しが無限に行われると発生する場合があります。</p><p>例4</p><pre><code>function test(x) {
  print (x);
  test(x+1); // 永久にtestが呼ばれる
} 
test(3);
</code></pre><p>それ以外の原因としては、Tonyuシステム自身のバグが考えられます。<br>その際は申し訳ありませんが、Tonyuを再起動してください。</p><hr><p><a href="./">Wikiトップ</a></p></div><div style="display:none"id="download"class="pagediv"title2="Tonyu1のダウンロード - Tonyu1 Wiki"><p><a href="./">Wikiトップ</a></p><h2 id="tonyu1のダウンロード">Tonyu1のダウンロード</h2><h3 id="注意">注意</h3><ul><li>ランタイム等に上書き更新する場合は、下記方法で更新してください。（Player.exeを上書きしただけだと、エラーが発生する可能性があります）<ul><li><a href="./start-error-win8-10">ランタイムの更新方法</a></li></ul></li><li>古いTonyu1のゲームで、Windows10,8等で起動しない場合は、最新版に更新すると起動します。<ul><li><a href="./start-error-win8-10">ランタイムの更新方法</a></li></ul></li><li>ver1.29～1.30で仕様変更があり、以前のバージョンと動作が違う場合は、下記を設定してください。<ul><li><a href="./compatibility">互換性の設定</a></li></ul></li><li>Windows10でメニューが文字化けする場合、Windows上の設定「ワールドワイド言語サポートでUnicode UTF-8を使用」を解除してください。<ul><li>「コントロールパネル」→「時計、言語、および地域」→「地域と言語」→「管理」タブ→「システム ロケールの変更」→「ワールドワイド言語サポートでUnicode UTF-8を使用」のチェックを外す</li></ul></li></ul><h3 id="ダウンロード">ダウンロード</h3><!--
#### プレリリースバージョン

[開発中のバージョン](./pre-release)です。
--><h4 id="最新バージョン">最新バージョン</h4><p><a href="./dl/Tonyu1_303_2025_0505.zip">Tonyu1_303_2025_0505.zip</a></p><ul><li>Midiプレイヤー（Kernel/Midiplayer2.exe）で使っているライブラリ（GuruGuruSMF）を更新（4.0.6→4.0.8）</li></ul><h4 id="以前のバージョン">以前のバージョン</h4><p><a href="./dl/Tonyu1_303_2024_0217.zip">Tonyu1_303_2024_0217.zip</a></p><ul><li><a href="./rf-mplayer#mplayerstopse">$mplayer.stopSE</a>の不具合修正（まだ完全に直ってない）</li></ul><p><a href="./dl/Tonyu1_302_2024_0212.zip">Tonyu1_302_2024_0212.zip</a></p><ul><li>デフォルト値変更<ul><li><a href="./rf-mplayer#mplayersetvolumelimiter">$mplayer.setVolumeLimiter</a>　音割れを防ぐ機能<ul><li>1(有効)→0(無効)</li></ul></li><li><a href="./rf-system#systemsetloopmode">$System.setLoopMode</a>　ゲームループ<ul><li>2→1 (mmtimer Loop)</li><li>2は廃止</li></ul></li><li><a href="./rf-mplayer#mplayersetsestopenable">$mplayer.setSeStopEnable</a>　<a href="./rf-mplayer#mplayerstopse">$mplayer.stopSE</a>の有効・無効設定<ul><li>1(有効)→0(無効)</li></ul></li></ul></li><li>ネットランキング<ul><li>URLに「https」も使えるよう修正</li><li>ネットランキングcgiを最近のPerlで動くように修正</li></ul></li><li>処理軽量化</li><li><a href="./rf-mplayer#mplayersetsoundplaymode">$mplayer.setSoundPlayMode(4)</a>で効果音ならなくなる不具合修正</li><li>細かい不具合修正</li></ul><p><a href="./dl/Tonyu1_301_2022_0916.zip">Tonyu1_301_2022_0916.zip</a></p><p>（2024-02-08 更新）プレリリース版だったものを最新版としてリリース</p><ul><li>細かい修正<ul><li>wavの再生処理を軽量化<ul><li>stopSE無効＆volumeLimiter無効の場合に、処理軽量化するよう実装</li><li>モノラルwavしかないときはモノラル再生にして軽量化</li></ul></li><li>mzoでpcm(wav)音源が上手くならないのを修正（Tonyu1.30で発生）</li><li>速いCPUでloopMode==0&amp;&amp;sleepTime==0の時、mzoの音が伸びたような音になるので修正</li><li>loopMode==0&amp;&amp;sleepTime==0の時、非アクティブになってもスリープがかからないので修正</li><li>loopMode==2を追加し、デフォルト値に設定<ul><li>loopMode==0(Busy Loop)とほぼ同じだが、FPSが維持できているときはsleepTime=1、FPSが維持できなくなるとsleepTime=0にする</li></ul></li><li>エディタのインデント挙動修正・インデント高速化</li></ul></li></ul><p><a href="./dl/Tonyu1_30_2022_0804.zip">Tonyu1_30_2022_0804.zip</a></p><ul><li>主な変更<ul><li>効果音を途中停止する<a href="./rf-mplayer#mplayerstopse">$mplayer.stopSE</a>を追加</li><li>オブジェクト大量生成時の点滅防止ライブラリ（<a href="https://www.tonyu.jp/project/viewProject.cgi?mainkey=277&amp;">スーパープロセッサ</a>）を導入（デフォルト有効）</li><li>wavのステレオ対応・音質向上<ul><li>44100Hz8bitモノラル相当 → 44100Hz16bitステレオに音質向上</li></ul></li><li>wav,mzoの音源をDirectSoundに変更<ul><li>wavのレイテンシが短縮</li></ul></li><li>wav,mzoの音量が大きい場合、音割れを防ぐ機能を追加（デフォルト有効）<ul><li><a href="./rf-mplayer#mplayersetvolumelimiter">$mplayer.setVolumeLimiter</a>で設定変更</li></ul></li><li>ランタイム版で起動時のウィンドウサイズや位置を指定する機能を追加<ul><li><a href="./rf-options#optionsgetenv">$Options.getEnv</a>, <a href="./rf-options#optionssetenv">$Options.setEnv</a>を追加</li></ul></li><li>switch文の自動インデントに対応</li></ul></li><li>ver1.30以降に作成したプロジェクトでの仕様変更(<code>targetVersion</code>&gt;=1300の場合)<ul><li>wav,mzoの音量が100%になるよう変更<ul><li>ver1.21～1.29に作られたプロジェクトは、互換性のため音量が50%のままになります</li></ul></li><li>スプライト描画の回転(angle)が１回転256段階だったのを36000段階に向上<ul><li>ver1.29以前に作られたプロジェクトでは、互換性のため256段階のままになります</li><li><a href="rf-system#systemsetspriteangleaccuracy">$System.setSpriteAngleAccuracy</a>で精度を切り替え可能</li></ul></li><li><a href="rf-object#objectsin">sin</a>,<a href="rf-object#objectcos">cos</a>の精度を0～360°で360段階だったのを36000段階に向上<ul><li>ver1.29以前に作られたプロジェクトは、互換性のため360段階のままになります</li><li><a href="rf-math#mathsetsincosaccuracy">$Math.setSinCosAccuracy</a>で精度を切り替え可能</li></ul></li></ul></li><li><a href="./compatibility">互換性の設定</a>を追加<ul><li>基本的には設定の必要はありませんが、オプションとして用意しました</li><li><a href="./rf-options#optionsset">$Options.set</a>に関連項目を追加</li></ul></li><li>仕様変更<ul><li><a href="./rf-options#optionsset">sleep_time</a>はビジーループ設定時（<a href="./rf-system#systemsetloopmode">$System.setLoopMode(0)</a>）のみ効くよう変更<ul><li>現在のマルチメディアタイマー動作ではCPU負荷が低く、基本的に<a href="./rf-options#optionsset">sleep_time</a>設定の必要がないため仕様変更</li><li>どうしても変更したい場合は<a href="./rf-system#systemsetsleeptimemmt">$System.setSleepTimeMMT</a>で変更できます</li></ul></li><li><a href="./rf-mplayer#mplayersetdelay">$mplayer.setDelay</a>は<a href="./rf-mplayer#mplayersetsoundplaymode">$mplayer.setSoundPlayMode(1or2)</a>に設定時のみ効くよう変更<ul><li><a href="./rf-mplayer#mplayersetsoundplaymode">$mplayer.setSoundPlayMode(3)</a>がデフォルト設定であり、自動でDelayを調整できるようになったため仕様変更</li><li>手動で変更したい場合は<a href="./rf-mplayer#mplayersetdelayds">$mplayer.setDelayDs</a>で変更できます</li></ul></li><li><a href="./rf-window#windowsetdrawmode">$window.setDrawMode</a>はWindows Vista以降で動作時は効かないよう変更<ul><li>Windows Vista以降は描画方式A意外だと、重かったりカクついたりするため、メソッドからは変更できないようにしました<ul><li>どうしても変更したい場合は<a href="./rf-window#windowsetdrawmodeforcemode">$window.setDrawModeForceMode</a>で効くように変更できます</li></ul></li><li>ウィンドウ上部のメニューから選択した場合は変更できます</li><li>Windows XP以前では<a href="./rf-window#windowsetdrawmode">$window.setDrawMode</a>は効きます</li></ul></li></ul></li><li>細かい修正<ul><li>default.tonyuprjに<code>targetVersion</code>を自動追記する機能追加<ul><li>Tonyuのどのバージョンから対象プロジェクトを使っていたかを記録します</li><li>互換性の自動維持の判定に使用されます</li><li><code>targetVersion</code>が記録されていない場合、<code>savedVersion</code>の値をコピーする(開発環境版)か、<code>savedVersion</code>の値を<code>targetVersion</code>として使います(ランタイム版)</li></ul></li><li><a href="./rf-map#mapscrollto">$map.scrollTo</a>でMap表示がおかしくなる場合があるのを修正<ul><li>Tonyu1_29_2021_0705から発生</li><li>ゲーム画面サイズが奇数、かつ画面サイズ以上の移動をした後に左上スクロールすると発生</li></ul></li><li>wav再生終了直後にノイズがなるのを修正</li><li>実行後の初回wav再生で音飛びするのを修正</li><li>11025Hz, 22050Hz, 44100Hz以外のwavの再生速度が速くなる不具合を修正</li><li>44100Hzを超えるwavを鳴らすとエラー発生する不具合を修正<ul><li>ただし44100Hzを超えるwavを鳴らしても44100Hzの音質で再生されます</li></ul></li><li>wavの同時発音数を9→50に変更</li><li><a href="./rf-options#optionsset">deactivation_pause</a>が1の時、タスクバーから最小化した場合、一時停止しない不具合を修正</li><li>起動時プロジェクト読み込み中にエラーした場合、以降ウィンドウのメニューが増えなくなるので修正</li><li>Copyrightの年を更新</li></ul></li><li>追加したメソッド一覧<ul><li><a href="./rf-mplayer#mplayerstopse">$mplayer.stopSE</a></li><li><a href="./rf-mplayer#mplayersetdelayds">$mplayer.setDelayDs</a></li><li><a href="./rf-mplayer#mplayergetautodelayds">$mplayer.getAutoDelayDs</a></li><li><a href="./rf-mplayer#mplayerresetautodelayds">$mplayer.resetAutoDelayDs</a></li><li><a href="./rf-mplayer#mplayersetsoundplaymode">$mplayer.setSoundPlayMode</a></li><li><a href="./rf-mplayer#mplayersetbasevolume">$mplayer.setBaseVolume</a></li><li><a href="./rf-mplayer#mplayersetvolumelimiter">$mplayer.setVolumeLimiter</a></li><li><a href="./rf-mplayer#mplayersetseloopenable">$mplayer.setSeLoopEnable</a></li><li><a href="./rf-mplayer#mplayersetsestopenable">$mplayer.setSeStopEnable</a></li><li><a href="./rf-options#optionsgetenv">$Options.getEnv</a></li><li><a href="./rf-options#optionssetenv">$Options.setEnv</a></li><li><a href="./rf-system#systemsetsleeptimemmt">$System.setSleepTimeMMT</a></li><li><a href="./rf-system#systemsetprocesssingle">$System.setProcessSingle</a></li><li><a href="./rf-system#systemsetlegacyframerate">$System.setLegacyFrameRate</a></li><li><a href="./rf-system#systemsetspriteangleaccuracy">$System.setSpriteAngleAccuracy</a></li><li><a href="./rf-math#mathsetsincosaccuracy">$Math.setSinCosAccuracy</a></li><li><a href="./rf-window#windowsetdrawmodeforcemode">$window.setDrawModeForceMode</a></li></ul></li></ul><p><a href="./dl/Tonyu1_29_2021_1212.zip">Tonyu1_29_2021_1212.zip</a></p><ul><li>細かい修正<ul><li>マルチメディアタイマーの処理軽量化</li><li>タイマー分解能変更メソッド追加<ul><li><a href="./rf-system#systemsettimerresolution">$System.setTimerResolution</a></li></ul></li><li>ゲームループ変更メソッド追加<ul><li><a href="./rf-system#systemsetloopmode">$System.setLoopMode</a></li></ul></li><li>スタッタリング防止自動調整メソッド追加<ul><li><a href="./rf-system#systemsetautoadjustscanline">$System.setAutoAdjustScanLine</a></li></ul></li></ul></li><li>グローバル変数追加<ul><li>Windowsのビルド番号、<a href="./rf-getosversion">$osBuildNumber</a>を追加<ul><li>Windows10とWindows11を判定できる</li></ul></li></ul></li><li>ネットランキングのURLを更新</li></ul><p><a href="./dl/Tonyu1_29_2021_0730.zip">Tonyu1_29_2021_0730.zip</a></p><ul><li>細かい修正<ul><li>Win98SEでVSyncが効いてないので修正。（リフレッシュレートが取得できないので、60Hzと仮定してVSyncを行う）</li><li>内部処理のディスプレイ情報取得を５秒１回に変更</li></ul></li></ul><p><a href="./dl/Tonyu1_29_2021_0705.zip">Tonyu1_29_2021_0705.zip</a></p><ul><li>既存不具合の修正、細かい修正、処理速度改善など<ul><li>$map.scrollTo()の高速化<ul><li>$map.scrollTo()でスクロール量が多い場合、処理が重いので軽量化</li></ul></li><li>特定のウィンドウサイズでTonyuを終了すると、エラーが大量に出る不具合を修正<ul><li><a href="http://www.tonyu.jp/joyful/joyful.cgi?mode=res&amp;no=13705">BBS No.13705</a>に該当</li></ul></li><li>起動中にクリックするとエラーが出る不具合を修正</li><li>ランタイム作成時Cookies.iniを残さない<ul><li>ランタイムではCookies.iniの設定に関わらず、起動時ステータスバーを表示しないよう変更</li></ul></li><li>Tonyu.exeと同じ場所にあるPlayer.exeを動作するように修正</li><li>設計中のドラッグ移動・マップ移動を滑らかにした</li><li>登録系のリスト削除で、最後の１項目の表示が消えないのを修正</li><li>内部のSleep処理のタイミングを変更</li><li>アプリ終了判定を変更</li></ul></li><li>グローバル変数追加<ul><li>Tonyuがアクティブ状態か取得する、<a href="./rf-window-active">$windowActive</a>を追加</li></ul></li></ul><p><a href="./dl/Tonyu1_29_2021_0630.zip">Tonyu1_29_2021_0630.zip</a></p><ul><li>数時間起動し続けると重くなって、2～4時間後にフリーズまたは強制終了になる不具合を修正（Tonyu1_29_2021_0501限定の不具合）</li><li>FPS・RPS表示の小数第２位を、切り捨てから四捨五入に変更</li><li>VSyncやフレームレート制御を調整</li><li>グローバル変数追加<ul><li>実際のディスプレイの縦横ピクセル数、<a href="./rf-display-wh">$_displayRealWidth, $_displayRealHeight</a>を追加</li><li>ディスプレイのリフレッシュレート（周波数）と色数、<a href="./rf-display-wh">$_displayFrequency, $_displayColor</a>を追加</li></ul></li></ul><p><a href="./dl/Tonyu1_29_2021_0501.zip">Tonyu1_29_2021_0501.zip</a></p><ul><li>フレームレート制御の実装を変更<ul><li>ビジーループ＋Sleepから、マルチメディアタイマーに変更</li></ul></li><li>CPU使用率を軽減</li><li>ゲーム画面のカクツキ（スタッタリング）軽減（Windows 8以降、Vista～7のAero有効時）</li><li>カクツキ（ティアリング・スタッタリング）対策用のメソッド追加<ul><li><a href="./rf-system#systemsetvsync">$System.setVSync</a></li><li><a href="rf-system#systemsetadjustscanline">$System.setAdjustScanLine</a></li></ul></li><li>$System.setFrameRateでFPSを小数単位でも指定できるようにしました<ul><li>$System.setFrameRateのFPS制限を廃止</li></ul></li><li>グローバル変数追加<ul><li><a href="./rf-fps-rps">$_fps, $_rps</a>追加（FPSとRPSが実数で取得できる）</li><li>ディスプレイの縦横ピクセル数、<a href="./rf-display-wh">$displayWidth, $displayHeight</a>を追加</li><li>Windowsのバージョン値、<a href="./rf-getosversion">$osPlatformId、$osMajorVer、$osMinorVer</a>を追加</li></ul></li><li>効果音のDelayをOS毎に調整<ul><li>XP以前は1350、Vista, 7は2400、8, 8.1は2500、10は3000</li></ul></li><li>描画方式のデフォルト設定を、XP以前はB方式、Vista以降はA方式に変更</li><li>ウィンドウの見た目が変化しました</li><li>ランタイムではF3キーで一時停止禁止</li><li>ウィンドウ移動中などでもゲームが止まらなくなりました</li><li>フレームレート(FPS)がより正確になりました</li><li>パフォーマンスウィンドウの変更<ul><li>FPS表示変更、RPS（Run Per Second）（実行速度）の表示追加、SleepTimeの表示</li></ul></li><li>非アクティブ時ページロードするとキーが効いてしまうのを防止</li><li>exeにバージョン情報を追加</li></ul><p><a href="./dl/Tonyu1_28_2021_0407.zip">Tonyu1_28_2021_0407.zip</a></p><ul><li>Tonyu1_28_2021_0404で発生した不具合を修正<ul><li>Tonyu.exeにcmmlファイルをD&amp;Dや、cmmlファイルを関連付けして開いた時などに、自動的にプロジェクトを開く機能が効かなくなっていたのを修正</li><li>オプションからサウンドoffにするとエラーが出るのを修正</li></ul></li></ul><p><a href="./dl/Tonyu1_28_2021_0404.zip">Tonyu1_28_2021_0404.zip</a></p><ul><li><a href="./rf-switch">switch文</a>の実装<ul><li>switch、case、defaultは変数名等には使えなくなります</li></ul></li><li>JoyStickの不具合を修正<ul><li>JoyStickを刺して抜いた後、Tonyu1を再起動するとJoyStick取得が重くなる不具合を修正<ul><li><a href="http://www.tonyu.jp/joyful/joyful.cgi?mode=res&amp;no=12342">BBS No.12342</a> に該当</li></ul></li><li>JoyStick１つ接続の時、２つ目のJoyStickのボタンも押下しているように取得される不具合を修正</li><li>getkey()と同じ挙動にしました（getButton()等の取得値は１フレームごとに+1）</li></ul></li><li>ウィンドウが非アクティブ時の挙動修正</li><li>効果音のDelayを3000に変更（Vista以降）</li><li>ファイルを開く・保存するダイアログを新しいタイプに変更（Vista以降）</li><li>エディタ編集時、ゲーム側でキーが反応しないように修正</li><li>エディタの30000バイト制限を廃止（Win9x系は制限を残しました）</li><li>稀にMidi再生・停止が失敗する不具合を軽減</li><li>ウィンドウやUIの大きさ・位置の修正</li><li>文言の修正、URL・年の更新</li></ul><p><a href="./dl/Tonyu1_27_2019_1205.zip">Tonyu1_27_2019_1205.zip</a></p><ul><li><a href="https://www.tonyu.jp/project/viewComment.cgi?mainkey=4513&amp;">Midiプレイヤーの不具合修正</a></li><li>Readme.txtの内容更新</li><li>MidiPlay.exeは現在使っていないので削除</li></ul><p><a href="./dl/Tonyu1_27_2019_0930.zip">Tonyu1_27_2019_0930.zip</a></p><ul><li>Midiプレイヤー（Kernel/Midiplayer2.exe）に<a href="https://www.tonyu.jp/project/viewProject.cgi?mainkey=667&amp;">YellowMusicPlayer</a>を使用するようにしました．</li></ul><p><a href="./dl/Tonyu1_27_2015_0714.zip">Tonyu1_27_2015_0714.zip</a></p><ul><li>描画方式を設定ファイル（Kernel/Cookies.ini）に保存するようにしました</li></ul><p><a href="./dl/Tonyu1_27_2015_0630.zip">Tonyu1_27_2015_0630.zip</a></p><ul><li>$InputBox.open で位置と大きさを指定できるようにしました。</li><li>Mathクラスのpow関数で、乗数が整数の場合に誤差が出る不具合を直しました</li></ul><p><a href="./dl/Tonyu1_27_2015_0213.zip">Tonyu1_27_2015_0213.zip</a></p><ul><li>Windows8 対応パッチを組み込みました</li><li>Player.exeを小さくしました</li><li>Mathクラスに 指数関数・対数関数を追加しました</li></ul><p><a href="./dl/Tonyu1_27_2015_0212.zip">Tonyu1_27_2015_0212.zip</a> ←Player.exeが大きいバージョン</p><p><a href="./dl/Tonyu_patch_for_win8.zip">Tonyu_patch_for_win8.zip</a></p><ul><li>(2015/01/10) Window8で起動しない場合，こちらの実行ファイルに差し替えて下さい</li></ul><p><a href="./dl/Tonyu1_27_2014_0129.zip">Tonyu1_27_2014_0129.zip</a></p><ul><li>$Options.setの sleep_time の動作を変更：設定値をdefault.tonyuprjには書き込まないようにしました。</li></ul><p><a href="./dl/Tonyu1_26_2011_0529.zip">Tonyu1_26_2011_0529.zip</a></p><ul><li>$Options.setに sleep_time を追加</li></ul><p><a href="./dl/Tonyu1_24_090816.zip">Tonyu1_24_090816.zip</a></p><ul><li>同梱のドキュメントをWeb版と同期</li></ul><p><a href="./dl/Tonyu1_24_080704.zip">Tonyu1_24_080704.zip</a></p><ul><li>$mplayer.setVolume メソッドを使った際の効果音の不具合を修正</li></ul><p><a href="./dl/Tonyu1_24_071003.zip">Tonyu1_24_071003.zip</a></p><ul><li>フルスクリーン時にmoveCursor メソッドの位置がずれる不具合を修正</li></ul><p><a href="./dl/Tonyu1_24_070903.zip">Tonyu1_24_070903.zip</a></p><ul><li>$mplayer.setDelayメソッド</li><li>Windows XP ではこの値の規定値は1000， Windows Vista では9000に設定してあります．</li><li>files フォルダ内でサブフォルダ利用可能</li></ul><p><a href="./dl/Tonyu1_23_070422.zip">Tonyu1_23_070422.zip</a></p><ul><li>MIDIプレイヤの変更がランタイムに反映されていなかった不具合を修正</li></ul><p><a href="./dl/Tonyu1_23_070402.zip">Tonyu1_23_070402.zip</a></p><ul><li>MIDIプレイヤを変更</li><li>プロジェクト作成・選択時にドライブを選択可能</li></ul><p><a href="./dl/Tonyu1_22_061020.zip">Tonyu1_22_061020.zip</a></p><ul><li>ヘルプファイルに*.hlp 以外(*.chm等）が指定可能</li></ul><p><a href="./dl/Tonyu1_22_061004.zip">Tonyu1_22_061004.zip</a></p><ul><li>ランタイム作成時，フルスクリーンの選択が無効になる不具合を修正</li></ul><p><a href="./dl/Tonyu1_22_01.exe">Tonyu1_22_01.exe</a></p><ul><li>Sprite.fillPolygon を実行後，他のページを開くとTonyuが強制終了する不具合を修正</li></ul><p><a href="./dl/Tonyu1_22.exe">Tonyu1_22.exe</a></p><ul><li>$System.setStackSize 追加</li><li>Sprite.fillPolygon 追加</li><li>ドキュメントをリニューアル</li><li>for文，while文中におけるエラー位置の指摘方法を改善</li></ul><h3 id="フルスクリーンキット">フルスクリーンキット</h3><p>作成したランタイムをフルスクリーンで動作させることが可能です.</p><p><a href="./dl/fullscreen0_02.zip">fullscreen0_02.zip</a></p><h3 id="古いバージョン">古いバージョン</h3><p><a href="./dl-history">過去のバージョンアップ履歴</a></p><p><a href="./dl/Tonyu1_21Beta.zip">Tonyu1_21Beta.zip</a><br><a href="./dl/Tonyu1_19Beta.exe">Tonyu1_19Beta.exe</a><br><a href="./dl/Tonyu1_1903.exe">Tonyu1_1903.exe</a><br><a href="./dl/Tonyu1_1902.zip">Tonyu1_1902.zip</a><br><a href="./dl/Tonyu1_1902.exe">Tonyu1_1902.exe</a><br><a href="./dl/Tonyu1_18_4.exe">Tonyu1_18_4.exe</a><br><a href="./dl/Tonyu1_18_3.exe">Tonyu1_18_3.exe</a><br><a href="./dl/Tonyu1_18_2.exe">Tonyu1_18_2.exe</a><br><a href="./dl/Tonyu1_18.zip">Tonyu1_18.zip</a><br><a href="./dl/Tonyu1_18.exe">Tonyu1_18.exe</a><br><a href="./dl/Tonyu1_17Patch.zip">Tonyu1_17Patch.zip</a><br><a href="./dl/Tonyu1_17.exe">Tonyu1_17.exe</a><br><a href="./dl/Tonyu1_16Light.exe">Tonyu1_16Light.exe</a><br><a href="./dl/Tonyu1_16.exe">Tonyu1_16.exe</a><br><a href="./dl/Tonyu1_15Light.exe">Tonyu1_15Light.exe</a><br><a href="./dl/Tonyu1_15.exe">Tonyu1_15.exe</a><br><a href="./dl/Tonyu1_14Light.exe">Tonyu1_14Light.exe</a><br><a href="./dl/Tonyu1_14.exe">Tonyu1_14.exe</a><br><a href="./dl/Tonyu1_13Light.exe">Tonyu1_13Light.exe</a><br><a href="./dl/Tonyu1_13.exe">Tonyu1_13.exe</a><br><a href="./dl/Tonyu1_12Light.exe">Tonyu1_12Light.exe</a><br><a href="./dl/Tonyu1_12.exe">Tonyu1_12.exe</a><br><a href="./dl/Tonyu1_11Light.exe">Tonyu1_11Light.exe</a><br><a href="./dl/Tonyu1_11.exe">Tonyu1_11.exe</a><br><a href="./dl/Tonyu1_09Light.exe">Tonyu1_09Light.exe</a><br><a href="./dl/Tonyu1_09.exe">Tonyu1_09.exe</a></p><h2 id="m-two">M-Two</h2><p>M-Twoは音楽作成ツールです。MIDIとは異なり、MMLと呼ばれる言語でテキストファイルを作成することで音楽が演奏できます。<br>演奏される音はMIDIとは一風変わった、ファミコン風味の懐かしい音色です。<br>作成した音楽を自作のプログラムから使えるドライバMEZONETも用意してあります。</p><p>Tonyu System のBGMとして利用できます。</p><p><a href="./dl/mtz12.zip">mtz12.zip</a> (Ver 1.2)<br><a href="./dl/mtz11.zip">mtz11.zip</a> (Ver 1.1)</p><hr><p><a href="./">Wikiトップ</a></p></div><div style="display:none"id="dl-history"class="pagediv"title2="過去のバージョンアップ履歴 - Tonyu1 Wiki"><p><a href="./download">ダウンロード</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="過去のバージョンアップ履歴">過去のバージョンアップ履歴</h2><p>1.21</p><ul><li>panel.save、 panel.loadメソッドを追加</li><li>$fullScreen 変数を追加</li><li>$Window.setDrawModeメソッド</li><li>スタックオーバーフロー（メソッド呼び出しの繰り返しによるエラー）検知機構追加</li></ul><p>1.1903</p><ul><li>MIDIに関する機能を1.17に完全差し戻し</li></ul><p>1.19(beta2)</p><ul><li>1.18に搭載のMIDIに不具合が生じたため、1.17の仕組みと差し替え</li><li>エディタで編集可能なプログラムサイズを30000Bに制限</li></ul><p>1.18</p><ul><li>クラスのカテゴリわけ機能を追加</li><li>MIDIの演奏前の待ち時間を削減</li><li>CheckBox 追加</li><li>RadioButton 追加</li><li>$Math 追加</li><li>$TextEditor 追加</li><li>TextChar.edit 追加</li><li>Sprite.centerText, Sprite.drawVerticalText, Sprite.drawPolygon, Sprite.drawRect, Sprite.drawRectDx, Sprite.drawTriangle, Sprite.gradationLine, Sprite.gradationRect, Sprite.gradationText 追加</li></ul><p>1.17</p><ul><li>ヘルプ機能をリニューアル</li><li>コード補完機能を追加</li><li>メソッドの定義を任意の場所で可能に</li><li>Object.colorHSLメソッド</li><li>Panel.copyRectメソッド</li><li>Object.amodメソッド</li><li>Sprite.drawBrokenLine、Panel.drawBrokenLineメソッド</li><li>Object.floorメソッド</li><li>Matrixクラス</li><li>Systemクラス</li></ul><p>1.16</p><ul><li>ランタイム実行時にフルスクリーンで表示可能に（別途フルスクリーンキットが必要）</li><li>$panel.drawDXSpriteメソッド追加</li><li>$panel.setTransparentColorメソッド追加</li><li>貼り付け可能なクリップボードデータの上限を4KBに拡張</li></ul><p>1.15</p><ul><li>エディタに置換機能を追加</li><li>$panel.setPixel追加</li><li>$windowX/$windowY変数を追加</li><li>$SelectBox.open $SelectBox.getStatus waitSelectメソッド(はい・いいえ選択ダイアログ)追加</li><li>$map.getBGColorメソッド追加</li><li>$mplayer.playにおいて効果音の音量を設定可能に</li><li>PanelChar::resizeメソッドの説明を追加</li><li>ランタイムアイコンにpngを使用可能に</li></ul><p>1.14</p><ul><li>ランタイム作成時に音楽データがコピーされない不具合を修正。</li><li>ランタイム作成時にfilesフォルダの内容をコピー可能に。</li><li>メッセージウィンドウを追加</li><li>$projectManager.loadPage を実行後、数フレーム処理が続いてしまう不具合を修正。</li><li>$Options.set,$Options.getメソッド追加。「Tonyuがアクティブでないときの実行の一時停止」「Tonyuがアクティブでないときのgetkeyメソッドの無効化」「ページを切り替えたときにBGMを停止しない」を可能に</li><li>「nullはオブジェクトではないので..」というエラーメッセージを「変数xxxは初期化されていないので...」というメッセージに変更。</li><li>absメソッドの説明を追加</li><li>getGreen,getBlue,getRedメソッド追加</li><li>crashToLineメソッド追加</li></ul><p>1.13</p><ul><li>timeStopメソッドを追加</li><li>notifyメソッドによりオブジェクトの速度が２倍になる不具合を修正</li><li>実行開始時のフォントが直前のsetFontメソッドの呼び出し内容によって変化する不具合を修正</li><li>waitInputメソッドを呼び出しによって表示されるウィンドウを右上の&quot;x&quot;によって閉じると処理が抜け出せなくなる不具合を修正</li><li>BGM、効果音を同一プロジェクト内で共有(ページ毎に読み込む必要なし)</li><li>randomizeメソッド、getTimeメソッド追加</li><li>onAppearメソッド追加</li><li>ハッシュテーブル追加</li><li>エラー発生時および検索結果のダブルクリックによるソースコード表示の不具合を修正</li><li>新規ページを作成時に標準で設定されるフォルダをSamplesからProjectsに変更</li></ul><p>1.12修正パッチからの変更点</p><ul><li>BGM、効果音が読み込まれない不具合を修正</li></ul><p>1.12</p><ul><li>パネルオブジェクトを追加。テキスト等の回転に対応</li><li>フレームマネージャを追加</li><li>配列にremove,indexOfメソッド追加、deleteメソッドの戻り値の仕様を変更</li><li>同一引数のgetkeyを１フレームに２回以上呼び出すと押した瞬間の判定ができない不具合を修正</li><li>valueOfメソッドが負の値を表す文字列を変換できない不具合を修正</li><li>エディタ内で範囲を選択することにより選択範囲のみインデントが可能に</li><li>$InputBox, waitInputで表示される入力ウィンドウのプロンプト表示に複数行を表示可能に</li></ul><p>1.11</p><ul><li>起動画面をリニューアル</li><li>ステータスバー設置</li><li>レシピ集追加</li><li>png画像読み込み対応</li><li>文字入力機能($InputBox, waitInput)追加</li><li>ジョイスティック２個使用に対応</li></ul><p>1.09</p><ul><li>APIリファレンスを命令リファレンスに改称。</li><li>代入文、if文、while文、メソッドの説明追加</li><li>extends文、is 演算子の説明追加</li><li>++ , -- 演算子追加</li><li>for文に機能追加</li><li>break文追加</li><li>$mouseManagerの各種メソッド追加,$mouseX,$mouseYを改良。画面外のマウス位置を検知</li></ul><p>1.08</p><ul><li>プログラム内検索機能追加</li><li>サテライトをリニューアル</li><li>MIDI 演奏開始時に処理が止まらないように改良</li><li>ファイル入出力機能を追加</li><li>AnimationAdaptor 追加</li><li>updateExメソッド 追加</li><li>angleDiffメソッド 追加</li><li>valueOfメソッド追加</li><li>/* ... */ スタイルの注釈に対応</li></ul><p>1.07</p><ul><li>ページ切り替え時のクラスのコンパイルを廃止、オブジェクトを破棄しないでのページの切り替えを可能に。</li><li>$mplayer.playで効果音を連続して鳴らすと前の効果音が消える不具合を修正</li><li>テキスト表示を強化。複数行表示対応。 フォント切り替え対応(setFontメソッド)</li><li>APIリファレンスに文字列操作を追加</li><li>オブジェクト一覧、パフォーマンスウィンドウを追加</li><li>screenOut,gotoScreen,getScreenX,getScreenYメソッド追加</li><li>ハイスコア登録CGIのバグを修正</li></ul><p>1.06</p><ul><li>02/3/24 ジョイスティック対応</li><li>3/23 ランタイムのアイコン変更を可能に</li><li>3/23 ツールバーウィンドウ改造</li><li>3/23 エディタの横にクラス一覧を表示</li></ul><p>1.05</p><ul><li>02/3/16 描画方法オプションを追加。半透明表示を高速化</li><li>3/15 途中に空の行があるときにインデントが狂うバグを修正</li><li>3/15 getVisibleメソッドを追加</li><li>3/14 キャラクタパターン選択ウィンドウを改良</li><li>3/10 一度コンパイルしたクラスのコンパイルを抑止することによりページ読み込み速度を向上</li><li>3/5 ランタイム実行開始時のTonyuロゴ表示を廃止</li><li>3/1 APIリファレンスの数学関数の項目にtruncメソッド追加</li></ul><p>1.04</p><ul><li>02/2/24 キャラクタパターン用ビットマップのパターン認識方法を改善</li><li>2/24 オブジェクトの貼り付けにより同名のオブジェクトができてしまうバグ を修正</li><li>2/24 $projectManager.getCurrentPageNameメソッド追加</li><li>2/24 文字列を== , != 演算子で比較可能に</li></ul><p>1.03</p><ul><li>02/2/17 $panel.getPixelメソッド追加</li><li>2/17 MIDIを使った後ページを切り替えるとI/Oエラーを出すバグを修正</li></ul><p>1.02</p><ul><li>02/2/14 実行中に画面サイズを変更すると画面表示がおかしくなるバグを修正</li></ul><p>1.01</p><ul><li>02/1/26 サンプルプログラムにHockey2追加</li><li>1/26 サンプルプログラムに注釈とサウンドをつける</li><li>1/26 ロード中に音楽がループするバグを修正</li><li>1/20 ランタイム作成前にページ保存</li><li>1/20 ランタイムでのリサイズ禁止</li><li>1/20 エラーウィンドウ作成</li><li>1/20 designMode() メソッド追加</li></ul><p>0.112</p><ul><li>1/13 exeファイル変更。Tonyu.exeとPlayer.exe。Player.exeはデモが実行される</li><li>1/13 サンプルプログラムにエアーホッケー(Hockey)を追加</li><li>02/1/1 ネットランキング機能追加</li><li>12/28 PlainCharクラスにwait,notifyメソッド追加</li><li>01/12/28 起動画面を変更</li></ul><p>0.111</p><ul><li>12/08 Char クラスを推奨されないクラスに。代わりにSpriteCharクラスを使うようにする</li><li>12/08 サンプルプログラムにMeteoGrazer(Meteo)を追加</li><li>12/08 rndメソッドに負の値を指定すると無限ループになるバグを修正</li><li>12/07 オブジェクト作成ダイアログを改造</li><li>12/06 TextChar , DxChar ,SecretCharクラス、drawDxSpriteメソッド追加</li><li>12/05 color定数8種類($clWhiteなど)を定義</li></ul><p>0.110</p><ul><li>12/02 サンプルプログラムにブロックくずしを追加</li><li>12/01 $panelを使用可能に</li><li>11/26 ZOrderを用いてキャラクタの表示順序を設定可能に</li></ul><p>0.109</p><ul><li>11/24 APIリファレンスに$map.get $map.set $map.scrollTo を追加</li><li>11/24 オブジェクトを選択しないでコピーや切り取りを行うとエラーが出るのを修正</li><li>11/24 null が使用可能に</li><li>11/21 識別子に漢字を使用可能に</li><li>11/16 Ball.bmpの絵を改良</li><li>11/08 インスペクタをリニューアル</li></ul><hr><p>0.108 ページ切り替え対応<br>0.107 マップ編集、表示対応<br>0.106 ProjectManager追加。クリップボードからの貼り付けによる不具合修正。マップスクロール機能追加、returnの後の式省略可能に。<br>0.104 サウンド機能追加<br>0.103 クラスリストの削除、並び替え追加、+=演算子追加<br>0.102 $map.setBackGround, $map.setBGColorメソッド追加<br>0.101 ビットマップ読み込みの不具合を修正</p><hr><p><a href="./download">ダウンロード</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="compatibility"class="pagediv"title2="互換性の設定 - Tonyu1 Wiki"><p><a href="./download">ダウンロード</a>&emsp;<a href="./">Wikiトップ</a></p><h2 id="互換性の設定">互換性の設定</h2><p>この設定は、ver1.30以降で使えます。</p><p>主にver1.29～1.30でいくつか仕様変更をしたため、以前のバージョンと動作が違うことがあります。<br>ただし、動作が変わっては困るものは自動的に互換性を保つため、<strong>基本的にはここの設定をする必要ありません。</strong></p><p>もし、動作に違和感を感じたり、以前の動作を再現したい場合は、下記の設定をお使いください。</p><p>下記２種類の項目があります</p><ul><li><a href="#%E8%87%AA%E5%8B%95%E7%9A%84%E3%81%AB%E4%BA%92%E6%8F%9B%E6%80%A7%E3%82%92%E7%B6%AD%E6%8C%81%E3%81%99%E3%82%8B%E9%A0%85%E7%9B%AE">自動的に互換性を維持する項目</a></li><li><a href="#%E6%89%8B%E5%8B%95%E3%81%A7%E4%BA%92%E6%8F%9B%E6%80%A7%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E3%81%99%E3%82%8B%E9%A0%85%E7%9B%AE">手動で互換性の設定をする項目</a></li></ul><h3 id="自動的に互換性を維持する項目">自動的に互換性を維持する項目</h3><p>ここの項目は、主に最新バージョンで仕様変更があった項目で、<br>旧バージョンで作られたプロジェクトでは、自動的に旧バージョンの仕様で動作する項目です。</p><p>default.tonyuprjファイルの<code>targetVersion</code>（無い場合は<code>savedVersion</code>）の値で、<br>どのTonyuのバージョンで作られたのか判断し、自動的に互換性の設定をします。<br>手動で設定変更したい場合は、以降の説明の方法で設定するか、<code>targetVersion</code>（無い場合は<code>targetVersion</code>を追記）の値を変更します。</p><p>※ <code>targetVersion</code>と<code>savedVersion</code>の値は、バージョン値の1000倍です。<br>&emsp; 例1）Tonyu<strong>1_29</strong>_2021_1212 → ver<strong>1.29</strong> → <strong>1290</strong><br>&emsp; 例2）Tonyu<strong>1_302</strong>_2024_0210 → ver<strong>1.302</strong> → <strong>1302</strong></p><p><strong>項目</strong></p><ul><li><a href="#wavmzo%E3%81%AE%E9%9F%B3%E9%87%8F">wav,mzoの音量</a></li><li><a href="#%E3%82%B9%E3%83%97%E3%83%A9%E3%82%A4%E3%83%88%E6%8F%8F%E7%94%BB%E3%81%AE%E5%9B%9E%E8%BB%A2angle%E3%81%AE%E7%B2%BE%E5%BA%A6">スプライト描画の回転(angle)の精度</a></li><li><a href="#sincos%E3%81%AE%E7%B2%BE%E5%BA%A6">sin,cosの精度</a></li><li><a href="#ver122%E4%BB%A5%E5%89%8D%E3%81%AE%E3%82%B2%E3%83%BC%E3%83%A0%E3%82%92ver123%E4%BB%A5%E9%99%8D%E3%81%A7%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E3%81%A8%E3%80%81wav%E3%81%8C%E3%83%AB%E3%83%BC%E3%83%97%E3%81%97%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86">ver1.22以前のゲームをver1.23以降で実行すると、wavがループしてしまう</a></li></ul><h4 id="wavmzoの音量">wav,mzoの音量</h4><p><strong>各バージョンの仕様</strong></p><ul><li>ver1.19以前、wavとmzoの音量は100%でした。</li><li>ver1.21～1.29は、wavとmzoの音量は50%でした。</li><li>ver1.30以降、wavとmzoの音量は100%になりました。</li></ul><p><strong>互換性維持の機能</strong></p><ul><li>ver1.21～1.29のプロジェクトは、自動的にwavとmzoの音量が50%に設定されます。</li><li>手動で音量を変更したい場合は、下記設定をしてください。</li></ul><p><strong>【ソースコードを編集しない方法】</strong><br>該当プロジェクトのdefault.tonyuprjファイルを編集します。<br><code>&lt;resourcelist name=&quot;params&quot;&gt;</code>で囲われた中に<br><code>&lt;param name=&quot;init_base_volume&quot; value=&quot;0.5&quot;/&gt;</code>を追記してください。<br><code>value</code>の値（<code>0.5</code>の部分）は、<a href="./rf-mplayer#mplayersetbasevolume">$mplayer.setBaseVolume</a>を参照し、設定したい値に変えてください。</p><p><strong>【ソースコードから設定する方法】</strong><br>ゲーム起動時などのタイミングで、<a href="./rf-mplayer#mplayersetbasevolume">$mplayer.setBaseVolume</a>を実行するようにプログラムしてください。</p><h4 id="スプライト描画の回転angleの精度">スプライト描画の回転(angle)の精度</h4><p><strong>各バージョンの仕様</strong></p><ul><li>ver1.29以前は、１回転で256段階の精度でした（約1.4°ごとに角度が変わる）</li><li>ver1.30以降、１回転で36000段階の精度に向上しました（0.01°ごとに角度が変わる）</li></ul><p><strong>互換性維持の機能</strong></p><ul><li>ver1.29以前のプロジェクトは、自動的に１回転で256段階の精度に設定されます。</li><li>手動で精度を変更したい場合は、下記設定をしてください。</li></ul><p><strong>【ソースコードを編集しない方法】</strong><br>該当プロジェクトのdefault.tonyuprjファイルを編集します。<br><code>&lt;resourcelist name=&quot;params&quot;&gt;</code>で囲われた中に<br><code>&lt;param name=&quot;init_sprite_angle_accuracy&quot; value=&quot;0&quot;/&gt;</code>を追記してください。<br><code>value</code>の値（<code>0</code>の部分）は、<a href="./rf-system#systemsetspriteangleaccuracy">$System.setSpriteAngleAccuracy</a>を参照し、設定したい値に変えてください。</p><p><strong>【ソースコードから設定する方法】</strong><br>ゲーム起動時などのタイミングで、<a href="./rf-system#systemsetspriteangleaccuracy">$System.setSpriteAngleAccuracy</a>を実行するようにプログラムしてください。</p><h4 id="sincosの精度">sin,cosの精度</h4><p><strong>各バージョンの仕様</strong></p><ul><li>ver1.29以前は、0～360°で360段階の精度でした（1°単位の精度）</li><li>ver1.30以降、0～360°で36000段階の精度に向上しました（0.01°単位の精度）</li></ul><p><strong>互換性維持の機能</strong></p><ul><li>ver1.29以前のプロジェクトは、自動的に0～360°で360段階の精度に設定されます。</li><li>手動で精度を変更したい場合は、下記設定をしてください。</li></ul><p><strong>【ソースコードを編集しない方法】</strong><br>該当プロジェクトのdefault.tonyuprjファイルを編集します。<br><code>&lt;resourcelist name=&quot;params&quot;&gt;</code>で囲われた中に<br><code>&lt;param name=&quot;init_sin_cos_accuracy&quot; value=&quot;0&quot;/&gt;</code>を追記してください。<br><code>value</code>の値（<code>0</code>の部分）は、<a href="./rf-math#mathsetsincosaccuracy">$Math.setSinCosAccuracy</a>を参照し、設定したい値に変えてください。</p><p><strong>【ソースコードから設定する方法】</strong><br>ゲーム起動時などのタイミングで、<a href="./rf-math#mathsetsincosaccuracy">$Math.setSinCosAccuracy</a>を実行するようにプログラムしてください。</p><h4 id="ver122以前のゲームをver123以降で実行すると、wavがループしてしまう">ver1.22以前のゲームをver1.23以降で実行すると、wavがループしてしまう</h4><ul><li>wavのループはver1.23から対応しました</li><li>ver1.22以前でwavをループ再生指定してもループしませんが、<br>そのままver1.23以降で実行するとwavがループ再生してしまいます（一部そのようなゲームがありました）</li></ul><p><strong>互換性維持の機能</strong></p><ul><li>ver1.22以前のプロジェクトは、自動的にwavループ無効に設定されます。</li><li>手動で設定を変更したい場合は、下記設定をしてください。</li></ul><p><strong>【ソースコードを編集しない方法】</strong><br>該当プロジェクトのdefault.tonyuprjファイルを編集します。<br><code>&lt;resourcelist name=&quot;params&quot;&gt;</code>で囲われた中に<br><code>&lt;param name=&quot;init_se_loop_enable&quot; value=&quot;0&quot;/&gt;</code>を追記してください。<br><code>value</code>の値（<code>0</code>の部分）は、<a href="./rf-mplayer#mplayersetseloopenable">$mplayer.setSeLoopEnable</a>を参照し、設定したい値に変えてください。</p><p><strong>【ソースコードから設定する方法】</strong><br>ゲーム起動時などのタイミングで、<a href="./rf-mplayer#mplayersetseloopenable">$mplayer.setSeLoopEnable</a>を実行するようにプログラムしてください。</p><h3 id="手動で互換性の設定をする項目">手動で互換性の設定をする項目</h3><p>ここの項目は、主に旧バージョンの不具合などの項目です<br>最新バージョンでは改善されている項目です<br>以前の動作を再現したい特殊な場合のみ、下記の設定をしてください</p><p><strong>項目</strong></p><ul><li><a href="#fps%E3%81%8C%E7%B4%8461%EF%BD%9E63%E3%81%AB%E3%81%AA%E3%82%8B%E7%8F%BE%E8%B1%A1">FPSが約61～63になる現象</a></li><li><a href="#11025hz-22050hz-44100hz%E4%BB%A5%E5%A4%96%E3%81%AEwav%E3%81%A7%E5%86%8D%E7%94%9F%E9%80%9F%E5%BA%A6%E3%81%8C%E9%80%9F%E3%81%8F%E3%81%AA%E3%82%8B%EF%BC%88%E3%81%8B%E3%81%A4%E9%9F%B3%E3%81%8C%E9%AB%98%E3%81%8F%E3%81%AA%E3%82%8B%EF%BC%89%E7%8F%BE%E8%B1%A1">11025Hz, 22050Hz, 44100Hz以外のwavで再生速度が速くなる（かつ音が高くなる）現象</a></li><li><a href="#%E5%8A%B9%E6%9E%9C%E9%9F%B3%E3%82%92%E5%A4%9A%E6%95%B0%E5%A4%A7%E9%9F%B3%E9%87%8F%E3%81%A7%E9%B3%B4%E3%82%89%E3%81%99%E3%81%A8%E9%9F%B3%E5%89%B2%E3%82%8C%E3%81%99%E3%82%8B%E7%8F%BE%E8%B1%A1">効果音を多数大音量で鳴らすと音割れする現象</a></li><li><a href="#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E5%A4%A7%E9%87%8F%E7%94%9F%E6%88%90%E3%81%97%E3%81%9F%E9%9A%9B%E3%80%81%E7%82%B9%E6%BB%85%E3%81%97%E3%81%9F%E3%82%8A%E5%8B%95%E4%BD%9C%E3%81%8C%E9%81%85%E3%81%8F%E3%81%AA%E3%82%8B%E7%8F%BE%E8%B1%A1">オブジェクトを大量生成した際、点滅したり動作が遅くなる現象</a></li></ul><h4 id="fpsが約61～63になる現象">FPSが約61～63になる現象</h4><ul><li>ver1.28以前は、FPSにずれがありました。<ul><li>例えば、フレームレートを60に設定しても、FPSが約62.5になっていました。</li></ul></li><li>ver1.29からはFPSが正確になりました。</li><li>ver1.28以前のFPSを再現したい場合は、下記の設定をしてください。</li></ul><p><strong>【ソースコードを編集しない方法】</strong><br>該当プロジェクトのdefault.tonyuprjファイルを編集します。<br><code>&lt;resourcelist name=&quot;params&quot;&gt;</code>で囲われた中に<br><code>&lt;param name=&quot;init_legacy_frame_rate&quot; value=&quot;1&quot;/&gt;</code>を追記してください。</p><p><strong>【ソースコードから設定する方法】</strong><br>ゲーム起動時などのタイミングで、<a href="./rf-system#systemsetlegacyframerate">$System.setLegacyFrameRate(1);</a>を実行するようにプログラムしてください。</p><h4 id="11025hz-22050hz-44100hz以外のwavで再生速度が速くなる（かつ音が高くなる）現象">11025Hz, 22050Hz, 44100Hz以外のwavで再生速度が速くなる（かつ音が高くなる）現象</h4><ul><li>ver1.29以前は、サンプリングレートが11025Hz, 22050Hz, 44100Hz以外のwavは再生速度が速くなるバグがありました。<br>（11025Hz, 22050Hz, 44100Hzは本来の再生速度で再生されています）</li><li>ver1.30より、本来の再生速度で再生するようにバグ修正しました。</li><li>ver1.29以前のなり方に戻したい場合は、下記の設定をしてください。</li><li>ただし、ver1.29以前のサウンドの不具合や音質劣化、レイテンシが大きくなる等も発生してしまいます。<br>（<a href="./rf-mplayer#mplayersetsoundplaymode">$mplayer.setSoundPlayMode</a>のmode=1を参照）</li></ul><p><strong>【ソースコードを編集しない方法】</strong><br>該当プロジェクトのdefault.tonyuprjファイルを編集します。<br><code>&lt;resourcelist name=&quot;params&quot;&gt;</code>で囲われた中に<br><code>&lt;param name=&quot;init_sound_play_mode&quot; value=&quot;1&quot;/&gt;</code>を追記してください。</p><p><strong>【ソースコードから設定する方法】</strong><br>ゲーム起動時などのタイミングで、<a href="./rf-mplayer#mplayersetsoundplaymode">$mplayer.setSoundPlayMode(1);</a>を実行するようにプログラムしてください。</p><h4 id="効果音を多数大音量で鳴らすと音割れする現象">効果音を多数大音量で鳴らすと音割れする現象</h4><ul><li>ver1.30より、音割れを防ぐ機能を追加したため、音割れしにくくなります。</li><li>大音量の際は音量が自動的に小さくなります。</li><li><strong>ver1.302より、この機能はデフォルトでOFFになりました。</strong></li><li>機能を有効にするには、下記の設定をしてください。</li></ul><p><strong>【ソースコードを編集しない方法】</strong><br>該当プロジェクトのdefault.tonyuprjファイルを編集します。<br><code>&lt;resourcelist name=&quot;params&quot;&gt;</code>で囲われた中に<br><code>&lt;param name=&quot;init_volume_limiter&quot; value=&quot;1&quot;/&gt;</code>を追記してください。</p><p><strong>【ソースコードから設定する方法】</strong><br>ゲーム起動時などのタイミングで、<a href="./rf-mplayer#mplayersetvolumelimiter">$mplayer.setVolumeLimiter(1);</a>を実行するようにプログラムしてください。</p><h4 id="オブジェクトを大量生成した際、点滅したり動作が遅くなる現象">オブジェクトを大量生成した際、点滅したり動作が遅くなる現象</h4><ul><li>ver1.30より、点滅防止機能を追加したため、本現象は発生しにくくなります。</li><li>機能を無効にするには、下記の設定をしてください。</li></ul><p><strong>【ソースコードを編集しない方法】</strong><br>該当プロジェクトのdefault.tonyuprjファイルを編集します。<br><code>&lt;resourcelist name=&quot;params&quot;&gt;</code>で囲われた中に<br><code>&lt;param name=&quot;init_process_single&quot; value=&quot;1&quot;/&gt;</code>を追記してください。</p><p><strong>【ソースコードから設定する方法】</strong><br>ゲーム起動時などのタイミングで、<a href="./rf-system#systemsetprocesssingle">$System.setProcessSingle(1);</a>を実行するようにプログラムしてください。</p><hr><p><a href="./download">ダウンロード</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="about2"class="pagediv"title2="Tonyu Systemについて - Tonyu1 Wiki"><p><a href="./">Wikiトップ</a></p><h2 id="tonyu-systemについて">Tonyu Systemについて</h2><h3 id="配布規定">配布規定</h3><p>このプログラム(Tonyu System)の著作権は、作者(<a href="https://twitter.com/hoge1e3">@hoge1e3</a>)にあります。<br>再配布については、アーカイブの内容を変えない場合、自由に再配布が可能です。<br>内容を変更したものを配布する場合、事前に ｈｏｇｅ１ｅ３ あっと じーめーるどっとこむ<br>または <a href="https://twitter.com/hoge1e3">@hoge1e3</a> まで連絡をください。</p><p>このプログラムを用いて作成されたプログラムの著作権は、そのプログラムの製作者にあります。<br>このプログラムのランタイム作成機能を用いて作成されたファイル(およびそのアーカイブファイル)は、製作者が自由に配布できます。</p><h3 id="免責事項">免責事項</h3><p>このプログラムを使用したために発生したいかなる事故、問題等も作者は責任を負わないものとします</p><h3 id="開発者">開発者</h3><p>作者(<a href="https://twitter.com/hoge1e3">@hoge1e3</a>)のほか、Tonyu1_27_2019_0930 のバージョンからは主に <a href="https://twitter.com/makkii_bcr">@makkii_bcr</a> が開発しています。</p><hr><p><a href="./">Wikiトップ</a></p></div><div style="display:none"id="about"class="pagediv"title2="Tonyu1とは - Tonyu1 Wiki"><p><a href="./">Wikiトップ</a></p><h2 id="tonyu1とは">Tonyu1とは</h2><p>Tonyu Systemは，アクションゲームの作成に適したプログラミング言語環境です．　　</p><h2 id="特徴">特徴</h2><h3 id="視覚的デザイン">視覚的デザイン</h3><p>キャラクタの配置やマップの作成はマウス操作で行います。ゲーム画面のレイアウトが素早く簡単にできます。</p><p><a href="./img/vis-design2.png"><img src-t="./img/vis-design2.png"alt="vis-design2.png"width="227"height="186"></a><br>↑ブロック崩しの面パターンなどは，マップエディタで作ることができます．</p><p><a href="./img/vis-design1.png"><img src-t="./img/vis-design1.png"alt="vis-design1.png"width="273"height="158"></a><br>↑オブジェクトをクリックすると各種パラメータが表示されます。</p><p><a href="./img/editor.png"><img src-t="./img/editor.png"alt="editor.png"width="344"height="167"></a><br>↑オブジェクトをダブルクリックすると、コードエディタが開きます。</p><h3 id="並列処理">並列処理</h3><p>ゲームの動きをプログラムするのに便利な並列処理を完全にサポートします。キャラクタの動きはキャラクタ毎に独立して記述します。<br>通常のゲームプログラムでは、「１フレーム（１コマ）毎に行う動作」を記述するのに対して「キャラクタが生まれてから、死ぬまでの動作」を自然に記述できます。</p><h3 id="グラフィックス・サウンドライブラリ">グラフィックス・サウンドライブラリ</h3><p>グラフィックスの表示やキー入力、サウンドなど、ゲームに必要な機能を簡単に使えます。</p><p><a href="./img/alpha.png"><img src-t="./img/alpha.png"alt="alpha.png"width="210"height="180"></a><br>↑回転表示や半透明表示もできます。</p><h3 id="ネットランキング対応">ネットランキング対応</h3><p>CGIが実行可能なWebページをお持ちであれば、作成したゲームのハイスコア登録をWeb上で行えます。登録用CGIのPerlスクリプトが添付されています。</p><h3 id="チュートリアル">チュートリアル</h3><p>初心者のために、<a href="./tutorial">簡単なゲームを作るための手順</a>をヘルプに添付しました。これを読みながらTonyuの使い方を学習することができます。</p><h3 id="サンプルプログラム">サンプルプログラム</h3><p>気軽に遊べるショートゲームを収録。ここで紹介した機能を一通り使っています。</p><h2 id="動作環境">動作環境</h2><p>動作条件</p><ul><li>Windows 95以降（Windows専用）</li><li>DirectX6以降</li></ul><p>動作するOS</p><ul><li>別途インストール無し<ul><li>Windows 11, 10, 8.1, 8, 7, Vista, XP, 2000, Me, 98SE</li></ul></li><li>DirectX6のインストールが必要<ul><li>Windows 98, 95</li></ul></li></ul><p>最低動作環境</p><ul><li>Windows98 / Pentium 266MHz / メモリ 128MB （<a href="http://www.tonyu.jp/joyful/joyful.cgi?mode=res&amp;no=8836">BBS No.8836</a>より）</li></ul><hr><p><a href="./">Wikiトップ</a></p></div><div style="display:none"id="404"class="pagediv"title2="ページが無い - Tonyu1 Wiki"><p>ページが存在しません。</p></div><div style="display:none"id="tr-stg06"class="pagediv"title2="チュートリアル - 実践編 - シューティングゲーム (6/11) - 敵を破壊する - Tonyu1 Wiki"><p><a href="./tr-stg05">←前</a>&emsp;<a href="./tr-stg07">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---シューティングゲーム-611">チュートリアル - 実践編 - シューティングゲーム (6/11)</h3><h2 id="敵を破壊する">敵を破壊する</h2><h3 id="敵と弾がぶつかったら、敵が死ぬ">敵と弾がぶつかったら、敵が死ぬ</h3><p>自機がやられっぱなしではゲームになりませんので、敵も破壊されるようにしましょう。<br>敵が弾に当たったら敵が死ぬようにすればいいのですから、<a href="./tr-stg05">自機を破壊する</a>を参考にこんなプログラムを思いつくかもしれません。<br>敵をクリックして、次のような行を追加します。</p><pre>
extends SpriteChar;
while (y<$screenHeight) {
  y=y+2;
  <span style="color:red">if (crashTo($tama)) die();</span>
  if (crashTo($MyChar)) $MyChar.die();
  update();
}
</pre><p>しかし、これで実行しても、敵は死んでくれません。<br>この文は「$tamaが当たったら(敵が)死ぬ」ということを意味しています。<br>$tamaとは、設計時に作った弾(実行を止めても画面上にいるオブジェクト)で、<br>しかも$tamaは実行するとすぐ上に飛んで行って消えてしまいます。</p><p>一方、自分が撃つ弾は、実行時に新しく発生しているものなので、$tamaというように名前をつけることができません。<br>しかも弾が画面上にいくつあるのかも状況によって変わってきます。<br>そこで、実行時に作られたオブジェクトを参照するための仕組みが必要となります。<br>それが</p><p><a href="./rf-for-chars">for (xx in $chars)</a> {}</p><p>という文です。さっきの行を消して次のように書いてみましょう。</p><pre>
extends SpriteChar;
while (y<$screenHeight) {
  y=y+2;
  <span style="color:red">for (t in $chars) {
    if ( t is Tama && crashTo(t) ) die();
  }</span>
  if (crashTo($MyChar)) $MyChar.die();
  update();
}
</pre><p>まず、最初の行</p><pre><code>  for (t in $chars) {
</code></pre><p>について解説します これは、今画面上にいる全部のオブジェクトを調べ上げて、変数tに順番代入しながら、内の文を実行します。<br>例えば、今画面に自機と敵が１つづつ、弾が２つあるとします。<br>すると、 for (t in $chars) {は まずtに自機オブジェクトを代入し、{ }内の文を実行します。<br>それが終わると今度はtに敵オブジェクトを代入し、同様に実行し、<br>さらに弾オブジェクトの１個目を代入し実行<br>さらに弾オブジェクトの２個目を代入し実行<br>という処理を行います。<br>(※ただし、どのオブジェクトが何番目に代入されるかは決まっていません)</p><p>次に{}内の処理について解説します。</p><pre><code>    if ( t is Tama &amp;&amp; crashTo(t) ) die();
</code></pre><p>ifの条件部が&amp;&amp;で区切られているので、&quot;t is Tama&quot;と、&quot;crashTo(t)&quot;が両方成り立ったときだけ、ifの条件部が成立します（<a href="./tr-stg01">自機を動かす</a>参照)<br>t is Tama という式は、オブジェクトtのクラスがTamaであるかという判定を行います。<br>前述のとおり、 for (t in $chars) {は、画面上の「全部の」オブジェクトを順番に代入していくので、そこには弾以外の自機や敵も含まれます。<br>弾に当たった場合にだけ破壊されなければならないので、tが弾オブジェクトであるかの判定が必要となります。<br>つまり ( t is Tama &amp;&amp; crashTo(t) )は、tが弾で、その弾にぶつかっていれば、という意味になります。<br>そして、この条件が成り立つと die();によって敵自身が死にます。</p><p>実行してみましょう。敵を弾に当てると敵が死ぬようになりました。</p><h3 id="敵の爆発パターンを作る">敵の爆発パターンを作る</h3><p>敵にも爆発パターンつけてみましょう（<a href="./tr-stg05">自機を破壊する</a>参照)</p><pre>
extends SpriteChar;
<span style="color:red">function onDie() {
  appear(new Bomb(x , y ,$pat_Sample+4));
}</span>
while (y<$screenHeight) {
  y=y+2;
  for (t in $chars) {
    if ( t is Tama && crashTo(t) ) die();
  }
  if (crashTo($MyChar)) $MyChar.die();
  update();
}
</pre><hr><p><a href="./tr-stg05">←前</a>&emsp;<a href="./tr-stg07">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-stg07"class="pagediv"title2="チュートリアル - 実践編 - シューティングゲーム (7/11) - 敵の動きに変化をつける - Tonyu1 Wiki"><p><a href="./tr-stg06">←前</a>&emsp;<a href="./tr-stg08">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---シューティングゲーム-711">チュートリアル - 実践編 - シューティングゲーム (7/11)</h3><h2 id="敵の動きに変化をつける">敵の動きに変化をつける</h2><h3 id="新しい動きを追加する">新しい動きを追加する</h3><p>今の敵は、上から下に直線で飛んでくるだけなので、ちょっと変わった動きをつけましょう</p><p>途中までは今までどおり下に飛んできて、その後自機のいる方向に曲がって飛んでくるようにします。<br>敵をダブルクリックして、次のようにかきかえましょう。</p><pre>
extends SpriteChar;
function onDie() {
  appear(new Bomb(x , y ,$pat_Sample+4));
}

<span style="color:red">nexty=rnd(50)+100;</span>
while (y< nexty ) {
  y=y+2;
  for (t in $chars) {
    if ( t is Tama && crashTo(t) ) die();
  }
  if (crashTo($MyChar)) $MyChar.die();
  update();
}

<span style="color:red">if (x<$MyChar.x) vx=2; else vx=-2;
while (y<$screenHeight) {
  y=y+3;
  x=x+vx;
  update();
}</span>
</pre><p>変更した部分を順番に見ていきましょう</p><pre><code> nexty=rnd(50)+100;
</code></pre><p>まず <a href="./rf-object#objectrnd">rnd</a>(50)は、<a href="./tr-stg04">敵を出現させる</a>でも登場した、乱数を返すメソッドです。<br>この場合、0から49の整数の乱数が返されます。<br>それに100が加算されるので結果として、nextyには100から149の乱数が代入されます。<br>次のwhileの条件が変わっています</p><pre><code> while (y&lt; nexty ) {
</code></pre><p>yがnextyより小さい(nextyより上)にいるまでは、先ほどまでと同じ処理をするようになります。<br>つまり、上のほうにいるときはまっすぐ降りてきます。</p><p>そして、動きが変化するところでは、次のような処理を行います</p><pre><code> if (x&lt;$MyChar.x) vx=2; else vx=-2;
</code></pre><p>vxは、後で説明するように、移動方向のx成分です。</p><p><strong>x&lt;$MyChar.x</strong>ならば（つまり、敵の位置が自機より左なら）右に移動するために、<br>vx=2のように移動方向を正の値(右方向)にします。</p><p>その後ろについている elseは「そうでなかったら」という意味です。<br>すなわち x&lt;$MyChar.x<strong>でない</strong>ならば（つまり、敵の位置が自機より右なら）左に移動するために、<br>vx=-2のように移動方向を負の値(左方向)にします。</p><p>上のようにしてvxを設定し、次の処理で実際に移動を行います。</p><pre><code>while (y&lt;$screenHeight) {
  y=y+3;
  x=x+vx;
  update();
}
</code></pre><h3 id="追加した部分でも当たり判定を行う">追加した部分でも当たり判定を行う</h3><p>しかし、これで実行させるとわかりますが、敵が曲がった後、当たり判定（自機が破壊される、弾にあたるとやられる）がまったくなくなってしまいます。<br>曲がった後のwhileの中で当たり判定の処理を書き忘れているためです。<br>そこで、最初のwhileで書いてある当たり判定の処理をコピーして持ってきましょう。</p><pre>
extends SpriteChar;
function onDie() {
  appear(new Bomb(x , y ,$pat_Sample+4));
}
nexty=rnd(50)+100;
while (y&lt;nexty) {
  y=y+2;
  for (t in $chars) {
    if ( t is Tama && crashTo(t) ) die();
  }
  if (crashTo($MyChar)) $MyChar.die();
  update();
}
if (x<$MyChar.x) vx=2; else vx=-2;
while (y<$screenHeight) {
  y=y+3;
  x=x+vx;
  <span style="color:red">for (t in $chars) {
    if ( t is Tama && crashTo(t) ) die();
  }
  if (crashTo($MyChar)) $MyChar.die();</span>
  update();
}
</pre><p><a href="./rf-method-define">メソッド</a>を使うともっと整理できます。<br>当たり判定を行うatariHanteiメソッドを作成してみましょう。</p><pre>
extends SpriteChar;
function onDie() {
  appear(new Bomb(x, y, $pat_Sample+4));
}

<span style="color:red">function atariHantei() {
  for (t in $chars) {
    if ( t is Tama && crashTo(t) ) die();
  }
  if (crashTo($MyChar)) $MyChar.die();
}</span>

nexty=rnd(50)+100;
while (y&lt;nexty) {
  y=y+2;
  <span style="color:red">atariHantei();</span>
  update();
}
if (x<$MyChar.x) vx=2; else vx=-2;
while (y<$screenHeight) {
  y=y+3;
  x=x+vx;
  <span style="color:red">atariHantei();</span>
  update();
}
</pre><hr><p><a href="./tr-stg06">←前</a>&emsp;<a href="./tr-stg08">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-stg08"class="pagediv"title2="チュートリアル - 実践編 - シューティングゲーム (8/11) - 得点を表示する - Tonyu1 Wiki"><p><a href="./tr-stg07">←前</a>&emsp;<a href="./tr-stg09">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---シューティングゲーム-811">チュートリアル - 実践編 - シューティングゲーム (8/11)</h3><h2 id="得点を表示する">得点を表示する</h2><h3 id="文字オブジェクトを作る">文字オブジェクトを作る</h3><p>やっつけた敵に応じて得点を表示するようにしましょう。</p><p>まず得点を表示するためのオブジェクトを作ります。<a href="./tr-basic02">オブジェクトを作る</a>を参考にオブジェクトを作成します。<br>「オブジェクトの種類」を「テキスト」にします。</p><p><img src-t="./img/newtext.png"width="394"height="402"alt="newtext.png"></p><ul><li><span style="font-size:small;color:#88a"><b>間違えて「テキスト」でなく、「スプライト」でオブジェクトを作ってしまったら....</b><br><br>この場合、オブジェクトをダブルクリックし、プログラム先頭の extends SpriteChar; を extends TextChar; に変更し、<br>一回実行し停止させるとテキストオブジェクトに変わります。<br></span></li></ul><p>オブジェクトをダブルクリックして、次のように入力します。</p><pre><code>extends TextChar;
$score=0;
while(1) {
  text=&quot;Score:&quot;+$score;
  update();
}
</code></pre><h3 id="文字を表示する">文字を表示する</h3><p>テキストオブジェクトは、文字をするためのオブジェクトです。<br>変数textに文字列を代入すると、その内容が画面に表示されます。<br>上のプログラムでは、文字列&quot;Score:&quot;の後ろに変数$scoreの内容を 付け加えたものをtextに代入しています。</p><h3 id="グローバル変数を使う">グローバル変数を使う</h3><p>$scoreという変数には頭に&quot;&#036;&quot;がついています。$で始まる変数はグローバル変数といい、どのオブジェクトからも参照できる変数です。<br>逆に、$がついていない変数は、そのオブジェクトが固有にもっている変数です。これをオブジェクト変数と呼びます。<br>オブジェクト変数は、同じ名前でもオブジェクトが違っていれば全く別の変数となります。</p><p>$scoreをグローバル変数にしたのは、敵などの他のオブジェクトが得点計算を行う必要があり、<br>表示をこの得点表示用のオブジェクトが行う必要があるからです。</p><p>とりあえず実行させてみると、画面上にScore : 0という文字が出ています。</p><h3 id="得点計算をする">得点計算をする</h3><p>敵が弾にあたってやられた時に得点が増えるようにしましょう。<br>敵をダブルクリックし、次のように変更します。</p><pre>
extends SpriteChar;
function onDie() {
  appear(new Bomb(x, y, $pat_Sample+4));
}
function atariHantei() {
  for (t in $chars) {
    if (t is Tama && crashTo(t)) <span style="color:red">{
      die();
      $score=$score+10;
    }</span>
  }
  if (crashTo($MyChar)) $MyChar.die();
}
nexty=rnd(50)+100;
while (y&lt;nexty) {
  y=y+2;
  atariHantei();
  update();
}
if (x<$MyChar.x) vx=2; else vx=-2;
while (y<$screenHeight) {
  y=y+3;
  x=x+vx;
  atariHantei();
  update();
}
</pre><p>実行すると、敵をやっつけるたびに得点がふえていきます。</p><hr><p><a href="./tr-stg07">←前</a>&emsp;<a href="./tr-stg09">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-stg09"class="pagediv"title2="チュートリアル - 実践編 - シューティングゲーム (9/11) - 弾、爆発を削除する - Tonyu1 Wiki"><p><a href="./tr-stg08">←前</a>&emsp;<a href="./tr-stg10">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---シューティングゲーム-911">チュートリアル - 実践編 - シューティングゲーム (9/11)</h3><h2 id="弾、爆発を削除する">弾、爆発を削除する</h2><p>ゲーム開始後、設計時においてあった弾と爆発パターンのオブジェクトが動くのが見えます。<br>これらのオブジェクトはゲーム中に作成されるものなので、実際には設計時においておく必要はありません。</p><p>これらのオブジェクトを削除してしまいましょう。 弾のオブジェクトをクリックし、<strong>Delete</strong>キーを押します。</p><p><img src-t="./img/delobj.png"width="92"height="224"alt="delobj.png"></p><p>弾が消えました。同様に爆発パターンも削除します</p><p>オブジェクトを消してしまっても、そのクラスがなくなってしまうことがありません。<br>実行してみると、弾も出ますし、爆発も表示されます。</p><p>これらの消してしまったオブジェクトのクラスを編集したいときは、<br>エディタ左側の、クラスの一覧から、編集したいクラスを選ぶと、そのクラスのソースファイルが表示されます。</p><p><img src-t="./img/clslist.png"width="408"height="217"alt="clslist.png"></p><hr><p><a href="./tr-stg08">←前</a>&emsp;<a href="./tr-stg10">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-stg10"class="pagediv"title2="チュートリアル - 実践編 - シューティングゲーム (10/11) - 配布する - Tonyu1 Wiki"><p><a href="./tr-stg09">←前</a>&emsp;<a href="./tr-stg11">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---シューティングゲーム-1011">チュートリアル - 実践編 - シューティングゲーム (10/11)</h3><h2 id="配布する">配布する</h2><p>これでゲームは一通り完成です。このゲームを配布したいとします。<br>他の人にTonyuをダウンロードさせるのは大変なので、単体で動くプログラム（ランタイム）を作成しましょう。</p><p>「ファイル」＞「ランタイム作成」を選びます。</p><p><img src-t="./img/rumenu.png"width="290"height="275"alt="rumenu.png"></p><p>タイトル、作者等の情報を入れます。</p><ul><li><p><strong>「メインページ」</strong><br>$page_indexを選択します。</p></li><li><p><strong>「ネットランキング管理者パスワード」</strong><br>ここでは空白にしておいてください。詳しくは次項の<a href="./tr-stg11">ネットランキング対応にする</a>で説明します。</p></li><li><p><strong>「アイコン」</strong><br>配布する実行ファイルのアイコンを変更できます。<br>右下「アイコン」の隣の「変更...」を押し、ファイルを選択してください。<br>ただし次のような制限があります。</p><ul><li>読み込めるのはbmpまたはpngファイル</li><li>画像の左上32*32の部分だけが使用される。</li><li>左上端の色が透過色になる。</li></ul><p>なお、実行ファイル名はPlayer.exeとなりますが、この名前は変更してもかまいません。</p></li><li><p><strong>「配布条件」</strong><br>このランタイムには、今までつくったプログラムのソースファイルがそのまま含まれます。<br>このため、他のユーザが簡単にプログラムの中身を書き換えることができます。<br>内容を書き換えたゲーム（または今あなたがつくったゲームそのもの）を、他の人が勝手に配っていいかを決めるのが配布条件です</p><ul><li><strong>再配布、改造ともに無断で許可</strong><br>プログラムの中身を変えようと変えまいと、他の人が勝手に配ってよいという、いちばん緩い条件です</li><li><strong>内容を変更しない再配布を無断で許可、改造は不可</strong><br>プログラムの中身を変えなければ、勝手に配ってよいという条件です</li><li><strong>再配布、改造は要連絡</strong><br>他の人が配布したい場合、作者への連絡が必要、という条件です。<br>この場合メールアドレス等、あなたの連絡先を書いてください。</li><li><strong>再配布、改造は不可</strong><br>勝手に配るな、といういちばんきつい条件です。</li><li><strong>その他</strong><br>どれにもあてはまらない場合は、条件を自分で書くことができます。</li></ul></li></ul><p>最後に、ランタイムを作成するディレクトリを選び、OKを押します。</p><p><img src-t="./img/rumenu2.png"width="755"height="423"alt="rumenu2.png"></p><p>ランタイム作成が完了したら、「OK」を選んでフォルダを開いてみます</p><p><img src-t="./img/rfold.png"width="674"height="296"alt="rfold.png"></p><p>このフォルダのPlayer.exeを実行すれば、作ったゲームが実行できます。 このフォルダを圧縮ツール等でまとめたものを配布してください。</p><hr><p><a href="./tr-stg09">←前</a>&emsp;<a href="./tr-stg11">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-stg11-1"class="pagediv"title2="チュートリアル - 実践編 - シューティングゲーム (11-1 / 11) - ネットランキング対応にする - ランキング用CGIを設置する - Tonyu1 Wiki"><p><a href="./tr-stg11">←前</a>&emsp;<a href="./tr-stg11-2">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---シューティングゲーム-11-1--11">チュートリアル - 実践編 - シューティングゲーム (11-1 / 11)</h3><h2 id="ネットランキング対応にする">ネットランキング対応にする</h2><h3 id="ランキング用cgiを設置する">ランキング用CGIを設置する</h3><p><strong>1.</strong> Tonyu Systemのアーカイブに添付されている&quot;Perl&quot;ディレクトリを開きます。</p><p>hiscore.cgi をテキストエディタで開きます</p><ul><li>1行目の #!/usr/bin/perlを、サーバのPerlの置いてある場所に設定します。</li><li>8行目の $password=&#39;<strong>pass</strong>&#39;;の値を変更します。任意の英数文字列です。<br>これが「<strong>ネットランキング管理者パスワード</strong>」なります。パスワードを忘れないようにしてください。</li><li>タイトルや、最初に表示されるHTMLの内容をお好みで変更します。</li></ul><p><strong>2.</strong> Perlディレクトリの内容をサーバにコピーします。(FTPを使用する場合、アスキーモードで転送してください)</p><p><strong>3.</strong> パーミッションを設定します</p><pre><code>hiscore.cgi  :  755(-rwxr-xr-x , 第三者による実行許可)
data/hiscore :  666(-rw-rw-rw- , 第三者による書き込み許可)
</code></pre><p><strong>4.</strong> hiscore.cgiをブラウザで開いて、ランキングのページが表示されるのを確認します</p><hr><p><a href="./tr-stg11">←前</a>&emsp;<a href="./tr-stg11-2">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-stg11-2"class="pagediv"title2="チュートリアル - 実践編 - シューティングゲーム (11-2 / 11) - ネットランキング対応にする - ネットランキング対応のランタイムを作成する - Tonyu1 Wiki"><p><a href="./tr-stg11-1">←前</a>&emsp;<a href="./tutorial">目次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---シューティングゲーム-11-2--11">チュートリアル - 実践編 - シューティングゲーム (11-2 / 11)</h3><h2 id="ネットランキング対応にする">ネットランキング対応にする</h2><h3 id="ネットランキング対応のランタイムを作成する">ネットランキング対応のランタイムを作成する</h3><p>先ほどまでで作成したシューティングをネットランキング対応にしましょう。</p><p>シューティングゲームのページを開いた状態で、メニューの「ウィンドウ」→「ネットランキング」を選びます</p><p><img src-t="./img/open-net-rank.png"width="305"height="384"alt="open-net-rank.png"></p><p>URLに、<a href="./tr-stg11-1">前項</a>でアップロードしたCGIのURLを設定します。</p><p><img src-t="./img/set-rank-url.png"width="650"height="87"alt="set-rank-url.png"></p><p>自機が死んだときにランキングのページを開くようにしましょう</p><p>メニューの「オブジェクト」→「新規」を選んで新しくオブジェクトを作成します。<br>オブジェクトの種類は「テキスト」です</p><p><img src-t="./img/new-text2.png"width="394"height="402"alt="new-text2.png"></p><p>テキストオブジェクトを選択します。 オブジェクトインスペクタで、文字を変更します</p><p><img src-t="./img/setcaption.png"width="359"height="243"alt="setcaption.png"></p><p>テキストをダブルクリックして、次のように入力します。</p><pre><code>extends TextChar;
setVisible(0);
while(!$MyChar.isDied()) {
  update();
}
setVisible(1);
while(getkey(13)==0) {
  update();
}
$ranking.setParam(&quot;score&quot;,$score);
$ranking.openBrowser();
</code></pre><p>このプログラムについて解説します。</p><pre><code>setVisible(0);
</code></pre><p>↑これはこのテキストを一旦非表示にするための命令です。</p><pre><code>while(!$MyChar.isDead()) {
  update();
}
</code></pre><p>↑これは、$MyCharつまり自機が死んでいない間、update()を繰り返します。<br><a href="./rf-plainchar#plaincharisdead">isDead</a> は、オブジェクトが死んでいる( die()メソッドがよばれている)かを検査するメソッドです。</p><pre><code>setVisible(1);
while(getkey(13)==0) {
  update();
}
</code></pre><p>↑この部分では、 setVisible(1);によりテキスト(&quot;Press Return to Regist Hiscore&quot;)を表示します。<br>さらにEnterキーが押されるまでupdate()を繰り返しながら待機します。</p><pre><code>$ranking.setParam(&quot;score&quot;,$score);
$ranking.openBrowser();
</code></pre><p>↑この部分で実際にWeb上にスコア登録をおこないます。</p><p><a href="./rf-ranking#rankingsetparam">$ranking.setParam</a>(name,value)は、登録の際のパラメータを設定します。ここでは、scoreという名前のパラメータに$scoreの値（つまり得点)を設定します。</p><p><a href="./rf-ranking#rankingopenbrowser">$ranking.openBrowser</a>(); は、ブラウザから登録画面を開きます。</p><p>試しに一回実行してみましょう。<br>自機が死んだ後、<code>Press Return to Regist Hiscore</code> が表示されます。<br>ここでEnterを押すとブラウザが開いて登録画面が表示されますが....</p><p><img src-t="./img/browse-error.png"width="307"height="95"alt="browse-error.png"></p><p>エラーが発生しました。実は、開発環境からはハイスコア登録できないようになっています。<br>ここでは、ブラウザが開くのとCGIが正常動作するのを確認するだけにします。<br>（この後ランタイムを作成するとハイスコア登録が可能になります）</p><p>この状態で、<a href="./tr-stg10">配布する</a>を参考にランタイムを作成します。<br>このとき、ネットランキングランキング管理者パスワードの欄に、<br><a href="./tr-stg11-1">前項</a>で設定した<strong>ネットランキング管理者パスワード</strong>を入力します。</p><p><img src-t="./img/mkpass.png"width="751"height="423"alt="mkpass.png"></p><p>作成したランタイムをWebサーバ上に上げて、ダウンロード可能な状態にしておきます</p><p>テストします。<br>Webサーバからアーカイブをダウンロード、解凍し、ゲームをやってみましょう。<br>自機が死んだらEnterを押して登録画面に入ります</p><hr><p><a href="./tr-stg11-1">←前</a>&emsp;<a href="./tutorial">目次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tr-stg11"class="pagediv"title2="チュートリアル - 実践編 - シューティングゲーム (11/ 11) - ネットランキング対応にする - Tonyu1 Wiki"><p><a href="./tr-stg10">←前</a>&emsp;<a href="./tr-stg11-1">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="チュートリアル---実践編---シューティングゲーム-1111">チュートリアル - 実践編 - シューティングゲーム (11/11)</h3><h2 id="ネットランキング対応にする">ネットランキング対応にする</h2><p>このゲームのハイスコアをWeb上で登録できるようにします。</p><p>※ ネットランキングを行うには、PerlによるCGIが実行可能なWebサーバが必要です。<br>&emsp;&ensp;この項では、Webサーバは各自が既に利用できていることを前提としています。</p><ol><li><a href="./tr-stg11-1">ランキング用CGIを設置する</a></li><li><a href="./tr-stg11-2">ネットランキング対応のランタイムを作成する</a></li></ol><hr><p><a href="./tr-stg10">←前</a>&emsp;<a href="./tr-stg11-1">次→</a>&emsp;<a href="./tutorial">チュートリアル</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="tutorial"class="pagediv"title2="チュートリアル - Tonyu1 Wiki"><p><a href="./">Wikiトップ</a></p><h2 id="チュートリアル">チュートリアル</h2><p>Tonyuでプログラムを作成する方法を学習します。</p><h3 id="基礎編">基礎編</h3><p>基本的な操作方法を学びます</p><ol><li><a href="./tr-basic01">新規プロジェクトを作る</a></li><li><a href="./tr-basic02">オブジェクトを作る</a></li><li><a href="./tr-basic03">オブジェクトを動かす</a></li><li><a href="./tr-basic04">オブジェクトを動かす2</a></li><li><a href="./tr-basic05">オブジェクトをコピーする</a></li><li><a href="./tr-basic06">オブジェクトのキャラクタパターンを指定する</a></li><li><a href="./tr-basic07">オブジェクトいろいろ</a></li><li><a href="./tr-basic08">カーソルキーで動くオブジェクト</a></li><li><a href="./tr-basic09">オブジェクトを追いかけるオブジェクト</a></li></ol><ul><li><a href="./tr-basic99">付録：キャラクタパターン用ビットマップの作り方</a></li></ul><h3 id="実践編">実践編</h3><p>プログラムの作り方を学びます</p><ul><li>シューティングゲーム<ol><li><a href="./tr-stg01">自機を動かす</a></li><li><a href="./tr-stg02">弾を撃つ</a></li><li><a href="./tr-stg03">敵を動かす</a></li><li><a href="./tr-stg04">敵を出現させる</a></li><li><a href="./tr-stg05">自機を破壊する</a></li><li><a href="./tr-stg06">敵を破壊する</a></li><li><a href="./tr-stg07">敵の動きに変化をつける</a></li><li><a href="./tr-stg08">得点を表示する</a></li><li><a href="./tr-stg09">弾、爆発を削除する</a></li><li><a href="./tr-stg10">配布する</a></li><li><a href="./tr-stg11">ネットランキング対応にする</a><ol><li><a href="./tr-stg11-1">ランキング用CGIを設置する</a></li><li><a href="./tr-stg11-2">ネットランキング対応のランタイムを作成する</a></li></ol></li></ol></li><li><span id="tr-mazegame">迷路ゲーム</span><ol><li><a href="./tr-maze01">マップを描く</a></li><li><a href="./tr-maze02">自機を動かす</a></li><li><a href="./tr-maze03">敵を動かす</a></li><li><a href="./tr-maze04">自機や敵を破壊する</a></li><li><a href="./tr-maze05">スタート画面を作る</a></li><li><a href="./tr-maze06">次の面に移る</a></li><li><a href="./tr-maze07">配布する</a></li></ol></li><li><a href="./html/scroll/html/HID00000001.htm">スクロールのサンプル</a></li><li><a href="./html/jump/jump_html/html/HID00000001.htm">ジャンプアクション</a></li></ul><hr><p><a href="./">Wikiトップ</a></p></div><div style="display:none"id="wnd-bgm"class="pagediv"title2="各種ウィンドウの使い方/オプション - BGM・効果音 - Tonyu1 Wiki"><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="各種ウィンドウの使い方オプション">各種ウィンドウの使い方/オプション</h3><h2 id="bgm・効果音">BGM・効果音</h2><p>BGM、効果音を読み込みます</p><p><img src-t="./img/bgmwin.png"width="327"height="245"alt="bgmwin.png"></p><h3 id="bgm、効果音を読み込む">BGM、効果音を読み込む</h3><p>「追加」をクリックし、サウンドファイルを選択します。</p><p>また「自動追加」で、ページと同一ディレクトリにあるすべてのサウンドを追加します。</p><p>※ 同じ名前をもつファイル(sound.wav と sound.midなど) は片方しか追加できません</p><h3 id="プログラム中でbgm、効果音を鳴らす">プログラム中でBGM、効果音を鳴らす</h3><p><a href="./rf-mplayer#mplayerplay">$mplayer.play</a>メソッドを呼び出します。</p><p>たとえば、上の図におけるgreat.wavを鳴らしたい場合は次のように記述します。</p><pre><code> $mplayer.play($se_great);
</code></pre><h3 id="読み込めるサウンドファイル">読み込めるサウンドファイル</h3><ul><li>wavファイル(*.wav)</li><li>MIDIファイル(*.mid)</li><li>M-Twoオブジェクトファイル(*.mzo) ... 音楽作成ソフト<a href="./download#m-two">M-Two</a>で作成された音楽演奏用ファイル</li></ul><hr><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="wnd-char"class="pagediv"title2="各種ウィンドウの使い方/オプション - キャラクタパターン - Tonyu1 Wiki"><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="各種ウィンドウの使い方オプション">各種ウィンドウの使い方/オプション</h3><h2 id="キャラクタパターン">キャラクタパターン</h2><p>キャラクタパターン用画像ファイルの読み込み、キャラクタパターンの選択を行います。</p><p><img src-t="./img/pat-win.png"width="591"height="257"alt="pat-win.png"></p><p>キャラクタパターン用画像ファイルを読み込むには、「追加」をクリックし、画像ファイルを選択します。</p><p>上の図のように画像ファイルの項目をダブルクリックすると、キャラクタパターン選択画面が表示されます。<br>各キャラクタパターンをクリックすると、そのパターン番号がクリップボードにコピーされます。</p><p>プログラム中に、オブジェクトが表示するキャラクタパターンを指定する場合は、次のように記述します</p><pre><code> p=$pat_ufo+1;
</code></pre><h4 id="参考">参考</h4><p><a href="./tr-basic06">チュートリアルのオブジェクトのキャラクタパターンを指定する</a></p><hr><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="wnd-code"class="pagediv"title2="各種ウィンドウの使い方/オプション - コード補完 - Tonyu1 Wiki"><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="各種ウィンドウの使い方オプション">各種ウィンドウの使い方/オプション</h3><h2 id="コード補完">コード補完</h2><p>エディタでの編集中に、メソッド名や変数名を自動的に入力する機能です。</p><p><strong>使い方</strong><br>エディタにて文字列を入力すると、その文字列で始まるメソッド名および変数名の一覧が<strong>コード補完</strong>ウィンドウに表示されます。</p><p>この状態で、<strong>カーソルキーの↑↓</strong>を利用して候補を選択します。</p><p><span style="font-size:small;color:#08f">↓例えば、次の例では、エディタに<strong>dr</strong>と入力した場合に、drで始まるメソッドが表示されます。</span></p><p><img src-t="./img/code-comp.png"width="500"height="361"alt="code-comp.png"></p><p><strong>カーソルキーの</strong> →を押すと、選択した候補がエディタに入力されます</p><p><img src-t="./img/code-decide.png"width="422"height="124"alt="code-decide.png"></p><p>なお、コード補完機能は、メニューの<strong>オプション</strong>から無効にすることもできます。</p><p><img src-t="./img/code-opt.png"width="195"height="141"alt="code-opt.png"></p><hr><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="wnd-csl"class="pagediv"title2="各種ウィンドウの使い方/オプション - コンソールウィンドウ - Tonyu1 Wiki"><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="各種ウィンドウの使い方オプション">各種ウィンドウの使い方/オプション</h3><h2 id="コンソールウィンドウ">コンソールウィンドウ</h2><p>各種情報を表示するウィンドウです。<a href="./rf-object#objectprint">print</a>メソッドを使って、このウィンドウに出力ができます。</p><p><img src-t="./img/console.png"width="564"height="447"alt="console.png"></p><h3 id="コンソールウィンドウの外観">コンソールウィンドウの外観</h3><p><img src-t="./img/console2.png"width="238"height="452"alt="console2.png"></p><hr><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="wnd-draw"class="pagediv"title2="各種ウィンドウの使い方/オプション - 描画方法 - Tonyu1 Wiki"><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="各種ウィンドウの使い方オプション">各種ウィンドウの使い方/オプション</h3><h2 id="描画方法">描画方法</h2><p>描画を行う場合の、描画方法を決めます。<br>お使いのマシンの環境（特にビデオカードの性能）や実行するゲームの種類 により最も速い描画方法を指定してください。</p><p>メニューの「オプション」＞「描画方法」で設定できます</p><p>A,B,Cの３つの方式がありますが、次のような特徴があります。</p><ul><li>A方式 ： 半透明表示が高速です。それ以外の描画速度は普通です</li><li>B方式 ： 半透明表示が高速です。画面が小さいと高速に、大きいと低速になります。</li><li>C方式 ： 半透明表示がとても遅くなりますが、半透明以外の描画は他の２方式より高速です</li></ul><p>ただしこれは以下の環境において観察したものです。他の環境では異なる性質を もつかもしれません</p><ul><li>CPU : Cerelon 1.2GHz</li><li>ビデオカード: NVidia RIVA TNT2</li><li>画面モード : 16bit Color 1024*768</li><li>DirectX : 7.0</li></ul><hr><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="wnd-map"class="pagediv"title2="各種ウィンドウの使い方/オプション - マップ作成 - Tonyu1 Wiki"><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="各種ウィンドウの使い方オプション">各種ウィンドウの使い方/オプション</h3><h2 id="マップ作成">マップ作成</h2><p>マップを使うと、下の図のようにキャラクタパターンを格子状に敷き詰めることができます。<br>※赤枠は実際には表示されません。</p><p><img src-t="./img/map-ex.png"width="392"height="264"alt="map-ex.png"></p><p>マップを作成するには、メニューの「ウィンドウ」＞「マップ」を選択します。 マップの大きさを設定します。各パラメータは下の図のような意味をもちます。</p><p><img src-t="./img/map-make.png"width="728"height="354"alt="map-make.png"></p><p>マップの描き方は、チュートリアルの<a href="./tr-maze01">マップを描く</a>も参考にしてください。</p><p>マップはメインウィンドウの大きさを超えて作成することもできます。この場合、画面をスクロールさせることによりマップの作成を行います。</p><p>スクロールは次のいずれかの方法で行えます。</p><ul><li>メインウィンドウ上でマウスの右ボタンでドラッグする</li><li><a href="./wnd-satellite">サテライト</a>を使う</li></ul><p>実行中のスクロールは、<a href="./rf-map#mapscrollto">$map.scrollTo</a>メソッドを使います</p><hr><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="wnd-objlist"class="pagediv"title2="各種ウィンドウの使い方/オプション - オブジェクト一覧 - Tonyu1 Wiki"><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="各種ウィンドウの使い方オプション">各種ウィンドウの使い方/オプション</h3><h2 id="オブジェクト一覧">オブジェクト一覧</h2><p>ツールの「オブジェクト一覧」ボタン または、オブジェクトインスペクタの「一覧」を押します。</p><p><img src-t="./img/form-ord-appear.png"width="321"height="124"alt="form-ord-appear.png"></p><p>設計中は次のように、配置したオブジェクトの一覧を表示します。</p><p><img src-t="./img/form-ord.png"width="259"height="315"alt="form-ord.png"></p><p>実行中は現在出現しているオブジェクト（実行中に作成したオブジェクトも含める） を表示します。オブジェクトの数が多くなると、次のような警告を表示します。</p><p><img src-t="./img/form-ord-warn.png"width="259"height="315"alt="form-ord-warn.png"></p><p>この場合、画面外に出たオブジェクトを消滅する処理を忘れている可能性がありますので 例えば次のような文を挟んでおくことをおすすめします。</p><p>screenOutについては命令リファレンスの<a href="./rf-plainchar#plaincharscreenout">screenOut</a>を参照してください。</p><pre><code> if (screenOut()) die();
</code></pre><hr><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="wnd-pfm"class="pagediv"title2="各種ウィンドウの使い方/オプション - パフォーマンス - Tonyu1 Wiki"><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="各種ウィンドウの使い方オプション">各種ウィンドウの使い方/オプション</h3><h2 id="パフォーマンス">パフォーマンス</h2><p>実行速度に関する情報を表示します。 メニューの「ウィンドウ」＞「パフォーマンス」で開くことができます。</p><p><img src-t="./img/perform.png"width="349"height="88"alt="perform.png"></p><ul><li><strong>FPS</strong><br>1秒間あたりの描画枚数を表示します。</li><li><strong>オブジェクト数</strong><br>現在出現しているオブジェクトの数です。多くなるほど処理は重くなります。<br>どのオブジェクトがどれくらい出現しているかは、<a href="./wnd-objlist">オブジェクト一覧</a>を参照してください</li><li><strong>CPU負荷</strong><br>通常は「最大」にしておいて問題ありませんが、他のアプリケーションとTonyuを同時に使っていて、<br>他のアプリケーションが遅すぎる場合は、「節約」側にすることで処理が軽くなります。<br>ただし、描画枚数も減ります。</li><li><strong><span style="color:red">!!処理が重過ぎます。update()を忘れている可能性があります。!!</span></strong><br>通常は表示されませんが、例えば、つぎのようなプログラムを実行すると表示されます。</li></ul><p>例1</p><pre><code>extends SpriteChar;
while(1) {
  x+=1;
}
</code></pre><p>このようにwhileループ中に<a href="./rf-plainchar#plaincharupdate">update</a>メソッドがないと、処理が大変重くなる場合があります。<br>プログラムを見直してください。この場合次のように修正します。</p><p>例2</p><pre>
extends SpriteChar;
while(1) {
  x+=1;
  <span style="color:red">update();</span>
}
</pre><hr><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="wnd-prjmgr"class="pagediv"title2="各種ウィンドウの使い方/オプション - プロジェクトマネージャ - Tonyu1 Wiki"><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="各種ウィンドウの使い方オプション">各種ウィンドウの使い方/オプション</h3><h2 id="プロジェクトマネージャ">プロジェクトマネージャ</h2><p>プロジェクトマネージャは、１つのゲームの中で複数のページを使うときに必要になります。</p><p>メニューの「ウィンドウ」＞「プロジェクトマネージャ」で、プロジェクトマネージャを開くと、現在開いているページと同一ディレクトリにあるページの一覧が表示されます。</p><p><img src-t="./img/1men.png"width="314"height="270"alt="1men.png"></p><p>各項目をダブルクリックするとそのページに移動します。</p><p>実行中にページを移動したいときは <a href="./rf-projectmanager#projectmanagerloadpage">$projectManager.loadPage</a>メソッドを使います。</p><p>参照</p><ul><li>チュートリアル：<a href="./tutorial#tr-mazegame">迷路ゲームの作成</a><ul><li><a href="./tr-maze06">次の面に移る</a></li><li><a href="./tr-maze05">スタート画面を作る</a></li></ul></li></ul><hr><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="wnd-recipe"class="pagediv"title2="各種ウィンドウの使い方/オプション - レシピ集 - Tonyu1 Wiki"><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="各種ウィンドウの使い方オプション">各種ウィンドウの使い方/オプション</h3><h2 id="レシピ集">レシピ集</h2><p>プログラミングに役立つレシピ（プログラムの雛型・例）を収録してあります。 レシピを閲覧するには、ツールウィンドウから<img src-t="./img/knife.png"width="33"height="25"alt="knife.png">を選びます。</p><p>「カテゴリ」から見たいカテゴリを選択し、レシピ一覧から選んでレシピを表示します。 レシピの「新規」をクリックすると、レシピを自分で作成することもできます。</p><p><img src-t="./img/recipe.png"width="509"height="301"alt="recipe.png"></p><hr><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="wnd-satellite"class="pagediv"title2="各種ウィンドウの使い方/オプション - サテライト - Tonyu1 Wiki"><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p><h3 id="各種ウィンドウの使い方オプション">各種ウィンドウの使い方/オプション</h3><h2 id="サテライト">サテライト</h2><p>マップの縮小図を表示します。 メニューの「ウィンドウ」＞「サテライト」で開くことができます。</p><p><img src-t="./img/sate.png"width="251"height="89"alt="sate.png"> ※この図は、サンプルのHockey2を開いた状態の表示です。</p><p>画面右側にマップ全体の縮小図が出ます。</p><p><span style="color:red">赤枠</span>はメインウィンドウが表示している範囲です。縮小図をクリックすることで赤枠を動かすことができます。メインウィンドウはそれに従ってスクロールします。</p><p>縮小図内で点滅する点は、オブジェクトの位置を表しています。</p><p>縮小図の表示範囲は矢印ボタン(<span style="color:#080">緑枠</span> )または<span style="color:#00f">青枠</span>の部分に数値を入力することで変更できます。</p><hr><p><a href="./wnd-use-opt">各種ウィンドウの使い方/オプション</a>&emsp;<a href="./">Wikiトップ</a></p></div><div style="display:none"id="wnd-use-opt"class="pagediv"title2="各種ウィンドウの使い方/オプション - Tonyu1 Wiki"><p><a href="./">Wikiトップ</a></p><h2 id="各種ウィンドウの使い方オプション">各種ウィンドウの使い方/オプション</h2><ul><li><a href="./wnd-code">コード補完</a></li><li><a href="./wnd-bgm">BGM・効果音</a></li><li><a href="./wnd-char">キャラクタパターン</a></li><li><a href="./wnd-map">マップ作成</a></li><li><a href="./wnd-satellite">サテライト</a></li><li><a href="./wnd-prjmgr">プロジェクトマネージャ</a></li><li><a href="./wnd-objlist">オブジェクト一覧</a></li><li><a href="./wnd-csl">コンソールウィンドウ</a></li><li><a href="./wnd-pfm">パフォーマンス</a></li><li><a href="./wnd-draw">描画方法(オプション)</a></li><li><a href="./wnd-recipe">レシピ集</a></li></ul><hr><p><a href="./">Wikiトップ</a></p></div></main></div></div><footer><hr><p>このWikiは<a href="https://www.tonyu.jp/project/userInfo.cgi?user=mkns&amp;">マッキー</a>が作成・編集し、Githubのリポジトリ「<a href="https://github.com/makkii-bcr/Tonyu1-wiki">makkii-bcr/Tonyu1-wiki</a>」で管理しています。</p></footer><script>!function(){var t="/Tonyu1-wiki";function e(t,e){for(var n=!1,a=document.getElementsByClassName("pagediv"),i=0;i<a.length;i++){var r=a[i];null!=r&&(r.id==t?(n=!0,r.style.display="block",document.title=r.attributes.title2.value,o(r)):r.style.display="none")}if(!n){var l=document.getElementById("404");l.style.display="block",document.title=l.title}}function n(t){var e,n,o=localStorage.getItem("r"),a=null;null==o?(a={r:Math.random()},localStorage.setItem("r",JSON.stringify(a))):a=JSON.parse(o),e={a:t,rf:document.referrer,r:a.r,u:navigator.userAgent,w:window.innerWidth,h:window.innerHeight,dw:window.screen.width,dh:window.screen.height,l1:navigator.language,la:navigator.languages},(n=new XMLHttpRequest).open("POST","https://mkbcr.net/api/kss/v1/kss"),n.send(JSON.stringify(e))}function o(t){for(var e=t.getElementsByTagName("img"),n=0;n<e.length;n++){var o=e[n],a=o.getAttribute("src-t");a&&o.setAttribute("src",a)}}function a(t){return"/"==t?"index":t.substring(1)}function i(e){return e.target&&location.origin==((n=e.target).origin||n.protocol+"//"+n.host)&&e.target.pathname?a(e.target.pathname.replace(t,"")):null;var n}function r(e){return e?a(e.replace(t,"")):null}var l=function(t){e(r(document.location.pathname),document.location.hash),t.preventDefault()};document.addEventListener("DOMContentLoaded",(function(t){r(document.location.pathname);setTimeout((function(){n(document.location.origin+document.location.pathname+document.location.hash)}),0),function(){for(var t=document.getElementsByTagName("a"),o=0;o<t.length;o++){var a=t[o];a.getAttribute("href")&&a.addEventListener("click",(function(t){var o=r(document.location.pathname),a=i(t),l=t.target.hash;if(setTimeout((function(){n(t.target.origin+"/"+t.target.pathname+l)}),0),a&&!a.match(/[\.\/]+/)){if(e(a),"index"==a)history.pushState(null,null,"./"+l);else{if(-1!=a.indexOf("/"))return;history.pushState(null,null,a+l)}if(t.preventDefault(),l){var u=document.getElementById(decodeURI(l.substring(1)));if(!u)return void window.scroll(0,0);var s=u.offsetTop,c=window.navigator.userAgent.toLowerCase();c.match(/msie/)||c.match(/trident/)?window.scroll(s,s):window.scroll({top:s,behavior:a==o?"smooth":"auto"})}else window.scroll(0,0)}}))}}(),void 0!==window.onpopstate?window.onpopstate=l:window.onhashchange=l}))}()</script></body></html>